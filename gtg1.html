<!DOCTYPE html>
<html>

<head>

<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* {box-sizing: border-box}

a {color: blue; outline: 0}
a:link {text-decoration: none}
a:visited {text-decoration: none}
a:hover {text-decoration: underline}
a:focus {text-decoration: underline}
a:active {text-decoration: none}

body {font-size: 110%; font-family: Helvetica}
input {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9; padding-left: 4px; padding-right: 4px; padding-top: 1px}
input[type="checkbox"] {background-color: ; transform:scale(1.5, 1.5);}
option {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9}
select {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9; padding-left: 1px; padding-right: 1px}
</style>

<title>gtg1</title>
</head>

<body>

<div id="dvDisplayBlocks">

<div id="dvBrowserSaveOuter" style="display: none; padding-left: 0.4em; padding-top: 0.4em">
  <div style="display: inline-block">
    <div><a href="javascript: browser_save__return_to_game()">return to game</a></div>
    <div style="height:0.8em"></div>
    <hr></hr>
  </div>
  <div style="height:0.6em"></div>
  <div id="dvBrowserSaveInner"></div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div><a href="javascript: browser_save__return_to_game()">return to game</a></div>
  </div>
  <div style="height:50em"></div>
  <div><a href="javascript: browser_save__delete_all_saved_data()">delete all browser saved data</a></div>
  <div style="height:1em"></div>
</div>

<div id="dvEditor_AddToLocInventory_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Add New Object To Location's Inventory</b></div>
  <div style="height:0.6em"></div>
  <div>
    Current Page/Location: <span id="spnEditor_AddToLocInventory_CurPageAndLoc"></span>
  </div>
  <div style="height:0.6em"></div>
  <div>
    Name of New Object: <input id="ipEditor_AddToLocInventory_ItmName" class="" value="" />
  </div>
  <div style="height:0.6em"></div>
  <div>
    Can Be Grabbed: <input id="ipEditor_AddToLocInventory_CanGrab" type="checkbox" class="" />
  </div>
  <div style="height:0.6em"></div>
  <div>To Show In Location Inventory, Requires Object: <span id="spnEditor_AddToLocInventory_StatusReq_ItmCodename"></span></div>
  <div style="height:0.1em"></div>
  <div>&nbsp;&nbsp;&nbsp;to have Status: <span id="spnEditor_AddToLocInventory_StatusReq_ItmStatus"></span></div>
  <div style="height:0.6em"></div>
  <div>
    Use-Receive Type: <span id="spnEditor_AddToLocInventory_Usereceivetype"></span>
  </div>
  <div id="dvEditor_AddToLocInventory_ItmThatAffects">
    <div style="height:0.6em"></div>
    <div>
      Other Object That Can Be Used Upon This: <span id="spnEditor_AddToLocInventory_ItmThatAffects"></span>
    </div>
    <div style="height:0.6em"></div>
    <div>
      Message When Use Received: <input id="ipEditor_AddToLocInventory_UseReceivedMsg" class="" value="" />
    </div>
  </div>
  <div style="height:0.6em"></div>
  <div>
    Message When Examined: <input id="ipEditor_AddToLocInventory_ExamineMsg" class="" value="" />
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__add_to_location_inventory__do_add()">add</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript: dev_editor__add_to_location_inventory__cancel_add()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_PageAdd_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Create New Page/Location</b></div>
  <div style="height:0.6em"></div>
  <div>
    Name of Page/Location: <input id="ipEditor_PageAdd_Name" class="" value="" />
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__create_new_page__do_add()">add</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript: dev_editor__create_new_page__cancel_add()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_TrAdd_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Add Text-Row</b></div>
  <div style="height:0.9em"></div>
  <div>
    Current Page/Location: <span id="spnEditor_TrAdd_CurPageAndLoc"></span>
  </div>
  <div style="height:0.9em"></div>
  <div>
    Display Text: <input id="ipEditor_TrAdd_TextOfRow" class="" value="" />
  </div>
  <div style="height:0.9em"></div>
  <div>
    Show If Which Item <span id="spnEditor_TrAdd_ItmInLocInv_IsIsNot"></span> In Location's Inventory: <span id="spnEditor_TrAdd_ItmInLocInv"></span>
  </div>
  <div style="height:0.9em"></div>
  <div>
    Show Based on Status of Which Object: <span id="spnEditor_TrAdd_ItmCodename"></span>
  </div>
  <div id="dvEditor_TrAdd_ItmStatusReq">
    <div style="height:0.3em"></div>
    <div>
      &nbsp;&nbsp;&nbsp;... Object Status Required: <span id="spnEditor_TrAdd_ItmStatusReq"></span>
    </div>
  </div>
  <div style="height:0.9em"></div>
  <div>
    Show Based on Player Status: <span id="spnEditor_TrAdd_UserInfo_InfoType"></span>
  </div>
  <div id="dvEditor_TrAdd_ExamObj_ItmCodename">
    <div style="height:0.3em"></div>
    <div>
      &nbsp;&nbsp;&nbsp;... Examined Which Object: <span id="spnEditor_TrAdd_ExamObj_ItmCodename"></span>
    </div>
  </div>
  <div style="height:0.9em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.9em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__add_text_row__do_add()">add</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript: dev_editor__add_text_row__cancel_add()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_UaAdd_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Add User-Action</b></div>
  <div style="height:0.6em"></div>
  <div>
    Current Page/Location: <span id="spnEditor_UaAdd_CurPageAndLoc"></span>
  </div>
  <div style="height:0.6em"></div>
  <div>
    Name of Action: <input id="ipEditor_UaAdd_UaText" class="" value="" />
  </div>
  <div style="height:0.6em"></div>
  <div>
    Action Type: <span id="spnEditor_UaAdd_Uatype"></span>
  </div>
  <div id="dvEditor_UaAdd_Itms">
    <div style="height:0.6em"></div>
    <div>
      Object: <span id="spnEditor_UaAdd_ItmCodename"></span>
    </div>
  </div>
  <div id="dvEditor_UaAdd_Locs">
    <div style="height:0.6em"></div>
    <div>Location: <span id="spnEditor_UaAdd_LocCodename"></span></div>
    <!--
    <div>
      <div><input id="rdEditor_UaAdd_LocCurOrNew" type="radio" class="" value="LocCur"/></div>
      <div style="height:0.1em"></div>
      <div>&nbsp;&nbsp;&nbsp;Current Location: <span id="spnEditor_UaAdd_LocCodename"></span></div>
      <div><input id="rdEditor_UaAdd_LocCurOrNew" type="radio" class="" value="LocNew" /></div>
      <div style="height:0.1em"></div>
      <div>&nbsp;&nbsp;&nbsp;New Location: <input id="ipEditor_UaAdd_UaText" class="" value="" /></div>
    </div>
    -->
  </div>
  <div id="dvEditor_UaAdd_statusReq">
    <div style="height:0.6em"></div>
    <div>
      Also Requires Object: <span id="spnEditor_UaAdd_StatusReq_ItmCodename"></span>&nbsp;&nbsp;to have Status: <span id="spnEditor_UaAdd_StatusReq_ItmStatus"></span>
    </div>
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__add_user_action__do_add()">add</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript: dev_editor__add_user_action__cancel_add()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_UaDelete_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Confirm Deletion of User-Action</b></div>
  <div style="height:0.6em"></div>
  <div>
    Current Page/Location: <span id="spnEditor_UaDelete_CurPageAndLoc"></span>
  </div>
  <div style="height:0.6em"></div>
  <div>
    User-Action Name: <span id="spnEditor_UaDelete_UaText" class=""></span>
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__delete_user_action__do_delete()">confirm deletion</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aEditor_UaDelete_cancelDelete" href="javascript: dev_editor__delete_user_action__cancel_delete()">cancel deletion</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_UaEdit_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>Edit User-Action</b></div>
  <div style="height:0.6em"></div>
  <div>
    Current Page/Location: <span id="spnEditor_UaEdit_CurPageAndLoc"></span>
  </div>
  <div style="height:0.6em"></div>
  <div>
    New Name for Action: <input id="ipEditor_UaEdit_UaText" class="" value="" />
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__edit_user_action__do_edit()">add</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript: dev_editor__edit_user_action__cancel_edit()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvEditor_ViewAllPages_Outer" style="padding-left: 0.4em; padding-top: 0.4em">
  <div><b>All Pages For Game</b></div>
  <div style="height:0.6em"></div>
  <div>
    Game: <span id="spnEditor_ViewAllPages_GameName" class=""></span>
  </div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: dev_editor__delete_user_action__do_delete()">confirm deletion</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aEditor_UaDelete_cancelDelete" href="javascript: dev_editor__delete_user_action__cancel_delete()">cancel deletion</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvGameOuter" style="padding-left: 1em; padding-top: 1em">
  <div id="dvGameInner_Page"></div>
  <div style="height:1.5em"></div>
  <div id="dvGameInner_Dev"></div>
  <div style="height:2em"></div>
</div>

<div id="dvUseItm_Outer" style="padding-left: 1em; padding-top: 1em">
  <div>
    Current Page/Location: <span id="spnUseItm_CurPageAndLoc"></span>
  </div>
  <div style="height:0.6em"></div>
  <div><b>Use Object:</b> <span id="spnUseItm_Name"></span></div>
  <div style="height:1.2em"></div>
  <div>... on an item in the current location:</div>
  <div style="height:0.6em"></div>
  <div id="dvUseItm_LocItms" class=""></div>
  <div style="height:1.2em"></div>
  <div>... or on an item in your inventory:</div>
  <div style="height:0.6em"></div>
  <div id="dvUseItm_UserEntItms" class=""></div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: return_to_user_inventory()">cancel</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

<div id="dvUserInventory_Outer" style="padding-left: 1em; padding-top: 1em">
  <div><b>Your Inventory</b></div>
  <div style="height:0.6em"></div>
  <div id="dvUserInventory_Inner" class=""></div>
  <div style="height:0.6em"></div>
  <div style="display: inline-block">
    <hr></hr>
    <div style="height:0.8em"></div>
    <div>
      <a style="white-space: nowrap" href="javascript: return_from_user_inventory()">done</a>
    </div>
  </div>
  <div style="height:2em"></div>
</div>

</div>

<script type="text/javascript">

"use strict";


// CONSTANTS
const C_altFilterOpt_exists = "exists";

const C_appSetting_defaultGameCodename = "defaultGameCodename";
const C_appSetting_dev = "dev";
const C_appSetting_dev_hideEditor = "dev_hideEditor";
const C_appSetting_narrow = "narrow";
const C_appSetting_LS = "LS";

const C_att_canGrab = "canGrab";
const C_att_curPageCodename = "curPageCodename"
const C_att_entCodename = "entCodename";
const C_att_examineMsg = "examineMsg";
const C_att_gameCodename = "gameCodename";
const C_att_info = "info";
const C_att_inventory = "inventory";
const C_att_isUser = "isUser";
const C_att_itmCodename = "itmCodename";
const C_att_itmInLocInv = "itmInLocInv";
const C_att_itmInLocInv_isIsNot = "itmInLocInv_isIsNot";
const C_att_itmStatusReq = "itmStatusReq";
const C_att_itmThatAffects = "itmThatAffects";
const C_att_locCodename = "locCodename";
const C_att_locName = "locName";
const C_att_name = "name";
const C_att_pageCodename = "pageCodename";
const C_att_relatedTypecode1 = "relatedTypecode1";
const C_att_relatedCodename1 = "relatedCodename1";
const C_att_relatedTypecode2 = "relatedTypecode2";
const C_att_relatedCodename2 = "relatedCodename2";
const C_att_startLocCodename = "startLocCodename";
const C_att_startPageCodename = "startPageCodename"
const C_att_startStatus = "startStatus";
const C_att_status = "status";
const C_att_infooptionset = "infooptionset";
const C_att_statusReq_itmCodename = "statusReq_itmCodename";
const C_att_statusReq_itmStatus = "statusReq_itmStatus";
const C_att_infotype = "infotype";
const C_att_textOfRow = "textOfRow";
const C_att_trCodename = "trCodename";
const C_att_uaCodename = "uaCodename";
const C_att_uaText = "uaText";
const C_att_uatype = "uatype";
const C_att_useReceivedMsg = "useReceivedMsg";
const C_att_usereceivetype = "usereceivetype";

const C_displayVarStub_locAtt = "LOC_ATT";

const C_displayVar_you = "YOU";
const C_displayVar_curLoc = "CUR_LOC";

const C_info_no = "no";
const C_info_yes = "yes";

const C_infooptionset_custom = "custom";
const C_infooptionset_yesNo = "yesNo";

const C_infotype_custom = "custom"; //not implemented yet -- NOTE: no commas allowed in custom infotype names
const C_infotype_itmExam = "itmExam";

const C_locCodename_cozyRoom = "cozy room";
const C_locCodename_scaryRoom = "scary room";

const C_misc_codename = "codename";
const C_misc_is = "is";
const C_misc_isNot = "is not";
const C_misc_userCodename = "user";
const C_misc_userDefName = "You";

const C_saveTypeName_appSetting = "appSetting";
const C_saveTypeName_entity = "entity";
const C_saveTypeName_game = "game";
const C_saveTypeName_location = "location";
const C_saveTypeName_page = "page";
const C_saveTypeName_unknown = "unknown";

const C_spacerHeight = "0.5em"

const C_status_closed = "closed";
const C_status_locked = "locked";
const C_status_open = "open";
const C_status_unlocked = "unlocked";

const C_typecode_appSetting = "appSetting";
const C_typecode_ent = "E";
const C_typecode_entinfo = "ei";
const C_typecode_entinfoData = "eid";
const C_typecode_game = "G";
const C_typecode_itm = "Itm";
const C_typecode_loc = "L";
const C_typecode_page = "P";
const C_typecode_tr = "tr";
const C_typecode_trcond = "trcond";
const C_typecode_ua = "ua";
const C_typecode_uacond = "uacond";

const C_uatype_examine = "examine";
const C_uatype_grabItm = "grabItm";
const C_uatype_moveToLoc = "moveToLoc";

const C_userAction_changeYourName = "change your name";
const C_userAction_goToInfo = "go to info";
const C_userAction_goToPage = "go to page"
const C_userAction_openInventory = "open your inventory";

const C_usereceivetype_closedOpen = "closedOpen";
const C_usereceivetype_lockedUnlocked = "lockedUnlocked";


// APP-LEVEL VARIABLES

const APP = {};
APP.allGameBrSvObjs = [];
APP.curGameObj = null;
APP.curItmObj = null;
APP.curPageObj = null;
APP.dev = "0";
APP.dev_hideEditor = "0";
APP.editor_curUaCodename = null;
APP.sort_addedTextForNum = null;
APP.userEntObj = null;


// INTERNAL FUNCTIONS

function addLocationAtt(pageObj, locCodename, att, defaultVal) {
  var locAttVal = getLocationAttFromBrowserSave(locCodename, att);

  if ( isBlank(locAttVal) ) {
    locAttVal = defaultVal;
    setLocationAttInBrowserSave(locCodename, att, locAttVal);
  }

  pageObj[att] = locAttVal;
}

function addPageAction(page, actionName, actionLinkText, actionVar1) {
  var action = {};

  action.name = actionName;
  action.linkText = actionLinkText;

  if (actionVar1 == "" || ! isBlank(actionVar1) ) {
    action.var1 = actionVar1;
  } else {
    action.var1 = "";
  }

  page.actions.push(action);
}

function addPageTextRow(page, textOfRow, spacesDown) {
  var textRow = {};

  textRow.textOfRow = textOfRow;
  textRow.spacesDown = spacesDown;

  page.textRows.push(textRow);
}

function changeLocAtt(pageObj, att, newVal) {
  setLocationAttInBrowserSave(pageObj.name, att, newVal);
  pageObj[att] = newVal;
}

// the daX and dcX functions are using "x = function(y) {}" syntax, so that we can e.g. do the frequent search for "dc ("  [without the space]  without finding the called function
const da = function(text) {
  alert(text);
};

const da_ = function() {
  // (same note as function dc)
}

const dc = function(text1, text2, text3, text4, text5, text6, text7, text8, text9, text10) {
  var str = "";

  if ( text1 === undefined ) {
  } else {
    str += text1;
  }

  if ( text2 === undefined ) {
  } else {
    str += " ----- " + text2;
  }

  if ( text3 === undefined ) {
  } else {
    str += " ----- " + text3;
  }

  if ( text4 === undefined ) {
  } else {
    str += " ----- " + text4;
  }

  if ( text5 === undefined ) {
  } else {
    str += " ----- " + text5;
  }

  if ( text6 === undefined ) {
  } else {
    str += " ----- " + text6;
  }

  if ( text7 === undefined ) {
  } else {
    str += " ----- " + text7;
  }

  if ( text8 === undefined ) {
  } else {
    str += " ----- " + text8;
  }

  if ( text9 === undefined ) {
  } else {
    str += " ----- " + text9;
  }

  if ( text10 === undefined ) {
  } else {
    str += " ----- " + text10;
  }

  console.log(str);
}

const dc_ = function() {
  // this blank function exists to give the developer an option to change dc ("some text here") to dc_ ("some text here")  [keep space between "dc" and "(" to avoid this comment popping up with Ctrl-F]
  // , as a way to remove the console.log action that occurs via calling dc ()
  // , but without having to comment out the line via //dc ("some text here")
  //
  // --> allows searching for "dc ("  [without the space]  to determine whether there are any stray console.log calls that will occur when running the code
};

const dc2 = function(varName) {
  dc ( varName, eval(varName) );
};

function deleteFromBrowserSave_multiple(typecodeToDelete, codenameToDelete) {
  for (var i = 0; i < localStorage.length; i++) {
    let keyName = localStorage.key(i);
    let bskParts = keyName.split(":");

    let curTypecode = bskParts[0];
    let curCodename = bskParts[1];

    if ( isEqual(curTypecode, typecodeToDelete) && isEqual(curCodename, codenameToDelete) ) {
      localStorage.removeItem(keyName);
    }
  }
}

function deleteFromBrowserSave_singleRow(typecode, codename, att) {
  var bsk = getBrowserSaveKey(typecode, codename, att);
  localStorage.removeItem(bsk);
}

function devEditor_addToLocInventory() {
  var usereceivetypeObjs, htmlSel_usereceivetypes, htmlSel_itms, htmlSel_itms_statusReq;

  hideAllDisplays();

  elem("spnEditor_AddToLocInventory_CurPageAndLoc").innerHTML = APP.curPageObj.getCurPageAndLoc();

  elem("ipEditor_AddToLocInventory_ItmName").value = "";
  elem("ipEditor_AddToLocInventory_UseReceivedMsg").value = "";
  elem("ipEditor_AddToLocInventory_ExamineMsg").value = "";
  elem("ipEditor_AddToLocInventory_CanGrab").checked = false;

  usereceivetypeObjs = getUsereceivetypesObjAy();
  htmlSel_usereceivetypes = getHtml_sel("selEditor_AddToLocInventory_Usereceivetype", true, usereceivetypeObjs, null, "width: 2in", "devEditor_addToLocInventory_changeUsereceivetype()", null, false, undefined, undefined, undefined);
  elem("spnEditor_AddToLocInventory_Usereceivetype").innerHTML = htmlSel_usereceivetypes;

  htmlSel_itms_statusReq = getHtml_sel("selEditor_AddToLocInventory_StatusReq_ItmCodename", true, APP.curGameObj.getAllItmObjs(false, true, true), null, "width: 2in", "devEditor_addToLocInventory_changeStatusReq_itmCodename()", null, false, undefined, "name2", undefined);
  elem("spnEditor_AddToLocInventory_StatusReq_ItmCodename").innerHTML = htmlSel_itms_statusReq;
  devEditor_addToLocInventory_changeStatusReq_itmCodename();

  htmlSel_itms = getHtml_sel("selEditor_AddToLocInventory_ItmThatAffects", true, APP.curGameObj.getAllItmObjs(true, false, true), null, "width: 2in", null, null, false, undefined, "name2", undefined);
  elem("spnEditor_AddToLocInventory_ItmThatAffects").innerHTML = htmlSel_itms;
  devEditor_addToLocInventory_changeUsereceivetype();

  elem("dvEditor_AddToLocInventory_Outer").style.display = "";
  elem("ipEditor_AddToLocInventory_ItmName").focus();
}

function devEditor_addToLocInventory_changeStatusReq_itmCodename() {
  var statusReq_itmCodename, itmStatusObjAy, htmlSel_statusReq_status;

  statusReq_itmCodename = getElemVal("selEditor_AddToLocInventory_StatusReq_ItmCodename");

  if ( isBlank(statusReq_itmCodename) ) {
    elem("spnEditor_AddToLocInventory_StatusReq_ItmStatus").innerHTML = "---";
  } else {
    let itmObj = getItmObj(statusReq_itmCodename);
    itmStatusObjAy = getItmStatusObjAy_fromUsereceivetype(itmObj.usereceivetype);
    htmlSel_statusReq_status = getHtml_sel("selEditor_AddToLocInventory_StatusReq_ItmStatus", true, itmStatusObjAy, null, "width: 2in");
    elem("spnEditor_AddToLocInventory_StatusReq_ItmStatus").innerHTML = htmlSel_statusReq_status;
  }
}

function devEditor_addToLocInventory_changeUsereceivetype() {
  var usereceivetype = getElemVal("selEditor_AddToLocInventory_Usereceivetype");

  elem("dvEditor_AddToLocInventory_ItmThatAffects").style.display = "none";

  if ( ! isBlank(usereceivetype) ) {
    elem("dvEditor_AddToLocInventory_ItmThatAffects").style.display = "";
  }
}

function devEditor_pageAdd() {
  hideAllDisplays();

  elem("ipEditor_PageAdd_Name").value = "";

  elem("dvEditor_PageAdd_Outer").style.display = "";
  elem("ipEditor_PageAdd_Name").focus();
}

function devEditor_trAdd() {
  var htmlSel_itms_checkLocInv_isIsNot, htmlSel_itms_checkLocInv, htmlSel_itms_checkStatus, infotypeObjs, htmlSel_infotypes, htmlSel_itms_examObj;

  hideAllDisplays();

  elem("spnEditor_TrAdd_CurPageAndLoc").innerHTML = APP.curPageObj.getCurPageAndLoc();

  elem("ipEditor_TrAdd_TextOfRow").value = "";

  htmlSel_itms_checkLocInv_isIsNot = getHtml_sel("selEditor_TrAdd_ItmInLocInv_IsIsNot", false, getIsIsNotObjAy(), C_misc_is, null, null, null, false, undefined, undefined, undefined);
  elem("spnEditor_TrAdd_ItmInLocInv_IsIsNot").innerHTML = htmlSel_itms_checkLocInv_isIsNot;

  htmlSel_itms_checkLocInv = getHtml_sel("selEditor_TrAdd_ItmInLocInv", true, APP.curGameObj.getAllItmObjs(true, false, true), null, null, "devEditor_trAdd_changeItm()", null, false, undefined, "name2", undefined);
  elem("spnEditor_TrAdd_ItmInLocInv").innerHTML = htmlSel_itms_checkLocInv;

  htmlSel_itms_checkStatus = getHtml_sel("selEditor_TrAdd_ItmCodename", true, APP.curGameObj.getAllItmObjs(false, true, true), null, null, "devEditor_trAdd_changeItm()", null, false, undefined, "name2", undefined);
  elem("spnEditor_TrAdd_ItmCodename").innerHTML = htmlSel_itms_checkStatus;

  infotypeObjs = getInfotypeObjAy();
  htmlSel_infotypes = getHtml_sel("selEditor_TrAdd_UserInfo_InfoType", true, infotypeObjs, C_info_yes, null, "devEditor_trAdd_changeInfotype()", null, false, undefined, undefined, undefined);
  elem("spnEditor_TrAdd_UserInfo_InfoType").innerHTML = htmlSel_infotypes;

  htmlSel_itms_examObj = getHtml_sel("selEditor_TrAdd_ExamObj_ItmCodename", true, APP.curGameObj.getAllItmObjs(false, false, true), null, null, "devEditor_trAdd_changeItm()", null, false, undefined, "name2", undefined);
  elem("spnEditor_TrAdd_ExamObj_ItmCodename").innerHTML = htmlSel_itms_examObj;

  elem("selEditor_TrAdd_UserInfo_InfoType").value = "";
  elem("selEditor_TrAdd_ExamObj_ItmCodename").value = "";

  devEditor_trAdd_changeItm();
  devEditor_trAdd_changeInfotype();

  elem("dvEditor_TrAdd_Outer").style.display = "";
  elem("ipEditor_TrAdd_TextOfRow").focus();
}

function devEditor_trAdd_changeInfotype() {
  var infotype;

  hideElem("dvEditor_TrAdd_ExamObj_ItmCodename");

  infotype = getElemVal("selEditor_TrAdd_UserInfo_InfoType");

  switch (infotype) {
    case C_infotype_itmExam:
      showElem("dvEditor_TrAdd_ExamObj_ItmCodename");
      break;
  }
}

function devEditor_trAdd_changeItm() {
  var itmCodename, itmObj, itmStatusObjs, htmlSel_itmStatusReq;

  elem("dvEditor_TrAdd_ItmStatusReq").style.display = "none";

  itmCodename = getElemVal("selEditor_TrAdd_ItmCodename");

  if ( isBlank(itmCodename) ) {
    return;
  }

  itmObj = getItmObj(itmCodename);

  if ( isBlank(itmObj.usereceivetype) ) {
    return;
  }

  itmStatusObjs = getItmStatusObjAy_fromUsereceivetype(itmObj.usereceivetype);
  htmlSel_itmStatusReq = getHtml_sel("selEditor_TrAdd_ItmStatusReq", true, itmStatusObjs, null, "width: 2in", undefined, undefined, undefined);
  elem("spnEditor_TrAdd_ItmStatusReq").innerHTML = htmlSel_itmStatusReq;
  elem("dvEditor_TrAdd_ItmStatusReq").style.display = "";
}

function devEditor_uaAdd() {
  var uatypesObjs, htmlSel_uatypes, allGameLocObjs, htmlSel_locs, htmlSel_itms_statusReq;
  var htmlSel_status;

  hideAllDisplays();

  elem("spnEditor_UaAdd_CurPageAndLoc").innerHTML = APP.curPageObj.getCurPageAndLoc();

  elem("ipEditor_UaAdd_UaText").value = "";

  uatypesObjs = getUatypesObjAy();
  htmlSel_uatypes = getHtml_sel("selEditor_UaAdd_Uatype", true, uatypesObjs, null, "width: 2in", "devEditor_uaAdd_changeUatype()", null, false, undefined, undefined, undefined);
  elem("spnEditor_UaAdd_Uatype").innerHTML = htmlSel_uatypes;
  
  allGameLocObjs = APP.curGameObj.getAllLocObjs(true);
  htmlSel_locs = getHtml_sel("selEditor_UaAdd_LocCodename", true, allGameLocObjs, null, "width: 2in", undefined, undefined, undefined);
  elem("spnEditor_UaAdd_LocCodename").innerHTML = htmlSel_locs;

  htmlSel_itms_statusReq = getHtml_sel("selEditor_UaAdd_StatusReq_ItmCodename", true, APP.curGameObj.getAllItmObjs(false, true, true), null, "width: 2in", "devEditor_uaAdd_changeStatusReq_itmCodename()", null, false, undefined, "name2", undefined);
  elem("spnEditor_UaAdd_StatusReq_ItmCodename").innerHTML = htmlSel_itms_statusReq;

  devEditor_uaAdd_changeUatype();
  devEditor_uaAdd_changeStatusReq_itmCodename();

  elem("dvEditor_UaAdd_Outer").style.display = "";
  elem("ipEditor_UaAdd_UaText").focus();
}

function devEditor_uaAdd_changeStatusReq_itmCodename() {
  var statusReq_itmCodename, itmStatusObjAy, htmlSel_statusReq_status;

  statusReq_itmCodename = getElemVal("selEditor_UaAdd_StatusReq_ItmCodename");

  if ( isBlank(statusReq_itmCodename) ) {
    elem("spnEditor_UaAdd_StatusReq_ItmStatus").innerHTML = "---";
  } else {
    let itmObj = getItmObj(statusReq_itmCodename);
    itmStatusObjAy = getItmStatusObjAy_fromUsereceivetype(itmObj.usereceivetype);
    htmlSel_statusReq_status = getHtml_sel("selEditor_UaAdd_StatusReq_ItmStatus", true, itmStatusObjAy, null, "width: 2in", undefined, undefined, undefined);
    elem("spnEditor_UaAdd_StatusReq_ItmStatus").innerHTML = htmlSel_statusReq_status;
  }
}

function devEditor_uaAdd_changeUatype() {
  var uatype = getElemVal("selEditor_UaAdd_Uatype");

  elem("dvEditor_UaAdd_Itms").style.display = "none";
  elem("dvEditor_UaAdd_Locs").style.display = "none";
  elem("dvEditor_UaAdd_statusReq").style.display = "none";

  switch(uatype) {

    case C_uatype_examine:
      {
        let htmlSel_itms_all = getHtml_sel("selEditor_UaAdd_ItmCodename", true, APP.curGameObj.getAllItmObjs(false, false, true), null, "width: 2in", null, null, false, undefined, "name2", undefined);
        elem("spnEditor_UaAdd_ItmCodename").innerHTML = htmlSel_itms_all;

        elem("dvEditor_UaAdd_Itms").style.display = "";
        break;
      }

    case C_uatype_grabItm:
      {
        let htmlSel_itms_canGrab = getHtml_sel("selEditor_UaAdd_ItmCodename", true, APP.curGameObj.getAllItmObjs(true, false, true), null, "width: 2in", null, null, false, undefined, "name2", undefined);
        elem("spnEditor_UaAdd_ItmCodename").innerHTML = htmlSel_itms_canGrab;

        elem("dvEditor_UaAdd_Itms").style.display = "";
        break;
      }

    case C_uatype_moveToLoc:
      elem("dvEditor_UaAdd_Locs").style.display = "";
      break;

  }

  if ( ! isBlank(uatype) ) {
    elem("dvEditor_UaAdd_statusReq").style.display = "";
  }
}

function devEditor_uaDelete() {
  var uaObj;

  hideAllDisplays();

  elem("spnEditor_UaDelete_CurPageAndLoc").innerHTML = APP.curPageObj.getCurPageAndLoc();

  uaObj = APP.curPageObj.getUaObj(APP.editor_curUaCodename);
  elem("spnEditor_UaDelete_UaText").innerHTML = uaObj.uaText;

  elem("dvEditor_UaDelete_Outer").style.display = "";

  elem("aEditor_UaDelete_cancelDelete").focus();
}

function devEditor_uaEdit(uaCodename) {
}

function didCondFail(condObj) {

  switch (condObj.infotype) {

    case C_infotype_itmExam:
      {
        let entObj, itmObj, eidObj;
dc("condObj.infotype",condObj.infotype)
        entObj = getEntObj(condObj.relatedCodename1);
        itmObj = getItmObj(condObj.relatedCodename2);

        eidObj = findEntinfoDataObj(itmObj.codename, C_infotype_itmExam, C_typecode_itm, itmObj.codename, condObj.info)

        if (eidObj == null) {
dc("eidObj == null")
          return true;
        } else {
dc("eidObj.codename",eidObj.codename)
          return false;
        }
      }
      break;
  }

  return false;
}

function didCondPass(condObj) {
  return ! didCondFail(condObj);
}

function displayBrowserSave() {
  hideAllDisplays();
  writeBrowserSavedData();
  elem("dvBrowserSaveOuter").style.display = "";
}

function displayPage(pageObj) {
  var displayText = "";

  hideAllDisplays();

  if (pageObj) {
    pageObj.init();
    displayText = getHtml_pageDisplay(pageObj);
  } else {
    displayText = "ERROR: could not load game page";
  }

  elem("dvGameInner_Page").innerHTML = displayText;
  elem("dvGameOuter").style.display = "";
}

function displayUseItm(codename) {
  var curLocObj;

  hideAllDisplays();

  elem("spnUseItm_CurPageAndLoc").innerHTML = APP.curPageObj.getCurPageAndLoc();

  APP.curItmObj = getItmObj(codename);
  
  elem("spnUseItm_Name").innerHTML = APP.curItmObj.name;

  curLocObj = APP.curPageObj.getLocObj();
  elem("dvUseItm_LocItms").innerHTML = curLocObj.getInventoryListHtml("receive_use_from_object", false, true);

  elem("dvUseItm_UserEntItms").innerHTML = APP.userEntObj.getInventoryListHtml(false, "receive_use_from_object");

  elem("dvUseItm_Outer").style.display = "";
}

function displayUserInventory() {
  var htmlList;

  hideAllDisplays();

  htmlList = APP.userEntObj.getInventoryListHtml(true, null)
  elem("dvUserInventory_Inner").innerHTML = htmlList;

  elem("dvUserInventory_Outer").style.display = "";
}

function doesObjArrayHaveElem(theArray, propName, propValToMatch) {
  for (var i = 0; i < theArray.length; i++) {

    if ( ! doesObjHaveProp(theArray[i],propName) ) {
      continue;
    }

    if ( isEqual(theArray[i][propName], propValToMatch) ) {
      return true;
    }
  }

  return false;
}

function doesObjHaveProp(obj, propName) {
  if (obj == null) {
    return false;
  }

  if ( obj[propName] === undefined ) {
    return false;
  } else {
    return true;
  }

  /* test code for this function:

  var x;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("1-true"); } else { dc_("1-false"); }

  x = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("2-true"); } else { dc_("2-false"); }

  x = 123;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("3-true"); } else { dc_("3-false"); }

  x = "abc";
  if ( doesObjHaveProp(x, "prop1") ) { dc_("4-true"); } else { dc_("4-false"); }

  x = {};
  if ( doesObjHaveProp(x, "prop1") ) { dc_("5-true"); } else { dc_("5-false"); }

  x.prop0 = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("6-true"); } else { dc_("6-false"); }

  x.prop1 = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("7-true"); } else { dc_("7-false"); }

  x.prop1 = "a";
  if ( doesObjHaveProp(x, "prop1") ) { dc_("8-true"); } else { dc_("8-false"); }

  */
}

function elem(elemId) {
  return document.getElementById(elemId);
}

function existsInBrowserSave(typecode, codename, att) {
  var bsk = getBrowserSaveKey(typecode, codename, att);
  var val = localStorage.getItem(bsk);

  if (val == null) {
    return false;
  } else {
    return true;
  }
}

function findEntinfoDataObj(entCodename, infotype, relatedTypecode1_toFind, relatedCodename1_toFind, info_toFind = null) {
  var codenameLeft, brSvObjs_codenames, i;

  codenameLeft = getCodenameLeft(entCodename);

dc("C_typecode_entinfoData",C_typecode_entinfoData)
dc("C_att_infotype",C_att_infotype)
dc("infotype",infotype)
dc("codenameLeft",codenameLeft)
  brSvObjs_codenames = getBrSvObjsFromBrSv(C_typecode_entinfoData, null, C_att_infotype, infotype, codenameLeft);
dc("brSvObjs_codenames.length",brSvObjs_codenames.length)

  brSvObjs_codenames.forEach( (brSvObjs_codename) => {
    let curEidCodename = brSvObjs_codename.codename;

    let relatedTypecode1_cur = getFromBrSv_valFromAtt(C_typecode_entinfoData, curEidCodename, C_att_relatedTypecode1);
    let relatedCodename1_cur = getFromBrSv_valFromAtt(C_typecode_entinfoData, curEidCodename, C_att_relatedCodename1);

    let relatedTypeCode1_isEqual = isEqual(relatedTypecode1_cur, relatedTypecode1_toFind);
    let relatedCodename1_isEqual = isEqual(relatedCodename1_cur, relatedCodename1_toFind);

    let curIsMatch = false;

    if ( info_toFind == null ) {

      if ( relatedTypeCode1_isEqual && relatedCodename1_isEqual ) {
        curIsMatch = true;
      }

    } else {

      let info_cur = getFromBrSv_valFromAtt(C_typecode_entinfoData, curEidCodename, C_att_info);
      let relatedInfo_isEqual = isEqual(info_cur, info_toFind);

      if ( relatedTypeCode1_isEqual && relatedCodename1_isEqual && relatedInfo_isEqual ) {
        curIsMatch = true;
      }
    }

    if (curIsMatch) {
      let eidObj = getEntinfoDataObj(curEidCodename);
      return eidObj;
    }
  } );

  return null;
}

function getAndMakeNewEnt(gameObj = APP.curGameObj, name, nameToUseForCodenameGenerator = null, isUser, locCodename, startLocCodename) {
  var nameToSendToGetCodename, codename, entObj;

  if ( isBlank(nameToUseForCodenameGenerator) ) {
    nameToSendToGetCodename = name;
  } else {
    nameToSendToGetCodename = nameToUseForCodenameGenerator;
  }

  codename = getCodenameFromGameAndName(gameObj, nameToSendToGetCodename, C_typecode_ent, false);

  var entObj = getEntObj(codename, gameObj.codename, name, isUser, locCodename, null, startLocCodename);

  entObj.saveToBrowser();

  return entObj;
}

function getAndMakeNewEntinfo(entCodename, infotype, info) {
  var codename, entinfoObj;

  codename = getNextSortedCodename(C_typecode_entinfo, entCodename, null, C_att_infotype, null);

  entinfoObj = getEntinfoObj(codename, entCodename, infotype, info);

  entinfoObj.saveToBrowser();

  return entinfoObj;
}

function getAndMakeNewEntinfoData(entCodename, infotype, relatedTypecode1, relatedCodename1, info) {
  var codename, entinfoDataObj;

  codename = getNextSortedCodename(C_typecode_entinfoData, entCodename, null, C_att_infotype, null);

  entinfoDataObj = getEntinfoDataObj(codename, entCodename, infotype, relatedTypecode1, relatedCodename1, info);

  entinfoDataObj.saveToBrowser();

  return entinfoDataObj;
}

function getAndMakeNewGame(codename, name) {
  var gameObj;

  if ( isBlank(codename) ) {
    codename = getCodenameFromGameAndName(null, name, C_typecode_game, true);
  }

  gameObj = getGameObj(codename, name);

  gameObj.saveToBrowser();

  return gameObj;
}

function getAndMakeNewItm(gameObj = APP.curGameObj, name, canGrab, startLocCodename, usereceivetype, startStatus, status, itmThatAffects, useReceivedMsg, statusReq_itmCodename, statusReq_itmStatus, examineMsg) {
  var codename, itmObj;

  codename = getCodenameFromGameAndName(gameObj, name, C_typecode_itm, false);

  itmObj = getItmObj(codename, gameObj.codename, name, canGrab, startLocCodename, usereceivetype, startStatus, status, itmThatAffects, useReceivedMsg, statusReq_itmCodename, statusReq_itmStatus, examineMsg);

  itmObj.saveToBrowser();

  return itmObj;
}

function getAndMakeNewLoc(gameObj = APP.curGameObj, name, pageCodename) {
  var codename, locObj;

  codename = getCodenameFromGameAndName(gameObj, name, C_typecode_loc, false);

  locObj = getLocObj(codename, gameObj.codename, name, pageCodename);

  locObj.saveToBrowser();

  return locObj;
}

function getAndMakeNewPage(gameObj = APP.curGameObj, name, locCodename, isNewLoc) {
  var codename, pageObj, firstTrObj;

  codename = getCodenameFromGameAndName(gameObj, name, C_typecode_page, false);

  if (isNewLoc) {
    getAndMakeNewLoc(undefined, name, codename);
    locCodename = codename;
  }

  pageObj = getPageObj(codename, gameObj.codename, name, locCodename);

  pageObj.saveToBrowser();

  getAndMakeNewTr( pageObj, "You are in " + name.toLowerCase() );

  pageObj.init();

  return pageObj;
}

function getAndMakeNewTr(pageObj = APP.curPageObj, textOfRow, itmCodename, itmStatusReq, itmInLocInv, itmInLocInv_isIsNot) {
  var codename, trObj;

  codename = getNextSortedCodename(C_typecode_tr, pageObj.codename, null, C_att_textOfRow, null);

  trObj = getTrObj(codename, pageObj.codename, textOfRow, itmCodename, itmStatusReq, itmInLocInv, itmInLocInv_isIsNot);

  pageObj.receiveTrObj(trObj);

  trObj.saveToBrowser();

  return trObj;
}

function getAndMakeNewTrcond(trObj, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info) {
  var codename, trcondObj;

  codename = getNextSortedCodename(C_typecode_trcond, trObj.codename, null, C_att_infotype, null);

  trcondObj = getTrcondObj(codename, trObj.codename, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info)

  trObj.receiveTrcondObj(trcondObj);

  trcondObj.saveToBrowser();

  return trcondObj;
}

function getAndMakeNewUa(pageObj = APP.curPageObj, uaText, uatype, itmCodename, locCodename, statusReq_itmCodename, statusReq_itmStatus) {
  var codename, uaObj;

  codename = getNextSortedCodename(C_typecode_ua, pageObj.codename, null, C_att_uaText, null);

  uaObj = getUaObj(codename, pageObj.codename, uaText, uatype, itmCodename, locCodename, statusReq_itmCodename, statusReq_itmStatus);

  pageObj.receiveUaObj(uaObj);

  uaObj.saveToBrowser();

  return uaObj;
}

function getAndMakeNewUacond(uaObj, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info) {
  var codename, uacondObj;

  codename = getNextSortedCodename(C_typecode_uacond, uaObj.codename, null, C_att_infotype, null);

  uacondObj = getUacondObj(codename, uaObj.codename, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info)

  uaObj.uaCondObjs.push(uacondObj);

  uacondObj.saveToBrowser();

  return uacondObj;
}

function getAppSetting(settingName) {
  var val = getFromBrSv_valFromAtt(C_typecode_appSetting, settingName, null);
  return val;
}

function getAsOneZero(val) {
  if (val == "1") {
    return "1";
  }

  if (val === 1) {
    return "1";
  }

  if (val == "0") {
    return "0";
  }

  if (val === 0) {
    return "0";
  }

  if ( isTrue(val) ) {
    return "1";
  }

  return "0";
}

function getBrowserSaveKey(typecode, codename, att) {
  var bsk, codename_processed, att_processed;
  
  bsk = typecode + ":";

  codename_processed = getProcessedSaveText(codename);

  bsk += codename_processed

  if ( ! isEqual(typecode, C_typecode_appSetting) ) {
    att_processed = getProcessedSaveText(att);
    bsk += ":" + att_processed;
  }

  return bsk;
}

function getBrowserSaveObj(keyName, keyValue) {
  var brSvObj = {};
  var bskParts = keyName.split(":");

  brSvObj.typecode = bskParts[0];
  brSvObj.codename = bskParts[1];
  
  if (bskParts.length > 2) {
    brSvObj.att = bskParts[2];
  } else {
    brSvObj.att = null;
  }

  brSvObj.val = keyValue;

  return brSvObj;
}

function getBrSvObjsFromBrSv(typecode, codename, att, val, codenameLeft) {
if (codenameLeft == "game-1,note-1,") dc_(">>>> entered getBrSvObjsFromBrSv()")
  var brSvObjAy = [];
  var typecodeCheckPassed, codenameCheckPassed, attCheckPassed, valCheckPassed, codenameLeftCheckPassed;

  for (var i = 0; i < localStorage.length; i++) {
    typecodeCheckPassed = false, codenameCheckPassed = false, attCheckPassed = false, valCheckPassed = false, codenameLeftCheckPassed = false;

    let keyName = localStorage.key(i);
    let keyValue = localStorage.getItem(keyName);

    let brSvObj = getBrowserSaveObj(keyName, keyValue);
if (codenameLeft == "game-1,note-1,") dc_(">>>> brSvObj.codename="+brSvObj.codename)
if (codenameLeft == "game-1,note-1,") dc_("-- " + keyName, localStorage.getItem(keyName))

    if ( isBlank(typecode) ) {
      typecodeCheckPassed = true;
    } else {
      if ( isEqual(brSvObj.typecode, typecode) ) {
if (codenameLeft == "game-1,note-1,") dc_("typecode check found & passed", typecode)
        typecodeCheckPassed = true;
      } else {
if (codenameLeft == "game-1,note-1,") dc_("typecode check found & failed", typecode)
      }
    }

    if (typecodeCheckPassed) {
      if ( isBlank(codename) ) {
        codenameCheckPassed = true;
      } else {
        if ( isEqual(brSvObj.codename, codename) ) {
if (codenameLeft == "game-1,note-1,") dc_("codename check found & passed", codename)
          codenameCheckPassed = true;
        } else {
if (codenameLeft == "game-1,note-1,") dc_("codename check found & failed", codename)
        }
      }
    }

    if (typecodeCheckPassed && codenameCheckPassed) {
      if ( isBlank(att) ) {
        attCheckPassed = true;
      } else {
        if ( isEqual(brSvObj.att, att) ) {
if (codenameLeft == "game-1,note-1,") dc_("att check found & passed", att)
          attCheckPassed = true;
        } else {
if (codenameLeft == "game-1,note-1,") dc_("att check found & failed", att)
        }
      }
    }

    if (typecodeCheckPassed && codenameCheckPassed && attCheckPassed) {
      if ( isBlank(val) ) {
        valCheckPassed = true;
      } else {
        if ( isEqual(brSvObj.val, val) ) {
if (codenameLeft == "game-1,note-1,") dc_("val check found & passed", val)
          valCheckPassed = true;
        } else {
if (codenameLeft == "game-1,note-1,") dc_("val check found & failed", val)
        }
      }
    }

    if (typecodeCheckPassed && codenameCheckPassed && attCheckPassed && valCheckPassed) {
      if ( isBlank(codenameLeft) ) {
        codenameLeftCheckPassed = true;
      } else {
        if ( leftIs(brSvObj.codename, codenameLeft) ) {
if (codenameLeft == "game-1,note-1,") dc_("codenameLeft check found & passed", "cnLeft=>", codenameLeft, ", cn=", brSvObj.codename)
          codenameLeftCheckPassed = true;
        } else {
if (codenameLeft == "game-1,note-1,") dc_("typecode check found & ", typecode)
        }
      }
    }

    if (typecodeCheckPassed && codenameCheckPassed && attCheckPassed && valCheckPassed && codenameLeftCheckPassed) {
      brSvObjAy.push(brSvObj);


if (codenameLeft == "game-1,note-1,") dc_("..... YES passed checks")
    } else {
if (codenameLeft == "game-1,note-1,") dc_("..... NOT passed checks")


    }
  }

  return brSvObjAy;
}

function getCodenameFromGameAndName(gameObj, name, typecode, isGame) {
  var codename, i;

  codename = getStringWithCharsReplaced(name, ":", "-");
  codename = getStringWithCharsReplaced(codename, " ", "-");
  codename = getStringWithCharsReplaced(codename, ",", "-");
  codename = codename.toLowerCase();

  if ( ! isGame ) {
    codename = gameObj.codename + "," + codename;
  }

  codename = getUniqueCodename(codename, typecode);

  return codename;
}

function getCodenameLeft(parent1Codename, parent2Codename) {
  var codenameLeft = parent1Codename + ",";
  if ( ! isBlank(parent2Codename) ) {
    codenameLeft += parent2Codename + ",";
  }
  return codenameLeft;
}

function getCodenameUniquePart(codename, addedTextForNum) {
  var codenameParts, codenameLeft, leftStrToRemove, codenameUniquePart;

  codenameParts = codename.split(",");
  codenameLeft = getCodenameLeft(codenameParts[0], codenameParts[1]);

  if ( isBlank(addedTextForNum) ) {
    leftStrToRemove = codenameLeft;
  } else {
    leftStrToRemove = codenameLeft + addedTextForNum;
  }

  codenameUniquePart = withoutLeft(codename, leftStrToRemove)

  return codenameUniquePart;
}

function getElemFromObjArray(theArray, propName, propValToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem[propName], propValToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return null;
  } else {
    return revisedArray[0];
  }
}

function getElemFromValArray(theArray, valToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem, valToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return "";
  } else {
    return revisedArray[0];
  }
}

function getElemVal(elemId) {
  var theElem, elemType, elemVal;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      if (elemVal = theElem.checked) {
        elemVal = "1";
      } else {
        elemVal = "0";
      }
      break;

    default:
      elemVal = theElem.value;
  }

  return elemVal;
}

function getEntinfoDataObj(codename, entCodename, infotype, relatedTypecode1, relatedCodename1, info) {
  var entinfoDataObj, brSvObjExists;

  entinfoDataObj = {};

  entinfoDataObj.codename = codename;

  brSvObjExists = existsInBrowserSave(C_typecode_entinfoData, codename, C_att_entCodename);

  if (brSvObjExists) {

    if ( isBlank(entCodename) ) {
      entCodename = getFromBrSv_valFromAtt(C_typecode_entinfoData, codename, C_att_entCodename);
    }

    if ( isBlank(infotype) ) {
      infotype = getFromBrSv_valFromAtt(C_typecode_entinfoData, codename, C_att_infotype);
    }

    if ( isBlank(relatedTypecode1) ) {
      relatedTypecode1 = getFromBrSv_valFromAtt(C_typecode_entinfoData, codename, C_att_relatedTypecode1);
    }

    if ( isBlank(relatedCodename1) ) {
      relatedCodename1 = getFromBrSv_valFromAtt(C_typecode_entinfoData, codename, C_att_relatedCodename1);
    }

    if ( isBlank(info) ) {
      info = getFromBrSv_valFromAtt(C_typecode_entinfoData, codename, C_att_info);
    }

  } else {

    entinfoDataObj._existsInBrSv = false;

  }

  entinfoDataObj.infotype = infotype;
  entinfoDataObj.entCodename = entCodename;
  entinfoDataObj.relatedTypecode1 = relatedTypecode1;
  entinfoDataObj.relatedCodename1 = relatedCodename1;
  entinfoDataObj.info = info;

  entinfoDataObj.changeInfo = function(info) {
    this.info = info;
    this.saveToBrowser();
  };

  entinfoDataObj.existsInBrSv = function() {
    return this._existsInBrSv;
  };

  entinfoDataObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_entinfoData, this.codename, C_att_entCodename, this.entCodename);
    saveToBrowser(C_typecode_entinfoData, this.codename, C_att_infotype, this.infotype);
    saveToBrowser(C_typecode_entinfoData, this.codename, C_att_relatedTypecode1, this.relatedTypecode1);
    saveToBrowser(C_typecode_entinfoData, this.codename, C_att_relatedCodename1, this.relatedCodename1);
    saveToBrowser(C_typecode_entinfoData, this.codename, C_att_info, this.info);
    this._existsInBrSv = true;
  };

  return entinfoDataObj;
}

function getEntinfoObj(codename, entCodename, infotype, info) {
  var entinfoObj, brSvObjExists;

  entinfoObj = {};

  entinfoObj.codename = codename;

  brSvObjExists = existsInBrowserSave(C_typecode_entinfo, codename, C_att_entCodename);

  if (brSvObjExists) {

    if ( isBlank(entCodename) ) {
      entCodename = getFromBrSv_valFromAtt(C_typecode_entinfo, codename, C_att_entCodename);
    }

    if ( isBlank(infotype) ) {
      infotype = getFromBrSv_valFromAtt(C_typecode_entinfo, codename, C_att_infotype);
    }

    if ( isBlank(info) ) {
      info = getFromBrSv_valFromAtt(C_typecode_entinfo, codename, C_att_info);
    }

  } else {

    entinfoObj._existsInBrSv = false;

  }

  entinfoObj.infotype = infotype;
  entinfoObj.entCodename = entCodename;
  entinfoObj.info = info;

  entinfoObj.changeInfo = function(info) {
    this.info = info;
    this.saveToBrowser();
  };

  entinfoDataObj.existsInBrSv = function() {
    return this._existsInBrSv;
  };

  entinfoObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_entinfo, this.codename, C_att_entCodename, this.entCodename);
    saveToBrowser(C_typecode_entinfo, this.codename, C_att_infotype, this.infotype);
    saveToBrowser(C_typecode_entinfo, this.codename, C_att_info, this.info);
    this._existsInBrSv = true;
  };
  
  return entinfoObj;
}

function getEntObj(codename, gameCodename = APP.curGameObj.codename, name, isUser, locCodename, inventory, startLocCodename) {
  var entObj = {};

  entObj.codename = codename;

  if ( isBlank(gameCodename) ) {
    gameCodename = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_gameCodename);
  }

  if ( isBlank(name) ) {
    name = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_name);
  }

  if ( isBlank(isUser) ) {
    isUser = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_isUser);
  }

  if ( isBlank(locCodename) ) {
    locCodename = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_locCodename);
  }

  if ( isBlank(inventory) ) {
    inventory = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_inventory);
  }

  if ( isBlank(startLocCodename) ) {
    startLocCodename = getFromBrSv_valFromAtt(C_typecode_ent, codename, C_att_startLocCodename);
  }

  entObj.gameCodename = gameCodename;
  entObj.name = name;
  entObj.isUser = getAsOneZero(isUser);
  entObj.locCodename = locCodename;
  entObj.startLocCodename = startLocCodename;

  entObj.itmObjs = getItmObjsFromInventory(inventory);

  entObj.getInventoryListHtml = function(includeUse, jsFuncName) {
    var i, html = "";

    if (this.itmObjs.length == 0) {

      html += "<div><i>(your inventory is empty)</i></div>\n";

    } else {

      this.itmObjs.sort( sorting_objs(C_att_name) );

      for (i = 0; i < this.itmObjs.length; i++) {
        let curItmObj = this.itmObjs[i];

        if (i > 0) {
          html += getHtmlDownSpacer();
        }

        if (includeUse) {

          html += "<div>" + curItmObj.name + "</div>\n";
          html += "<div>&nbsp;&nbsp;&nbsp;" + getHtml_a("use", "use_object", curItmObj.codename) + "</div>\n";

        } else if ( ! isBlank(jsFuncName) ) {

          html += "<div>" + getHtml_a(curItmObj.name, jsFuncName, curItmObj.codename) + "</div>\n";

        } else {

          html += "<div>" + curItmObj.name + "</div>\n";

        }
      }

    }

    return html;
  };

  entObj.hasItm = function(itmCodenameToFind) {
    for (var i = 0; i < this.itmObjs.length; i++) {
      if ( isEqual(this.itmObjs[i].codename, itmCodenameToFind) ) {
        return true;
      }
    }

    return false;
  };

  entObj.moveToLocCodename = function(locCodename) {
    this.locCodename = locCodename;
    saveToBrowser(C_typecode_ent, this.codename, C_att_locCodename, this.locCodename);
  };

  entObj.moveToLocObj = function(locObj) {
    this.moveToLocCodename(locObj.codename);
  };

  entObj.receiveItmObj = function(itmObj) {
    var inventory;

    this.itmObjs.push(itmObj);

    inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_ent, this.codename, C_att_inventory, inventory);
  };

  entObj.removeItmObj = function(itmObj) {
    var inventory;

    this.itmObjs = getObjArrayWithoutElem(this.itmObjs, C_misc_codename, itmObj.codename)

    inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_ent, this.codename, C_att_inventory, inventory);
  };

  entObj.reset = function() {
    this.moveToLocCodename(this.startLocCodename);
  };

  entObj.saveToBrowser = function() {
    var inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_ent, this.codename, C_att_isUser, this.isUser);
    saveToBrowser(C_typecode_ent, this.codename, C_att_name, this.name);
    saveToBrowser(C_typecode_ent, this.codename, C_att_gameCodename, this.gameCodename);
    saveToBrowser(C_typecode_ent, this.codename, C_att_locCodename, this.locCodename);
    saveToBrowser(C_typecode_ent, this.codename, C_att_inventory, inventory);
    saveToBrowser(C_typecode_ent, this.codename, C_att_startLocCodename, startLocCodename);
  };
  
  return entObj;
}

function getFromBrSv_valFromAtt(typecode, codename, att) {
  var bsk = getBrowserSaveKey(typecode, codename, att);
  var val = localStorage.getItem(bsk);
  return val;
}

function getGameObj(codename, name, startPageCodename, curPageCodename) {
  var gameObj = {};

  gameObj.codename = codename;

  if ( isBlank(name) ) {
    name = getFromBrSv_valFromAtt(C_typecode_game, codename, C_att_name);
  }

  if ( isBlank(startPageCodename) ) {
    startPageCodename = getFromBrSv_valFromAtt(C_typecode_game, codename, C_att_startPageCodename);
  }

  if ( isBlank(curPageCodename) ) {
    curPageCodename = getFromBrSv_valFromAtt(C_typecode_game, codename, C_att_curPageCodename);
  }
  
  gameObj.name = name;
  gameObj.startPageCodename = startPageCodename;
  gameObj.curPageCodename = curPageCodename;

  gameObj.getAllEntObjs = function() {
    var entBrSvObjs, i, entObjs = [];

    entBrSvObjs = getBrSvObjsFromBrSv(C_typecode_ent, null, C_att_gameCodename, this.codename, null);

    for(i = 0; i < entBrSvObjs.length; i++) {
      let curEntBrSvObj = entBrSvObjs[i];
      let curEntCodename = curEntBrSvObj.codename;
      let curEntObj = getEntObj(curEntCodename, this.codename);
      entObjs.push(curEntObj);
    }

    entObjs.sort( sorting_objs(C_att_name) );

    return entObjs;
  };

  gameObj.getAllItmObjs = function(canGrabOnly, usereceivetypeOnly, includeLoc) {
    var entObjs = this.getAllEntObjs();
    var locObjs = this.getAllLocObjs();
    var itmObjs = [];

    entObjs.forEach( (curEntObj) => {
      curEntObj.itmObjs.forEach( (curItmObj) => {
        if (  (! canGrabOnly || isTrue(curItmObj.canGrab))  &&  (! usereceivetypeOnly || ! isBlank(curItmObj.usereceivetype))  ) {
          if (includeLoc) {
            curItmObj.name2 = curItmObj.name;
          }
          itmObjs.push(curItmObj);
        }
      } );
    } );

    locObjs.forEach( (curLocObj) => {
      curLocObj.itmObjs.forEach( (curItmObj) => {
        if (  (! canGrabOnly || isTrue(curItmObj.canGrab))  &&  (! usereceivetypeOnly || ! isBlank(curItmObj.usereceivetype))  ) {
          if (includeLoc) {
            curItmObj.name2 = curItmObj.name + " (" + curLocObj.name + ")";
          }
          itmObjs.push(curItmObj);
        }
      } );
    } );

    itmObjs.sort( sorting_objs(C_att_name) );

    return itmObjs;
  };

  gameObj.getAllLocObjs = function() {
    var locBrSvObjs, i, locObjs = [];

    locBrSvObjs = getBrSvObjsFromBrSv(C_typecode_loc, null, C_att_gameCodename, this.codename, null);

    for (i = 0; i < locBrSvObjs.length; i++) {
      let curLocBrSvObj = locBrSvObjs[i];
      let curLocCodename = curLocBrSvObj.codename;
      let curLocObj = getLocObj(curLocCodename, this.codename);
      locObjs.push(curLocObj);
    }

    locObjs.sort( sorting_objs(C_att_name) );

    return locObjs;
  };

  gameObj.getAllPageObjs = function() {
    var pageBrSvObjs, i, pageObjs = [];

    pageBrSvObjs = getBrSvObjsFromBrSv(C_typecode_page, null, C_att_gameCodename, this.codename, null);

    for (let curPageBrSvObj in pageBrSvObjs) {
      let curPageCodename = curPageBrSvObj.codename;
      let curPageObj = getPageObj(curPageCodename, this.codename);
      curPageObj.init();
      pageObjs.push(curPageObj);
    }

    pageObjs.sort( sorting_objs(C_att_name) );

    return pageObjs;
  };

  gameObj.reset = function() {
    var allEntObjs = this.getAllEntObjs();
    var allItmObjs = this.getAllItmObjs(false, false, false);

    allEntObjs.forEach( function(entObjInLoop) {
      entObjInLoop.reset();
    } );

    allItmObjs.forEach( function(itmObjInLoop) {
      itmObjInLoop.reset();
    } );

    this.curPageCodename = this.startPageCodename;
    this.saveToBrowser();

    APP.curPageObj = null;
    APP.entUserObj = null;
  };

  gameObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_game, this.codename, C_att_name, this.name);
    saveToBrowser(C_typecode_game, this.codename, C_att_startPageCodename, this.startPageCodename);
    saveToBrowser(C_typecode_game, this.codename, C_att_curPageCodename, this.curPageCodename);
  };
  
  return gameObj;
}

function getHtml_a(linkText, jsFunc, jsArg1, jsArg2) {
  var html = "<a href='javascript: " + jsFunc + " (" ;

  if ( ! isBlank(jsArg1) ) {
    html += " \"" + jsArg1 + "\"";
  }

  if ( ! isBlank(jsArg2) ) {
    html += " , \"" + jsArg2 + "\"";
  }

  html += " )'>" + linkText + "</a>";

  return html;
}

function getHtml_pageDisplay(pageObj) {
  var html = "";
  var i, trObjs, uaObjs, infoLinkHtml;


  // TEXT-ROWS

  trObjs = pageObj.getAllTrObjs();

  for (i = 0; i < trObjs.length; i++) {
    let curTrObj, showTr, itmObj, curTrcondObjs;

    curTrObj = trObjs[i];
    showTr = true;

    if ( ! isBlank(curTrObj.itmStatusReq) ) {
      itmObj = getItmObj(curTrObj.itmCodename);
      if ( ! isEqual(curTrObj.itmStatusReq, itmObj.status) ) {
        showTr = false;
      }
    }

    if ( ! isBlank(curTrObj.itmInLocInv) ) {
      let locObj = APP.curPageObj.getLocObj();

      if ( ! isBlank(curTrObj.itmInLocInv) && ! isBlank(curTrObj.itmInLocInv_isIsNot) ) {
        if ( curTrObj.itmInLocInv_isIsNot == C_misc_is && ! locObj.hasItm(curTrObj.itmInLocInv) ) {
          showTr = false;
        }

        if ( isEqual(curTrObj.itmInLocInv_isIsNot, C_misc_isNot) && locObj.hasItm(curTrObj.itmInLocInv) ) {
          showTr = false;
        }
      }
    }

    if ( curTrObj.condsFailed() ) {
      showTr = false;
    }

    if (showTr) {
      let textOfRow = curTrObj.textOfRow;

      if ( isTrue(APP.dev) && ! isTrue(APP.dev_hideEditor) ) {
        textOfRow += "&nbsp;&nbsp;&nbsp;" + getHtml_a("> edit text", "dev_editor__edit_text_row", curTrObj.codename);
        textOfRow += "&nbsp;&nbsp;&nbsp;" + getHtml_a("> delete", "dev_editor__delete_text_row", curTrObj.codename);
      }

      html += getHtmlForAddedTextRow(html, textOfRow, 1);
    }
  }

  if ( isTrue(APP.dev) && ! isTrue(APP.dev_hideEditor) ) {
    html += getHtmlDownSpacer();
    html += "<div>" + getHtml_a("> add new text-row", "dev_editor__goto__add_text_row") + "</div>\n";
  }

  html += getHtmlDownSpacer(2);


  // USER-ACTIONS FOR PAGE

  uaObjs = pageObj.getAllUaObjs();

  if (uaObjs.length == 0) {

    html += getHtmlForAddedTextRow(html, "(no user-actions are available yet for this page)", 1);

  } else {

    for (i = 0; i < uaObjs.length; i++) {

      let curUaObj = uaObjs[i];
      let showUa = true;
      let uaText;

      switch (curUaObj.uatype) {
        case C_uatype_examine:
          {
            let locObj = APP.curPageObj.getLocObj();

            let locHasItm = locObj.hasItm(curUaObj.itmCodename);
            if ( ! locHasItm ) {
              showUa = false;
            }
          }
          break;
        case C_uatype_grabItm:
          {
            let locObj = APP.curPageObj.getLocObj();

            let locHasItm = locObj.hasItm(curUaObj.itmCodename);
            if ( ! locHasItm ) {
              showUa = false;
            }
          }
          break;
        case C_uatype_moveToLoc:
          break;
      }

      if ( ! isBlank(curUaObj.statusReq_itmCodename) ) {
        let statusReqItmObj = getItmObj(curUaObj.statusReq_itmCodename);

        if ( ! isEqual(curUaObj.statusReq_itmStatus, statusReqItmObj.status) ) {
          showUa = false;
        }
      }


      if ( curUaObj.condsFailed() ) {
        showUa = false;
      }

      if (showUa) {
        uaText = getHtml_a(curUaObj.uaText, "do_action", curUaObj.uatype, curUaObj.codename);

        if ( isTrue(APP.dev) && ! isTrue(APP.dev_hideEditor) ) {
          uaText += "&nbsp;&nbsp;&nbsp;" + getHtml_a("> edit text", "dev_editor__edit_user_action_text", curUaObj.codename);
          uaText += "&nbsp;&nbsp;&nbsp;" + getHtml_a("> delete", "dev_editor__goto__delete_user_action", curUaObj.codename);
        }

        html += getHtmlForAddedTextRow(html, uaText, 1);
      }

    }

  }

  if ( isTrue(APP.dev) && ! isTrue(APP.dev_hideEditor) ) {
    html += getHtmlDownSpacer();
    html += "<div>" + getHtml_a("> add new user-action", "dev_editor__goto__add_user_action") + "</div>\n";
  }


  // USER-ACTIONS GENERAL

  if ( ! isBlank(pageObj.locCodename) ) {
    infoLinkHtml = getHtml_userAction(C_userAction_openInventory, C_userAction_openInventory);
    html += getHtmlForAddedTextRow(html, infoLinkHtml, 2, true);
  }


  return html;
}

function getHtml_sel(selectElemId, includeBlank, ay, defValue, theStyle, onChange, blankDisplay, isDisabled, valueProp = "codename", displayProp = "name", isValArray = false) {
  var i, html;

  html = "<select id='" + selectElemId + "'";

  if (  !isBlank(theStyle) ) {
    html += " style='" + theStyle + "'";
  }

  if ( !isBlank(onChange) ) {
    html += " onchange='javascript: " + onChange + "'";
  }

  if (isDisabled) {
    html += " disabled";
  }

  html += ">\n";

  if (includeBlank) {
    html += "<option value=''";
    if ( isBlank(defValue) ) html += " selected";
    html += ">";
    if (blankDisplay) {
      html += blankDisplay + "</option>\n";
    } else {
      html += " </option>\n";
    }
  }

  for (i = 0; i < ay.length; i++ ) {
    let curOptionId, curOptionDisplay;

    if (isValArray) {
      curOptionId = ay[i];
      curOptionDisplay = ay[i];
    } else {
      curOptionId = ay[i][valueProp];
      curOptionDisplay = ay[i][displayProp];
    }

    html += "<option value='" + curOptionId + "'";

    if ( isEqual(defValue, curOptionId) ) {
      html += " selected";
    }

    html += ">" + curOptionDisplay + "</option>\n";
  }

  html += "</select>\n";

  return html;
}

function getHtml_userAction(linkText, linkActionName, linkActionVar1) {
  var html = getHtml_a(linkText, "do_action", linkActionName, linkActionVar1);
  return html;
}

function getHtmlDownSpacer(spacesDown) {
  var i, html = "";

  if ( ! isNumeric(spacesDown) ) {
    spacesDown = 1;
  } else {
    if ( spacesDown < 0 || spacesDown > 100 ) {
      spacesDown = 1;
    }
  }

  for (i = 1; i <= spacesDown; i++ ) {
    html += "<div style='height: " + C_spacerHeight + "'></div>\n";
  }

  return html;
}

function getHtmlForAddedTextRow(curHtml, rowOfText, spacesDown, skipParsing) {
  var newHtml = "", parsedText;

  if ( ! isNumeric(spacesDown) ) {
    spacesDown = 1;
  } else {
    if ( spacesDown < 0 || spacesDown > 100 ) {
      spacesDown = 1;
    }
  }

  if ( isBlank(curHtml) && spacesDown <= 1 ) {
    // no action -- no need to add a space for the first row of text on the screen (unless the calling function requested 2+ spaces)
  } else {
    newHtml += getHtmlDownSpacer(spacesDown);
  }

  if (skipParsing) {
    parsedText = rowOfText;
  } else {
    parsedText = getParsedDisplayText(rowOfText);
  }

  newHtml += "<div>" + parsedText + "</div>\n";

  return newHtml;
}

function getInfotypeDisplayText(infotype) {
  switch(infotype) {
    case C_infotype_custom:
      return "custom";
      break;
    case C_infotype_itmExam:
      return "object examined";
      break;
  }
}

function getInfotypeObjAy() {
  var ay = [];
  //var infotypeObj_custom = {};
  var infotypeObj_itmExam = {};

  //infotypeObj_custom.codename = C_infotype_custom;
  //infotypeObj_custom.name = getInfotypeDisplayText(C_infotype_custom);
  //ay.push(infotypeObj_custom);

  infotypeObj_itmExam.codename = C_infotype_itmExam;
  infotypeObj_itmExam.name = getInfotypeDisplayText(C_infotype_itmExam);
  ay.push(infotypeObj_itmExam);

  return ay;
}

function getInventoryFromItmObjs(itmObjs) {
  var i, inventory = "";

  for(i = 0; i < itmObjs.length; i++) {
    let curItmObj = itmObjs[i];
    let curItmCodename = curItmObj.codename;

    if (i > 0) {
      inventory += ";";
    }

    inventory += curItmCodename;
  }

  return inventory;
}

function getIsIsNotObjAy() {
  var ay = [];

  var obj_is = {};
  obj_is.codename = C_misc_is;
  obj_is.name = C_misc_is;
  ay.push(obj_is);

  var obj_isNot = {};
  obj_isNot.codename = C_misc_isNot;
  obj_isNot.name = C_misc_isNot;
  ay.push(obj_isNot);

  return ay;
}

function getItmObj(codename, gameCodename = APP.curGameObj.codename, name, canGrab, startLocCodename, usereceivetype, startStatus, status, itmThatAffects, useReceivedMsg, statusReq_itmCodename, statusReq_itmStatus, examineMsg) {
  var itmObj = {};

  itmObj.codename = codename;

  if ( isBlank(gameCodename) ) {
    gameCodename = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_gameCodename);
  }

  if ( isBlank(name) ) {
    name = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_name);
  }

  if ( isBlank(canGrab) ) {
    canGrab = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_canGrab);
  }

  if ( isBlank(startLocCodename) ) {
    startLocCodename = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_startLocCodename);
  }

  if ( isBlank(usereceivetype) ) {
    usereceivetype = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_usereceivetype);
  }

  if ( isBlank(startStatus) ) {
    startStatus = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_startStatus);
  }

  if ( isBlank(status) ) {
    status = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_status);
  }

  if ( isBlank(itmThatAffects) ) {
    itmThatAffects = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_itmThatAffects);
  }

  if ( isBlank(useReceivedMsg) ) {
    useReceivedMsg = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_useReceivedMsg);
  }

  if ( isBlank(statusReq_itmCodename) ) {
    statusReq_itmCodename = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_statusReq_itmCodename);
  }

  if ( isBlank(examineMsg) ) {
    examineMsg = getFromBrSv_valFromAtt(C_typecode_itm, codename, C_att_examineMsg);
  }

  itmObj.gameCodename = gameCodename;
  itmObj.name = name;
  itmObj.canGrab = getAsOneZero(canGrab);
  itmObj.startLocCodename = startLocCodename;
  itmObj.usereceivetype = usereceivetype;
  itmObj.startStatus = startStatus;
  itmObj.status = status;
  itmObj.itmThatAffects = itmThatAffects;
  itmObj.useReceivedMsg = useReceivedMsg;
  itmObj.statusReq_itmCodename = statusReq_itmCodename;
  itmObj.statusReq_itmStatus = statusReq_itmStatus;
  itmObj.examineMsg = examineMsg;

  itmObj.reset = function() {
    var gameObj = getGameObj(this.gameCodename);
    var allGameEntObjs = gameObj.getAllEntObjs();
    var allGameLocObjs = gameObj.getAllLocObjs();
    var startLocObj;
    var startLocAlreadyHasItm = false;

    allGameEntObjs.forEach( (entObjInLoop) => {
      if ( entObjInLoop.hasItm(this.codename) ) {
        entObjInLoop.removeItmObj(this);
      }
    } );

    allGameLocObjs.forEach( (locObjInLoop) => {
      let curLocObjInLoop_isItmStartLoc = false;

      if ( isEqual(locObjInLoop.codename, this.startLocCodename) ) {
        startLocObj = locObjInLoop;
        curLocObjInLoop_isItmStartLoc = true;
      }

      if ( locObjInLoop.hasItm(this.codename) ) {
        if (curLocObjInLoop_isItmStartLoc) {
          startLocAlreadyHasItm = true;
        } else {
          locObjInLoop.removeItmObj(this);
        }
      }
    } );

    if ( ! startLocAlreadyHasItm ) {
      startLocObj.receiveItmObj(this);
    }

    if ( ! isBlank(this.startStatus) && ! isEqual(this.startStatus, this.status) ) {
      this.status = this.startStatus;
      this.saveToBrowser();
    }
  };

  itmObj.saveToBrowser = function() {
    let canGrabOneZero = getAsOneZero(this.canGrab);

    saveToBrowser(C_typecode_itm, this.codename, C_att_gameCodename, this.gameCodename);
    saveToBrowser(C_typecode_itm, this.codename, C_att_name, this.name);
    saveToBrowser(C_typecode_itm, this.codename, C_att_canGrab, canGrabOneZero);
    saveToBrowser(C_typecode_itm, this.codename, C_att_startLocCodename, this.startLocCodename);
    saveToBrowser(C_typecode_itm, this.codename, C_att_usereceivetype, this.usereceivetype);
    saveToBrowser(C_typecode_itm, this.codename, C_att_startStatus, this.startStatus);
    saveToBrowser(C_typecode_itm, this.codename, C_att_status, this.status);
    saveToBrowser(C_typecode_itm, this.codename, C_att_itmThatAffects, this.itmThatAffects);
    saveToBrowser(C_typecode_itm, this.codename, C_att_useReceivedMsg, this.useReceivedMsg);
    saveToBrowser(C_typecode_itm, this.codename, C_att_statusReq_itmCodename, this.statusReq_itmCodename);
    saveToBrowser(C_typecode_itm, this.codename, C_att_statusReq_itmStatus, this.statusReq_itmStatus);
    saveToBrowser(C_typecode_itm, this.codename, C_att_examineMsg, this.examineMsg);
  };
  
  return itmObj;
}

function getItmObjsFromInventory(inventory) {
  var itmObjs, itmCodenames, i;

  itmObjs = [];

  if ( isBlank(inventory) ) {
    return itmObjs;
  }

  itmCodenames = inventory.split(";");

  for (i = 0; i < itmCodenames.length; i++) {
    let curItmCodename = itmCodenames[i];
    let curItmObj = getItmObj(curItmCodename);
    itmObjs.push(curItmObj);
  }

  return itmObjs;
}

function getItmStatusObjAy_fromUsereceivetype(usereceivetype) {
  var ay = [];

  switch(usereceivetype) {

    case C_usereceivetype_closedOpen:
      {
        let obj_usereceivetype_closedOpen__closed = {};
        obj_usereceivetype_closedOpen__closed.codename = C_status_closed;
        obj_usereceivetype_closedOpen__closed.name = C_status_closed;
        ay.push(obj_usereceivetype_closedOpen__closed);

        let obj_usereceivetype_closedOpen__open = {};
        obj_usereceivetype_closedOpen__open.codename = C_status_open;
        obj_usereceivetype_closedOpen__open.name = C_status_open;
        ay.push(obj_usereceivetype_closedOpen__open);

        return ay;
      }
      break;

    case C_usereceivetype_lockedUnlocked:
      {
        let obj_usereceivetype_lockedUnlocked__locked = {};
        obj_usereceivetype_lockedUnlocked__locked.codename = C_status_locked;
        obj_usereceivetype_lockedUnlocked__locked.name = C_status_locked;
        ay.push(obj_usereceivetype_lockedUnlocked__locked);

        let obj_usereceivetype_lockedUnlocked__unlocked = {};
        obj_usereceivetype_lockedUnlocked__unlocked.codename = C_status_unlocked;
        obj_usereceivetype_lockedUnlocked__unlocked.name = C_status_unlocked;
        ay.push(obj_usereceivetype_lockedUnlocked__unlocked);

        return ay;
      }
      break;

  }
}

function getLocationAttFromBrowserSave(locCodename, att) {
  var val = getFromBrSv_valFromAtt(C_saveTypeName_location, locCodename, att);
  return val;
}

function getLocDisplayVar(att) {
  var displayVar = C_displayVarStub_locAtt + "__" + att;
  return displayVar;
}

function getLocDisplayVarCode(att) {
  var displayVarCode = "_" + getLocDisplayVar(att) + "_"
  return displayVarCode;
}

function getLocObj(codename, gameCodename = APP.curGameObj.codename, name, pageCodename, inventory) {
  var locObj = {}, itmCodenames, i;

  locObj.codename = codename;

  if ( isBlank(gameCodename) ) {
    gameCodename = getFromBrSv_valFromAtt(C_typecode_loc, codename, C_att_gameCodename);
  }

  if ( isBlank(name) ) {
    name = getFromBrSv_valFromAtt(C_typecode_loc, codename, C_att_name);
  }

  if ( isBlank(pageCodename) ) {
    pageCodename = getFromBrSv_valFromAtt(C_typecode_loc, codename, C_att_pageCodename);
  }

  if ( isBlank(inventory) ) {
    inventory = getFromBrSv_valFromAtt(C_typecode_loc, codename, C_att_inventory);
  }

  locObj.gameCodename = gameCodename;
  locObj.name = name;
  locObj.pageCodename = pageCodename;

  locObj.itmObjs = getItmObjsFromInventory(inventory);

  locObj.getInventoryListHtml = function(jsFuncName, editLinks, checkStatusReq) {
    var i, html = "";

    if (this.itmObjs.length == 0) {

      html += "<div><i>(nothing in this location's inventory)</i></div>\n";

    } else {

      this.itmObjs.sort( sorting_objs(C_att_name) );

      for (i = 0; i < this.itmObjs.length; i++) {

        let writeItem, curItmObj, statusReq_itmObj;

        writeItem = true;

        if (i > 0) {
          html += getHtmlDownSpacer();
        }

        curItmObj = this.itmObjs[i];

        if ( isTrue(checkStatusReq) && ! isBlank(curItmObj.statusReq_itmCodename) ) {
          statusReq_itmObj = getLocObj(curItmObj.statusReq_itmCodename);
          if ( ! isEqual(statusReq_itmObj.status, curItmObj.statusReq_itmStatus) ) {
            writeItem = false;
          }
        }

        if ( writeItem ) {
          if (jsFuncName) {
            html += "<div>" + getHtml_a(curItmObj.name, jsFuncName, curItmObj.codename) + "</div>\n";
          } else if (editLinks) {
            html += "<div>- " + curItmObj.name + "&nbsp;&nbsp;"  + getHtml_a("> rename", "dev_editor__rename_inventory_object", curItmObj.codename) + "</div>\n";
          } else {
            html += "<div>- " + curItmObj.name + "</div>\n";
          }
        }

      }

    }

    return html;
  };

  locObj.getItmObjs = function(canGrabOnly) {
    var itmObjs = [];

    this.itmObjs.forEach( (curItmObj) => {
      if ( ! canGrabOnly || isTrue(curItmObj.canGrab) ) {
        itmObjs.push(curItmObj);
      }
    } );

    itmObjs.sort( sorting_objs(C_att_name) );

    return itmObjs;
  };

  locObj.hasItm = function(itmCodenameToFind) {
    for (var i = 0; i < this.itmObjs.length; i++) {
      if ( isEqual(this.itmObjs[i].codename, itmCodenameToFind) ) {
        return true;
      }
    }

    return false;
  };

  locObj.receiveItmObj = function(itmObj) {
    var inventory;

    this.itmObjs.push(itmObj);

    inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_loc, this.codename, C_att_inventory, inventory);
  };

  locObj.removeItmObj = function(itmObj) {
    var inventory;

    this.itmObjs = getObjArrayWithoutElem(this.itmObjs, C_misc_codename, itmObj.codename)

    inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_loc, this.codename, C_att_inventory, inventory);
  };

  locObj.saveToBrowser = function() {
    var inventory = getInventoryFromItmObjs(this.itmObjs);

    saveToBrowser(C_typecode_loc, this.codename, C_att_gameCodename, this.gameCodename);
    saveToBrowser(C_typecode_loc, this.codename, C_att_name, this.name);
    saveToBrowser(C_typecode_loc, this.codename, C_att_pageCodename, this.pageCodename);
    saveToBrowser(C_typecode_loc, this.codename, C_att_inventory, inventory);
  };
  
  return locObj;
}

function getTypecodeAddedTextForNum(typecode) {
  var x = typecode.toLowerCase() + "-";
  return x;
}

function getNextSortedCodename(typecode, parent1Codename, parent2Codename, anyValidAtt, addedTextForNum) {
  var codenameLeftToFind, ay, lastAyItemCodename, nextNum, newCodename;

  codenameLeftToFind = getCodenameLeft(parent1Codename, parent2Codename);

  ay = getBrSvObjsFromBrSv(typecode, null, anyValidAtt, null, codenameLeftToFind);

  if ( isBlank(addedTextForNum) ) {
    addedTextForNum = getTypecodeAddedTextForNum(typecode);
  }

  APP.sort_addedTextForNum = addedTextForNum;
  ay.sort( sorting_sortedCodenameAy() );

  if (ay.length == 0) {

    nextNum = 1;

  } else {

    let lastNum;

    lastAyItemCodename = ay[ay.length - 1].codename;

    lastNum = getCodenameUniquePart(lastAyItemCodename, addedTextForNum);

    nextNum = Number(lastNum) + 1;

  }

  newCodename = parent1Codename;

  if ( ! isBlank(parent2Codename) ) {
    newCodename += "," + parent2Codename
  }

  newCodename += ",";

  if ( ! isBlank(addedTextForNum) ) {
    newCodename += addedTextForNum;
  }

  newCodename += nextNum;

  APP.sort_addedTextForNum = null;

  return newCodename;
}

function getObjArrayAsString(theArray, propName, propName2) {
  var i, str = "";
  for (i = 0; i < theArray.length; i++ ){
    str += "array item #" + (parseInt(i) + 1) + " ----- ";
    str += propName1 + ": " + theArray[i][propName1];
    if ( !isBlank(propName2) ) str += ", " + propName2 + ": " + theArray[i][propName2];
    str += "\n";
  }
  return str;
}

function getObjArrayWithoutElem(theArray, propName, propValToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem[propName], propValToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;

  /* test code for this function:
  var x1 = {prop1: "a"};
  var x2 = {prop1: "b"};
  var x3 = {prop1: "b"};
  var x4 = {prop1: "a"};

  var ay = [x1, x2, x3, x4];

  var ay2 = getObjArrayWithoutElem(ay, "prop1", "b")

  dc_(getObjArrayAsString(ay2, "prop1"))
  */
}

function getObj_fromCodename(typecode, codename, gameCodename) {



//INCOMPLETE: finish later



  var obj;

  switch(typecode) {
    case C_typecode_appSetting:
      // this one should never be used, as we don't set up app-settings as objects
      break;
    case C_typecode_ent:
      obj = getEntObj(codename, gameCodename);
      break;
    case C_typecode_entinfo:
      break;
    case C_typecode_entinfoData:
      break;
    case C_typecode_game:
      break;
    case C_typecode_itm:
      break;
    case C_typecode_loc:
      break;
    case C_typecode_page:
      break;
    case C_typecode_tr:
      break;
    case C_typecode_trcond:
      break;
    case C_typecode_ua:
      break;
  }

  return obj;
}

function getObj_fromObjOrCodename(typecode, objOrCodename, gameCodename = APP.curGameObj.codename) {
  var codename = objOrCodename.codename;

  if ( ! codename ) {
    objOrCodename = getObj_fromCodename(typecode, objOrCodename, gameCodename);
  }

  return objOrCodename
}

function getPageObj(codename, gameCodename = APP.curGameObj.codename, name, locCodename) {
  var pageObj = {};

  pageObj.codename = codename;

  if ( isBlank(gameCodename) ) {
    gameCodename = getFromBrSv_valFromAtt(C_typecode_page, codename, C_att_gameCodename);
  }

  if ( isBlank(name) ) {
    name = getFromBrSv_valFromAtt(C_typecode_page, codename, C_att_name);
  }

  if ( isBlank(locCodename) ) {
    locCodename = getFromBrSv_valFromAtt(C_typecode_page, codename, C_att_locCodename);
  }

  pageObj.gameCodename = gameCodename;
  pageObj.name = name;
  pageObj.locCodename = locCodename;

  pageObj._trObjs = [];
  pageObj._uaObjs = [];

  pageObj.getAllTrObjs = function() {
    APP.sort_addedTextForNum = getTypecodeAddedTextForNum(C_typecode_tr);
    this._trObjs.sort( sorting_sortedCodenameAy() );
    APP.sort_addedTextForNum = null;
    return this._trObjs;
  };

  pageObj.getAllUaObjs = function() {
    APP.sort_addedTextForNum = getTypecodeAddedTextForNum(C_typecode_ua);
    this._uaObjs.sort( sorting_sortedCodenameAy() );
    APP.sort_addedTextForNum = null;
    return this._uaObjs;
  };

  pageObj.deleteTr = function(trCodenameToDelete, skipAyRefresh) {
    var newAy, trObj, trcondObjs;

    trObj = this.getTrObj(trCodenameToDelete);

    trcondObjs = trObj.getAllTrcondObjs();

    trcondObjs.forEach( (trcondObj) => {
      trObj.deleteTrcond(trcondObj.codename, true);
    } );

    deleteFromBrowserSave_multiple(C_typecode_tr, trCodenameToDelete);

    if ( ! skipAyRefresh ) {
      newAy = getObjArrayWithoutElem(this._trObjs, C_misc_codename, trCodenameToDelete);
      this._trObjs = newAy;
    }
  };

  pageObj.deleteUa = function(uaCodenameToDelete, skipAyRefresh) {
    var newAy, uaObj, uacondObjs;

    uaObj = this.getUaObj(uaCodenameToDelete);
    uacondObjs = uaObj.getAllUacondObjs();

    uacondObjs.forEach( (uarcondObj) => {
      uaObj.deleteUacond(uacondObj.codename, true);
    } );

    deleteFromBrowserSave_multiple(C_typecode_ua, uaCodenameToDelete);

    if ( ! skipAyRefresh ) {
      newAy = getObjArrayWithoutElem(this._uaObjs, C_misc_codename, uaCodenameToDelete);
      this._uaObjs = newAy;
    }
  };

  pageObj.getCurPageAndLoc = function() {
    var locObj, txt;

    locObj = getLocObj(APP.userEntObj.locCodename);

    if ( isBlank(this.locCodename) || ! isEqual(this.locCodename, locObj.codename) ) {
      let locObj = getLocObj(APP.userEntObj.locCodename);
      txt = this.name + " / " + locObj.name;
    } else {
      txt = this.name;
    }

    return txt;
  };

  pageObj.getTrObj = function(trCodename) {
    for (var i = 0; i < this._trObjs.length; i++) {
      let curTrObj = this._trObjs[i];
      if ( isEqual(trCodename, curTrObj.codename) ) {
        return curTrObj;
      }
    }
    return null;
  };

  pageObj.getUaObj = function(uaCodename) {
    for (var i = 0; i < this.uaObjs.length; i++) {
      let curUaObj = this.uaObjs[i];
      if ( isEqual(uaCodename, curUaObj.codename) ) {
        return curUaObj;
      }
    }
    return null;
  };

  pageObj.init = function() {
    this.loadTrObjsFromBrowserSave();
    this.loadUaObjsFromBrowserSave();
  };

  pageObj.loadTrObjsFromBrowserSave = function() {
    var codenameLeft, brSvObjs, i;

    this._trObjs = [];

    codenameLeft = getCodenameLeft(this.codename);

    brSvObjs = getBrSvObjsFromBrSv(C_typecode_tr, null, C_att_textOfRow, null, codenameLeft);

    for (i = 0; i < brSvObjs.length; i++) {
      let curBrSvObj = brSvObjs[i];
      let newTrObj = getTrObj(curBrSvObj.codename, this.codename, curBrSvObj.val);

      newTrObj.init();

      this._trObjs.push(newTrObj);
    }
  };

  pageObj.loadUaObjsFromBrowserSave = function() {
    var codenameLeft, brSvObjs, i;

    this._uaObjs = [];

    codenameLeft = getCodenameLeft(this.codename);

    brSvObjs = getBrSvObjsFromBrSv(C_typecode_ua, null, C_att_uaText, null, codenameLeft);

    for (i = 0; i < brSvObjs.length; i++) {
      let curBrSvObj = brSvObjs[i];
      let newUaObj = getUaObj(curBrSvObj.codename, this.codename, curBrSvObj.val);

      newUaObj.init();

      this._uaObjs.push(newUaObj);
    }

  };

  pageObj.getLocObj = function() {
    var locObj = getLocObj(this.locCodename, this.gameCodename, null, this.codename);
    return locObj;
  };

  pageObj.receiveTrObj = function(trObj) {
    this._trObjs.push(trObj);
  };

  pageObj.receiveUaObj = function(uaObj) {
    this._uaObjs.push(uaObj);
  };

  pageObj.display = function() {
    displayPage(this);
  };

  pageObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_page, this.codename, C_att_gameCodename, this.gameCodename);
    saveToBrowser(C_typecode_page, this.codename, C_att_name, this.name);
    saveToBrowser(C_typecode_page, this.codename, C_att_locCodename, this.locCodename);
  };
  
  return pageObj;
}

function getParsedDisplayText(originalText) {
  var i, newText = "";
  var words = originalText.split(" ");

  for (i = 0; i < words.length; i++) {
    let curWord = words[i];
    let curTmp1, curTmp2, curTmp3, possibleDisplayVar;
    let textToAddLeft = "";
    let textToAddRight = "";

    //alert("word " + (i + 1) + " => " + curWord); 
    if ( leftIs(curWord, "_") || leftIs(curWord, "\"_") ) {

      if ( leftIs(curWord, "\"_") ) {
        textToAddLeft = "\""
        curTmp1 = withoutLeft(curWord, "\"_");
      } else {
        curTmp1 = withoutLeft(curWord, "_");
      }

      //alert("... has a left underscore ..."); 

      if ( rightIs(curWord, "_") ) {

        //alert("... and a right underscore ..."); 
        possibleDisplayVar = withoutRight(curTmp1, "_" );

      } else if ( rightIs(curWord, ",") ) {

        //alert("... and a right comma ..."); 
        curTmp2 = withoutRight(curTmp1, ",");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = ","
        }

      } else if ( rightIs(curWord, ".") ) {

        //alert("... and a right period ..."); 
        curTmp2 = withoutRight(curTmp1, ".");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = "."
        }

      } else if ( rightIs(curWord, "?") ) {

        //alert("... and a right question mark ..."); 
        curTmp2 = withoutRight(curTmp1, "?");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = "?"
        }

      } else if ( rightIs(curWord, "!") ) {

        //alert("... and a right exclamation point ..."); 
        curTmp2 = withoutRight(curTmp1, "!");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = "!"
        }

      } else if ( rightIs(curWord, ";") ) {

        //alert("... and a right semicolon ..."); 
        curTmp2 = withoutRight(curTmp1, ";");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = ";"
        }

      } else if ( rightIs(curWord, ":") ) {

        //alert("... and a right colon ..."); 
        curTmp2 = withoutRight(curTmp1, ":");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = ":"
        }

      } else if ( rightIs(curWord, "\"") ) {

        //alert("... and a right colon ..."); 
        curTmp2 = withoutRight(curTmp1, "\"");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = "\""
        }

      } else if ( rightIs(curWord, "</a>") ) {

        //alert("... and a right colon ..."); 
        curTmp2 = withoutRight(curTmp1, "</a>");
        if ( rightIs(curTmp2, "_") ) {
          //alert("... after an underscore ..."); 
          possibleDisplayVar = withoutRight(curTmp2, "_" );
          textToAddRight = "</a>"
        }

      }
     
      if (possibleDisplayVar) {
        curWord = getParsedDisplayText_doPossDisVar(curWord, possibleDisplayVar, textToAddLeft, textToAddRight)
      }

    }

    if ( newText.length > 0 ) {
      newText += " ";
    }

    newText += curWord;
  }

  return newText;
}

function getParsedDisplayText_doPossDisVar(curWord, possibleDisplayVar, textToAddLeft, textToAddRight) {
  //alert("... resulting in a possible displayVar of '" + possibleDisplayVar + "' ..."); 
  switch (possibleDisplayVar) {

    case C_displayVar_you:
      curWord = textToAddLeft + APP.youObj.name + textToAddRight;
      //alert("... and we found displayVar '" + possibleDisplayVar + "' so we changed to the underlying value!");
      break;

    case C_displayVar_curLoc:
      curWord = textToAddLeft + APP.youObj.locName + textToAddRight;
      //alert("... and we found displayVar '" + possibleDisplayVar + "' so we changed to the underlying value!");
      break;

    default:

      //alert("... checking possibleDisplayVar '" + possibleDisplayVar + "' for leftIs '" + C_displayVarStub_locAtt + "'");
      if ( leftIs(possibleDisplayVar, C_displayVarStub_locAtt) ) {
        let att = withoutLeft(possibleDisplayVar, C_displayVarStub_locAtt + "__");
        curWord = textToAddLeft + APP.curPageObj[att] + textToAddRight;
      }

      //alert("... but displayVar '" + possibleDisplayVar + "' does not exist as an option, so we are sticking with the original word " + curWord);
  }

  return curWord;
}

function getProcessedSaveText(text) {
  var x = getStringWithCharsReplaced(text, ":", " ");
  return x;
}

function getProcessedStringForSave(oldString) {
  var newString = getStringWithCharsReplaced(oldString, "  ", "&nbsp;&nbsp;");
  newString = getStringWithCharsReplaced(newString, "\n", "<br />");
  return newString;
}

function getProcessedStringForTextView(oldString) {
  var newString = getStringWithCharsReplaced(oldString, "&nbsp;&nbsp;", "  ");
  newString = getStringWithCharsReplaced(newString, "<br />", "\n");
  return newString;
}

function getRand(numDigits) {
  return getRandomPositiveWholeNumber(numDigits);
}

function getRandomPositiveWholeNumber(numDigits) {
  var a = Math.random();
  var b = String(a);
  var c = b.split(".");
  var d = c[1];

  var e;
  if ( isNumeric(numDigits) ){
    e = right(d,numDigits);
  } else {
    e = d;
  }
  return e;
}

function getStringWithCharsReplaced(oldString, oldChars, newChars) {
  if ( oldString == null || oldChars == null ) {
    return "";
  }

  if ( newChars == null ) {
    newChars = "";
  }

  var newString = oldString;

  for (var i = 1; i <= 100000; i++) {  //use a counter to prevent being stuck in a loop if something goes wrong
    if ( !newString.includes(oldChars) ) {
      return newString;
    }

    newString = newString.replace(oldChars, newChars);
  }

  return newString;
}

function getTextFromUser(promptText, defaultVal) {
  if ( isBlank(defaultVal) ) {
    defaultVal = "";
  }

  var response = prompt(promptText, defaultVal);

  return response;
}

function getTrcondObj(codename, trCodename, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info){
  var trcondObj, brSvObjExists;

  trcondObj = {};

  if ( isBlank(codename) ) {
    codename = getNextSortedCodename(C_typecode_trcond, trCodename, null, C_att_infotype, null);
  }

  trcondObj.codename = codename;

  brSvObjExists = existsInBrowserSave(C_typecode_trcond, codename, C_att_trCodename);

  if (brSvObjExists) {

    if ( isBlank(trCodename) ) {
      trCodename = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_trCodename);
    }

    if ( isBlank(infotype) ) {
      infotype = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_infotype);
    }

    if ( isBlank(relatedTypecode1) ) {
      relatedTypecode1 = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_relatedTypecode1);
    }

    if ( isBlank(relatedCodename1) ) {
      relatedCodename1 = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_relatedCodename1);
    }

    if ( isBlank(relatedTypecode2) ) {
      relatedTypecode2 = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_relatedTypecode2);
    }

    if ( isBlank(relatedCodename2) ) {
      relatedCodename2 = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_relatedCodename2);
    }

    if ( isBlank(info) ) {
      info = getFromBrSv_valFromAtt(C_typecode_trcond, codename, C_att_info);
    }

  } else {

    trcondObj._existsInBrSv = false;

  }

  trcondObj.trCodename = trCodename;
  trcondObj.infotype = infotype;
  trcondObj.relatedTypecode1 = relatedTypecode1;
  trcondObj.relatedCodename1 = relatedCodename1;
  trcondObj.relatedTypecode2 = relatedTypecode2;
  trcondObj.relatedCodename2 = relatedCodename2;
  trcondObj.info = info;

  trcondObj.existsInBrSv = function() {
    return this._existsInBrSv;
  };

  trcondObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_trcond, this.codename, C_att_trCodename, this.trCodename);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_infotype, this.infotype);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_relatedTypecode1, this.relatedTypecode1);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_relatedCodename1, this.relatedCodename1);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_relatedTypecode2, this.relatedTypecode2);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_relatedCodename2, this.relatedCodename2);
    saveToBrowser(C_typecode_trcond, this.codename, C_att_info, this.info);
    this._existsInBrSv = true;
  };

  return trcondObj;
}

function getTrObj(codename, pageCodename = APP.curPageObj.codename, textOfRow, itmCodename, itmStatusReq, itmInLocInv, itmInLocInv_isIsNot) {
  var trObj = {};

  trObj.codename = codename;

  if ( isBlank(pageCodename) ) {
    pageCodename = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_pageCodename);
  }

  if ( isBlank(textOfRow) ) {
    textOfRow = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_textOfRow);
  }

  if ( isBlank(itmCodename) ) {
    itmCodename = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_itmCodename);
  }

  if ( isBlank(itmStatusReq) ) {
    itmStatusReq = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_itmStatusReq);
  }

  if ( isBlank(itmInLocInv) ) {
    itmInLocInv = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_itmInLocInv);
  }

  if ( isBlank(itmInLocInv_isIsNot) ) {
    itmInLocInv_isIsNot = getFromBrSv_valFromAtt(C_typecode_tr, codename, C_att_itmInLocInv_isIsNot);
  }

  trObj.pageCodename = pageCodename;
  trObj.textOfRow = textOfRow;
  trObj.itmCodename = itmCodename;
  trObj.itmStatusReq = itmStatusReq;
  trObj.itmInLocInv = itmInLocInv;
  trObj.itmInLocInv_isIsNot = itmInLocInv_isIsNot;

  trObj._trcondObjs = [];

  trObj.changeTextOfRow = function(newTextOfRow) {
    this.textOfRow = newTextOfRow;
    saveToBrowser(C_typecode_tr, this.codename, C_att_textOfRow, this.textOfRow);
  };

  trObj.deleteTrcond = function(trcondCodenameToDelete, skipAyRefresh) {
    var newAy;

    deleteFromBrowserSave_multiple(C_typecode_trcond, trcondCodenameToDelete);

    if ( ! skipAyRefresh ) {
      newAy = getObjArrayWithoutElem(this._trcondObjs, C_misc_codename, trcondCodenameToDelete);
      this._trcondObjs = newAy;
    }
  };

  trObj.condsFailed = function() {
    var i;

    for (i = 0; i < this._trcondObjs.length; i++) {
      let curTrcondObj = this._trcondObjs[i];
dc("curTrcondObj.codename",curTrcondObj.codename)
      let condFailed = didCondFail(curTrcondObj);
      if (condFailed) {
        return true;
      }
    }

    return false;
  };

  trObj.condsPassed = function() {
    return ! this.condsFailed();
  };

  trObj.getAllTrcondObjs = function() {
    APP.sort_addedTextForNum = getTypecodeAddedTextForNum(C_typecode_trcond);
    this._trcondObjs.sort( sorting_sortedCodenameAy() );
    APP.sort_addedTextForNum = null;
    return this._trcondObjs;
  };

  trObj.loadTrcondObjsFromBrowserSave = function() {
    var codenameLeft, brSvObjs, i;

    this._trcondObjs = [];

    codenameLeft = getCodenameLeft(this.codename);

    brSvObjs = getBrSvObjsFromBrSv(C_typecode_trcond, null, C_att_infotype, null, codenameLeft);

    for (i = 0; i < brSvObjs.length; i++) {
      let curBrSvObj = brSvObjs[i];
      let newTrcondObj = getTrcondObj(curBrSvObj.codename, this.codename, curBrSvObj.val);
      this._trcondObjs.push(newTrcondObj);
    }
  };

  trObj.init = function() {
    this.loadTrcondObjsFromBrowserSave();
  };

  trObj.condsPassed = function() {
    return ! this.condsFailed();
  };

  trObj.receiveTrcondObj = function(trcondObj) {
    this._trcondObjs.push(trcondObj);
  };

  trObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_tr, this.codename, C_att_pageCodename, this.pageCodename);
    saveToBrowser(C_typecode_tr, this.codename, C_att_textOfRow, this.textOfRow);
    saveToBrowser(C_typecode_tr, this.codename, C_att_itmCodename, this.itmCodename);
    saveToBrowser(C_typecode_tr, this.codename, C_att_itmStatusReq, this.itmStatusReq);
    saveToBrowser(C_typecode_tr, this.codename, C_att_itmInLocInv, this.itmInLocInv);
    saveToBrowser(C_typecode_tr, this.codename, C_att_itmInLocInv_isIsNot, this.itmInLocInv_isIsNot);
  };
  
  return trObj;
}

function getUaObj(codename, pageCodename = APP.curPageObj.codename, uaText, uatype, itmCodename, locCodename, statusReq_itmCodename, statusReq_itmStatus) {
  var uaObj = {};

  uaObj.codename = codename;

  if ( isBlank(pageCodename) ) {
    pageCodename = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_pageCodename);
  }

  if ( isBlank(uaText) ) {
    uaText = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_uaText);
  }

  if ( isBlank(uatype) ) {
    uatype = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_uatype);
  }

  if ( isBlank(itmCodename) ) {
    itmCodename = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_itmCodename);
  }

  if ( isBlank(locCodename) ) {
    locCodename = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_locCodename);
  }

  if ( isBlank(statusReq_itmCodename) ) {
    statusReq_itmCodename = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_statusReq_itmCodename);
  }

  if ( isBlank(statusReq_itmStatus) ) {
    statusReq_itmStatus = getFromBrSv_valFromAtt(C_typecode_ua, codename, C_att_statusReq_itmStatus);
  }

  uaObj.pageCodename = pageCodename;
  uaObj.uaText = uaText;
  uaObj.uatype = uatype;
  uaObj.itmCodename = itmCodename;
  uaObj.locCodename = locCodename;
  uaObj.statusReq_itmCodename = statusReq_itmCodename;
  uaObj.statusReq_itmStatus = statusReq_itmStatus;

  uaObj.condsFailed = function() {
    var i;

    for (i = 0; i < this._uacondObjs.length; i++) {
      let curUacondObj = this._uacondObjs[i];
      let condFailed = didCondFail(curUacondObj);
      if (condFailed) {
        return true;
      }
    }

    return false;
  };

  uaObj.condsPassed = function() {
    return ! this.condsFailed();
  };

  uaObj.deleteUacond = function(uacondCodenameToDelete, skipAyRefresh) {
    var newAy;

    deleteFromBrowserSave_multiple(C_typecode_uacond, uacondCodenameToDelete);

    if ( ! skipAyRefresh ) {
      newAy = getObjArrayWithoutElem(this._uacondObjs, C_misc_codename, uacondCodenameToDelete);
      this._uacondObjs = newAy;
    }
  };

  uaObj.getAllUacondObjs = function() {
    APP.sort_addedTextForNum = getTypecodeAddedTextForNum(C_typecode_uacond);
    this._uacondObjs.sort( sorting_sortedCodenameAy() );
    APP.sort_addedTextForNum = null;
    return this._uacondObjs;
  };

  uaObj.loadUacondObjsFromBrowserSave = function() {
    var codenameLeft, brSvObjs, i;

    this._uacondObjs = [];

    codenameLeft = getCodenameLeft(this.codename);

    brSvObjs = getBrSvObjsFromBrSv(C_typecode_uacond, null, C_att_infotype, null, codenameLeft);

    for (i = 0; i < brSvObjs.length; i++) {
      let curBrSvObj = brSvObjs[i];
      let newUacondObj = getUacondObj(curBrSvObj.codename, this.codename, curBrSvObj.val);
      this._uacondObjs.push(newUacondObj);
    }
  };

  uaObj.init = function() {
    this.loadUacondObjsFromBrowserSave();
  };

  uaObj.receiveUacondObj = function(uacondObj) {
    this._uacondObjs.push(uacondObj);
  };

  uaObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_ua, this.codename, C_att_pageCodename, this.pageCodename);
    saveToBrowser(C_typecode_ua, this.codename, C_att_uaText, this.uaText);
    saveToBrowser(C_typecode_ua, this.codename, C_att_uatype, this.uatype);
    saveToBrowser(C_typecode_ua, this.codename, C_att_itmCodename, this.itmCodename);
    saveToBrowser(C_typecode_ua, this.codename, C_att_locCodename, this.locCodename);
    saveToBrowser(C_typecode_ua, this.codename, C_att_statusReq_itmCodename, this.statusReq_itmCodename);
    saveToBrowser(C_typecode_ua, this.codename, C_att_statusReq_itmStatus, this.statusReq_itmStatus);
  };
  
  return uaObj;
}

function getUacondObj(codename, uaCodename, infotype, relatedTypecode1, relatedCodename1, relatedTypecode2, relatedCodename2, info){
  var uacondObj, brSvObjExists;

  uacondObj = {};

  if ( isBlank(codename) ) {
    codename = getNextSortedCodename(C_typecode_uacond, uaCodename, null, C_att_infotype, null);
  }

  uacondObj.codename = codename;

  brSvObjExists = existsInBrowserSave(C_typecode_uacond, codename, C_att_uaCodename);

  if (brSvObjExists) {

    if ( isBlank(uaCodename) ) {
      uaCodename = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_uaCodename);
    }

    if ( isBlank(infotype) ) {
      infotype = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_infotype);
    }

    if ( isBlank(relatedTypecode1) ) {
      relatedTypecode1 = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_relatedTypecode1);
    }

    if ( isBlank(relatedCodename1) ) {
      relatedCodename1 = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_relatedCodename1);
    }

    if ( isBlank(relatedTypecode2) ) {
      relatedTypecode2 = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_relatedTypecode2);
    }

    if ( isBlank(relatedCodename2) ) {
      relatedCodename2 = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_relatedCodename2);
    }

    if ( isBlank(info) ) {
      info = getFromBrSv_valFromAtt(C_typecode_uacond, codename, C_att_info);
    }

  } else {

    uacondObj._existsInBrSv = false;

  }

  uacondObj.uaCodename = uaCodename;
  uacondObj.infotype = infotype;
  uacondObj.relatedTypecode1 = relatedTypecode1;
  uacondObj.relatedCodename1 = relatedCodename1;
  uacondObj.relatedTypecode2 = relatedTypecode2;
  uacondObj.relatedCodename2 = relatedCodename2;
  uacondObj.info = info;

  uacondObj.existsInBrSv = function() {
    return this._existsInBrSv;
  };

  uacondObj.saveToBrowser = function() {
    saveToBrowser(C_typecode_uacond, this.codename, C_att_uaCodename, this.uaCodename);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_infotype, this.infotype);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_relatedTypecode1, this.relatedTypecode1);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_relatedCodename1, this.relatedCodename1);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_relatedTypecode2, this.relatedTypecode2);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_relatedCodename2, this.relatedCodename2);
    saveToBrowser(C_typecode_uacond, this.codename, C_att_info, this.info);
    this._existsInBrSv = true;
  };

  return uacondObj;
}

function getUatypeDisplayText(uatype) {
  switch(uatype) {
    case C_uatype_examine:
      return "examine";
      break;
    case C_uatype_grabItm:
      return "grab item";
      break;
    case C_uatype_moveToLoc:
      return "move to location";
      break;
  }
}

function getUatypesObjAy() {
  var ay = [];
  var uatypeObj_examine = {};
  var uatypeObj_grabItm = {};
  var uatypeObj_moveToLoc = {};

  uatypeObj_examine.codename = C_uatype_examine;
  uatypeObj_examine.name = getUatypeDisplayText(C_uatype_examine);
  ay.push(uatypeObj_examine);

  uatypeObj_grabItm.codename = C_uatype_grabItm;
  uatypeObj_grabItm.name = getUatypeDisplayText(C_uatype_grabItm);
  ay.push(uatypeObj_grabItm);
  
  uatypeObj_moveToLoc.codename = C_uatype_moveToLoc;
  uatypeObj_moveToLoc.name = getUatypeDisplayText(C_uatype_moveToLoc);
  ay.push(uatypeObj_moveToLoc);

  return ay;
}

function getUniqueCodename(codename, typecode) {
  var i, uniqueCodenameFound = false;

  for (i = 1; i < 10000; i++) {
    let testBsk = getBrowserSaveKey(typecode, codename, C_att_name);

    let x = localStorage.getItem(testBsk);

    if (x == null) {
      uniqueCodenameFound = true;
      break;
    }
    
    codename += i;
  }

  if ( ! uniqueCodenameFound ) {
    throw("ERROR: could not generate unique codename for " + typecode + " / " + codename);
  }

  return codename;
}

function getUsereceivetypeDisplayText(usereceivetype) {
  switch(usereceivetype) {
    case C_usereceivetype_closedOpen:
      return C_status_closed + " / " + C_status_open;
      break;
    case C_usereceivetype_lockedUnlocked:
      return C_status_locked + " / " + C_status_unlocked;
      break;
  }
}

function getUsereceivetypesObjAy() {
  var ay = [];
  var usereceivetypeObj_closedOpen = {};
  var usereceivetypeObj_lockedUnlocked = {};

  usereceivetypeObj_closedOpen.codename = C_usereceivetype_closedOpen;
  usereceivetypeObj_closedOpen.name = getUsereceivetypeDisplayText(C_usereceivetype_closedOpen);
  ay.push(usereceivetypeObj_closedOpen);

  usereceivetypeObj_lockedUnlocked.codename = C_usereceivetype_lockedUnlocked;
  usereceivetypeObj_lockedUnlocked.name = getUsereceivetypeDisplayText(C_usereceivetype_lockedUnlocked);
  ay.push(usereceivetypeObj_lockedUnlocked);

  return ay;
}

function getUsereceivetypeStartStatus(usereceivetype) {
  switch(usereceivetype) {
    case C_usereceivetype_closedOpen:
      return C_status_closed;
      break;
    case C_usereceivetype_lockedUnlocked:
      return C_status_locked;
      break;
  }
}

function getValArrayWithoutElem(theArray, valToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem, valToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;
}

function hideAllDisplays() {
  elem("dvBrowserSaveOuter").style.display = "none";
  elem("dvEditor_AddToLocInventory_Outer").style.display = "none";
  elem("dvEditor_PageAdd_Outer").style.display = "none";
  elem("dvEditor_TrAdd_Outer").style.display = "none";
  elem("dvEditor_UaAdd_Outer").style.display = "none";
  elem("dvEditor_UaDelete_Outer").style.display = "none";
  elem("dvEditor_UaEdit_Outer").style.display = "none";
  elem("dvGameOuter").style.display = "none";
  elem("dvUseItm_Outer").style.display = "none";
  elem("dvUserInventory_Outer").style.display = "none";
  elem("dvEditor_ViewAllPages_Outer").style.display = "none";
}

function hideElem(id) {
  elem(id).style.display = "none"
}

function isBlank(val) {
  if(val === undefined) return true;

  if(val == null) return true;

  if(val == "0")return false;

  if(parseInt(val) == 0)return false;

  if(val == "") return true;

  if(!val)return true;

  return false;
}

function isEqual(val1, val2) {
  if ( isBlank(val1) && isBlank(val2) ) return true;
  if ( val1 == val2 ) return true;
  if ( Number(val1) == Number(val2) ) return true;
  return false;
}

function isNumeric(val) {
  if ( isBlank(val) ) return false;
  return val == val * 1;
}

function isTrue(arg) {
  if ( isBlank(arg) ) {
    return false;
  }

  if ( arg === true ) {
    return true;
  }

  if ( arg == "1" || arg == 1 ) {
    return true;
  }

  if ( String(arg).toLowerCase() == "true" ) {
    return true;
  }

  return false;
}

function left(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theLeft = str.substr(0, numChars);
  return theLeft;
}

function leftIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackLeft = left(haystack, lenNeedle);

  return isEqual(haystackLeft, needle);
}

function loadAllGameCodenames() {
  APP.allGameBrSvObjs = getBrSvObjsFromBrSv(C_typecode_game, null, C_att_name, null, null);
}

function processItmUse(itmCodename_toReceiveUse) {
  var itmObj_toReceiveUse, baseMsg, resultText, resultMsg;

  itmObj_toReceiveUse = getItmObj(itmCodename_toReceiveUse);

  baseMsg = "\nUsing Item:  " + APP.curItmObj.name + "\n";
  baseMsg += "\nOn Item:  " + itmObj_toReceiveUse.name + "\n";

  if ( isBlank(itmObj_toReceiveUse.usereceivetype) ) {

    resultText = "no effect";

  } else if ( ! isEqual(itmObj_toReceiveUse.itmThatAffects, APP.curItmObj.codename) ) {

    resultText = "no effect"

  } else {

    switch (itmObj_toReceiveUse.usereceivetype) {

      case C_usereceivetype_closedOpen:
        if (itmObj_toReceiveUse.status == C_status_closed) {
          itmObj_toReceiveUse.status = C_status_open;
          itmObj_toReceiveUse.saveToBrowser();
          resultText = "" + itmObj_toReceiveUse.name + " is now " + C_status_open;
        } else if (itmObj_toReceiveUse.status == C_status_open) {
          resultText = "no effect (" + itmObj_toReceiveUse.name + " is already " + C_status_open;
        }
        break;

      case C_usereceivetype_lockedUnlocked:
        if (itmObj_toReceiveUse.status == C_status_locked) {
          itmObj_toReceiveUse.status = C_status_unlocked;
          itmObj_toReceiveUse.saveToBrowser();
          resultText = "" + itmObj_toReceiveUse.name + " is now " + C_status_unlocked;
        } else if (itmObj_toReceiveUse.status == C_status_unlocked) {
          resultText = "no effect (" + itmObj_toReceiveUse.name + " is already " + C_status_unlocked;
        }
        break;
    }

  }

  if ( isBlank(resultText) ) {
    resultText = "ERROR: there is a problem with '" + itmObj_toReceiveUse.name + "'";
  }

  resultMsg = baseMsg + "\n\nRESULT:  " + resultText + "\n\n\n";

  if ( ! isBlank(itmObj_toReceiveUse.useReceivedMsg) ) {
    alert("\n" + itmObj_toReceiveUse.useReceivedMsg + "\n\n\n");
  } else {
    alert(resultMsg);
  }

  runCurGame();
}

function right(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theRight = str.substr(str.length - numChars);
  return theRight;
}

function rightIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackRight = right(haystack, lenNeedle);

  return isEqual(haystackRight, needle);
}

function runCurGame() {
  runCurGame_init();

  if (APP.curPageObj && ! isBlank(APP.curPageObj.locCodename) ) {
    APP.curLocObj = getLocObj(APP.curPageObj.locCodename);
  }

  APP.curPageObj.display();

  if (APP.dev == "1") {
    runCurGame_addDevOptions();
  }

  elem("dvGameOuter").style.display = "";
}

function runCurGame_addDevOptions() {
  var curGameName, curPageName, html = "", curPageIsLoc, curPageIsLoc_display;

  if (APP.curGameObj) {
    curGameName = APP.curGameObj.name;
  } else {
    curGameName = "(no game loaded)";
  }

  if (APP.curPageObj) {

    curPageName = APP.curPageObj.name;

    if ( ! isBlank(APP.curPageObj.locCodename) ) {
      curPageIsLoc = true;
      curPageIsLoc_display = "yes";
    } else {
      curPageIsLoc = false;
      curPageIsLoc_display = "no";
    }

  } else {

    curPageName = "(no page loaded)";

  }

  html += "<div><hr></hr></div>\n";
  html += getHtmlDownSpacer(2);
  html += "<div style='color: red'>Dev Options:"

  if ( isTrue(APP.dev_hideEditor) ) {
    html += "&nbsp;&nbsp;<a href='javascript: dev_editor__show_editor ( )'>> show dev editor</a>";
  }

  html += "</div>\n";

  if ( ! isTrue(APP.dev_hideEditor) ) {

    html += getHtmlDownSpacer(2);

    html += "<div>current page: " + curPageName;
    if (APP.curPageObj) {
      html += "&nbsp;&nbsp;<a href='javascript: dev_editor__rename_page ( )'>> rename</a>";
    }
    //html += "&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript: dev_editor__view_all_pages ( )'>> view all pages</a>";
    html += "&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript: dev_editor__goto__create_new_page ( )'>> create new page/location</a></div>\n";

    html += getHtmlDownSpacer();

    html += "<div>current page is a location: " + curPageIsLoc + "</div>\n";

    if (curPageIsLoc) {
      html += getHtmlDownSpacer(2);
      html += "<div>inventory for location:</div>\n";
      html += getHtmlDownSpacer();
      html += APP.curLocObj.getInventoryListHtml(null, true, false);
      html += "<div>" + getHtml_a("> add to location's inventory", "dev_editor__goto__add_to_location_inventory", APP.curLocObj.codename) + "</div>\n";
    }

    html += getHtmlDownSpacer(2);

    html += "<div>current game: " + curGameName;
    //if (APP.curGameObj) {
    //  html += "&nbsp;&nbsp;<a href='javascript: dev_editor__rename_game ( )'>> rename</a>";
    //}
    //html += "&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript: dev_editor__view_all_games ( )'>> view all games</a></div>\n";
    html += "</div>\n";

    html += getHtmlDownSpacer();
    html += "<div><a href='javascript: dev_editor__reset_game ( )'>> reset game</a></div>\n";

    html += getHtmlDownSpacer(2);

    html += "<a href='javascript: browser_save__view ( )'>> view browser saved data</a></div>\n";

    html += getHtmlDownSpacer();

    html += "<a href='javascript: dev_editor__hide_editor ( )'>> hide dev editor</a></div>\n";
  }

  elem("dvGameInner_Dev").innerHTML = html;
}

function runCurGame_init() {
  var userEntLocObj;

  runCurGame_init_Pages();
  runCurGame_init_userEntity();

  userEntLocObj = getLocObj(APP.userEntObj.locCodename);
}

function runCurGame_init_Pages() {
  if ( isBlank(APP.curGameObj.curPageCodename) ) {

    let startPageObj;

    if ( isBlank(APP.curGameObj.startPageCodename) ) {
      let allPageBrSvObjs = getBrSvObjsFromBrSv(C_typecode_page, null, C_att_gameCodename, APP.curGameObj.codename, null);

      if (allPageBrSvObjs.length == 0) {
        startPageObj = getAndMakeNewPage(APP.curGameObj, "Room 1", null, true);
      } else {
        let pageCodename = allPageBrSvObjs[0].codename;
        startPageObj = getPageObj(pageCodename);
      }

      APP.curGameObj.startPageCodename = startPageObj.codename;
      APP.curGameObj.saveToBrowser();
    } else {
      startPageObj = getPageObj(APP.curGameObj.startPageCodename);
    }

    APP.curGameObj.curPageCodename = APP.curGameObj.startPageCodename;
    APP.curGameObj.saveToBrowser();

    APP.curPageObj = startPageObj;

  } else {

    APP.curPageObj = getPageObj(APP.curGameObj.curPageCodename);

  }
}

function runCurGame_init_userEntity() {
  var i, hasUserEnt = false;

  APP.curGame_allEntBrSvObjs = getBrSvObjsFromBrSv(C_typecode_ent, null, C_att_gameCodename, APP.curGameObj.codename, null);

  for (i = 0; i < APP.curGame_allEntBrSvObjs.length; i++) {
    let curEntCodename;

    curEntCodename = APP.curGame_allEntBrSvObjs[i].codename;

    if ( isEqual(curEntCodename, APP.curGameObj.codename + "," + C_misc_userCodename) ) {
      APP.userEntObj = getEntObj(curEntCodename, APP.curGameObj.codename);
      hasUserEnt = true;
      break;
    }
  }

  if ( ! hasUserEnt ) {

    APP.userEntObj = getAndMakeNewEnt(undefined, C_misc_userDefName, C_misc_userCodename, true, APP.curPageObj.locCodename, APP.curPageObj.locCodename);
  }
}

function runUserAction(uatype, uaVar1) {
  switch (uatype) {

    case C_uatype_examine:
      {
        let uaObj, itmObj, eidObj, msgToShow;

        uaObj = getUaObj(uaVar1);
        itmObj = getItmObj(uaObj.itmCodename);

        eidObj = findEntinfoDataObj(itmObj.codename, C_infotype_itmExam, C_typecode_itm, itmObj.codename, undefined)

        if ( eidObj == null ) {
          eidObj = getAndMakeNewEntinfoData(APP.userEntObj.codename, C_infotype_itmExam, C_typecode_itm, itmObj.codename, C_info_yes);
        } else if ( ! isEqual(eidObj.info, C_info_yes) ) {
          eidObj.changeInfo(C_info_yes);
        }

        if ( isBlank(itmObj.examineMsg) ) {
          msgToShow = "There is nothing special about this object.";
        } else {
          msgToShow = itmObj.examineMsg;
        }

        alert("\n" + itmObj.name + "\n\n\n" + msgToShow + "\n\n\n");

        APP.curPageObj.display();
      }
      break;

    case C_uatype_grabItm:
      {
        let uaObj = getUaObj(uaVar1);
        let itmObj = getItmObj(uaObj.itmCodename);
        let curLocObj = APP.curPageObj.getLocObj();

        APP.userEntObj.receiveItmObj(itmObj);
        curLocObj.removeItmObj(itmObj);

        runCurGame();
      }
      break;

    case C_uatype_moveToLoc:
      {
        let uaObj = getUaObj(uaVar1);
        let moveToLocObj = getLocObj(uaObj.locCodename);

        APP.curPageObj = getPageObj(moveToLocObj.pageCodename);

        APP.curGameObj.curPageCodename = APP.curPageObj.codename;
        APP.curGameObj.saveToBrowser();

        APP.userEntObj.moveToLocObj(moveToLocObj);

        runCurGame();
      }
      break;

    case C_userAction_openInventory:
      // OLD, but still using for now
      displayUserInventory();
      break;

  
    default:
      alert("ERROR: action '" + getUatypeDisplayText(uatype) + "' was not found");
  }
}

function saveToBrowser(typecode, codename, att, val) {
  var bsk = getBrowserSaveKey(typecode, codename, att);
  
  if ( isBlank(val) ) {
    val = "";
  }

  localStorage.setItem(bsk, val);
}

function setAppSetting(settingName, val) {
  saveToBrowser(C_typecode_appSetting, settingName, null, val);
}

function setLocationAttInBrowserSave(locCodename, att, locAttVal) {
  saveToBrowser(C_typecode_loc, locCodename, att, locAttVal);
}

function setPageToNonLocation(page) {
  page.isLocation = false;
}

function showElem(id) {
  elem(id).style.display = ""
}

function sorting_objs(propNameToSortBy) {
  return function(objA, objB) {
    var comparisonCode;

    var objA_hasProp = doesObjHaveProp(objA, propNameToSortBy);
    var objB_hasProp = doesObjHaveProp(objB, propNameToSortBy);

    if ( objA_hasProp && objB_hasProp ) {
      comparisonCode = sorting_returnComparisonCode(objA[propNameToSortBy], objB[propNameToSortBy]);
    } else if ( objA_hasProp ) {
      comparisonCode = -1;
    } else if ( objB_hasProp ) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };

  /* test code for this function:

  var i, ay = [];

  var x1 = {};
  x1.thisObjName = "x1";
  // no setting x1.prop1
  ay.push(x1);

  var x2 = [];
  x2.thisObjName = "x2";
  x2.prop1 = "b";
  ay.push(x2);

  var x3 = [];
  x3.thisObjName = "x3";
  x3.prop1 = null;
  ay.push(x3);

  var x4 = [];
  x4.thisObjName = "x4";
  x4.prop1 = "";
  ay.push(x4);

  var x5 = [];
  x5.thisObjName = "x5";
  x5.prop1 = "c";
  ay.push(x5);

  var x6 = [];
  x6.thisObjName = "x6";
  x6.prop1 = "a";
  ay.push(x6);

  dc_("--------------------");

  for (i = 0; i < ay.length; i++) {
    dc_("PRE-sort: ay[" + i + "], .thisObjName=" + ay[i].thisObjName + ", .prop1=" + ay[i].prop1);
  }

  dc_("--------------------");

  ay.sort( sorting_objs("prop1") );

  for (i = 0; i < ay.length; i++) {
    dc_("POST-sort: ay[" + i + "], .thisObjName=" + ay[i].thisObjName + ", .prop1=" + ay[i].prop1);
  }

  */
}

function sorting_returnComparisonCode(valA, valB) {
  var comparisonCode;

  var aIsBlank = isBlank(valA);
  var bIsBlank = isBlank(valB);

  var aIsNumeric = isNumeric(valA);
  var bIsNumeric = isNumeric(valB);

  // return -1  -->  A comes before B
  // return  1  -->  B comes before A
  // return  0  -->  neither A nor B comes first

  if ( aIsBlank && bIsBlank ) {
    // both are blank, so neither comes first
    comparisonCode = 0;

  } else if (aIsBlank && !bIsBlank) {
    // A is blank, so B comes first
    comparisonCode = 1;

  } else if (!aIsBlank && bIsBlank) {
    // B is blank, so A comes first
    comparisonCode = -1;

  } else if (aIsNumeric && !bIsNumeric) {
    // A is a number, but B is not, so A comes first
    comparisonCode = -1;

  } else if (!aIsNumeric && bIsNumeric) {
    // B is a number, but A is not, so B comes first
    comparisonCode = 1;

  } else if (aIsNumeric && bIsNumeric) {

    // both are numbers...
    let valA_num = parseFloat(valA);
    let valB_num = parseFloat(valB);

    if (valA_num < valB_num) {
      // A < B numerically, so A comes first
      comparisonCode = -1;

    } else if (valA_num > valB_num) {
      // A > B numerically, so B comes first
      comparisonCode = 1;

    } else {
      // A == B numerically, so neither comes first
      comparisonCode = 0;

    }

  } else {

    // both are non-blank non-numbers, so compare as lowercase strings
    let valA_str = String(valA).toLowerCase();
    let valB_str = String(valB).toLowerCase();

    if (valA_str < valB_str) {
      // A < B by lowercase-string comparison, so A comes first
      comparisonCode = -1;

    } else if (valA_str > valB_str) {
      // A > B by lowercase-string comparison, so B comes first
      comparisonCode = 1;

    } else {
      // A == B by lowercase-string comparison, so neither comes first
      comparisonCode = 0;

    }

  }

  return comparisonCode;
}

const sorting_sortedCodenameAy = () => {
  return (ayObjA, ayObjB) => {
    var codenameParts, codenameLeft, leftStrToRemove, sortvalA, sortvalB;

    /* OLD - move to getCodenameUniquePart()
    codenameParts = ayObjA.codename.split(",");
    codenameLeft = getCodenameLeft(codenameParts[0], codenameParts[1]);

    if ( isBlank(APP.sort_addedTextForNum) ) {
      leftStrToRemove = codenameLeft;
    } else {
      leftStrToRemove = codenameLeft + APP.sort_addedTextForNum;
    }

    sortvalA = withoutLeft(ayObjA.codename, leftStrToRemove);
    sortvalB = withoutLeft(ayObjB.codename, leftStrToRemove);
    */

    sortvalA = getCodenameUniquePart(ayObjA.codename, APP.sort_addedTextForNum);
    sortvalB = getCodenameUniquePart(ayObjB.codename, APP.sort_addedTextForNum);

    if ( Number(sortvalA) < Number(sortvalB) ) {
      return -1;
    } else {
      return 1;
    }
  };
};

function sorting_vals() {
  return function(valA, valB) {
    var comparisonCode = sorting_returnComparisonCode(valA, valB);
    return comparisonCode;
  };
}

function startApp() {
  var defGameCodename, defGameObj;

  startApp_processQueryString();

  APP.dev = getAsOneZero( getAppSetting(C_appSetting_dev) );

  //keys_startMonitoring();

  if ( getAppSetting(C_appSetting_LS) == "1" ) {
    displayBrowserSave();
    return;
  }

  APP.dev_hideEditor = getAsOneZero( getAppSetting(C_appSetting_dev_hideEditor) );

  loadAllGameCodenames();

  defGameCodename = getAppSetting(C_appSetting_defaultGameCodename);

  if ( isBlank(defGameCodename) ) {
    if (APP.allGameBrSvObjs.length > 0) {
      defGameCodename = APP.allGameBrSvObjs[0].codename;
    } else {
      defGameObj = getAndMakeNewGame("game-1", "Your First Game");
      defGameCodename = defGameObj.codename;
    }
  
    setAppSetting(C_appSetting_defaultGameCodename, defGameCodename);
  }

  if ( ! defGameObj ) {
    defGameObj = getGameObj(defGameCodename);
  }

  APP.curGameObj = defGameObj;

  runCurGame();
}

function startApp_processQueryString() {
  var qs_urlParams = new URLSearchParams(window.location.search);

  if ( qs_urlParams.has(C_appSetting_dev) ) {
    setAppSetting(C_appSetting_dev, "1");
  }

  if ( qs_urlParams.has(C_appSetting_narrow) ) {
    setAppSetting(C_appSetting_narrow, "1");
  }

  if ( qs_urlParams.has(C_appSetting_LS) ) {
    setAppSetting(C_appSetting_LS, "1");
  } else {
    setAppSetting(C_appSetting_LS, "0");
  }
}

function withoutLeft(haystack, needle) {
  if (typeof haystack !== "string") return "";
  if (typeof needle !== "string") return haystack;

  var lenNeedle = needle.length;

  if (lenNeedle == 0) {
    return haystack;
  }

  var haystackLeft = left(haystack, lenNeedle);

  if ( isEqual(haystackLeft, needle) ) {
    return haystack.substr(lenNeedle);
  } else {
    return haystack;
  }
}

function withoutRight(haystack , needle) {
  if (typeof haystack !== "string") return "";
  if (typeof needle !== "string") return haystack;

  var lenNeedle = needle.length;

  if (lenNeedle == 0) {
    return haystack;
  }

  var haystackRight = right(haystack, lenNeedle);

  if ( isEqual(haystackRight, needle) ) {
    return haystack.substr(0, haystack.length - lenNeedle);
  } else {
    return haystack;
  }
}

function writeBrowserSavedData() {
  var i, keyName, keyValue, html = "", appSetting_narrow;
  var ay = [];

  appSetting_narrow = getAppSetting(C_appSetting_narrow);

  html += "<div><a href='javascript: browser_save__add_row()'>add row</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript: browser_save__refresh_view()'>refresh view</a></div>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<table cellpadding=5 cellspacing=0 border=1>\n";

  if (localStorage.length <= 0) {
    html += "<tr><td>(no items in storage)</td></tr>\n";
  } else {
    if (appSetting_narrow == "1") {
      html += "<tr><td></td><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><b>Key Name</b></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td style='height: 1px; background-color: black'></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td><b>Key Value</b></td></tr>\n";
      html += "  </table>\n";
      html += "</td></tr>\n";
    } else {
      html += "<tr><td></td><td><b>Key Name</b></td><td><b>Key Value</b></td></tr>\n";
    }
  }

  // put localStorage into an array, for sorting
  for (i = 0; i < localStorage.length; i++) {
    let lsPair = {};
    lsPair.keyName = localStorage.key(i);
    lsPair.keyValue = localStorage.getItem(lsPair.keyName);
    ay.push(lsPair);
  }

  ay.sort( writeBrowserSavedData_sortingFunc() );

  for (i = 0; i < ay.length; i++) {
    keyName = ay[i].keyName;
    keyValue = ay[i].keyValue;

    if (appSetting_narrow == "1") {
      html += "<tr><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><a href='javascript: browser_save__edit_row(\"" + keyName + "\")'>edit</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript: browser_save__change_key_name(\"" + keyName + "\")'>change key</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript: browser_save__delete_row(\"" + keyName + "\")'>delete</a></td></tr>\n";
      html += "  </table>\n";
      html += "</td>\n";
    } else {
      html += "<tr><td style='white-space: nowrap'>&nbsp;<a href='javascript: browser_save__edit_row(\"" + keyName + "\")'>edit</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript: browser_save__change_key_name(\"" + keyName + "\")'>change key</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript: browser_save__delete_row(\"" + keyName + "\")'>delete</a>&nbsp;&nbsp;</td>\n";
    }

    if (appSetting_narrow == "1") {
      html += "<td>" + keyName + "</td></tr>\n";
      html += "<tr><td></td><td>" + keyValue + "</td></tr>\n";
    } else {
      html += "<td>" + keyName + "</td><td>" + keyValue + "</td></tr>\n";
    }
  }

  html += "</table>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<div><a href='javascript: browser_save__add_row()'>add row</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript: browser_save__refresh_view()'>refresh view</a></div>\n";

  elem("dvBrowserSaveInner").innerHTML = html;
}

const writeBrowserSavedData_sortingFunc = () => {
  return (lsPairA, lsPairB) => {
    if (lsPairA.keyName.toLowerCase() < lsPairB.keyName.toLowerCase()) {
      return -1;
    } else {
      return 1;
    }
  };
};


// USER-VIEWABLE FUNCTIONS

function browser_save__add_row() {
  var keyName = prompt("\nNew key name:", "");
  var keyValue = prompt("\nNew key value:", "");

  if ( isBlank(keyName) ) {
    return undefined;
  }

  localStorage.setItem(keyName, keyValue);
  displayBrowserSave();
  return undefined;
}

function browser_save__change_key_name(curKeyName) {
  var editedKeyName, keyValue, keyValueFromEditedKeyName, warningMsg, confirmationMsg;

  //get new key name user requests
  editedKeyName = prompt("\nChange key name to:", curKeyName);

  //exit if user did not provide a new key name
  if ( isBlank(editedKeyName) ) {
    return undefined;
  }

  //grab existing key value for current key name
  keyValue = localStorage.getItem(curKeyName);

  //check to see if new requestd key name is already in use; if so, disallow
  keyValueFromEditedKeyName = localStorage.getItem(editedKeyName);
  if ( !isBlank(keyValueFromEditedKeyName) ) {
    warningMsg = "*** OPERATION DISALLOWED ***\n";
    warningMsg += "You tried to change key with keyName='" + curKeyName + "'\n";
    warningMsg += "( keyValue='" + keyValue + "' )\n";
    warningMsg += "... to the new-keyName '" + editedKeyName + "'\n";
    warningMsg += "... but that new-keyName already exists, with existing-keyValue '" + keyValueFromEditedKeyName + "'";
    alert(warningMsg);
    return undefined;
  }

  //save new key to storage
  localStorage.setItem(editedKeyName, keyValue);

  //delete previous key name
  localStorage.removeItem(curKeyName);

  //provide info with change
  confirmationMsg = "Change Made:\n\n";
  confirmationMsg += " old-keyName: " + curKeyName + "\n";
  confirmationMsg += " new-keyName " + editedKeyName + "\n";
  confirmationMsg += " keyValue: " + keyValue;
  alert(confirmationMsg);

  //refresh storage view
  displayBrowserSave();
  return undefined;
}

function browser_save__delete_all_saved_data() {
  var clearStoragePrompt;
  
  //disabling typing of "clear it" confirmation during heavy design and development phase
  //clearStoragePrompt = prompt("\ntype 'clear it' to clear local storage", "");
  //if (clearStoragePrompt == "clear it") {
  //  localStorage.clear();
  //  alert("storage cleared");
  //} else {
  //  alert("storage NOT cleared");
  //}

  if ( confirm("\nDelete all saved browser data?\n\n\n") ) {

    localStorage.clear();

    if ( confirm("\nStorage cleared.\n\nRestart app?\n\n\n") ) {
      location.reload(true);
    }

  } else {

    alert("\nOperaton canceled. Storage NOT cleared.\n\n\n");

  }

  return undefined;
}

function browser_save__delete_row(keyName) {
  if ( confirm("\nDelete this row?\n\n\n") ) {
    localStorage.removeItem(keyName);
    displayBrowserSave();
  }
  return undefined;
}

function browser_save__edit_row(keyName) {
  var curKeyValue = localStorage.getItem(keyName);

  var editedKeyValue = prompt( "\nChange key value to:", getProcessedStringForTextView(curKeyValue) );

  if ( editedKeyValue == null ) {
    return undefined;
  }

  editedKeyValue = getProcessedStringForSave(editedKeyValue);

  localStorage.setItem(keyName, editedKeyValue);
  displayBrowserSave();
  return undefined;
}

function browser_save__return_to_game() {
  elem("dvBrowserSaveOuter").style.display = "none";
  startApp();
  return undefined;
}

function browser_save__refresh_view() {
  displayBrowserSave();
  return undefined;
}

function browser_save__view() {
  displayBrowserSave();
  return undefined;
}

function dev_editor__add_text_row__cancel_add() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__add_text_row__do_add() {
  var textOfRow = getElemVal("ipEditor_TrAdd_TextOfRow");
  var itmCodename = getElemVal("selEditor_TrAdd_ItmCodename");
  var itmInLocInv = getElemVal("selEditor_TrAdd_ItmInLocInv");
  var itmInLocInv_isIsNot;
  var itmStatusReq = null;
  var infotype = getElemVal("selEditor_TrAdd_UserInfo_InfoType");
  var examObj_itmCodename;
  var trObj;

  if ( isBlank(textOfRow) ) {
    alert("\nPlease enter 'Display Text'\n\n\n");
    elem("ipEditor_TrAdd_TextOfRow").focus();
    return undefined;
  }

  if ( ! isBlank(itmCodename) ) {
    itmStatusReq = getElemVal("selEditor_TrAdd_ItmStatusReq");

    if ( isBlank(itmStatusReq) ) {
      alert("\nPlease select 'Object Status Required'\n\n\n");
      return undefined;
    }

    itmInLocInv_isIsNot = getElemVal("selEditor_TrAdd_ItmInLocInv_IsIsNot");
  }

  if ( ! isBlank(infotype) ) {
    examObj_itmCodename = getElemVal("selEditor_TrAdd_ExamObj_ItmCodename");

    if ( isBlank(examObj_itmCodename) ) {
      alert("\nPlease select 'Examined Which Object'\n\n\n");
      return undefined;
    }
  }

  trObj = getAndMakeNewTr(undefined, textOfRow, itmCodename, itmStatusReq, itmInLocInv, itmInLocInv_isIsNot);

  if ( ! isBlank(infotype) ) {
    getAndMakeNewTrcond(trObj, infotype, C_typecode_ent, APP.userEntObj.codename, C_typecode_itm, examObj_itmCodename, C_info_yes);
  }

  runCurGame();

  return undefined;
}

function dev_editor__add_to_location_inventory__cancel_add() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__add_to_location_inventory__do_add() {
  var itmName, canGrab, usereceivetype, startStatus, status, itmThatAffects, useReceivedMsg, statusReq_itmCodename, statusReq_itmStatus, itmObj, examineMsg;

  itmName = getElemVal("ipEditor_AddToLocInventory_ItmName");
  canGrab = getElemVal("ipEditor_AddToLocInventory_CanGrab");
  usereceivetype = getElemVal("selEditor_AddToLocInventory_Usereceivetype");

  if ( isBlank(itmName) ) {
    alert("\nPlease enter 'Name of New Object'\n\n\n");
    elem("ipEditor_AddToLocInventory_ItmName").focus();
    return undefined;
  }

  statusReq_itmCodename = getElemVal("selEditor_AddToLocInventory_StatusReq_ItmCodename");

  if ( ! isBlank(statusReq_itmCodename) ) {
    statusReq_itmStatus = getElemVal("selEditor_AddToLocInventory_StatusReq_ItmStatus");

    if ( isBlank(statusReq_itmStatus) ) {
      alert("\nPlease select 'to have Status'\n\n\n");
      return undefined;
    }
  }

  if ( ! isBlank(usereceivetype) ) {
    startStatus = getUsereceivetypeStartStatus(usereceivetype);
    status = startStatus;

    itmThatAffects = getElemVal("selEditor_AddToLocInventory_ItmThatAffects");
    if ( isBlank(itmThatAffects) ) {
      alert("\nPlease enter 'Other Object That Can Be Used Upon This'\n\n\n");
      return undefined;
    }
  }

  useReceivedMsg = getElemVal("ipEditor_AddToLocInventory_UseReceivedMsg");

  examineMsg = getElemVal("ipEditor_AddToLocInventory_ExamineMsg");

  itmObj = getAndMakeNewItm(APP.curGameObj, itmName, canGrab, APP.curPageObj.locCodename, usereceivetype, startStatus, status, itmThatAffects, useReceivedMsg, statusReq_itmCodename, statusReq_itmStatus, examineMsg)

  APP.curLocObj.receiveItmObj(itmObj);
  
  runCurGame();
  return undefined;
}

function dev_editor__add_user_action__cancel_add() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__add_user_action__do_add() {
  var uaText = getElemVal("ipEditor_UaAdd_UaText");
  var uatype = getElemVal("selEditor_UaAdd_Uatype");
  var itmCodename, locCodename, statusReq_itmCodename, statusReq_itmStatus;

  if ( isBlank(uaText) ) {
    alert("\nPlease enter 'Name of Action'\n\n\n");
    elem("ipEditor_UaAdd_UaText").focus();
    return undefined;
  }

  if ( isBlank(uatype) ) {
    alert("\nPlease select 'Action Type'\n\n\n");
    return undefined;
  }

  switch(uatype) {

    case C_uatype_examine:
      itmCodename = getElemVal("selEditor_UaAdd_ItmCodename");
      if ( isBlank(itmCodename) ) {
        alert("\nPlease select 'Object'\n\n\n");
        return undefined;
      }
      break;

    case C_uatype_grabItm:
      itmCodename = getElemVal("selEditor_UaAdd_ItmCodename");
      if ( isBlank(itmCodename) ) {
        alert("\nPlease select 'Object'\n\n\n");
        return undefined;
      }
      break;

    case C_uatype_moveToLoc:
      locCodename = getElemVal("selEditor_UaAdd_LocCodename");
      if ( isBlank(locCodename) ) {
        alert("\nPlease select 'Location'\n\n\n");
        return undefined;
      }
      break;

  }

  statusReq_itmCodename = getElemVal("selEditor_UaAdd_StatusReq_ItmCodename");

  if ( ! isBlank(statusReq_itmCodename) ) {
    statusReq_itmStatus = getElemVal("selEditor_UaAdd_StatusReq_ItmStatus");

    if ( isBlank(statusReq_itmStatus) ) {
      alert("\nPlease select 'to have Status'\n\n\n");
      return undefined;
    }
  }

  getAndMakeNewUa(undefined, uaText, uatype, itmCodename, locCodename, statusReq_itmCodename, statusReq_itmStatus);

  runCurGame();

  return undefined;
}

function dev_editor__create_new_page__cancel_add() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__create_new_page__do_add() {
  var name = getElemVal("ipEditor_PageAdd_Name");

  if ( isBlank(name) ) {
    alert("\nPlease enter 'Name of Page/Location'\n\n\n");
    return undefined;
  }

  getAndMakeNewPage(APP.curGameObj, name, null, true);

  alert("\nPage created\n\n\n")

  runCurGame();

  return undefined;
}

function dev_editor__delete_text_row(trCodename) {
  var curTextOfRow, trObj, trcondObjs;
  
  curTextOfRow = getFromBrSv_valFromAtt(C_typecode_tr, trCodename, C_att_textOfRow);

  if ( confirm("\nPlease confirm that you want to delete this text-row\n\n\n") ) {
    APP.curPageObj.deleteTr(trCodename);

    displayPage(APP.curPageObj);
  }

  return undefined;
}

function dev_editor__delete_user_action__cancel_delete() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__delete_user_action__do_delete() {
  var uaObj;

  uaObj = APP.curPageObj.deleteUa(APP.editor_curUaCodename);
  displayPage(APP.curPageObj);
  
  APP.editor_curUaCodename = null;

  return undefined;
}

function dev_editor__edit_user_action__cancel_edit() {
  displayPage(APP.curPageObj);
  return undefined;
}

function dev_editor__edit_user_action__do_edit() {
}

function dev_editor__edit_text_row(trCodename) {
  var curTextOfRow, newTextOfRow, trObj;

  trObj = APP.curPageObj.getTrObj(trCodename);  

  newTextOfRow = prompt("\nEnter new text:", trObj.textOfRow);

  if ( ! isBlank(newTextOfRow) ) {
    trObj.textOfRow = newTextOfRow;
    trObj.saveToBrowser();

    displayPage(APP.curPageObj);
  }

  return undefined;
}

function dev_editor__edit_user_action_text(uaCodename) {
  var curUaText, newUaText, uaObj;

  uaObj = APP.curPageObj.getUaObj(uaCodename);

  newUaText = prompt("\nEnter new text:", uaObj.uaText);

  if ( ! isBlank(newUaText) ) {
    uaObj.uaText = newUaText;
    uaObj.saveToBrowser();

    displayPage(APP.curPageObj);
  }

  return undefined;
}

function dev_editor__goto__add_to_location_inventory() {
  devEditor_addToLocInventory();
  return undefined;
}

function dev_editor__goto__add_text_row() {
  devEditor_trAdd();
  return undefined;
}

function dev_editor__goto__add_user_action() {
  devEditor_uaAdd();
  return undefined;
}

function dev_editor__goto__create_new_page() {
  devEditor_pageAdd();
  return undefined;
}

function dev_editor__goto__delete_user_action(uaCodename) {
  APP.editor_curUaCodename = uaCodename;
  devEditor_uaDelete(uaCodename);
  return undefined;
}

function dev_editor__goto__edit_user_action(uaCodename) {
  APP.editor_curUaCodename = uaCodename;
  devEditor_uaEdit(uaCodename);
  return undefined;
}

function dev_editor__hide_editor() {
  setAppSetting(C_appSetting_dev_hideEditor, "1")
  startApp();
  return undefined;
}

function dev_editor__rename_game() {
  var newName;
  
  newName = prompt("\nEnter new name:", APP.curGameObj.name);

  if ( isBlank(newName) ) {
    return undefined;
  }

  APP.curGameObj.name = newName;
  APP.curGameObj.saveToBrowser();

  runCurGame();

  return undefined;
}

function dev_editor__rename_inventory_object(codename) {
  var itmObj, newName;

  itmObj = getItmObj(codename);

  var newName = prompt("Enter new name:", itmObj.name);

  if ( ! isBlank(newName) ) {
    itmObj.name = newName;
    itmObj.saveToBrowser();

    runCurGame();
  }

  return undefined;
}

function dev_editor__rename_page() {
  var newName;
  
  newName = prompt("\nEnter new name:", APP.curPageObj.name);

  if ( ! isBlank(newName) ) {
    APP.curPageObj.name = newName;
    APP.curPageObj.saveToBrowser();

    runCurGame();
  }

  return undefined;
}

function dev_editor__reset_game() {
  if ( confirm("\nAre you sure you want to reset this game?\n\n\n") ) {
    APP.curGameObj.reset();
    runCurGame();
  }

  return undefined;
}

function dev_editor__show_editor() {
  setAppSetting(C_appSetting_dev_hideEditor, "0")
  startApp();
  return undefined;
}

function dev_editor__view_all_games() {
  return undefined;
}

function dev_editor__view_all_pages() {
  return undefined;
}

function do_action(uatype, uaVar1) {
  runUserAction(uatype, uaVar1);
  return undefined;
}

function receive_use_from_object(itmCodename) {
  processItmUse(itmCodename)
  return undefined;
}

function return_from_user_inventory() {
  runCurGame();
}

function return_to_user_inventory() {
  do_action(C_userAction_openInventory);
  return undefined;
}

function use_object(codename) {
  displayUseItm(codename);
  return undefined;
}

// START APP (also runs the default game)

startApp();


</script>

</body>

</html>
