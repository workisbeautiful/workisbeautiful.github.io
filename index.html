<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>

<style>
* {box-sizing: border-box}

a {color: blue; outline: 0}
a:link {text-decoration: none}
a:visited {text-decoration: none}
a:hover {text-decoration: underline}
a:focus {text-decoration: underline}
a:active {text-decoration: none}

body {font-size: 110%; font-family: Helvetica}
/* div {padding: 0; margin: 0} */
input {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9}
input.ipMonthDay {width: 1.85em; padding-top: 3px; text-align: center}
input.ipNumeric {width: 3em; padding-left: 4px; padding-right: 4px; padding-top: 3px}
input.ipText {padding-left: 4px; padding-right: 4px; padding-top: 1px}
input.ipTime {width: 1.85em; padding-top: 3px; text-align: center}
input.ipYear {width: 2.85em; padding-top: 3px; text-align: center}
select {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9; padding-left: 1px; padding-right: 1px}
table {}

.grid1 {display: grid; grid-template-columns: auto auto auto; padding: 0.5em; padding-right: 0.75em; padding-bottom: 0.65em}
.grid1Cell {/* border: 1px solid red */}
.gc1Header {grid-column: 1/4; padding-bottom: 0.5em; border-bottom: 1px gray solid; text-align: center}
.gc1Line {grid-column: 1/4; border-bottom: 1px gray solid}
.gc1VSpace1 {grid-column: 1/4; padding-bottom: 1em}
.gc1VSpace2 {grid-column: 1/4; padding-bottom: 1em}
.gc1VSpace3 {grid-column: 1/4; padding-bottom: 0.5em}
.gc1VSpace4 {grid-column: 1/4; padding-bottom: 1.8em}
.gc1VSpaceX {grid-column: 1/4}
.gc1Text {white-space: nowrap; padding-right: 0.6em; padding-top: 3px; text-align: right}
.gc1TextRight {font-style: italic; padding-top: 3px; text-align: left}
.gc1TextForCheckbox {white-space: nowrap; padding-right: 0.6em; text-align: right}
.gc1TextForActionCheckbox {grid-column: 1/3; padding-right: 0.6em; text-align: right}
.gc1Input {grid-column: 2/4}
.gc1Select {grid-column: 2/4}
.gc1Checkbox {grid-column: 2/4}
.gc1ActionCheckbox {padding-top: 0px /* 2px top padding looked even on PC, but not on Android */}
.gc1ActionCheckboxFirst {padding-right: 5em}
.gc1Footer {grid-column: 1/4; text-align: center}
.gc1QuickLinks {grid-column: 1/4; text-align: left}

.grid2 {display: inline-grid; grid-template-columns: auto auto}
.grid2Cell {/* border: 1px solid red */}
.gc2Header {grid-column: 1/3; padding-bottom: 0.5em; border-bottom: 1px gray solid; text-align: left}
.gc2Header2 {grid-column: 1/3; padding-bottom: 0.4em; border-bottom: 1px gray solid; text-align: center}
.gc2VSpace1 {grid-column: 1/3; padding-bottom: 0.6em}
.gc2VSpace2 {grid-column: 1/3; padding-bottom: 0.6em}
.gc2VSpace3 {grid-column: 1/3; padding-bottom: 0.5em}
.gc2TextLeft {white-space: nowrap; padding-right: 0.8em; /* padding-top: 3px; */ text-align: right}
.gc2TextRight {white-space: nowrap}
.gc2Footer {grid-column: 1/3; text-align: left}

.grid3 {display: grid; grid-template-columns: auto auto; grid-gap: 10px; border: 2px solid grey; padding: 10px}
.gc3 {border: 1px solid lightgrey; padding: 5px}
.gc3TextLeft {width: 150px; padding-right: 5px; text-align: right}
.gc3TextRight {width: 150px}
.gc3LikeInput {width: 140px; display: inline-block; text-align: center}
.gc3InputRight {width: 150px}
.gc3Header {grid-column: 1/3; font-weight: bold; font-size: 18px; text-align: center}
.gc3Footer {grid-column: 1/3; text-align: center}

.bold {font-weight: bold}
.font85 {font-size: 85%}
.font135 {font-size: 135%}

.backgroundBlack {background-color: black}
.backgroundBlue {background-color: blue}
.backgroundBrown {background-color: brown}
.backgroundGreen {background-color: #00CC66}
.backgroundRed {background-color: red}
.black {color: black}
.blue {color: blue}
.borderBlack {border: 0.07em solid black}
.borderBlue {border: 0.07em solid blue}
.borderBrown {border: 0.07em solid brown}
.borderGreen {border: 0.07em solid #00CC66}
.borderRed {border: 0.07em solid red}
.brown {color: brown}
.green {color: #00CC66}
.red {color: red}

.likeInput {font-size: 95%; background-color: #f9f9f9; border: 1px solid darkgray; box-shadow: 1px 1px 1px 0 lightgray inset}

.popUpMaxTextWidth {width: 10em}
.popUpText {display: block}

/*
input.ipTime {background-color: yellow}
input.ipTime {width: 2em; padding-top: 2px; text-align: center}
*/
</style>

<title>wib</title>
</head>
<body>
<script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>


<div id="dvMainViewOverlay" style="/* border: 1px solid red */">

  <div id="dvAppHeader">
    <span id="spnAppHeader_OptionalPageTitle" class="bold" style="display: none"></span>
    <span id="spnAppHeader_AppParen1" class="font85">&nbsp;&nbsp;(</span>
    <span id="spnAppHeader_AppNameAndVersion" class="bold font135">wib v0.0</span>
    <span id="spnAppHeader_AppParen2" class="font85">)</span>
    <span id="spnAppHeader_Home">
      &nbsp;&nbsp;&nbsp;<a id="aAppHeader_Home" href="javascript:void return_home()" style="white-space: nowrap; font-size: 110%"><b>home</b></a>
    </span>
    <span id="spnAppHeader_Dev">
      &nbsp;&nbsp;&nbsp;<a href="javascript:void show_dev_screen()"><span style="white-space: nowrap; font-size: 80%">(dev)</span></a>
    </span>
    <span id="spnAppHeader_Builder">
      &nbsp;&nbsp;<a href="javascript:void go_to_builder()"><span style="white-space: nowrap; font-size: 80%">(builder)</span></a>
    </span>
    <div style="height:1.0em"></div>
  </div>

  <div id="dvPage_BackupExport" style="display: none">
    <div style="display: inline-block">
      <table cellspacing=0 cellpadding=0>
      <tr><td style="height: 20px"></td></tr>
      </table>
      <div style="height:1em"></div>
    </div>
    <div style="height:0.8em"></div>
    <textarea id="taExportedBackupText" style="height: 50vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea>
    <div style="height:0.8em"></div>
    <div><a href="javascript:void copy_imported_text_to_clipboard()">copy to clipboard</a></div>
    <div style="height:2em"></div>
  </div>

  <div id="dvPage_BackupImport" style="display: none">
    <div style="height:0.8em"></div>
    <div>Paste text-to-import below:</div>
    <div style="height:0.4em"></div>
    <textarea id="taBackupTextToImport" style="height: 50vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea>
    <div style="height:0.8em"></div>
    <div><a href="javascript:void begin_import()">begin import</a></div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_ChooseWibtype" style="display: none">
    <div style="font-weight: bold">Choose Type</div>
    <div style="height: 0.8em"></div>
    <div>
      <a href="javascript:void choose_type__cancel()" style="white-space: nowrap">cancel</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
      <div id="dvChooseWibtype_Items"></div>
    <div style="height: 1.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void choose_type__cancel()" style="white-space: nowrap">cancel</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_Dev" style="display: none">
    <div style="height:0.8em"></div>
    <div><a href="javascript:void export_backup_text()">export backup text</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void import_backup_text()">import backup text</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_import_blocked()">toggle import-backup-text blocked (for this device)</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_wibapp_dev()">toggle dev mode</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_wibapp_narrow()">toggle app narrow mode</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void storage__show()">show storage</a></div>
    <div style="height:100em"></div>
    <div><a href="javascript:void clear_storage()">clear storage</a></div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_Home" style="display: none">
    <div style="font-weight: bold">Home</div>
    <div style="height:0.8em"></div>
    <div>
      <a href="javascript:void make_new_list()" style="white-space: nowrap">new list</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void show_types()" style="white-space: nowrap">show types</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
    <div id="dvHome_Items"></div>
    <div style="height: 0.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void make_new_list()" style="white-space: nowrap">new list</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void home_page__view_as_regular_item()" style="white-space: nowrap">view home page as regular item</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_MoveOrCopy" style="display: none">
    <div style="font-weight: bold">Moving or Copying Items</div>
    <div style="height:0.8em"></div>
    <div>from list:&nbsp;&nbsp;&nbsp;<span id="spnMoveOrCopy_FromList"></span></div>
    <div style="height:1.5em"></div>
    <div id="MoveOrCopy_Info1">moving or copying these items:</div>
    <div style="height:0.8em"></div>
    <div style="display: inline-block">
      <div style="border-bottom: 1px black solid"></div>
      <div style="height:1em"></div>
      <div id="dvMoveOrCopy_ItemsBeingMovedOrCopied"></div>
      <div style="height:1em"></div>
      <div style="border-bottom: 1px black solid"></div>
    </div>
    <div style="height:1.5em"></div>
    <div>... to which list?&nbsp;&nbsp;&nbsp;<a id="aMoveOrCopy_Cancel" style="white-space: nowrap" href="javascript:void cancel_move()">cancel</a></div>
    <div style="height:0.8em"></div>
    <div style="display: inline-block">
      <div style="border-bottom: 1px black solid"></div>
      <div style="height:1em"></div>
      <div id="dvMoveOrCopy_ListsToMoveOrCopyItemsTo"></div>
      <div style="height:1em"></div>
      <div style="border-bottom: 1px black solid"></div>
    </div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_NavigateItems" style="display: none">
    <div id="dvNavigateItems_ItemNameDisplay" style="font-size: 100%"></div>
    <div id="dvNavigateItems_JoinedListsArea" style="display: none">
      <div style="height: 0.3em"></div>
      <div id="dvNavigateItems_JoinedListsDisplay"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void navigate__cancel()" style="white-space: nowrap">cancel connection process</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
      <div id="dvNavigateItems_Items"></div>
    <div style="height: 1.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void navigate__cancel()" style="white-space: nowrap">cancel connection process</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_ShowStorage" style="display: none">
    <div id="dvStorage"></div>
    <div style="height:0.6em"></div>
    <div style="display: inline-block">
      <hr></hr>
      <div style="height:0.8em"></div>
      <div><a href="javascript:void return_home_from_storage()">return home</a></div>
    </div>
    <div id="dvShowStorage_EditAllItemIds">
      <div style="height:1em"></div>
      <textarea id="taShowStorage_EditAllItemIds" style="height: 20vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea><br />
      <a href="javascript:void edit_storage_row__do_all_items_edit()" style="white-space: nowrap">make this edit</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void edit_storage_row__cancel_all_items_edit()" style="white-space: nowrap">cancel</a>
    </div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_WibBuilder_AllApps" style="display: none">
    <div>
      <a href="javascript:void all_apps__create_new_app()" style="white-space: nowrap">create new app</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_apps__go_to_all_scripts()" style="white-space: nowrap">all scripts</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_apps__go_to_all_screens()" style="white-space: nowrap">all screens</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div>
      <div id="dvWibBuilder_AllApps_Items" style="display: inline-grid; grid-template-columns: auto auto; grid-column-gap: 0.8em; grid-row-gap: 1.8em"></div>
    </div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div>
      <a href="javascript:void all_apps__create_new_app()" style="white-space: nowrap">create new app</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_apps__go_to_all_scripts()" style="white-space: nowrap">all scripts</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_apps__go_to_all_screens()" style="white-space: nowrap">all screens</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_AllScreens" style="display: none">
    <div>
      <a href="javascript:void all_screens__build_new_screen()" style="white-space: nowrap">build new screen</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_screens__go_to_all_apps()" style="white-space: nowrap">all apps</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_screens__go_to_all_scripts()" style="white-space: nowrap">all scripts</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div id="dvWibBuilder_AllScreens_Items"></div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div>
      <a href="javascript:void all_screens__build_new_screen()" style="white-space: nowrap">build new screen</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_screens__go_to_all_apps()" style="white-space: nowrap">all apps</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_screens__go_to_all_scripts()" style="white-space: nowrap">all scripts</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_AllScripts" style="display: none">
    <div>
      <a href="javascript:void all_scripts__create_new_script()" style="white-space: nowrap">create new script</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_scripts__go_to_all_apps()" style="white-space: nowrap">all apps</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_scripts__go_to_all_screens()" style="white-space: nowrap">all screens</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div>
      <div id="dvWibBuilder_AllScripts_Items" style="display: inline-grid; grid-template-columns: auto auto auto; grid-column-gap: 0.8em; grid-row-gap: 1.8em"></div>
    </div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div>
      <a href="javascript:void all_scripts__create_new_script()" style="white-space: nowrap">create new script</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_scripts__go_to_all_apps()" style="white-space: nowrap">all apps</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void all_scripts__go_to_all_screens()" style="white-space: nowrap">all screens</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_BuildScreen" style="display: none">
    <div style="display: grid; width: 19.5em; margin-left: 0.3em; padding: 0.7em; padding-bottom: 1em; border: 0.2em solid lightgrey; border-bottom: 0; font-size: 90%; font-style: italic">
      <div style="font-weight: bold">Info About This Screen:</div>
      <div style="height: 0.7em"></div>
      <div style="height: 0.1em; background-color: black"></div>
      <div style="height: 0.7em"></div>
      <div style="display: grid; grid-template-columns: auto auto">
        <div style="text-size: 85%; padding-right: 0.5em; padding-top: 0.2em; text-align: right">type of screen:</div>
        <div style="text-size: 85%; font-style: normal"><span id="spnWibBuilder_BuildScreen__ScreenTypeCode"></span></div>
        <div style="grid-column: 1/3; height: 0.8em"></div>
        <div style="text-size: 85%; padding-right: 0.5em; text-align: right">type of thing:</div>
        <div id="dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Link">
          <a id="aWibBuilder_BuildScreen_TypeName" style="text-size: 85%; font-style: normal" href="javascript:void build_screen__set_type_of_thing()">(click here)</a>
        </div>

<!-- OLD
        <div id="dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Text" style="display: none; text-size: 85%; font-style: normal"></div>
-->

      </div>
    </div>
    <div style="display: grid; width: 19em; border: 0.2em solid grey; padding: 0.5em">
      <div id="dvWibBuilder_BuildScreen_HeaderText" style="border: 0.2em solid lightgrey; padding: 0.5em; font-weight: bold; text-align: center">Create&nbsp;&nbsp;________</div>
      <div style="height: 0.5em"></div>
      <div style="display: grid; grid-template-columns: auto auto; grid-gap: 0.4em">
        <div id="dvWibBuilder_BuildScreen_ItemNameText" style="border: 0.2em solid lightgrey; width: ; padding: 0.5em; padding-top: 0.7em; text-align: right">_______ Name:</div>
        <div style="border: 0.2em solid lightgrey; width: ; padding: 0.5em">
          <input style="width: 100%" />
        </div>
      </div>
      <div style="height: 0.5em"></div>
      <div class="blue" style="border: 0.2em solid lightgrey; padding: 0.5em; font-style: italic; text-align: center">save&nbsp;&nbsp;&nbsp;</div>
    </div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void build_screen__run_this_screen()">run this screen</a></div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void build_screen__go_to_all_screens()">list of all screens</a></div>
  </div>

  <div id="dvPage_WibBuilder_ChooseExistingWibtype" style="display: none">
    <div style="">
      <a href="javascript:void choose_existing_type__cancel()">cancel</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div id="dvWibBuilder_ChooseExistingWibtype_Items"></div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div style="">
      <a href="javascript:void choose_existing_type__cancel()">cancel</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_DisplayScreen" style="display: none">
    <div style="display: grid; width: 19em; border: 0.2em solid grey; padding: 0.8em">
      <div id="dvWibBuilder_DisplayScreen_HeaderText" style="font-weight: bold; text-align: center">Create&nbsp;&nbsp;________</div>
      <div style="height: 1em"></div>
      <div style="display: grid; grid-template-columns: auto auto; grid-gap: 0.4em">
        <div id="dvWibBuilder_DisplayScreen_ItemNameText" style="width: ; padding-top: 0.15em; text-align: right">_______ Name:</div>
        <div style="width: ">
          <input class="ipText" id="ipWibBuilder_DisplayScreen_ItemNameValue" style="width: 100%" />
        </div>
      </div>
      <div style="height: 1em"></div>
      <div style="text-align: center"><a href="javascript:void display_screen__save_new_item()">save</a>&nbsp;&nbsp;&nbsp;</div>
    </div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void display_screen__build_this_screen()">build this screen</a></div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void display_screen__go_to_all_screens()">list of all screens</a></div>
  </div>

  <div id="dvPage_WibBuilder_RunScreen" style="display: none">

    <div id="dvWibBuilder_RunScreen_OldSection" style="display: none">
      <div style="display: grid; width: 19em; border: 0.2em solid grey; padding: 0.8em">
        <div id="dvWibBuilder_RunScreen_HeaderText" style="font-weight: bold; text-align: center">Create&nbsp;&nbsp;________</div>
        <div style="height: 1em"></div>
        <div style="display: grid; grid-template-columns: auto auto; grid-gap: 0.4em">
          <div id="dvWibBuilder_RunScreen_ItemNameText" style="width: ; padding-top: 0.15em; text-align: right">_______ Name:</div>
          <div style="width: ">
            <input class="ipText" id="ipWibBuilder_RunScreen_ItemNameValue" style="width: 100%" />
          </div>
        </div>
        <div style="height: 1em"></div>
        <div style="text-align: center"><a href="javascript:void run_screen__save_new_item()">save</a>&nbsp;&nbsp;&nbsp;</div>
      </div>
      <div style="height: 1.8em"></div>
      <div><a href="javascript:void run_screen__build_this_screen()">build this screen</a></div>
      <div style="height: 1.8em"></div>
      <div><a href="javascript:void run_screen__go_to_all_screens()">list of all screens</a></div>
    </div>

    <div id="dvWibBuilder_RunScreen_NewSection" style="display: none">
      <div id="dvWibBuilder_RunScreen_NewGrid" style="display: inline-grid">
        (new grid HTML goes here)
      </div>
      <div style="height: 1.8em"></div>
      <div><a href="javascript:void run_screen__back_to_app()">back to app</a></div>
    </div>

  </div>

  <div id="dvPage_WibBuilder_ShowWibtypeInstances" style="display: none">
    <div>
      <a id="aWibBuilder_ShowWibtypeInstances_RunScreenAgain" href="javascript:void show_instances__run_screen_again()" style="white-space: nowrap">run screen again</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void show_instances__go_to_all_screens()" style="white-space: nowrap">go to all screens</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div id="dvWibBuilder_ShowWibtypeInstances_Items"></div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div>
      <a href="javascript:void show_instances__run_screen_again()" style="white-space: nowrap">run screen again</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void show_instances__go_to_all_screens()" style="white-space: nowrap">go to all screens</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_ViewApp" style="display: none">
    <div id="dvWibBuilder_ViewApp_ItemName">(app item name goes here)</div>
    <div style="height: 1.8em"></div>
    <div>
      <a href="javascript:void view_app__run_app()" style="white-space: nowrap">run this app</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void view_app__go_to_all_apps()" style="white-space: nowrap">go to all apps</a>
    </div>
  </div>

  <div id="dvPage_Wibtypes" style="display: none">
    <div class="red" style="font-weight: bold">Types</div>
    <div style="height: 0.8em"></div>
    <div>
      <a href="javascript:void make_new_type()" style="white-space: nowrap">make new type</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void return_home()" style="white-space: nowrap">home</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
      <div id="dvWibtypes_Items"></div>
    <div style="height: 0.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void make_new_type()" style="white-space: nowrap">make new type</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void return_home()" style="white-space: nowrap">home</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_ViewItem" style="display: none">

    <div id="dvViewItem_ItemNameArea">
      <div id="dvItemName" style="font-weight: bold; font-size: 115%"></div>
    </div>

    <div id="dvViewItem_JoinedListsArea" style="display: none">
      <div style="height: 0.3em"></div>
      <div id="dvListNameForItem"></div>
    </div>

    <div id="dvViewItem_ConnectedItemsArea">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div id="dvViewItem_ConnectedItems_Header" style="display: none">
        <div style="height: 0.95em"></div>
        <div style="display: inline-block">
          <div>Connected Items:</div>
          <div style="height: 0.3em"></div>
          <div style="border-bottom: 2px solid #BBBBBB"></div>
        </div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <div id="dvViewItem_ConnectedItems_ItemsIndent" style="display: inline-block; width: 1em"></div>
        <div id="dvViewItem_ConnectedItems_Items" style="display: inline-block"></div>
      </div>
      <div id="dvViewItem_ConnectedItems_LinkArea" style="display: none">
        <div style="height: 1.8em"></div>
        <div><a href="javascript:void add_connected_item()" style="white-space: nowrap">add connected item</a></div>
      </div>
    </div>

    <div id="dvViewItem_ItemActionsArea1" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <div>
          <span id="spnViewItem_DoneStatusDisplay1" style="display: none">DONE&nbsp;&nbsp;</span>
          <span id="spnViewItem_DoneStatusLink1" style="display: none">
            <a id="aViewItem_DoneStatusLink1" href="javascript:void change_done_status()" style="white-space: nowrap">mark done</a>
          </span>
          <span id="spnViewItem_MoveCopy1" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void move_or_copy_to_different_list()" style="white-space: nowrap">move or copy</a>
          </span>
          <span id="spnViewItem_ShowWibtypes" style="display: none">
            <a href="javascript:void show_types()" style="white-space: nowrap">back to types</a>
          </span>
          <span id="spnViewItem_ShowWibtypeInfoField" style="display: none">
            <span style="white-space: nowrap">back to <a id="aViewItem_BackToType" href="javascript:void back_to_type()">type</a></span>
          </span>
        </div>
        <div style="height: 1.4em"></div>
        <div>
          <a href="javascript:void rename_item()"><nowrap>rename</nowrap></a>
          <span id="spnViewItem_Delete1">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void delete_item()"><nowrap>delete</nowrap></a>
          </span>
          <span id="spnViewItem_Notes_No1" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void add_notes()"><nowrap>add notes</nowrap></a>
          </span>
        </div>
      </div>
    </div>

    <div id="dvViewItem_Notes_Yes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div id="dvViewItem_Notes"></div>
      <div style="height: 0.2em"></div>
      <div>
        <a style="white-space: nowrap" href="javascript:void edit_notes()">edit notes</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void delete_notes()">delete notes</a>
      </div>
    </div>

    <div id="dvViewItem_Wibtypes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div id="dvViewItem_Wibtypes_WtifData"></div>
    </div>

    <div id="dvViewItem_WibtypeInfoFieldInfo" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div class="grid2">
        <div class="grid2Cell gc2Header">Info-Field Info:&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void edit_info_field_info()">edit</a></div>
        <div class="grid2Cell gc2VSpace1"></div>
        <div class="grid2Cell gc2TextLeft">Data Type:</div>
        <div class="grid2Cell gc2TextRight"><span id="spn_ViewItem_WibtypeInfoFieldInfo_WibDataType"></span></div>
        <div class="grid2Cell gc2VSpace2"></div>
        <div class="grid2Cell gc2TextLeft">Required:</div>
        <div class="grid2Cell gc2TextRight"><span id="spn_ViewItem_WibtypeInfoFieldInfo_Required"></span></div>
      </div>
    </div>

    <div id="dvViewItem_ListMembers_No" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div><a href="javascript:void make_into_a_list()">make into a list</a></div>
    </div>

    <div id="dvViewItem_ListMembers_Yes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <span id="spnViewItem_MakeNewItem1">
          <a id="aViewItem_MakeNewItem1" href="javascript:void make_new_item()" style="white-space: nowrap">new item</a>
        </span>
        <span id="spnViewItem_MakeNewField1">
          <a href="javascript:void make_new_type_info_field()" style="white-space: nowrap">new info-field</a>
        </span>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aReorder1" style="white-space: nowrap" href="javascript:void toggle_reorder()">reorder</a>
        <span id="spnViewItem_More1">
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aMoreOptions1" style="white-space: nowrap" href="javascript:void toggle_more_options()">more...</a>
        </span>
      </div>
      <div id="dvMoreOptions1" style="display: none">
        <div style="height: 1.4em"></div>
        <div>
          <a style="white-space: nowrap" href="javascript:void mark_all()">mark all</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id='aGrabItems1' style="white-space: nowrap" href="javascript:void grab_items()">grab</a>
        </div>
      </div>
      <div style="height: 1em"></div>
      <div style="display: inline-block">
        <div style="border-bottom: 2px solid #BBBBBB"></div>
        <div style="height: 1.2em"></div>
        <div id="dvViewItem_ListMembers_Items"></div>
        <div style="height: 0.3em"></div>
        <div style="border-bottom: 2px solid #BBBBBB"></div>
      </div>
      <div style="height: 1em"></div>
      <div>
        <span id="spnViewItem_MakeNewItem2">
          <a id="aViewItem_MakeNewItem2" href="javascript:void make_new_item()" style="white-space: nowrap">new item</a>
        </span>
        <span id="spnViewItem_MakeNewField2">
          <a href="javascript:void make_new_type_info_field()" style="white-space: nowrap">new field</a>
        </span>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aReorder2" style="white-space: nowrap" href="javascript:void toggle_reorder()">reorder</a>
        <span id="spnViewItem_More2">
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aMoreOptions2" style="white-space: nowrap" href="javascript:void toggle_more_options()">more...</a>
        </span>
      </div>
      <div id="dvMoreOptions2" style="display: none">
        <div style="height: 1.4em"></div>
        <div>
          <a style="white-space: nowrap" href="javascript:void mark_all()">mark all</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id='aGrabItems2' style="white-space: nowrap" href="javascript:void grab_items()">grab</a>
        </div>
      </div>
    </div>

    <div id="dvViewItem_ItemActionsArea2" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <div>
          <span id="spnViewItem_DoneStatusDisplay2" style="display: none">DONE&nbsp;&nbsp;</span>
          <span id="spnViewItem_DoneStatusLink2" style="display: none">
            <a id="aViewItem_DoneStatusLink2" href="javascript:void change_done_status()" style="white-space: nowrap">mark done</a>
          </span>
          <span id="spnViewItem_MoveCopy2" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void move_or_copy_to_different_list()" style="white-space: nowrap">move or copy</a>
          </span>
        </div>
        <div style="height: 1.4em"></div>
        <div>
          <a href="javascript:void rename_item()"><nowrap>rename</nowrap></a>
          <span id="spnViewItem_Delete2">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void delete_item()"><nowrap>delete</nowrap></a>
          </span>
          <span id="spnViewItem_Notes_No2" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void add_notes()"><nowrap>add notes</nowrap></a>
          </span>
        </div>
      </div>
    </div>

    <div id="dvViewItem_WibtypesForListMembersArea" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div id="dvViewItem_WibtypesForListMembers_Header" style="display: none">
        <div style="height: 0.95em"></div>
        <div style="display: inline-block">
          <div>Types for List Members:</div>
          <div style="height: 0.3em"></div>
          <div style="border-bottom: 2px solid #BBBBBB"></div>
        </div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <div id="dvViewItem_WibtypesForListMembers_ItemsIndent" style="display: inline-block; width: 1em"></div>
        <div id="dvViewItem_WibtypesForListMembers_Items" style="display: inline-block"></div>
      </div>
      <div id="dvViewItem_WibtypesForListMembers_LinkArea" style="display: none">
        <div style="height: 0.8em"></div>
        <div><a href="javascript:void view_item__add_type_for_list_members()" style="white-space: nowrap">add type for list members</a></div>
      </div>
    </div>

    <div id="dvViewItem_EndSpacerArea">
      <div style="height:1em"></div>
    </div>

  </div> <!-- END OF: id="dvPage_ViewItem" -->


</div> <!-- END OF: id="dvMainViewOverlay" -->


<div id="dvPopUp" style="display: none; border: 2px black solid">

  <div class="grid1" id="dvPopUp_AddTimeTracking" style="display: none; padding-top: 0.3em">
    <div class="grid1Cell gc1Header" style="padding-bottom: 0.3em"><b>Add Time Tracking</b></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Item Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnAddTimeTracking_itemName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Start Y / M / D:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipAddTimeTracking_StartYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipAddTimeTracking_StartMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipAddTimeTracking_StartDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Start Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipAddTimeTracking_StartHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipAddTimeTracking_StartMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1VSpaceX" id="dvAddTimeTracking_EndDate_Link" style="display: none; text-align: center">
      <a style="white-space: nowrap; font-size: 90%" href="javascript:void add_time_tracking__display_end_date()">display end date</a>
    </div>
    <div class="grid1Cell gc1Text" id="dvAddTimeTracking_EndDate_Data_1" style="display: none">End Y / M / D:</div>
    <div class="grid1Cell gc1Input" id="dvAddTimeTracking_EndDate_Data_2" style="display: none">
      <input id="ipAddTimeTracking_EndYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipAddTimeTracking_EndMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipAddTimeTracking_EndDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">End Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipAddTimeTracking_EndHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipAddTimeTracking_EndMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Mins Tracked:</div>
    <div class="grid1Cell gc1Input"><input id="ipAddTimeTracking_MinutesTracked" class="ipNumeric" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void add_time_tracking__add_this()">add this</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void add_time_tracking__cancel()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_ChangeDoneStatus" style="display: none">
    <div class="grid1Cell gc1Header"><b>Change Done Status</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">List Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_mainListName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Item Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_itemName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Current Status:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_currentStatus" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace3"></div>
    <div class="grid1Cell gc1Line"></div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Undone1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Undone2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Undone" href="javascript:void do_change_done_status('undone')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Done1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Done2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Done" href="javascript:void do_change_done_status('done')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Okay1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Okay2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Okay" href="javascript:void do_change_done_status('okay')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Info1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Info2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Info" href="javascript:void do_change_done_status('info')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Notice1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Notice2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Notice" href="javascript:void do_change_done_status('notice')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4"></div>
    <div class="grid1Cell gc1Line"></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void cancel_change_done_status()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_EditTimeTracking" style="display: none; padding-top: 0.3em">
    <div class="grid1Cell gc1Header" style="padding-bottom: 0.3em"><b>Edit Time Tracking</b></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Item Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnEditTimeTracking_itemName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Start Y / M / D:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipEditTimeTracking_StartYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipEditTimeTracking_StartMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipEditTimeTracking_StartDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Start Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipEditTimeTracking_StartHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipEditTimeTracking_StartMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1VSpaceX" id="dvEditTimeTracking_EndDate_Link" style="display: none; text-align: center">
      <a style="white-space: nowrap; font-size: 90%" href="javascript:void edit_time_tracking__display_end_date()">display end date</a>
    </div>
    <div class="grid1Cell gc1Text" id="dvEditTimeTracking_EndDate_Data_1" style="display: none">End Y / M / D:</div>
    <div class="grid1Cell gc1Input" id="dvEditTimeTracking_EndDate_Data_2" style="display: none">
      <input id="ipEditTimeTracking_EndYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipEditTimeTracking_EndMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipEditTimeTracking_EndDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">End Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipEditTimeTracking_EndHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipEditTimeTracking_EndMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Mins Tracked:</div>
    <div class="grid1Cell gc1Input"><input id="ipEditTimeTracking_MinutesTracked" class="ipNumeric" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void edit_time_tracking__make_this_edit()">make this edit</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void edit_time_tracking__cancel()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewItem" style="display: none; padding-top: 0.3em">
    <div class="grid1Cell gc1Header" style="padding-bottom: 0.3em"><b>Make New Item</b></div>
    <div class="grid1Cell gc1VSpace3" style="padding-bottom: 0.3em"></div>
    <div class="grid1Cell gc1QuickLinks">
      <a style="white-space: nowrap; font-size: 95%" href="javascript:void make_new_item__make_line()">quick line</a>
    </div>
    <div class="grid1Cell gc1VSpace3" style="padding-bottom: 0.1em"></div>
    <div class="grid1Cell gc1Text" style="padding-left: 2em">Item Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewItem_ItemName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">add to top of list:</div>
    <div class="grid1Cell gc1ActionCheckbox gc1ActionCheckboxFirst"><input id="ckMakeNewItem_TopOfList" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">remain on list view:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_StayListView" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">add additional items:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_AddMoreItems" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">do time tracking:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_TimeTracking" onclick="doCheckboxClickAction('ckMakeNewItem_TimeTracking')" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">
      <span style="display: none"><a style="white-space: nowrap; font-size: 90%" href="javascript:void set_ymd_to_today()">today</a>&nbsp;&nbsp;&nbsp;&nbsp;Start Y / M / D:</span>
      <span>Start Y / M / D:</span>
    </div>
    <div class="grid1Cell gc1Input gc1Group1">
      <input id="ipMakeNewItem_StartYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_StartMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_StartDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">Start Time:</div>
    <div class="grid1Cell gc1Input gc1Group1">
      <input id="ipMakeNewItem_StartHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipMakeNewItem_StartMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1VSpaceX gc1Group1" id="dvMakeNewItem_EndDate_Link" style="display: none; text-align: center">
      <a style="white-space: nowrap; font-size: 90%" href="javascript:void make_new_item__display_end_date()">display end date</a>
    </div>
    <div class="grid1Cell gc1Text gc1Group1" id="dvMakeNewItem_EndDate_Data_1" style="display: none">End Y / M / D:</div>
    <div class="grid1Cell gc1Input gc1Group1" id="dvMakeNewItem_EndDate_Data_2" style="display: none">
      <input id="ipMakeNewItem_EndYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_EndMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_EndDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">End Time:</div>
    <div class="grid1Cell gc1Input gc1Group1">
      <input id="ipMakeNewItem_EndHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipMakeNewItem_EndMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">Mins Tracked:</div>
    <div class="grid1Cell gc1Input gc1Group1"><input id="ipMakeNewItem_MinutesTracked" class="ipNumeric" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" /></div>
    <div class="grid1Cell gc1VSpace2" style="padding-bottom: 0.8em"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void make_new_item__make()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void make_new_item__cancel()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewItemTT" style="display: none; padding-top: 0.3em">
    <div class="grid1Cell gc1Header" style="padding-bottom: 0.3em"><b>New Time Tracking</b></div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 0.4em"></div>
    <div class="grid1Cell gc1Text">
      <span style="display: none"><a style="white-space: nowrap; font-size: 90%" href="javascript:void set_ymd_to_today()">today</a>&nbsp;&nbsp;&nbsp;&nbsp;Start Y / M / D:</span>
      <span>Start Y / M / D:</span>
    </div>
    <div class="grid1Cell gc1Input">
      <input id="ipMakeNewItemTT_StartYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItemTT_StartMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItemTT_StartDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 1.0em"></div>
    <div class="grid1Cell gc1Text">Start Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipMakeNewItemTT_StartHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipMakeNewItemTT_StartMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 1.0em"></div>
    <div class="grid1Cell gc1VSpaceX" id="dvMakeNewItemTT_EndDate_Link" style="display: none; text-align: center">
      <a style="white-space: nowrap; font-size: 90%" href="javascript:void make_new_item_tt__display_end_date()">display end date</a>
    </div>
    <div class="grid1Cell gc1Text" id="dvMakeNewItemTT_EndDate_Data_1" style="display: none">End Y / M / D:</div>
    <div class="grid1Cell gc1Input" id="dvMakeNewItemTT_EndDate_Data_2" style="display: none">
      <input id="ipMakeNewItemTT_EndYear" class="ipYear" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItemTT_EndMonth" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItemTT_EndDay" class="ipMonthDay" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 1.0em"></div>
    <div class="grid1Cell gc1Text">End Time:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipMakeNewItemTT_EndHour" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      : <input id="ipMakeNewItemTT_EndMinute" class="ipTime" maxlength="2" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
    </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 0.8em"></div>
    <div class="grid1Cell gc1VSpaceX" style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 0.8em"></div>
    <div class="grid1Cell gc1Text" style="padding-left: 2em">Item Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewItemTT_ItemName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 1.0em"></div>
    <div class="grid1Cell gc1Text">Mins Tracked:</div>
    <div class="grid1Cell gc1Input">
      <input id="ipMakeNewItemTT_MinutesTracked" class="ipNumeric" maxlength="4" onclick="js_handleClick(this)" onchange="js_handleChange(this)" />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void make_new_item_tt__make()">make</a>
      </div>
    <div class="grid1Cell gc1VSpaceX" style="padding-bottom: 1.0em"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void make_new_item_tt__cancel()">cancel</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void make_new_item_tt__switch_to_normal()">switch to normal</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewWibtype" style="display: none">
    <div class="grid1Cell gc1Header red"><b>Make New Type</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">Type Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewWibtype_WibtypeName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void do_make_new_type()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void cancel_make_new_type()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewWibtypeInfoField" style="display: none">
    <div class="grid1Cell gc1Header red"><b>Make New Info-Field</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">Type Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnMakeNewWibtypeInfoField_WibtypeName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Info-Field Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewWibtypeInfoField_WibtypeInfoFieldName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Data Type:</div>
    <div class="grid1Cell gc1Select"><span id="spnMakeNewWibtypeInfoField_WibDataTypeId" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForCheckbox">Required:</div>
    <div class="grid1Cell gc1Checkbox"><input id="ckMakeNewWibtypeInfoField_Required" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void do_make_new_type_info_field()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void cancel_make_new_type_info_field()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_WibBuilder_UseExistingWibtype" style="display: none">
    <div class="grid1Cell gc1Header"><b>Use Existing Type?</b></div>
    <div class="grid1Cell gc1VSpace4"></div>
    <div class="grid1Cell gc1Footer" style="font-weight: bold">
      <a href="javascript:void build_screen__use_existing_type('yes')">Yes -- use an existing type of thing</a>
    </div>
    <div class="grid1Cell gc1VSpace4"></div>
    <div class="grid1Cell gc1Footer" style="font-weight: bold">
      <a href="javascript:void build_screen__use_existing_type('no')">No -- create a new type of thing to use</a>
    </div>
    <div class="grid1Cell gc1VSpace4"></div>
    <div class="grid1Cell gc1Line"></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a href="javascript:void build_screen__use_existing_type('cancel')">cancel</a>
    </div>
  </div>

</div>


<textarea id="taDev1" style="display: none"></textarea>


<script type="text/javascript">


"use strict";


///// CONSTANTS

const CONST_wibappVersion = "0.93"; // leave this at top for easy editing

const CONST_cssClassName_backgroundBlack = "backgroundBlack";
const CONST_cssClassName_backgroundBlue = "backgroundBlue";
const CONST_cssClassName_backgroundBrown = "backgroundBrown";
const CONST_cssClassName_backgroundGreen = "backgroundGreen";
const CONST_cssClassName_backgroundRed = "backgroundRed";
const CONST_cssClassName_black = "black";
const CONST_cssClassName_blue = "blue";
const CONST_cssClassName_bold = "bold";
const CONST_cssClassName_borderBlack = "borderBlack";
const CONST_cssClassName_borderBlue = "borderBlue";
const CONST_cssClassName_borderBrown = "borderBrown";
const CONST_cssClassName_borderGreen = "borderGreen";
const CONST_cssClassName_borderRed = "borderRed";
const CONST_cssClassName_brown = "brown";
const CONST_cssClassName_green = "green";
const CONST_cssClassName_red = "red";

const CONST_displayCode_normal = "0";
const CONST_displayCode_hidden1 = "1";

const CONST_doneStatusCode_done = "1";
const CONST_doneStatusCode_info = "4";
const CONST_doneStatusCode_notice = "3";
const CONST_doneStatusCode_okay = "2";
const CONST_doneStatusCode_undone = "0";
const CONST_doneStatusDisplay_done = "done";
const CONST_doneStatusDisplay_info = "info";
const CONST_doneStatusDisplay_notice = "notice";
const CONST_doneStatusDisplay_okay = "okay";
const CONST_doneStatusDisplay_undone = "undone";

const CONST_importBlocked = "importBlocked";

const CONST_listName_homePage = "home_page_list";
const CONST_listName_wibtypes = "types";

const CONST_propName_sortPosition = "sortPosition";
const CONST_propName_itemId = "itemId";
const CONST_propName_itemName = "itemName";
const CONST_propName_wibtypeItemId = "wibtypeItemId";
const CONST_propName_wtifItemId = "wtifItemId";

const CONST_reordering_mode_normal = "normal";
const CONST_reordering_mode_moveAboveOtherItem = "moveAboveOtherItem";

const CONST_storedDataVersion = "stored_data_version";

const CONST_stringOfAllItemIds = "string_of_all_item_ids";

const CONST_timeTracking_itemName = "Time Tracking";
const CONST_timeTracking_wtifEndTime_itemName = "End Time";
const CONST_timeTracking_wtifEndYMD_itemName = "End Y / M / D";
const CONST_timeTracking_wtifMinsTracked_itemName = "Mins Tracked";
const CONST_timeTracking_wtifStartTime_itemName = "Start Time";
const CONST_timeTracking_wtifStartYMD_itemName = "Start Y / M / D";

const CONST_wb_appList_itemName = "wib-builder-app-list";
const CONST_wb_appWibtype_itemName = "wib-builder-app";
const CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName = "FirstScriptItemId";

const CONST_wb_listOfWibtypeInstanceHolderLists_itemName = "wb-list-of-wibtype-instance-holder-lists";

const CONST_wb_screenBoxWibtype_itemName = "wib-builder-screen-box";
const CONST_wb_screenBoxWibtype_wtif_BoxesAcross_itemName = "BoxesAcross";
const CONST_wb_screenBoxWibtype_wtif_BoxesDown_itemName = "BoxesDown";
const CONST_wb_screenBoxWibtype_wtif_ContentData_itemName = "ContentData";
const CONST_wb_screenBoxWibtype_wtif_ContentTypeCode_itemName = "ContentTypeCode";
const CONST_wb_screenBoxWibtype_wtif_StartColumn_itemName = "StartColumn";
const CONST_wb_screenBoxWibtype_wtif_StartRow_itemName = "StartRow";

const CONST_wb_screenList_itemName = "wib-builder-screen-list";
const CONST_wb_screenTypeCode_createWibtype = "1";
const CONST_wb_screenTypeCode_editWibtype = "2";
const CONST_wb_screenWibtype_itemName = "wib-builder-screen";
const CONST_wb_screenWibtype_wtif_NumColumns_itemName = "NumColumns";
const CONST_wb_screenWibtype_wtif_NumRows_itemName = "NumRows";
const CONST_wb_screenWibtype_wtif_WbAppItemId_itemName = "WbAppItemId";

const CONST_wb_script_actionCode_displayScreen = "1";
const CONST_wb_scriptList_itemName = "wib-builder-script-list";
const CONST_wb_scriptRowWibtype_itemName = "wib-builder-script-row";
const CONST_wb_scriptRowWibtype_wtif_RowNum_itemName = "RowNum";
const CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName = "ActionCode";
const CONST_wb_scriptRowWibtype_wtif_ActionData_itemName = "ActionData";
const CONST_wb_scriptWibtype_itemName = "wib-builder-script";
const CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName = "WbAppItemId";

const CONST_wb_wibtypeInstanceHolderWibtype_itemName = "wb-wibtype-instance-holder-wibtype";
const CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName = "WibtypeInstanceHeldItemId";

const CONST_wbs_screenWtifs_screenTypeCode_itemName = "ScreenTypeCode";
const CONST_wbs_screenWtifs_wibtypeItemId_itemName = "WibtypeItemId";

const CONST_wdt_ui_endDay = "EndDay";
const CONST_wdt_ui_endHour = "EndHour";
const CONST_wdt_ui_endMinute = "EndMinute";
const CONST_wdt_ui_endMonth = "EndMonth";
const CONST_wdt_ui_endYear = "EndYear";
const CONST_wdt_ui_minutesTracked = "MinutesTracked";
const CONST_wdt_ui_startDay = "StartDay";
const CONST_wdt_ui_startHour = "StartHour";
const CONST_wdt_ui_startMinute = "StartMinute";
const CONST_wdt_ui_startMonth = "StartMonth";
const CONST_wdt_ui_startYear = "StartYear";

const CONST_wibapp_narrow = "wibapp_narrow";
const CONST_wibapp_dev1 = "wibapp_dev1";

const CONST_wibDataType_date_name = "date";
const CONST_wibDataType_date_id = 2;
const CONST_wibDataType_numeric_name = "numeric";
const CONST_wibDataType_numeric_id = 4;
const CONST_wibDataType_text_name = "text";
const CONST_wibDataType_text_id = 1;
const CONST_wibDataType_timeOfDay_name = "time of day";
const CONST_wibDataType_timeOfDay_id = 3;

const sD = "`"; // sD = storageDivider
const sD2 = "≡"; // sD2 = storageDivider2, used for text formatting during backup


///// APP-LEVEL VARIABLES

var wapp = {};
wapp.focusElemId = null;
wapp.focusElemId_pre = null;
wapp.focusItemId = null;
wapp.grabbing_itemId1 = null;
wapp.grabbing_itemId2 = null;
wapp.grabbing_itemIdArray = [];
wapp.grabbingOn = false;
wapp.homePageList_itemId = null;
wapp.isDev1 = false;
wapp.itemObj = null;
wapp.makeNewItem_TopOfList = "1";
wapp.makeNewItem_StayListView = "1";
wapp.makeNewItem_AddMoreItems = "0";
wapp.makeNewItem_TimeTracking = "0";
wapp.moreOptionsOn = false;
wapp.qs_obj = null;
wapp.qs_urlParams = null;
wapp.reorderingOn = false;
wapp.reordering_activatedItemId = null;
wapp.reordering_mode = null;
wapp.runningApp_itemObj = null;
wapp.timeTracking_defaultYear = null;
wapp.timeTracking_defaultMonth = null;
wapp.timeTracking_defaultDay = null;
wapp.timeTracking_wibtypeItemId = null;
wapp.wappDataLoadedSuccessfully = true;
wapp.wb_appListItemId = null;
wapp.wb_appWibtype_itemId = null;
wapp.wb_curApp_itemObj = null;
wapp.wb_curScreen_itemObj = null;
wapp.wb_curWibtype_itemObj = null;
wapp.wb_listOfWibtypeInstanceHolderLists_itemId = null;
wapp.wb_screenBoxWibtype_itemId = null;
wapp.wb_screenListItemId = null;
wapp.wb_screenWibtype_itemId = null;
wapp.wb_scriptListItemId = null;
wapp.wb_scriptRowWibtype_itemId = null;
wapp.wb_scriptWibtype_itemId = null;
wapp.wb_wibtypeInstanceHolderWibtype_itemId = null;
wapp.wdt_internalChangeToUi = false;
wapp.wdto = null;
wapp.wdtUiDataObj = null;
wapp.wibtypes_itemId = null;


///// INTERNAL FUNCTIONS

function activateItemForReordering(itemId) {
  var elemId = getHtml_aItem(itemId);
  var reorderingTr_elemId = getHtml_reorderingActivated_tr(itemId);

  wapp.reordering_activatedItemId = itemId;

  css_addClass(elemId, CONST_cssClassName_bold);

  elem(reorderingTr_elemId).style.display = "" ;

  toggleReorderingMode_normal(itemId);
}

function aO(argumentValue) {
  // EXAMPLE USAGE:
  // 
  // function getPetMessage(aO_typeOfPet, aO_petName) {
  //   return "you have a " + aO_typeOfPet.a + " named " + aO_petName.a;
  // }
  // 
  // console.log( getPetMessage(aO("dog"), aO("Rover")) );
  // /* prints 'you have a dog named Rover' */

  var argObj = {};
  argObj.a = argumentValue;

  return argObj;
}

function copyItems(sourceListObj, targetListObj, listMembers_itemIdArray) {
  listMembers_itemIdArray.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);
    curItemObj.copyToList(targetListObj.itemId);
  } );
}

function createConnectedItemDataObj(itemId2) {
  var connectedItemDataObj = {};

  connectedItemDataObj.itemId2 = itemId2;

  return connectedItemDataObj;
}

function createItemInfoString(itemName, doneStatusCode, displayCode, isList, notes, isWibtype, isWibtypeInfoField) {
  var itemInfoString = itemName + sD;

  if ( isBlank(doneStatusCode) ) {
    itemInfoString += CONST_doneStatusCode_undone;
  } else {
    itemInfoString += doneStatusCode;
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(displayCode) ) {
    itemInfoString += CONST_displayCode_normal;
  } else {
    itemInfoString += displayCode
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(isList) ) {
    itemInfoString += "0";
  } else {
    itemInfoString += isList
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(notes) ) {
    itemInfoString += "";
  } else {
    itemInfoString += notes
  }

  itemInfoString = itemInfoString + sD;
  if (isWibtype == "1") {
    itemInfoString += "1";
  } else {
    itemInfoString += "0";
  }

  itemInfoString = itemInfoString + sD;
  if (isWibtypeInfoField == "1") {
    itemInfoString += "1";
  } else {
    itemInfoString += "0";
  }

  return itemInfoString;
}

function createListMemberDataObj(itemId, sortPosition) {
  var listMemberDataObj = {};

  listMemberDataObj.itemId = itemId;
  listMemberDataObj.sortPosition = sortPosition;

  return listMemberDataObj;
}

function createWibtypeForListMembersDataObj(wibtypeItemId) {
  var wibtypeForListMembersDataObj = {};

  wibtypeForListMembersDataObj.wibtypeItemId = wibtypeItemId;

  return wibtypeForListMembersDataObj;
}

function createWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName, theData) {
  //NOTE:
  //  don't need the itemId of the item whose data is being held here
  //  -> this wtif-data-object will be stored in an array property of that item
  //      (see "itemIdAssignedToTheWibtype" in function ".saveToDatastore" below)

  var wtifDataObj = {};

  wtifDataObj.wibtypeItemId = wibtypeItemId;

  if ( isBlank(wtifItemId) ) {
    let wtifItemObj = searchForItemObj_OLD(null, null, null, null, null, null, wtifItemName, wibtypeItemId, true);
    wtifItemId = wtifItemObj.itemId;
  }

  wtifDataObj.wtifItemId = wtifItemId;

  wtifDataObj.theData = theData;

  wtifDataObj.deleteFromDatastore = function(itemIdAssignedToTheWibtype) {
    //declaring new variables, because:
    //  accidentally using wtifItemId or theData
    //  (instead of this.theData or this.wtifItemId)
    //  would not throw an error even with "use strict"
    //  (because the former variables are used/available in the parent function)
    let wtifItemId_toDelete = this.wtifItemId;

    //NOTE: "itemIdAssignedToTheWibtype" is the item whose wtif-data is being deleted
    var saveKeyText_wtifData = getSaveKeyText_wtifData(itemIdAssignedToTheWibtype, wtifItemId_toDelete);

    deleteFromDatastore(saveKeyText_wtifData);
  };

  wtifDataObj.saveToDatastore = function(itemIdAssignedToTheWibtype) {
    //declaring new variables, because:
    //  accidentally using wtifItemId or theData
    //  (instead of this.theData or this.wtifItemId)
    //  would not throw an error even with "use strict"
    //  (because the former variables are used/available in the parent function)
    let wtifItemId_toSave = this.wtifItemId;
    let theData_toSave = this.theData;

    //NOTE: "itemIdAssignedToTheWibtype" is the item whose wtif-data is being stored
    var saveKeyText_wtifData = getSaveKeyText_wtifData(itemIdAssignedToTheWibtype, wtifItemId_toSave);

    saveToDatastore(saveKeyText_wtifData, theData_toSave);
  };

  return wtifDataObj;
}

function createWibtypeInfoFieldInfoString(wibDataTypeId, required) {
  var itemInfoString = wibDataTypeId + sD + required;
  return itemInfoString;
}

function css_addClass(elemId, classNameToAdd) {
  var theElem = elem(elemId);
  theElem.classList.add(classNameToAdd);
}

function css_removeAllColors(elemId) {
  var theElem = elem(elemId);
  theElem.classList.remove(CONST_cssClassName_black);
  theElem.classList.remove(CONST_cssClassName_brown);
  theElem.classList.remove(CONST_cssClassName_green);
  theElem.classList.remove(CONST_cssClassName_red);
}

function css_removeClass(elemId, classNameToRemove) {
  var theElem = elem(elemId);
  theElem.classList.remove(classNameToRemove);
}

function css_setElemToDoneStatusColor(elemId, doneStatusCode) {
  var doneStatusCssClassNameColor = getDoneStatusCssClassNameColor(doneStatusCode);
  css_removeAllColors(elemId);

  //only add a css-class for the color, if we received a color-name back
  // (might receive back a blank value, in order to not set the color of the html-element)
  if ( !isBlank(doneStatusCssClassNameColor) ) {
    css_addClass(elemId, doneStatusCssClassNameColor);
  }
}

function da(text) {
  alert(text);
}

function dc(text1, text2, text3, text4, text5, text6, text7, text8, text9, text10) {
  var str = "";

  if ( text1 === undefined ) {
  } else {
    str += text1;
  }

  if ( text2 === undefined ) {
  } else {
    str += " ----- " + text2;
  }

  if ( text3 === undefined ) {
  } else {
    str += " ----- " + text3;
  }

  if ( text4 === undefined ) {
  } else {
    str += " ----- " + text4;
  }

  if ( text5 === undefined ) {
  } else {
    str += " ----- " + text5;
  }

  if ( text6 === undefined ) {
  } else {
    str += " ----- " + text6;
  }

  if ( text7 === undefined ) {
  } else {
    str += " ----- " + text7;
  }

  if ( text8 === undefined ) {
  } else {
    str += " ----- " + text8;
  }

  if ( text9 === undefined ) {
  } else {
    str += " ----- " + text9;
  }

  if ( text10 === undefined ) {
  } else {
    str += " ----- " + text10;
  }

  console.log(str);
}

function dc_() {
  // this function is just to allow a developer to change dc("some text here") to dc_("some text here")
  // , as a way to remove the console.log action that occurs in dc()
  // , but without having to comment out the line via //dc("some text here")
  //
  // --> allows searching for "dc(" to determine whether there are any stray console.log calls that will occur when running the code
}

function deactivateItemForReordering(itemId) {
  wapp.reordering_activatedItemId = null;

  // we might be deactivating the reordering-item from a page that does not have the HTML elements related to reordering that specific item
  //   i.e. this function is only being called to clear the wapp.reordering_activatedItemId, probably via toggleReordering_off()
  //
  // therefore, we need to check for the existence of the elements below, before acting upon them
  var reorderingItem_elemId = getHtml_aItem(itemId);
  var reorderingActivatedArea_forItem_elemId = getHtml_reorderingActivated_tr(itemId);

  if ( html_doesElemExist(reorderingItem_elemId) ) {
    css_removeClass(reorderingItem_elemId, CONST_cssClassName_bold);
  }

  if ( html_doesElemExist(reorderingActivatedArea_forItem_elemId) ) {
    elem(reorderingActivatedArea_forItem_elemId).style.display = "none" ;
  }
}

function deleteFromDatastore(itemKey) {
  localStorage.removeItem(itemKey);
}

function deleteItem(itemIdToDelete, suppressErrorMsgIfNotFound, setWappItemToFirstJoinedList) {
  var itemObjToDelete, deletionSuccess;

  itemObjToDelete = grabItemObj(itemIdToDelete, suppressErrorMsgIfNotFound);

  if (!itemObjToDelete) {
    return false;
  }

  deletionSuccess = itemObjToDelete.doDeletion(setWappItemToFirstJoinedList);

  return deletionSuccess;
}

function deleteItem__joinedList_and_itemName(joinedListWithItemId, itemNameToDelete) {
  var igo = new ItemGrabbingObj();

  igo.set_targetItemName(itemNameToDelete);
  igo.set_targetJoinedListWithItemId(joinedListWithItemId);
  igo.set_returnFirstOnly_false();

  var itemObjArray = igo.runSearchAndReturnX();

  itemObjArray.forEach( (itemObj) => {
    itemObj.doDeletion(null);
  } );

  return true;
}

function displayPage(pageName) {
  wappObj_clearAll();

  // set dev link
  if (wapp.isDev1) {
    elem("spnAppHeader_Dev").style.display = "";
  } else {
    elem("spnAppHeader_Dev").style.display = "none";
  }

  // set different page heading for WibBuilder vs original
  if ( leftIs(pageName, "WibBuilder") ) {

    document.body.style.display = "grid";
    document.body.style.margin = "0.8em";

    elem("spnAppHeader_OptionalPageTitle").style.display = "";
    elem("spnAppHeader_OptionalPageTitle").innerHTML = "";
    elem("spnAppHeader_AppParen1").style.display = "";
    elem("spnAppHeader_AppParen2").style.display = "";

    css_removeClass("spnAppHeader_AppNameAndVersion", CONST_cssClassName_bold);
    css_removeClass("spnAppHeader_AppNameAndVersion", "font135");
    css_addClass("spnAppHeader_AppNameAndVersion", "font85");

    elem("spnAppHeader_Home").style.display = "none";
    elem("spnAppHeader_Builder").style.display = "none";

  } else {

    document.body.style.display = "";
    document.body.style.margin = "";

    elem("spnAppHeader_OptionalPageTitle").style.display = "none";
    elem("spnAppHeader_OptionalPageTitle").innerHTML = "";
    elem("spnAppHeader_AppParen1").style.display = "none";
    elem("spnAppHeader_AppParen2").style.display = "none";

    css_addClass("spnAppHeader_AppNameAndVersion", CONST_cssClassName_bold);
    css_removeClass("spnAppHeader_AppNameAndVersion", "font85");
    css_addClass("spnAppHeader_AppNameAndVersion", "font135");

    elem("spnAppHeader_Home").style.display = "";
    elem("spnAppHeader_Builder").style.display = "";

  }

  // clear all HTML elements that were populated with items programatically
  //  -- these could possibly cause conflicts when referring to item-ids that are referenced via the naming convention of an HTML element's id
  elem("dvChooseWibtype_Items").innerHTML = "";
  elem("dvHome_Items").innerHTML = "";
  elem("dvListNameForItem").innerHTML = "";
  elem("dvMoveOrCopy_ItemsBeingMovedOrCopied").innerHTML = "";
  elem("dvMoveOrCopy_ListsToMoveOrCopyItemsTo").innerHTML = "";
  elem("dvNavigateItems_Items").innerHTML = "";
  elem("dvViewItem_ConnectedItems_Items").innerHTML = "";
  elem("dvViewItem_ListMembers_Items").innerHTML = "";
  elem("dvViewItem_Wibtypes_WtifData").innerHTML = "";
  elem("dvViewItem_WibtypesForListMembers_Items").innerHTML = "";
  elem("dvWibBuilder_AllApps_Items").innerHTML = "";
  elem("dvWibBuilder_AllScreens_Items").innerHTML = "";
  elem("dvWibBuilder_AllScripts_Items").innerHTML = "";
  elem("dvWibBuilder_ChooseExistingWibtype_Items").innerHTML = "";
  elem("dvWibBuilder_ShowWibtypeInstances_Items").innerHTML = "";
  elem("dvWibtypes_Items").innerHTML = "";

  // hide all display-page sections -- will show the target display-page below
  elem("dvPage_BackupExport").style.display = "none";
  elem("dvPage_BackupImport").style.display = "none";
  elem("dvPage_ChooseWibtype").style.display = "none";
  elem("dvPage_Dev").style.display = "none";
  elem("dvPage_Home").style.display = "none";
  elem("dvPage_MoveOrCopy").style.display = "none";
  elem("dvPage_NavigateItems").style.display = "none";
  elem("dvPage_ShowStorage").style.display = "none";
  elem("dvPage_ViewItem").style.display = "none";
  elem("dvPage_WibBuilder_AllApps").style.display = "none";
  elem("dvPage_WibBuilder_AllScreens").style.display = "none";
  elem("dvPage_WibBuilder_AllScripts").style.display = "none";
  elem("dvPage_WibBuilder_BuildScreen").style.display = "none";
  elem("dvPage_WibBuilder_ChooseExistingWibtype").style.display = "none";
  elem("dvPage_WibBuilder_RunScreen").style.display = "none";
  elem("dvPage_WibBuilder_ShowWibtypeInstances").style.display = "none";
  elem("dvPage_WibBuilder_ViewApp").style.display = "none";
  elem("dvPage_Wibtypes").style.display = "none";

  // show target display-page
  if ( !isBlank(pageName) ) {
    elem("dvPage_" + pageName).style.display = "inline-grid";
  }

  // run display-page-specific code
  switch (pageName) {

    case "BackupExport": {
      writeBackupExport();
      break;
    }

    case "BackupImport": {
      elem("taBackupTextToImport").value = "";
      elem("taBackupTextToImport").focus();
      break;
    }

    case "ChooseWibtype": {
      let html = "";

      let wibtypesList_itemObj = grabItemObj(wapp.wibtypes_itemId);
      let wibtypeItemIds = wibtypesList_itemObj.getListMemberItemIds();

      for (let i = 0; i < wibtypeItemIds.length; i++) {

        let alreadyHasThisWibtype = wapp.itemObj.hasWibtypeForListMembers( wibtypeItemIds[i] );

        if ( ! alreadyHasThisWibtype ) {

          let wibtypeItemObj = grabItemObj( wibtypeItemIds[i] );
          
          if (html !== "") html += "<div style='grid-column: 1/3; height: 1.8em'></div>"

          html += "<div><a href='javascript:void choose_wibtype__this_one(\"" + wibtypeItemObj.itemId + "\")'>" + wibtypeItemObj.itemName + "</a></div>\n";

        }

      }

      if (html == "") html += "(no types have been created yet)";

      elem("dvChooseWibtype_Items").innerHTML = html;
      break;
    }

    case "Dev": {
      // don't currently need anything special for Dev
      break;
    }

    case "Home": {
      elem("spnAppHeader_Home").style.display = "none";

      toggleGrabbing_off();
      toggleReordering_off();

      if (!wapp.itemObj) {
        setWappItemObj(grabItemObjByName(CONST_listName_homePage));
      }

      elem("dvHome_Items").innerHTML = writeHtml_items();

      if (wapp.focusElemId) {
        elem(wapp.focusElemId).focus();
        focus_clear();
      };

      break;
    }

    case "MoveOrCopy": {
      let isSingleItem, isSingleItemListMove;

      elem("spnAppHeader_Home").style.display = "none";

      if ( !isBlank(wapp.grabbing_itemId1) && isBlank(wapp.grabbing_itemId2) ) {
        //single-item-move-or-copy

        isSingleItem = true;

        let grabbingItemObj1 = grabItemObj(wapp.grabbing_itemId1);
        if (grabbingItemObj1.isList == "1") {
          isSingleItemListMove = true;
        }
        
        if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
          elem("spnMoveOrCopy_FromList").innerHTML = "<i>Home</i>";
        } else {
          elem("spnMoveOrCopy_FromList").innerHTML = "<i>" + grabItemObj(wapp.itemObj.displayedOnList_itemId).itemName + "</i>";
        }

      } else {

        isSingleItem = false;

        elem("spnMoveOrCopy_FromList").innerHTML = "<i>" + wapp.itemObj.itemName + "</i>";

      }

      if (isSingleItem) {
        if (isSingleItemListMove) {
          elem("MoveOrCopy_Info1").innerHTML = "moving this item:";
        } else {
          elem("MoveOrCopy_Info1").innerHTML = "moving or copying this item:";
        }
      } else {
        elem("MoveOrCopy_Info1").innerHTML = "moving or copying these items:";
      }

      elem("dvMoveOrCopy_ItemsBeingMovedOrCopied").innerHTML = writeHtml_MoveOrCopy_ItemsBeingMovedOrCopied();
      elem("dvMoveOrCopy_ListsToMoveOrCopyItemsTo").innerHTML = writeHtml_MoveOrCopy_ListsToMoveOrCopyItemsTo();
      break;
    }

    case "NavigateItems": {
      elem("dvNavigateItems_ItemNameDisplay").innerHTML = "Connecting to:&nbsp;&nbsp;<b>" + wapp.itemObj.itemName + "</b>";

      if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
        elem("dvNavigateItems_JoinedListsArea").style.display = "none";
      } else {
        elem("dvNavigateItems_JoinedListsArea").style.display = "";
        let displayedOnList_itemObj = grabItemObj(wapp.itemObj.displayedOnList_itemId);
        //elem("dvNavigateItems_JoinedListsDisplay").innerHTML = "&nbsp;&nbsp;&nbsp;( member of list:&nbsp;&nbsp;<a href='javascript:void go_to_list(\"" + displayedOnList_itemObj.itemId + "\")'>" + displayedOnList_itemObj.itemName + "</a> )";
        elem("dvNavigateItems_JoinedListsDisplay").innerHTML = "&nbsp;&nbsp;&nbsp;( member of list:&nbsp;&nbsp;" + displayedOnList_itemObj.itemName + " )";
      }

      let html = "";

      var listItemIds_alreadyWritten = [];
      var homePageList_itemObj = grabItemObj(wapp.homePageList_itemId);
      var homePageList_memberDataObjs = homePageList_itemObj.getListMemberDataObjs();

      html += writeHtml_navigationTree(homePageList_memberDataObjs, listItemIds_alreadyWritten, 0);

      if (html == "") html += "(none created yet)";

//elem("taDev1").innerHTML = html;
      elem("dvNavigateItems_Items").innerHTML = html;
      break;
    }

    case "ShowStorage": {
      elem("dvShowStorage_EditAllItemIds").style.display = "none";
      writeStorage();
      break;
    }

    case "ViewItem": {
      let i, wibtypeItemObj, hasDisplayedLists = false;

      if (wapp.itemObj.isWibtype == "1") {
        elem("dvItemName").innerHTML = "<div class='" + CONST_cssClassName_red +"'><i>[this is a type]</i></div><div style='height: 8px'></div>" + wapp.itemObj.itemName;
      } else if (wapp.itemObj.isWibtypeInfoField == "1") {
        elem("dvItemName").innerHTML = "<div class='" + CONST_cssClassName_red +"'><i>[this is a type info-field]</i></div><div style='height: 8px'></div>" + wapp.itemObj.itemName;
      } else {
        elem("dvItemName").innerHTML = wapp.itemObj.itemName;
      }

      //TO-DO2: display multiple list names, if this item is a member of 2+
      
      elem("dvListNameForItem").innerHTML = "";

      if (wapp.itemObj.isWibtype == "0") {
        for (i = 0; i < wapp.itemObj.joinedLists_itemIds.length; i++) {
          let curItemObjForLoop = grabItemObj(wapp.itemObj.joinedLists_itemIds[0])

          if (wapp.itemObj.isWibtypeInfoField == "1" && curItemObjForLoop.isWibtype == "1") {
            wibtypeItemObj = curItemObjForLoop;
            //elem("dvListNameForItem").innerHTML = "&nbsp;&nbsp;&nbsp;<span style='color: " + CONST_cssClassName_red + "'><b>type info-field</b></span>";
          } else if (curItemObjForLoop.displayCode == CONST_displayCode_normal && curItemObjForLoop.isWibtype == "0") {
            hasDisplayedLists = true;
            wapp.itemObj.displayedOnList_itemId = curItemObjForLoop.itemId;
            elem("dvListNameForItem").innerHTML = "&nbsp;&nbsp;&nbsp;member of list:&nbsp;&nbsp;<a href='javascript:void go_to_list(\"" + curItemObjForLoop.itemId + "\")'>" + curItemObjForLoop.itemName + "</a>";
            break;
          }
        }

        if (hasDisplayedLists) {
          elem("dvViewItem_JoinedListsArea").style.display = "";
        } else {
          elem("dvViewItem_JoinedListsArea").style.display = "none";
        }
      }

      if (wapp.itemObj.connectedItemDataObjs.length > 0) {
        let html = "";

        for (i = 0; i < wapp.itemObj.connectedItemDataObjs.length; i++) {
          let x = grabItemObj(wapp.itemObj.connectedItemDataObjs[i].itemId2);
          if (html !== "") html += "<div style='height: 1em'></div>"
          html += " <div><a href='javascript:void go_to_item(" + x.itemId + ")'>" + x.itemName + "</a></div>\n";
        }

        elem("dvViewItem_ConnectedItems_Header").style.display = "";
        elem("dvViewItem_ConnectedItems_ItemsIndent").style.display = "inline-block";
        elem("dvViewItem_ConnectedItems_Items").innerHTML = html;
        elem("dvViewItem_ConnectedItems_LinkArea").style.display = "";
      } else {
        elem("dvViewItem_ConnectedItems_Header").style.display = "none";
        elem("dvViewItem_ConnectedItems_ItemsIndent").style.display = "none";
        elem("dvViewItem_ConnectedItems_Items").innerHTML = "connected items: <i>none</i>&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:void add_connected_item()\" style=\"white-space: nowrap\">add</a>";
        elem("dvViewItem_ConnectedItems_LinkArea").style.display = "none";
      }

      if (wapp.itemObj.isWibtype == "1") {
        elem("dvViewItem_ItemActionsArea1").style.display = "";
        elem("dvViewItem_ItemActionsArea2").style.display = "none";
        elem("spnViewItem_MoveCopy1").style.display = "none";
        elem("spnViewItem_MoveCopy2").style.display = "none";
        elem("spnViewItem_ShowWibtypes").style.display = "";
        elem("spnViewItem_ShowWibtypeInfoField").style.display = "none";
        elem("spnViewItem_Delete1").style.display = "none";
        elem("spnViewItem_Delete2").style.display = "none";
      } else if (wapp.itemObj.isWibtypeInfoField == "1") {
        elem("dvViewItem_ItemActionsArea1").style.display = "";
        elem("dvViewItem_ItemActionsArea2").style.display = "none";
        elem("spnViewItem_MoveCopy1").style.display = "none";
        elem("spnViewItem_MoveCopy2").style.display = "none";
        elem("spnViewItem_ShowWibtypes").style.display = "none";
        elem("spnViewItem_ShowWibtypeInfoField").style.display = "";
        elem("aViewItem_BackToType").href = "javascript:void back_to_type(" + wibtypeItemObj.itemId + ")";
        elem("aViewItem_BackToType").innerHTML = wibtypeItemObj.itemName;
        elem("spnViewItem_Delete1").style.display = "none";
        elem("spnViewItem_Delete2").style.display = "none";
      } else {
        if (wapp.itemObj.isList == "0") {
          elem("dvViewItem_ItemActionsArea1").style.display = "";
          elem("dvViewItem_ItemActionsArea2").style.display = "none";
          elem("spnViewItem_MoveCopy1").style.display = "";
          elem("spnViewItem_MoveCopy2").style.display = "";
        } else {
          elem("dvViewItem_ItemActionsArea1").style.display = "none";
          elem("dvViewItem_ItemActionsArea2").style.display = "";
          elem("spnViewItem_MoveCopy1").style.display = "";
          elem("spnViewItem_MoveCopy2").style.display = "";
        }
        elem("spnViewItem_ShowWibtypes").style.display = "none";
        elem("spnViewItem_ShowWibtypeInfoField").style.display = "none";
        elem("spnViewItem_Delete1").style.display = "";
        elem("spnViewItem_Delete2").style.display = "";
      }

      if (wapp.itemObj.isWibtype == "1" || wapp.itemObj.isWibtypeInfoField == "1") {
        elem("spnViewItem_DoneStatusDisplay1").style.display = "none";
        elem("spnViewItem_DoneStatusDisplay2").style.display = "none";
        elem("spnViewItem_DoneStatusLink1").style.display = "none";
        elem("spnViewItem_DoneStatusLink2").style.display = "none";

      } else if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_undone) {
        elem("spnViewItem_DoneStatusDisplay1").style.display = "none";
        elem("spnViewItem_DoneStatusDisplay2").style.display = "none";

        elem("spnViewItem_DoneStatusLink1").style.display = "";
        elem("spnViewItem_DoneStatusLink2").style.display = "";

        elem("aViewItem_DoneStatusLink1").style.display = "";
        elem("aViewItem_DoneStatusLink2").style.display = "";
        elem("aViewItem_DoneStatusLink1").innerHTML = "mark done";
        elem("aViewItem_DoneStatusLink2").innerHTML = "mark done";

      } else {
        elem("spnViewItem_DoneStatusDisplay1").style.display = "";
        elem("spnViewItem_DoneStatusDisplay2").style.display = "";
        elem("spnViewItem_DoneStatusDisplay1").innerHTML = getDoneStatusDisplay(wapp.itemObj.doneStatusCode).toUpperCase() + "&nbsp;&nbsp;";
        elem("spnViewItem_DoneStatusDisplay2").innerHTML = elem("spnViewItem_DoneStatusDisplay1").innerHTML;
        css_setElemToDoneStatusColor("spnViewItem_DoneStatusDisplay1", wapp.itemObj.doneStatusCode);
        css_setElemToDoneStatusColor("spnViewItem_DoneStatusDisplay2", wapp.itemObj.doneStatusCode);

        elem("spnViewItem_DoneStatusLink1").style.display = "";
        elem("spnViewItem_DoneStatusLink2").style.display = "";

        elem("aViewItem_DoneStatusLink1").style.display = "";
        elem("aViewItem_DoneStatusLink2").style.display = "";
        elem("aViewItem_DoneStatusLink1").innerHTML = "change";
        elem("aViewItem_DoneStatusLink2").innerHTML = "change";

      }

      if ( isBlank(wapp.itemObj.notes) ) {
        elem("dvViewItem_Notes_Yes").style.display = "none";
        elem("spnViewItem_Notes_No1").style.display = "";
        elem("spnViewItem_Notes_No2").style.display = "";
        elem("dvViewItem_Notes").innerHTML = "";
      } else {
        elem("dvViewItem_Notes_Yes").style.display = "";
        elem("spnViewItem_Notes_No1").style.display = "none";
        elem("spnViewItem_Notes_No2").style.display = "none";
        elem("dvViewItem_Notes").innerHTML = wapp.itemObj.notes;
      }

      if (wapp.itemObj.isWibtype == "1" || wapp.itemObj.isWibtypeInfoField == "1") {
        elem("dvViewItem_Wibtypes").style.display = "none";
      } else {
        elem("dvViewItem_Wibtypes").style.display = "";
        elem("dvViewItem_Wibtypes_WtifData").innerHTML = writeHtml_WtifData(); 
      }

      if (wapp.itemObj.isWibtypeInfoField == "1") {
        elem("dvViewItem_WibtypeInfoFieldInfo").style.display = "";
        elem("spn_ViewItem_WibtypeInfoFieldInfo_WibDataType").innerHTML = getWibDataTypeNameFromId(wapp.itemObj.wibDataTypeId);
        elem("spn_ViewItem_WibtypeInfoFieldInfo_Required").innerHTML = getBooleanFieldTextDisplay(wapp.itemObj.required);
      } else {
        elem("dvViewItem_WibtypeInfoFieldInfo").style.display = "none";
      }

      // write HTML for list-members, and associated links
      if (wapp.itemObj.isWibtype == "1") {
        elem("dvViewItem_ListMembers_Yes").style.display = "";
        elem("dvViewItem_ListMembers_No").style.display = "none";
        elem("spnViewItem_MakeNewItem1").style.display = "none";
        elem("spnViewItem_MakeNewItem2").style.display = "none";
        elem("spnViewItem_MakeNewField1").style.display = "";
        elem("spnViewItem_MakeNewField2").style.display = "";
        elem("spnViewItem_More1").style.display = "none";
        elem("spnViewItem_More2").style.display = "none";
        elem("dvViewItem_ListMembers_Items").innerHTML = writeHtml_items();
      } else if (wapp.itemObj.isWibtypeInfoField == "1") {
        elem("dvViewItem_ListMembers_No").style.display = "none";
        elem("dvViewItem_ListMembers_Yes").style.display = "none";
        elem("dvViewItem_ListMembers_Items").innerHTML = "";
      } else {
        elem("spnViewItem_MakeNewItem1").style.display = "";
        elem("spnViewItem_MakeNewItem2").style.display = "";
        elem("spnViewItem_MakeNewField1").style.display = "none";
        elem("spnViewItem_MakeNewField2").style.display = "none";
        elem("spnViewItem_More1").style.display = "";
        elem("spnViewItem_More2").style.display = "";
        if (wapp.itemObj.isList == "1") {
          elem("dvViewItem_ListMembers_Yes").style.display = "";
          elem("dvViewItem_ListMembers_No").style.display = "none";
          elem("dvViewItem_ListMembers_Items").innerHTML = writeHtml_items();
        } else {
          elem("dvViewItem_ListMembers_Yes").style.display = "none";
          elem("dvViewItem_ListMembers_No").style.display = "";
          elem("dvViewItem_ListMembers_Items").innerHTML = "";
        }
      }

      // if there is a still-activated reordering item, set it to bold
      if (wapp.reordering_activatedItemId) {
        css_addClass(getHtml_aItem(wapp.reordering_activatedItemId), CONST_cssClassName_bold);
      }

      // dvViewItem_WibtypesForListMembersArea
      if (wapp.itemObj.isWibtype == "1" || wapp.itemObj.isWibtypeInfoField == "1" || wapp.itemObj.isList == "0" ) {

        elem("dvViewItem_WibtypesForListMembersArea").style.display = "none";

      } else {

        elem("dvViewItem_WibtypesForListMembersArea").style.display = "";

        if (wapp.itemObj.wibtypeForListMembersDataObjs.length > 0) {
          let html = "";

          for (i = 0; i < wapp.itemObj.wibtypeForListMembersDataObjs.length; i++) {
            let x = grabItemObj(wapp.itemObj.wibtypeForListMembersDataObjs[i].wibtypeItemId);
            if (html !== "") html += "<div style='height: 1em'></div>"
            //html += " <div><a href='javascript:void go_to_item(" + x.itemId + ")'>" + x.itemName + "</a></div>\n";
            html += " <div>" + x.itemName + "</div>\n";
          }

          elem("dvViewItem_WibtypesForListMembers_Header").style.display = "";
          elem("dvViewItem_WibtypesForListMembers_ItemsIndent").style.display = "inline-block";
          elem("dvViewItem_WibtypesForListMembers_Items").innerHTML = html;
          elem("dvViewItem_WibtypesForListMembers_LinkArea").style.display = "";
        } else {
          elem("dvViewItem_WibtypesForListMembers_Header").style.display = "none";
          elem("dvViewItem_WibtypesForListMembers_ItemsIndent").style.display = "none";
          elem("dvViewItem_WibtypesForListMembers_Items").innerHTML = "types for list members: <i>none</i>&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:void view_item__add_type_for_list_members()\" style=\"white-space: nowrap\">add</a>";
          elem("dvViewItem_WibtypesForListMembers_LinkArea").style.display = "none";
        }

      }

      if (wapp.focusElemId) {

        if (wapp.focusElemId_pre) {
          elem(wapp.focusElemId_pre).focus();
          wapp.focusElemId_pre = null;
        }

        elem(wapp.focusElemId).focus();

        if ( isBlank(wapp.focusItemId) || isBlank(wapp.reordering_activatedItemId) ) {

          // if we do not have a focus-item-id, or if we do not have an activated reordering-item-id, we can reset the focus-element & focus-item-id

          focus_clear();

        } else if ( isEqual(wapp.focusItemId, wapp.reordering_activatedItemId) ) {

          // if the focus-item-id and the activated reordering-item-id are equal, we want to keep the focus on this item

          // --> no action here

        } else {

          // if the focus-item-id and the activated reordering-item-id aren't equal, we will reset the focus-element & focus-item-id
          //   (not sure why this would occur, but just in case)

          focus_clear();

        }

      }

      break;
    }

    case "WibBuilder_AllApps": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - All Apps";

      let html = "";

      let appList_itemObj = grabItemObj(wapp.wb_appListItemId);
      let appList_listMemberDataObjs = appList_itemObj.getListMemberDataObjs();

      appList_listMemberDataObjs.forEach( (appList_listMemberDataObj) => {
        let appItemObj = grabItemObj(appList_listMemberDataObj.itemId);
        if (html !== "") html += "<div style='grid-column: 1/3; height: 1.8em'></div>"

        html += "<div>" + appItemObj.itemName + "</div>\n";
        html += "<div style='padding-left: 0.4em'>\n";
        html += "  <a href='javascript:void all_apps__view_app(\"" + appItemObj.itemId + "\")'>view</a>\n";
        html += "  &nbsp;&nbsp;<a href='javascript:void all_apps__delete_app(\"" + appItemObj.itemId + "\")'>delete</a>\n";
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("dvWibBuilder_AllApps_Items").innerHTML = html;

      break;
    }

    case "WibBuilder_AllScreens": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - All Screens";

      let html = "";

      let screenList_itemObj = grabItemObj(wapp.wb_screenListItemId);
      let screenList_listMemberDataObjs = screenList_itemObj.getListMemberDataObjs();

      screenList_listMemberDataObjs.forEach( (screenList_listMemberDataObj) => {
        let screenItemObj = grabItemObj(screenList_listMemberDataObj.itemId);
        if (html !== "") html += "<div style='height: 1.8em'></div>"

        let screenNameDisplay = wb_getScreenNameDisplay(screenItemObj);

        html += "<div>" + screenNameDisplay + "\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__build_screen(\"" + screenItemObj.itemId + "\")'>build</a>\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__run_screen(\"" + screenItemObj.itemId + "\")'>run</a>\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__delete_screen(\"" + screenItemObj.itemId + "\")'>delete</a>\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__show_type_instances(\"" + screenItemObj.itemId + "\")'>type instances</a>\n";
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("dvWibBuilder_AllScreens_Items").innerHTML = html;

      break;
    }

    case "WibBuilder_AllScripts": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - All Scripts";

      let html = "";

      let scriptList_itemObj = grabItemObj(wapp.wb_scriptListItemId);
      let scriptList_listMemberDataObjs = scriptList_itemObj.getListMemberDataObjs();

      scriptList_listMemberDataObjs.forEach( (scriptList_listMemberDataObj) => {
        let scriptItemObj = grabItemObj(scriptList_listMemberDataObj.itemId);

        let app_itemId = scriptItemObj.getWtifData(wapp.wb_scriptWibtype_itemId, null, CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName);
        let app_itemObj = grabItemObj(app_itemId);

        if (html !== "") html += "<div style='grid-column: 1/4; height: 1.8em'></div>"

        html += "<div>APP: " + app_itemObj.itemName + "</div>\n";
        html += "<div>SCRIPT: " + scriptItemObj.itemName + "</div>\n";
        html += "<div style='padding-left: 0.4em'><a href='javascript:void all_scripts__delete_script(\"" + scriptItemObj.itemId + "\")'>delete</a></div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("dvWibBuilder_AllScripts_Items").innerHTML = html;

      break;
    }

    case "WibBuilder_BuildScreen": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Build Screen";

      let screenTypeCodes_array = wb_getScreenTypeCodesAarray();

      if (wapp.wb_curScreen_itemObj) {

        let wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj)
        let screenTypeCode = wapp.wb_curScreen_itemObj.getWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_screenTypeCode_itemName)
        let screenTypeCodes_SelectHtml = getHtml_selectElem("selWibBuilder_BuildScreen_ScreenTypeCode", false, screenTypeCodes_array, screenTypeCode, "width: 7.2em", "build_screen__changeScreenType()", null, false);

        elem("aWibBuilder_BuildScreen_TypeName").innerHTML = wibtypeItemObj_associatedWithScreen.itemName;
        elem("spnWibBuilder_BuildScreen__ScreenTypeCode").innerHTML = screenTypeCodes_SelectHtml;

        elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = wb_getScreenNameDisplay(wapp.wb_curScreen_itemObj, wibtypeItemObj_associatedWithScreen);
        elem("dvWibBuilder_BuildScreen_ItemNameText").innerHTML = wibtypeItemObj_associatedWithScreen.itemName + " Name:";

      } else {

        let screenTypeCodes_SelectHtml = getHtml_selectElem("selWibBuilder_BuildScreen_ScreenTypeCode", false, screenTypeCodes_array, CONST_wb_screenTypeCode_createWibtype, "width: 7.2em", "build_screen__changeScreenType()", null, false);

        elem("aWibBuilder_BuildScreen_TypeName").innerHTML = "(click here)";
        elem("spnWibBuilder_BuildScreen__ScreenTypeCode").innerHTML = screenTypeCodes_SelectHtml;
        elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = "Create&nbsp;&nbsp;________";
        elem("dvWibBuilder_BuildScreen_ItemNameText").innerHTML = "_______ Name:";

      }

      break;
    }

    case "WibBuilder_ChooseExistingWibtype": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Choose Existing Type";

      let uniqueWibTypeItemIds = [];

      let i, html = "";
      let allScreens_itemObj = grabItemObj(wapp.wb_screenListItemId);
      let allScreens_itemIdList = allScreens_itemObj.getListMemberItemIds();

      for (i = 0; i < allScreens_itemIdList.length; i++) {
        let screenInLoop_itemObj = grabItemObj(allScreens_itemIdList[i]);

        let screenInLoop_wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(screenInLoop_itemObj);

        if ( !doesValArrayHaveElem(uniqueWibTypeItemIds, screenInLoop_wibtypeItemObj_associatedWithScreen.itemId) ) {
          uniqueWibTypeItemIds.push(screenInLoop_wibtypeItemObj_associatedWithScreen.itemId);
        }
      }

      for (i = 0; i < uniqueWibTypeItemIds.length; i++) {
        let wibTypeItemObj_inLoop = grabItemObj(uniqueWibTypeItemIds[i]);

        if (html !== "") html += "<div style='height: 1.8em'></div>"

        html += "<div><a href='javascript:void choose_existing_type__click_type(\"" + wibTypeItemObj_inLoop.itemId + "\")'>" + wibTypeItemObj_inLoop.itemName + "</a></div>\n";
      }

      if (html == "") html += "(no types available)";

      elem("dvWibBuilder_ChooseExistingWibtype_Items").innerHTML = html;

      break;

    }

    case "WibBuilder_DisplayScreen": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "[SCREEN TITLE WILL GO HERE]";
/*
      elem("dvWibBuilder_RunScreen_HeaderText").innerHTML = wb_getScreenNameDisplay(wapp.wb_curScreen_itemObj, wibtypeItemObj_associatedWithScreen);
      elem("dvWibBuilder_RunScreen_ItemNameText").innerHTML = wibtypeItemObj_associatedWithScreen.itemName + " Name:";
      elem("ipWibBuilder_RunScreen_ItemNameValue").value = "";
      elem("ipWibBuilder_RunScreen_ItemNameValue").focus();
*/
      break;
    }

    case "WibBuilder_RunScreen": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Run Screen";

      let wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);

      if (wibtypeItemObj_associatedWithScreen) {

        elem("dvWibBuilder_RunScreen_OldSection").style.display = "";
        elem("dvWibBuilder_RunScreen_NewSection").style.display = "none";

        elem("dvWibBuilder_RunScreen_HeaderText").innerHTML = wb_getScreenNameDisplay(wapp.wb_curScreen_itemObj, wibtypeItemObj_associatedWithScreen);
        elem("dvWibBuilder_RunScreen_ItemNameText").innerHTML = wibtypeItemObj_associatedWithScreen.itemName + " Name:";
        elem("ipWibBuilder_RunScreen_ItemNameValue").value = "";
        elem("ipWibBuilder_RunScreen_ItemNameValue").focus();

      } else {

        elem("dvWibBuilder_RunScreen_OldSection").style.display = "none";
        elem("dvWibBuilder_RunScreen_NewSection").style.display = "";





        //TO-DO1.5:
        //  (1) move to new e.g. "WibBuilder_DisplayScreen"
        //  (2) draw screen HTML
        elem("dvWibBuilder_RunScreen_NewGrid").style.gridTemplateColumns = "";

      }

      break;
    }

    case "WibBuilder_ShowWibtypeInstances": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Show Instances";

      let html = "";
      let wibtypeInstance_itemObjs = getInstanceItemObjsForWibtype(wapp.wb_curWibtype_itemObj.itemId);

      wibtypeInstance_itemObjs.forEach( (wibtypeInstance_itemObj) => {
        if (html !== "") html += "<div style='height: 1.8em'></div>"

        html += "<div>" + wibtypeInstance_itemObj.itemName;
        html += "&nbsp;&nbsp;<a href='javascript:void show_instances__edit(" + wibtypeInstance_itemObj.itemId + ")'>edit</a>\n";
        html += "&nbsp;&nbsp;<a href='javascript:void show_instances__delete(" + wibtypeInstance_itemObj.itemId + ")'>delete</a>\n";
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("dvWibBuilder_ShowWibtypeInstances_Items").innerHTML = html;

      elem("aWibBuilder_ShowWibtypeInstances_RunScreenAgain").focus();

      break;
    }

    case "WibBuilder_ViewApp": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - View App";

      elem("dvWibBuilder_ViewApp_ItemName").innerHTML = wapp.wb_curApp_itemObj.itemName;

/*
      elem("dvWibBuilder_RunScreen_HeaderText").innerHTML = wb_getScreenNameDisplay(wapp.wb_curScreen_itemObj, wibtypeItemObj_associatedWithScreen);
      elem("dvWibBuilder_RunScreen_ItemNameText").innerHTML = wibtypeItemObj_associatedWithScreen.itemName + " Name:";
      elem("ipWibBuilder_RunScreen_ItemNameValue").value = "";
      elem("ipWibBuilder_RunScreen_ItemNameValue").focus();
*/
      break;
    }

    case "Wibtypes": {
      setWappItemObj(grabItemObj(wapp.wibtypes_itemId));
      elem("dvWibtypes_Items").innerHTML = writeHtml_items();
      break;
    }

    default: {
      // no action currently
    }
  }
}

function doCheckboxClickAction(elemId) {
  var checkboxIsChecked = false;
  if ( elem(elemId).checked ) {
    checkboxIsChecked = true;
  }

  switch (elemId) {
    case "ckMakeNewItem_TimeTracking":
      if (checkboxIsChecked) {
        html_displayAllElementsOfClass("gc1Group1")
        wapp.wdtUiDataObj.initUi_endDateOrLink();
        elem("ipMakeNewItem_StartHour").focus();
      } else {
        html_hideAllElementsOfClass("gc1Group1")
      }
      break;
  }
}

function doesObjArrayHaveElem(theArray, propName, propValToMatch) {
  for (var i = 0; i < theArray.length; i++) {

    if ( ! doesObjHaveProp(theArray[i],propName) ) {
      continue;
    }

    if ( isEqual(theArray[i][propName], propValToMatch) ) {
      return true;
    }
  }

  return false;
}

function doesObjHaveProp(obj, propName) {
  if (obj == null) {
    return false;
  }

  if ( obj[propName] === undefined ) {
    return false;
  } else {
    return true;
  }

  /* test code for this function:

  var x;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("1-true"); } else { dc_("1-false"); }

  x = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("2-true"); } else { dc_("2-false"); }

  x = 123;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("3-true"); } else { dc_("3-false"); }

  x = "abc";
  if ( doesObjHaveProp(x, "prop1") ) { dc_("4-true"); } else { dc_("4-false"); }

  x = {};
  if ( doesObjHaveProp(x, "prop1") ) { dc_("5-true"); } else { dc_("5-false"); }

  x.prop0 = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("6-true"); } else { dc_("6-false"); }

  x.prop1 = null;
  if ( doesObjHaveProp(x, "prop1") ) { dc_("7-true"); } else { dc_("7-false"); }

  x.prop1 = "a";
  if ( doesObjHaveProp(x, "prop1") ) { dc_("8-true"); } else { dc_("8-false"); }

  */
}

function doesValArrayHaveElem(theArray, valToMatch) {

  for (var i = 0; i < theArray.length; i++) {

    if ( isEqual(theArray[i], valToMatch) ) {
      return true;
    }

  }

  return false;
}

function elem(elemId) {
  return document.getElementById(elemId);
}

function focus_clear() {
  wapp.focusItemId = null;
  wapp.focusElemId = null;
}

function focus_set_fromItemId(itemId) {
  wapp.focusItemId = itemId;
  wapp.focusElemId = getHtml_aItem(itemId);
}

function focus_set_fromElemId(elemId) {
  wapp.focusItemId = null;
  wapp.focusElemId = elemId;
}

function getAllItemsArray() {
  var allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  var allItemIds_array = getIdArray(allItemIds_string);
  return allItemIds_array;
}

function getBooleanFieldTextDisplay(booleanFieldZeroOrOne) {
  if ( booleanFieldZeroOrOne == "1" ) {
    return "yes";
  } else{
    return "no";
  }
}

function getDoneStatusDisplay(doneStatusCode) {
  if ( isEqual(doneStatusCode, CONST_doneStatusCode_done) ) {
    return CONST_doneStatusDisplay_done;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_notice) ) {
    return CONST_doneStatusDisplay_notice;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_info) ) {
    return CONST_doneStatusDisplay_info;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_okay) ) {
    return CONST_doneStatusDisplay_okay;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_undone) ) {
    return CONST_doneStatusDisplay_undone;
  }
}

function getDoneStatusCssClassNameColor(doneStatusCode, dev__elemId) {
  var cssClassNameColor;

  if ( isEqual(doneStatusCode, CONST_doneStatusCode_done) ) {
    cssClassNameColor = CONST_cssClassName_green;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_info) ) {
    cssClassNameColor = CONST_cssClassName_black;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_notice) ) {
    cssClassNameColor = CONST_cssClassName_red;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_okay) ) {
    cssClassNameColor = CONST_cssClassName_brown;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_undone) ) {
    cssClassNameColor = "";
  }

  return cssClassNameColor;
}

function getElemVal(elemId) {
  var theElem, elemType, elemVal;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      if (elemVal = theElem.checked) {
        elemVal = "1";
      } else {
        elemVal = "0";
      }
      break;

    default:
      elemVal = theElem.value;
  }

  return elemVal;
}

function getElemFromObjArray(theArray, propName, propValToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem[propName], propValToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return null;
  } else {
    return revisedArray[0];
  }
}

function getElemFromValArray(theArray, valToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem, valToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return "";
  } else {
    return revisedArray[0];
  }
}

function getFromDatastore(itemKey) {
  var itemValue = localStorage.getItem(itemKey);
  return itemValue;
}

function getHtml_aItem(itemId) {
  return "aItem_" + itemId;
}

function getHtml_reorderingActivated_tr(itemId) {
  return "trActivatedForReordering_" + itemId;
}

function getHtml_reorderingModeIs_normal_tblOptions(itemId) {
  return "reorderingModeIs_normal_tblOptions_" + itemId;
}

function getHtml_reorderingModeIs_moveAboveOtherItem_dvInstructions(itemId) {
  return "reorderingModeIs_moveAboveOtherItem_dvInstructions_" + itemId;
}

function getHtml_selectElem(selectElemId, includeBlank, theArray, defValue, theStyle, onChange, blankDisplay, isDisabled) {
  var i, html;

  html = "<select id='" + selectElemId + "'";

  if (  !isBlank(theStyle) ) {
    html += " style='" + theStyle + "'";
  }

  if ( !isBlank(onChange) ) {
    html += " onchange='javascript:void " + onChange + "'";
  }

  if (isDisabled) {
    html += " disabled";
  }

  html += ">\n";

  if (includeBlank) {
    html += "<option value=''";
    if ( isBlank(defValue) ) html += " selected";
    html += ">";
    if (blankDisplay) {
      html += blankDisplay + "</option>\n";
    } else {
      html += " </option>\n";
    }
  }


  for (i = 0; i < theArray.length; i++ ) {
    let curOptionId = theArray[i].optionId;
    let curOptionDisplay = theArray[i].optionDisplay;

    html += "<option value='" + curOptionId + "'";

    if ( isEqual(defValue, curOptionId) ) {
      html += " selected";
    }

    html += ">" + curOptionDisplay + "</option>\n";
  }

  html += "</select>\n";

  return html;
}

function getIdArray(string_ids){
  var array_ids;
  if (isBlank(string_ids)) return [];
  array_ids = string_ids.split(sD);
  return array_ids;
}

function getIdString(array_ids){
  var string_ids = array_ids.join(sD);
  return string_ids;
}

function getInstanceItemObjsForWibtype(wibtypeItemId) {
  var igo = new ItemGrabbingObj();

  igo.set_targetAssignedToWibtypeWithItemId(wibtypeItemId);
  igo.set_returnFirstOnly_false();

  var instanceItemObjs_array = igo.runSearchAndReturnX();

  return instanceItemObjs_array;
}

function getItemDisplay_fromInfoString(itemInfoString) {
  var iit = getItemInfoTransfer();
  iit.receiveString(itemInfoString);
  return iit.getDisplay();
}

function getItemDisplay_fromItemId(itemId) {
  var itemObj = grabItemObj(itemId);
  var iit = getItemInfoTransfer();
  iit.receiveObject(itemObj);
  return iit.getDisplay();
}

function getItemIdArrayAsObjArray(itemIdArray) {
  var itemObjArray = [];
  
  itemIdArray.forEach( (itemId) => {
    let itemObj = grabItemObj(itemId);
    itemObjArray.push(itemObj);
  } );

  return itemObjArray;
}

var getItemInfoTransfer = function() {
  //TO-DO2: handle data types, e.g. double-confirm setting isX to "0" or "1" (and xCode to "0" ?)


  // FAMILY OF FUNCTIONS:
  //
  //  (1) getItemInfoTransfer()  ---  core object
  //
  //  (2) transferItemInfo_XtoY  ---  functions called by other wib code, in order to move item-info from one structure to another
  //
  //  (3) getItemDisplay_fromX   ---  developer functions to quickly view the data for an item
  //
  //
  // NOTES:
  //
  //   A. an "itemInfoObject", as referenced in this family of functions, does not technically need to be a full wapp item-obj created by itemObjFactory
  //    (it could also be an object that just holds the item-level name/value pairs for an item, without the additional arrays and functions from itemObjFactory)


  var _itemInfoValues;
  var _itemInfoNames = [];

  _itemInfoNames.push("itemName");
  _itemInfoNames.push("doneStatusCode");
  _itemInfoNames.push("displayCode");
  _itemInfoNames.push("isList");
  _itemInfoNames.push("notes");
  _itemInfoNames.push("isWibtype");
  _itemInfoNames.push("isWibtypeInfoField");

  // not sure if we want this function to be private or public -- keeping here as example of private for now
  function _setItemInfoValue(itemInfoName_toFind, itemInfoValue_toSet) {
    _itemInfoNames.forEach( (itemInfoName_forLoop, idx) => {
      if ( isEqual(itemInfoName_toFind, itemInfoName_forLoop) ) {
        _itemInfoValues[idx] = itemInfoValue_toSet;
      }
    } );
  }

  return {
    getDisplay: function() {
      // this function is basically the same code flow as getString(), but it displays
      //  a human-readable text output including property names
      let text = "";

      for (let i = 0; i < _itemInfoValues.length; i++) {
        if (i > 0) text += "\n";
        text += _itemInfoNames[i] + ": " + _itemInfoValues[i];
      }

      return text;
    },
    
    getItemInfoValue: function(itemInfoName_toFind) {
      _itemInfoNames.forEach( (itemInfoName_forLoop, idx) => {
        if ( isEqual(itemInfoName_toFind, itemInfoName_forLoop) ) {
          return _itemInfoValues[idx];
        }
      } );

      return null;
    },
    
    getArray: function() {
      return _itemInfoValues;
    },
    
    getString: function() {
      let itemInfoString = "";

      // need to move through the _itemInfoNames array in index order starting from 0,
      //  because the itemInfoString we are returning must be built in the same order
      for (let i = 0; i < _itemInfoNames.length; i++) {
        if (itemInfoString.length > 0) {
          itemInfoString = itemInfoString + sD;
        }
        itemInfoString = itemInfoString + _itemInfoValues[i];
      }

      return itemInfoString;
    },
    
    receiveArray: function(itemInfoArray) {
      _itemInfoValues = [];

      // need to move through the received itemInfoArray array in index order starting from 0,
      //  because the elements in the _itemInfoValues array must be set in the same order
      for (let i = 0; i < itemInfoArray.length; i++ ) {
        _itemInfoValues.push(itemInfoArray[i]);
      }
    },
    
    receiveObject: function(itemInfoObject) {
      _itemInfoValues = [];

      // need to move through the _itemInfoNames array in index order starting from 0,
      //  because the elements in the _itemInfoValues array must be set in the same order
      for (let i = 0; i < _itemInfoNames.length; i++ ) {
        let itemInfoName_forLoop = _itemInfoNames[i];

        let itemInfoValue_forLoop = itemInfoObject[itemInfoName_forLoop];

        _itemInfoValues.push( itemInfoValue_forLoop );
      }
    },
    
    receiveString: function(itemInfoString) {
      _itemInfoValues = itemInfoString.split(sD);
    },

    setObject: function(itemInfoObject) {
      // can use .forEach here to go through the _itemInfoNames array,
      //  because we can set the matching properties on the received itemInfoObject
      //  by using the _itemInfoNames index value that is passed into .forEach
      _itemInfoNames.forEach( (itemInfoName_forLoop, idx) => {
        itemInfoObject[itemInfoName_forLoop] = _itemInfoValues[idx];
      } );
    }
  }
};

function getObjArrayAsString(theArray, propName, propName2) {
  var i, str = "";
  for (i = 0; i < theArray.length; i++ ){
    str += "array item #" + (parseInt(i) + 1) + " ----- ";
    str += propName1 + ": " + theArray[i][propName1];
    if ( !isBlank(propName2) ) str += ", " + propName2 + ": " + theArray[i][propName2];
    str += "\n";
  }
  return str;
}

function getObjArrayWithoutElem(theArray, propName, propValToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem[propName], propValToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;

  /* test code for this function:
  var x1 = {prop1: "a"};
  var x2 = {prop1: "b"};
  var x3 = {prop1: "b"};
  var x4 = {prop1: "a"};

  var ay = [x1, x2, x3, x4];

  var ay2 = getObjArrayWithoutElem(ay, "prop1", "b")

  dc_(getObjArrayAsString(ay2, "prop1"))
  */
}

function getProcessedStringForSave(oldString) {
  var newString = getStringWithCharsReplaced(oldString, "  ", "&nbsp;&nbsp;");
  return newString;
}

function getSaveKeyText_connectedItems_ofItem(itemId) {
  return "iCI_" + itemId;
}

function getSaveKeyText_item(itemId) {
  return "i_" + itemId;
}

function getSaveKeyText_joinedLists_ofItem(itemId) {
  return "iJL_" + itemId;
}

function getSaveKeyText_listMembers_ofItem(itemId) {
  return "iLM_" + itemId;
}

function getSaveKeyText_wibtypeInfoFieldInfo_ofItem(itemId) {
  return "iWTIFI_" + itemId;
}

function getSaveKeyText_wibtypeAssignments_toItem(itemId) {
  return "iWTAs_" + itemId;
}

function getSaveKeyText_wibtypesForListMembers_ofItem(itemId) {
  return "iWTFLMs_" + itemId;
}

function getSaveKeyText_wtifData(itemIdAssignedToTheWibtype, wtifItemId) {
  return "i" + itemIdAssignedToTheWibtype + "_wtif" + wtifItemId;
}

function getSelectArrayElem(optionId, optionDisplay) {
  var theObj = {};

  theObj.optionId = optionId;

  if (optionDisplay === undefined) {
    theObj.optionDisplay = optionId;
  } else {
    theObj.optionDisplay = optionDisplay;
  }

  return theObj;
}

function getStringWithCharsReplaced(oldString, oldChars, newChars) {
  if ( oldString == null || oldChars == null ) {
    return "";
  }

  if ( newChars == null ) {
    newChars = "";
  }

  var newString = oldString;

  for (var i = 1; i <= 100000; i++) {  //use a counter to prevent being stuck in a do-loop if something goes wrong
    if ( !newString.includes(oldChars) ) {
      return newString;
    }

    newString = newString.replace(oldChars, newChars);
  }

  return newString;
}

function getValArrayWithoutElem(theArray, valToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem, valToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;
}

function getWibDataTypeNameFromId(wibDataTypeId) {
  switch (parseInt(wibDataTypeId)) {
    case parseInt(CONST_wibDataType_text_id):
      return CONST_wibDataType_text_name;
    case parseInt(CONST_wibDataType_date_id):
      return CONST_wibDataType_date_name;
    case parseInt(CONST_wibDataType_timeOfDay_id):
      return CONST_wibDataType_timeOfDay_name;
    case parseInt(CONST_wibDataType_numeric_id):
      return CONST_wibDataType_numeric_name;
  }
}

function getWibDataTypesAsArray() {
  var anObj;
  var theArray = [];

  //WibDataType = "text"
  anObj = getSelectArrayElem(CONST_wibDataType_text_id, CONST_wibDataType_text_name);
  anObj.wibDataTypeId = CONST_wibDataType_text_id;
  anObj.wibDataTypeName = CONST_wibDataType_text_name;
  theArray.push(anObj);

  //WibDataType = "date"
  anObj = getSelectArrayElem(CONST_wibDataType_date_id, CONST_wibDataType_date_name);
  anObj.wibDataTypeId = CONST_wibDataType_date_id;
  anObj.wibDataTypeName = CONST_wibDataType_date_name;
  theArray.push(anObj);

  //WibDataType = "time of day"
  anObj = getSelectArrayElem(CONST_wibDataType_timeOfDay_id, CONST_wibDataType_timeOfDay_name);
  anObj.wibDataTypeId = CONST_wibDataType_timeOfDay_id;
  anObj.wibDataTypeName = CONST_wibDataType_timeOfDay_name;
  theArray.push(anObj);

  //WibDataType = "numeric"
  anObj = getSelectArrayElem(CONST_wibDataType_numeric_id, CONST_wibDataType_numeric_name);
  anObj.wibDataTypeId = CONST_wibDataType_numeric_id;
  anObj.wibDataTypeName = CONST_wibDataType_numeric_name;
  theArray.push(anObj);

  return theArray;
}

function getWithLeadingZeroes(startingVal, resultingNumberStringLength) {
  //TO-DO2: allow >5 total string length

  resultingNumberStringLength = parseInt(resultingNumberStringLength);

  if (resultingNumberStringLength < 2 || resultingNumberStringLength > 5)  {
    alert("ERROR: function getWithLeadingZeroes, getWithLeadingZeroes limited to resultingNumberStringLength between 2 and 5 (resultingNumberStringLength=" + resultingNumberStringLength);
    return;
  }

  if ( isBlank(startingVal) ) return "";

  if ( !isNumeric(startingVal) ) return "";

  var endingVal = "";
  startingVal = parseInt(startingVal);

  if (startingVal < 10) {
    if (resultingNumberStringLength == 2) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 3) { endingVal = "00" + String(startingVal);
    } else if (resultingNumberStringLength == 4) { endingVal = "000" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "0000" + String(startingVal);
    }
  } else if (startingVal < 100) {
    if (resultingNumberStringLength == 3) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 4) { endingVal = "00" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "000" + String(startingVal);
    }
  } else if (startingVal < 1000) {
    if (resultingNumberStringLength == 4) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "00" + String(startingVal);
    }
  } else if (startingVal < 10000) {
    if (resultingNumberStringLength == 5) { endingVal = "0" + String(startingVal); }
  }

  return endingVal;
}

function goToItemView(itemId, maintainActivatedItem) {
  if ( !isBlank(itemId) ) {
    setWappItemObj(grabItemObj(itemId));
  }

  if ( !isBlank(wapp.reordering_activatedItemId) ) {
    if (!maintainActivatedItem) {
      css_addClass(getHtml_aItem(itemId), CONST_cssClassName_bold);
    }
  }

  displayPage("ViewItem");
  toggleGrabbing_off();
}

function grabAllItemObjs__wtifItemName_and_wibtypeItemId_and_wtifTheData(wtifItemName, wtifWibtypeItemId, wtifTheData){
  var igo = new ItemGrabbingObj();

  igo.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData(wtifItemName, wtifWibtypeItemId, wtifTheData);
  igo.set_returnFirstOnly_false();

  var itemObjArray = igo.runSearchAndReturnX();

  return itemObjArray;
}

function grabItemObj(itemId, suppressErrorMsgIfNotFound) {
  var i, saveKeyText_item, itemObj, itemInfoString, itemDataArray;

  // get the item-data-string from the datastore
  saveKeyText_item = getSaveKeyText_item(itemId);
  itemInfoString = getFromDatastore(saveKeyText_item);

  if ( isBlank(itemInfoString) ) {
    if (!suppressErrorMsgIfNotFound) {
      showSoftError("grabItemObj()", "item with itemId=" + itemId + " does not exist in data storage");
    }
    return null;
  }

  // create an item-object
  itemObj = itemObjFactory();

  // set the item-object's properties from the retrieved item-data
  itemDataArray = itemInfoString.split(sD);
  itemObj.itemId = itemId;
  itemObj.itemName = itemDataArray[0];
  itemObj.doneStatusCode = itemDataArray[1];
  itemObj.displayCode = itemDataArray[2];
  itemObj.isList = itemDataArray[3];
  itemObj.notes = itemDataArray[4];
  itemObj.isWibtype = itemDataArray[5];
  itemObj.isWibtypeInfoField = itemDataArray[6];

  // set joined-lists array, if any exist for this item
  let saveKeyText_joinedLists_ofItem = getSaveKeyText_joinedLists_ofItem(itemObj.itemId);
  let joinedLists_itemIds_string = getFromDatastore(saveKeyText_joinedLists_ofItem);
  itemObj.joinedLists_itemIds = getIdArray(joinedLists_itemIds_string);

  // set wibtype-assignments array, if any exist for this item
  let saveKeyText_wibtypeAssignments_toItem = getSaveKeyText_wibtypeAssignments_toItem(itemObj.itemId);
  let assignedWibtypes_itemIds_string = getFromDatastore(saveKeyText_wibtypeAssignments_toItem);
  itemObj.assignedWibtypes_itemIds = getIdArray(assignedWibtypes_itemIds_string);

  // set data-from-wibtype-assignment-info-fields, if any
  //  loop through any wibtype-itemIds that are assigned to this item-we-are-creating
  itemObj.assignedWibtypes_itemIds.forEach( (current_assignedWibtype_itemId) => {

    // get the item-object for the current wibtype-itemId in the outer loop
    let currentWibtype_itemObj = grabItemObj(current_assignedWibtype_itemId);

    // get the list-member-itemIds for the outer-loop-wibtype's item-object
    let currentWibtype_listMemberItemIds = currentWibtype_itemObj.getListMemberItemIds();

    // loop through the list-member-itemIds
    currentWibtype_listMemberItemIds.forEach( (currentListMemberItemId_ofTheCurrentWibtype) => {

      // we are now in an inner loop, of the list-member-data-itemIds for the wibtype from the outer loop
      // 
      // each list-member-data-itemId is for a wibtype-info-field
      //  (the variable is "currentListMemberItemId_ofTheCurrentWibtype" in this inner loop)

      // get the wtif-related-data from datastore for this item-we-are-creating
      let saveKeyText_wtifData = getSaveKeyText_wtifData(itemObj.itemId, currentListMemberItemId_ofTheCurrentWibtype)
      let wtifData = getFromDatastore(saveKeyText_wtifData);

      // create and fill the wtif-data-object that holds the wtif-data for this item-we-are-creating
      let wtifDataObj = createWtifDataObj(currentWibtype_itemObj.itemId, currentListMemberItemId_ofTheCurrentWibtype, null, wtifData);

      // push tye wtif-data-object to the associated array-property of this item-we-are-creating
      itemObj.wtifDataObjs.push(wtifDataObj);

    } );
  } );

  // if this is a wibtype-info-field, set wibtype-info-field-info properties for this item-object
  if (itemObj.isWibtypeInfoField == "1") {
    let saveKeyText_wibtypeInfoFieldInfo_ofItem = getSaveKeyText_wibtypeInfoFieldInfo_ofItem(itemObj.itemId);
    let wibtypeInfoFieldInfo_string = getFromDatastore(saveKeyText_wibtypeInfoFieldInfo_ofItem);
    let wibtypeInfoFieldInfo_array = wibtypeInfoFieldInfo_string.split(sD);
    let wibDataTypeId = wibtypeInfoFieldInfo_array[0];
    let required = wibtypeInfoFieldInfo_array[1];
    itemObj.setWibtypeInfoFieldInfo(wibDataTypeId, required, false);
  }

  // load connected-items
  var saveKeyText_connectedItems_ofItem = getSaveKeyText_connectedItems_ofItem(itemObj.itemId)  
  var connectedItems_string = getFromDatastore(saveKeyText_connectedItems_ofItem);
  var connectedItems_array = [];
  if ( !isBlank(connectedItems_string) ) connectedItems_array = connectedItems_string.split(sD);
  for (i = 0; i < connectedItems_array.length; i++) {
    let itemId2 = connectedItems_array[i];
    let x = createConnectedItemDataObj(itemId2);
    itemObj.connectedItemDataObjs.push(x);
  }

  // load wibtypes-for-list-members
  var saveKeyText_wibtypesForListMembers_ofItem = getSaveKeyText_wibtypesForListMembers_ofItem(itemObj.itemId)  
  var wibtypesForListMembers_string = getFromDatastore(saveKeyText_wibtypesForListMembers_ofItem);
  var wibtypesForListMembers_array = [];
  if ( !isBlank(wibtypesForListMembers_string) ) wibtypesForListMembers_array = wibtypesForListMembers_string.split(sD);
  for (i = 0; i < wibtypesForListMembers_array.length; i++) {
    let wibtypeItemId = wibtypesForListMembers_array[i];
    let x = createWibtypeForListMembersDataObj(wibtypeItemId);
    itemObj.wibtypeForListMembersDataObjs.push(x);
  }

  // return the item-object
  return itemObj;
}

function grabItemObj__wtifItemName_and_wibtypeItemId_and_wtifTheData(wtifItemName, wtifWibtypeItemId, wtifTheData){
  var igo = new ItemGrabbingObj();

  igo.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData(wtifItemName, wtifWibtypeItemId, wtifTheData);

  var itemObj = igo.runSearchAndReturnX();

  return itemObj;
}

function grabItemObj__listItemId_and_memberItemName(listItemId, memberItemName, dev1){
  var igo = new ItemGrabbingObj();

  igo.set_targetJoinedListWithItemId(listItemId, dev1);
  igo.set_targetItemName(memberItemName, dev1);

  var itemObj = igo.runSearchAndReturnX(dev1);

  return itemObj;
}

function grabItemObjByName(itemName) {
  return searchForItemObj_OLD(null, null, null, null, null, null, itemName, null, true);
}

function hidePopUp(popUpCode) {
  elem("dvMainViewOverlay").style.display = "";
  elem("dvPopUp").style.display = "none";
  elem("dvPopUp_" + popUpCode).style.display = "none";
}

function html_displayAllElementsOfClass(className) {
  html_toggleDisplayAllElementsOfClass(className, true);
}

function html_doesElemExist(elemId) {
  var possibleElem = elem(elemId);

  if ( isBlank(possibleElem) ) {
    return false;
  } else {
    return true;
  }
}

function html_hideAllElementsOfClass(className) {
  html_toggleDisplayAllElementsOfClass(className, false);
}

function html_toggleDisplayAllElementsOfClass(className, doShow) {
  var ay = document.querySelectorAll("." + className);
  ay.forEach( (theElem, idx) => {
    if (doShow) {
      theElem.style.display = "";
    } else {
      theElem.style.display = "none";
    }
  } );
}

function importBackupText(textToImport) {
  var i, keyValuePairs, keyName, keyValue;

  //split storage-keys from text-to-import string
  keyValuePairs = textToImport.split(sD2);

  //if we don't have an even number of items, there is a mismatch of key/value pairs
  if (keyValuePairs.length % 2 > 0) {
    alert("uneven number of key/value pairs, operation canceled");
    return;
  }

  //clear existing storage
  if ( !confirm("About to clear existing storage, in order to proceed with import. Continue?") ) {
    return
  }
  localStorage.clear();

  //do the import
  for (i = 0; i < keyValuePairs.length; i = i + 2) {
    keyName = keyValuePairs[i];
    keyValue = keyValuePairs[i+1];
//if(!confirm("would make:\nkeyName: "+keyName+"\nkeyValue: "+keyValue+"\n\nexisting keyValue: "+getFromDatastore(keyName)))return
    localStorage.setItem(keyName, keyValue);
//if(!confirm("just added:\nkeyName: "+keyName+"\n\nnow, when re-grabbed from localStorage it is: "+getFromDatastore(keyName)))return
  }

  alert("Import complete");

  //refresh app and go to home page
  return_home();
}

function isBlank(val, dev1) {
  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-1") }

  if(val === undefined) return true;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-2") }

  if(val == null) return true;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-3") }

  if(val == "0")return false;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-4") }

  if(parseInt(val) == 0)return false;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-5") }

  if(val == "") return true;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-6") }

  if(!val)return true;

  //if ( dev1 === undefined ) {} else { dc_(dev1, "isBlank-7") }
  //if ( dev1 === undefined ) {} else { dc_(dev1, "val == 'null'", val == "null") }

  return false;
}

function isEqual(val1, val2) {
  if ( isBlank(val1) && isBlank(val2) ) return true;
  if ( val1 == val2 ) return true;
  if ( Number(val1) == Number(val2) ) return true;
  return false;
}

function isMemberOfList(memberItemId, listItemId) {
  var listItemObj, listMemberDataObjs, i;

  listItemObj = grabItemObj(listItemId);
  listMemberDataObjs = listItemObj.getListMemberDataObjs();
  
  for (i = 0; i < listMemberDataObjs.length; i++) {
    if ( isEqual(listMemberDataObjs[i].itemId, listItemId) ) {
      return true;
    }
  }

  return false;
}

function isNumeric(val) {
  if ( isBlank(val) ) return false;
  return val == val * 1;
}

function isWibtypeInUse(wibtypeItemId) {
  var allItemIds_array = getAllItemsArray();
  
  for (var i = 0; i < allItemIds_array.length; i++) {
    let itemId_insideLoop = allItemIds_array[i];
    let saveKeyText_wibtypeAssignments_toItem = getSaveKeyText_wibtypeAssignments_toItem(itemId_insideLoop);
    let assignedWibtypes_string = getFromDatastore(saveKeyText_wibtypeAssignments_toItem);
    let assignedWibtypes_array = getIdArray(assignedWibtypes_string);

    if ( doesValArrayHaveElem(assignedWibtypes_array, wibtypeItemId) ) {
      return true;
    }
  }

  return false;
}

function ItemGrabbingObj() {
  this.errorDuringSettingParams = false;

  this.returnFirstOnly = true;

  this.sortOption_itemName = "itemName";
  this.sortOption_itemId = "itemId";
  this.validSortOptions = [];
  this.validSortOptions.push(this.sortOption_itemName);
  this.validSortOptions.push(this.sortOption_itemId);

  this.sortOptionsArray = [];

  this.target_itemName = null;
  this.target_joinedListWithItemId = null;
  this.target_assignedToWibtypeWithItemId = null;

  this.target_wtif_isFrom_wibtypeItemId = null;
  this.target_wtif_itemId = null;
  this.target_wtif_itemName = null;
  this.target_wtif_searchForBlankTheData = false;
  this.target_wtif_theData = null;

  this.wtifDataSearchHasBeenSet = false;

  /* --- INSTRUCTIONS ---

  // create and run search object:
  
  var igo = new ItemGrabbingObj();
   
  // include any or all of the following:
  //   (all must be true for an item to be returned)
   
  igo.set_targetItemName(itemName_toSearchFor);
  igo.set_targetJoinedListWithItemId(listItemId_toSearchFor);
  igo.set_targetAssignedToWibtypeWithItemId(wibtypeItemId_toSearchFor);

  // can only include one of the following two options:

  // -> option 1:
  igo.set_targetCombo_wtifItemId_and_wtifData(wtifItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
  //
  //  --- or ---
  //
  // -> option 2:
  igo.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData(wtifItemName_toSearchFor, wtifWibtypeItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
  
  igo.set_returnFirstOnly_false();  // optional (ItemGrabbingObj() defaults to returnFirstOnly==true)

  // FUTURE:
  //  will be able to set sorting options
  //  (other than by itemName, which is the defaut now)
  //  [eventually, the syntax will be ---- this.addSortOption(xyz), and we'll reference the various this.sortOption_aaa etc]

  var itemObj = igo.runSearchAndReturnX();       // if returnFirstOnly==true (default)
  //  --- or ---
  var itemObjArray = igo.runSearchAndReturnX();  // if returnFirstOnly==false

  */

  this.addSortOption = function(sortOption) {
    if ( !doesValArrayHaveElem(this.validSortOptions, sortOption) ) {
      showSoftError("ItemGrabbingObj -> .addSortOption()", "received sortOption value '" + sortOption + "' -- but that is not a valid sortOption");
      return false;
    }

    if ( doesValArrayHaveElem(this.sortOptionsArray, sortOption) ) {
      showSoftError("ItemGrabbingObj -> .addSortOption()", "the sortOptionsArray already includes the sortOption '" + sortOption + "'");
      return false;
    }

    this.sortOptionsArray.push(sortOption);
  }

  this.runSearchAndReturnX = function(dev1) {
    if (this.errorDuringSettingParams) {
      showSoftError("ItemGrabbingObj.runSearchAndReturnX()", "an error previously occurred during the setting of search parameters, so we cannot run this search")
      return;
    }

    var i, result_itemObjArray = [];
    var allItemIds_array = getAllItemsArray();
    
    for (i = 0; i < allItemIds_array.length; i++) {

      let curItemObj = grabItemObj(allItemIds_array[i]);

      if ( !isBlank(this.target_itemName) ) {
        if ( !isEqual(this.target_itemName, curItemObj.itemName) ) {
          continue;
        }
      }

      if ( !isBlank(this.target_joinedListWithItemId) ) {
        if ( !doesValArrayHaveElem(curItemObj.joinedLists_itemIds, this.target_joinedListWithItemId) ) {
          continue;
        }
      }

      if ( !isBlank(this.target_assignedToWibtypeWithItemId) ) {
        if ( !doesValArrayHaveElem(curItemObj.assignedWibtypes_itemIds, this.target_assignedToWibtypeWithItemId) ) {
          continue;
        }
      }

      if ( !isBlank(this.target_wtif_itemId) || !isBlank(this.target_wtif_itemName) ) {
        let wtifIdOrName_found = false;
        let wtifTheData_matchSuccessful = false;

        for (let j = 0; j < curItemObj.wtifDataObjs.length; j++) {
          let curWtifDataObj = curItemObj.wtifDataObjs[j];

          if ( !isBlank(this.target_wtif_itemId) ) { 

            if ( isEqual(curWtifDataObj.wtifItemId, this.target_wtif_itemId) ) {
              wtifIdOrName_found = true;
            }

          } else if ( !isBlank(this.target_wtif_itemName) ) {

            let wtifItemObj = grabItemObj(curWtifDataObj.wtifItemId);

            if ( isEqual(curWtifDataObj.wibtypeItemId, this.target_wtif_isFrom_wibtypeItemId) && isEqual(wtifItemObj.itemName, this.target_wtif_itemName) ) {
              wtifIdOrName_found = true;
            }

          }

          if (wtifIdOrName_found) {
            if (this.target_wtif_searchForBlankTheData && isBlank(curWtifDataObj.theData) ) {
              wtifTheData_matchSuccessful = true;
            } else if ( isEqual(curWtifDataObj.theData, this.target_wtif_theData) ) {
              wtifTheData_matchSuccessful = true;
            }
            break;
          }

        }

        if (!wtifTheData_matchSuccessful) {
          continue;
        }
      }

      result_itemObjArray.push(curItemObj);

      if (this.returnFirstOnly) {
        break;
      }
    }

    if (result_itemObjArray.length == 0) {

      if (this.returnFirstOnly) {
        return null;
      } else {
        return [];
      }

    } else if (this.returnFirstOnly) {

      return result_itemObjArray[0];

    } else {

      if ( this.sortOptionsArray.length == 0 ) {
        this.addSortOption(this.sortOption_itemName);
      }

      result_itemObjArray.sort( this.runSearch_sortingFunction() ) ;

      return result_itemObjArray;

    }
  }

  this.runSearch_sortingFunction = () => {
    return (objA, objB) => {
      for (var i = 0; i < this.sortOptionsArray.length; i++) {

        let comparisonCode;

        switch (this.sortOptionsArray[i]) {

          case this.sortOption_itemName:
            comparisonCode = sorting_returnComparisonCode(objA.itemName, objB.itemName);
            break;

          case this.sortOption_itemId:
            comparisonCode = sorting_returnComparisonCode(objA.itemId, objB.itemId);
            break;

        }

        if (comparisonCode == -1 || comparisonCode == 1) {
          return comparisonCode;
        } else {
          // comparisonCode == 0 (neither A nor B comes first) --> so therefore no action is needed here; we will allow the loop counter to continue onto the next sorting option in the i-loop
        }
      }

      // none of the array of sorting options resulted in a 1 or -1 comparisonCode, so we return 0 here
      return 0;
    };
  };

  this.set_targetAssignedToWibtypeWithItemId = function(targetAssignedToWibtypeWithItemId) {
    this.target_assignedToWibtypeWithItemId = targetAssignedToWibtypeWithItemId;
  };

  this.set_targetItemName = function(targetItemName) {
    this.target_itemName = targetItemName;
  };

  this.set_targetJoinedListWithItemId = function(targetJoinedListWithItemId) {
    this.target_joinedListWithItemId = targetJoinedListWithItemId;
  };

  this.set_returnFirstOnly_false = function() {
    this.returnFirstOnly = false;
  };

  this.set_returnFirstOnly_true = function() {
    this.returnFirstOnly = true;
  };

  this.set_targetCombo_wtifItemId_and_wtifData = function(targetWtif_itemId, targetWtif_theData, targetWtif_searchForBlankTheData) {
    if (this.wtifDataSearchHasBeenSet) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemId_and_wtifData()", "wtifDataSearchHasBeenSet is already *true* (received targetWtif_itemId=" + targetWtif_itemId + ", targetWtif_theData=" + targetWtif_theData)
      return;
    }

    if ( isBlank(targetWtif_itemId) ) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemId_and_wtifData()", "received blank value for required parameter targetWtif_itemId")
      return;
    }

    if (targetWtif_searchForBlankTheData && !isBlank(targetWtif_theData)) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemId_and_wtifData()", "received targetWtif_searchForBlankTheData=true, but received non-blank value for targetWtif_theData (targetWtif_theData=" + targetWtif_theData)
      return;
    }

    this.target_wtif_itemId = targetWtif_itemId;

    if (targetWtif_searchForBlankTheData && isBlank(targetWtif_theData)) {
      this.target_wtif_theData = null;
      this.target_wtif_searchForBlankTheData = true;
    } else {
      this.target_wtif_theData = targetWtif_theData;
      this.target_wtif_searchForBlankTheData = false;
    }

    this.wtifDataSearchHasBeenSet = true;
  };

  this.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData = function(targetWtif_itemName, targetWtif_isFrom_wibTypeItemId, targetWtif_theData, targetWtif_searchForBlankTheData) {
    if (this.wtifDataSearchHasBeenSet) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData()", "wtifDataSearchHasBeenSet is already *true* (received targetWtif_itemName=" + targetWtif_itemName + "targetWtif_isFrom_wibTypeItemId=" + targetWtif_isFrom_wibTypeItemId + ", targetWtif_theData=" + targetWtif_theData)
      return;
    }

    if ( isBlank(targetWtif_itemName) ) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData()", "received blank value for required parameter targetWtif_itemName")
      return;
    }

    if ( isBlank(targetWtif_isFrom_wibTypeItemId) ) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData()", "received blank value for required parameter targetWtif_isFrom_wibTypeItemId")
      return;
    }

    if (targetWtif_searchForBlankTheData && !isBlank(targetWtif_theData)) {
      this.errorDuringSettingParams = true;
      showSoftError("ItemGrabbingObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData()", "received targetWtif_searchForBlankTheData=true, but received non-blank value for targetWtif_theData (targetWtif_theData=" + targetWtif_theData)
      return;
    }

    this.target_wtif_itemName = targetWtif_itemName;
    this.target_wtif_isFrom_wibtypeItemId = targetWtif_isFrom_wibTypeItemId;

    if (targetWtif_searchForBlankTheData && isBlank(targetWtif_theData)) {
      this.target_wtif_theData = null;
      this.target_wtif_searchForBlankTheData = true;
    } else {
      this.target_wtif_theData = targetWtif_theData;
      this.target_wtif_searchForBlankTheData = false;
    }

    this.wtifDataSearchHasBeenSet = true;
  };
}

function itemNameIsAllowed(itemName) {
  var disallowedName = false;

  if ( isEqual(itemName, CONST_listName_homePage) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_listName_wibtypes) ) {
    //TO-DO2: handle this one differently -- okay for non-wibtypes?
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_timeTracking_itemName ) ) {
    //TO-DO2: handle this one differently -- okay for non-wibtypes?
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_listOfWibtypeInstanceHolderLists_itemName ) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_wibtypeInstanceHolderWibtype_itemName ) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_screenList_itemName ) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_screenWibtype_itemName ) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_appWibtype_itemName ) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_wb_appList_itemName ) ) {
    disallowedName = true;
  }

  if (disallowedName) {
    alert("Item Name '" + itemName + "' is not allowed, as it is reserved by the app");
    return false;
  }

  return true;
}

function itemObjFactory() {
  var itemObj = {};

  itemObj.itemId = null;
  itemObj.itemName = "";
  itemObj.doneStatusCode = CONST_doneStatusCode_undone;
  itemObj.displayCode = CONST_displayCode_normal;
  itemObj.isList = "0";
  itemObj.notes = "";
  itemObj.joinedLists_itemIds = [];
  itemObj.isWibtype = "0";
  itemObj.isWibtypeInfoField = "0";
  itemObj.assignedWibtypes_itemIds = [];
  itemObj.wtifDataObjs = [];
  itemObj.connectedItemDataObjs = [];
  itemObj.wibtypeForListMembersDataObjs = [];

  itemObj.addItemToListMembers = function(itemIdToAdd) {
    var listMemberDataObjs, curMaxSortPosition, sortPositionToUse, newListMemberDataObj;

    //grab current list-members for this list 
    listMemberDataObjs = this.getListMemberDataObjs();

    //set the new sortPosition value
    if (listMemberDataObjs.length == 0) {
      curMaxSortPosition = -1;
    } else {
      curMaxSortPosition = listMemberDataObjs[listMemberDataObjs.length - 1].sortPosition;
    }
    sortPositionToUse = parseInt(curMaxSortPosition) + 1

    //create a new list-member-data-object, and add it to the current array
    newListMemberDataObj = createListMemberDataObj(itemIdToAdd, sortPositionToUse);
    listMemberDataObjs.push(newListMemberDataObj);
    
    //save the revised list-members-array to datastore
    this.saveListMembersToDatastore(listMemberDataObjs);
  };

  itemObj.addWibtypeForListMembers = function(wibtypeItemId_toAdd) {
    // add this wibtype to the array of wibtypes-for-list-members for this item (if not already present)
    if ( ! this.hasWibtypeForListMembers(wibtypeItemId_toAdd) ) {
      let x = createWibtypeForListMembersDataObj(wibtypeItemId_toAdd);
      this.wibtypeForListMembersDataObjs.push(x);
    }

    // assign the wibtype to all existing list-members
    var listMemberItemObjs = this.getListMemberItemObjs();
    listMemberItemObjs.forEach( (listMemberItemObj) => {
      listMemberItemObj.assignToWibtype(wibtypeItemId_toAdd);
    } );

    //save this item's wibtypes-for-list-members to the datastore
    this.saveWibtypesForListMembersToDatastore();
  };

  itemObj.assignToWibtype = function(wibtypeItemIdToAssign) {
    //confirm that this item is not already assigned to the wibtype
    if ( this.isAssignedToType(wibtypeItemIdToAssign) ) {
      return;
    }
    
    //add the new wibtype's itemId to this list's array of wibtype-assignments
    this.assignedWibtypes_itemIds.push(wibtypeItemIdToAssign);

    //save this item's wibtype-assignments to datastore
    this.saveWibtypeAssignmentsToDatastore();

    //TO-DO2: something about grabbing info-field-data-objects?
  };

  itemObj.changeItemInfo = function(itemName, doneStatusCode, displayCode, isList, notes) {
    if ( !itemNameIsAllowed(itemName) ) {
      return false;
    }

    // process itemName and notes strings here, in case they were not processed by the calling function
    itemName = getProcessedStringForSave(itemName);
    notes = getProcessedStringForSave(notes);

    if ( !isBlank(itemName) ) this.itemName = itemName;
    if ( !isBlank(doneStatusCode) ) this.doneStatusCode = doneStatusCode;
    if ( !isBlank(displayCode) ) this.displayCode = displayCode;
    if ( !isBlank(isList) ) this.isList = isList;
    if ( notes !== null ) this.notes = notes;
    this.saveItemInfoToDatastore();
    return true;
  };

  itemObj.doDeletion = function(setWappItemToFirstJoinedList, overrideWtifDeletionCheck) {
    var firstListItemId = null, saveKeyText_listMembers_ofItem, i, curAllItemIds_string, curAllItemIds_array, newAllItemIds_string = "";

    // check if this is a list with list-members
    if (this.isList == "1") {
      if ( this.hasListMembers() ) {
        alert("Can't delete something that has list members");
        return false;
      }
    }

    // don't allow deletion if this is a wtif whose wibtype is assigned to any items
    if (this.isWibtypeInfoField == "1" && ! overrideWtifDeletionCheck) {

      for (i = 0; i < this.joinedLists_itemIds.length; i++) {
        let curItemObjFor_iLoop = grabItemObj( this.joinedLists_itemIds[0] )

        if (curItemObjFor_iLoop.isWibtype == "1") {
          
          let allItemIds = getAllItemsArray();

          for (let j = 0; j < allItemIds.length; j++) {
            let curItemObjFor_jLoop = grabItemObj( allItemIds[j] );
            if ( curItemObjFor_jLoop.isAssignedToType(curItemObjFor_iLoop.itemId) ) {
              alert("Can't delete a type-info-field that is assigned to other items");
              return false;
            }
          }

          break;  // only check the first wibtype we find -- wtifs can't currently belong to more than one wibtype
        }

      }

    }

    // don't allow deletion if this is a wibtype that is assigned to any items
    if (this.isWibtype == "1") {
      let allItemIds = getAllItemsArray();

      for (let i = 0; i < allItemIds.length; i++) {
        let curItemObjFor_iLoop = grabItemObj( allItemIds[i] );
        if ( curItemObjFor_iLoop.isAssignedToType(this.itemId) ) {
          alert("Can't delete a type that is assigned to other items");
          return false;
        }
      }
    }

    // delete assigned-wibtypes and wtif-data for this item
    this.assignedWibtypes_itemIds.forEach( (assignedWibtypes_itemId) => {
      deleteFromDatastore(getSaveKeyText_wibtypeAssignments_toItem(this.itemId));

      let assignedWibtypes_itemObj = grabItemObj(assignedWibtypes_itemId);
      let wtifItemIds = assignedWibtypes_itemObj.getListMemberItemIds()

      wtifItemIds.forEach( (wtifItemId) => {
        deleteFromDatastore(getSaveKeyText_wtifData(this.itemId, wtifItemId));
      } );
    } );

    // remove from joined-lists
    for (i = 0; i < this.joinedLists_itemIds.length; i++) {
      let joinedList_itemId = this.joinedLists_itemIds[i];
      let joinedList_itemObj = grabItemObj(joinedList_itemId);
      if ( firstListItemId == null ) firstListItemId = joinedList_itemId
      joinedList_itemObj.removeListMember(this.itemId);
    }

    // delete joined-list-info for this item
    deleteFromDatastore( getSaveKeyText_joinedLists_ofItem(this.itemId) );

    // delete list-members entry for this item
    deleteFromDatastore( getSaveKeyText_listMembers_ofItem(this.itemId) );

    // delete wibtype-info-field-info entry for this item
    deleteFromDatastore( getSaveKeyText_wibtypeInfoFieldInfo_ofItem(this.itemId) );

    // remove from all-items array
    curAllItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
    curAllItemIds_array = getIdArray(curAllItemIds_string);
    for (i = 0; i < curAllItemIds_array.length; i++) {
      if ( !isEqual(curAllItemIds_array[i], this.itemId) ) {
        if ( !isBlank(newAllItemIds_string) ) newAllItemIds_string += sD;
        newAllItemIds_string += curAllItemIds_array[i];
      }
    }
    saveToDatastore(CONST_stringOfAllItemIds, newAllItemIds_string);

    // delete item-info from datastore
    deleteFromDatastore(getSaveKeyText_item(this.itemId));

    // clear app-level current-item-id
    setWappItemObj(null);

    // if requested by the calling function, set the wapp-item-obj to the item-id of the first joined-list for the deleted item, so that we move to that list in the UI
    if (setWappItemToFirstJoinedList && !isBlank(firstListItemId) ) {
      setWappItemObj(grabItemObj(firstListItemId));
    }

    return true;
  };

  itemObj.changeDoneStatus = function(newDoneStatusCode) {
    this.changeItemInfo(null, newDoneStatusCode, null, null, null);
  }

  itemObj.connectToItem = function(itemId2, saveToDatastore) {
    var i, thisItemAlreadyHasConnection = false, item2AlreadyHasConnection = false;

    // check for existing connection data for this item
    for (i = 0; i < this.connectedItemDataObjs.length; i++) {
      if ( isEqual(itemId2, this.connectedItemDataObjs[i].itemId2) ) {
        thisItemAlreadyHasConnection = true;
        break;
      }
    }

    if (!thisItemAlreadyHasConnection) {
      let x = createConnectedItemDataObj(itemId2);
      itemObj.connectedItemDataObjs.push(x);
    }

    var item2Obj = grabItemObj(itemId2);

    // check for existing connection data for item2
    for (i = 0; i < item2Obj.connectedItemDataObjs.length; i++) {
      if ( isEqual(this.itemId, item2Obj.connectedItemDataObjs[i].itemId2) ) {
        item2AlreadyHasConnection = true;
        break;
      }
    }

    if (!item2AlreadyHasConnection) {
      let x = createConnectedItemDataObj(this.itemId);
      item2Obj.connectedItemDataObjs.push(x);
    }

    if (saveToDatastore) {
      if (!thisItemAlreadyHasConnection) {
        this.saveConnectedItemsToDatastore();
      }

      if (!item2AlreadyHasConnection) {
        item2Obj.saveConnectedItemsToDatastore();
      }
    }

    return true;
  };

  itemObj.copyToList = function(listToCopyTo_itemId) {
    // TO-DO2: need to handle attempt to copy-to-list that this item is already a member of

    // double-check that this is not a wib or witf -- shouldn't be allowed to be copied through UI, but double-checking here due to importance of the wibtype system
    // TO-DO2: implement this in additional places
    if (this.isWibtype == "1" || this.isWibtypeInfoField == "1") {
      //TO-DO2: showSoftError(funcName, errorText);
      console.log("ERROR: function itemObjFactory -> itemObj.copyToList, disallowed operation on a type entry or on a type info-field (this.isWibtype=" + this.isWibtype + ", this.isWibtypeInfoField=" + this.isWibtypeInfoField);
      alert("ERROR: function itemObjFactory -> itemObj.copyToList, disallowed operation on a type entry or on a type info-field (this.isWibtype=" + this.isWibtype + ", this.isWibtypeInfoField=" + this.isWibtypeInfoField);
      return;
    }
  
    makeNewItem(this.doneStatusCode, null, null, "0", "0", false, this.itemName, null, this.displayCode, this.isList, listToCopyTo_itemId)
  };

  itemObj.getListMemberDataObjs = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string, listMembers_array, i, curListMemberDataObj, listMemberDataObjs = [];

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);
    listMembers_array = getIdArray(listMembers_string);

    for (i = 0; i < listMembers_array.length; i = i + 2) {
      curListMemberDataObj = createListMemberDataObj(listMembers_array[i], listMembers_array[i + 1]);
      listMemberDataObjs.push(curListMemberDataObj);
    }

    //for now, we will sort the array by sortPosition every time; in the future, this could be provided as a separate function
    listMemberDataObjs.sort( sortingObjects_numeric(CONST_propName_sortPosition) );

    return listMemberDataObjs;
  };

  itemObj.getListMemberItemIds = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string, listMembers_array, i, listMemberItemIds = [];

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);
    listMembers_array = getIdArray(listMembers_string);

    for (i = 0; i < listMembers_array.length; i = i + 2) {
      listMemberItemIds.push(listMembers_array[i]);
    }

    return listMemberItemIds;
  };

  itemObj.getListMemberItemObjs = function() {
    var itemIdArray = this.getListMemberItemIds();
    var itemObjArray = getItemIdArrayAsObjArray(itemIdArray);
    return itemObjArray;
  }

  itemObj.getMainListName = function() {
    if ( this.joinedLists_itemIds.length == 0 ) {
      return "";
    } else {
      let mainListItemObj = grabItemObj(this.joinedLists_itemIds[0]);
      return mainListItemObj.itemName;
    }
  };

  itemObj.getWtifData = function(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet) {
    var wtifDataObj = this.getWtifDataObj(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet);
    if (wtifDataObj) {
      return wtifDataObj.theData;
    }
    return null;
  };

  itemObj.getWtifDataObj = function(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet) {
    var devItemIdToCheck = null;

    if (parseInt(this.itemId) == devItemIdToCheck) {
      console.log("itemObjFactory/itemObj.getWtifDataObj(), this.itemId=" + this.itemId + ", this.wtifDataObjs.length=" + this.wtifDataObjs.length);
      console.log("itemObjFactory/itemObj.getWtifDataObj(), trying to match: wibtypeItemId_toGet=" + wibtypeItemId_toGet + ", wtifItemId_toGet=" + wtifItemId_toGet + ", wtifItemId_toGet, wtifItemName_toGet=" + wtifItemName_toGet);
    }

    for (var i = 0; i < this.wtifDataObjs.length; i++ ) {

      let wtifDataObj_forThisLoop = this.wtifDataObjs[i];

      if ( isEqual(wtifDataObj_forThisLoop.wibtypeItemId, wibtypeItemId_toGet) ) {

        if (parseInt(this.itemId) == devItemIdToCheck) console.log("itemObjFactory/itemObj.getWtifDataObj(), matched the wibtype")

        if ( isEqual(wtifDataObj_forThisLoop.wtifItemId, wtifItemId_toGet) ) {

          if (parseInt(this.itemId) == devItemIdToCheck) console.log("itemObjFactory/itemObj.getWtifDataObj(), leaving function: matched on wtif-itemId")
          return wtifDataObj_forThisLoop;

        } else if ( !isBlank(wtifItemName_toGet) ) {

          let wtifItemObj_forThisLoop = grabItemObj(wtifDataObj_forThisLoop.wtifItemId);
          if ( isEqual(wtifItemObj_forThisLoop.itemName, wtifItemName_toGet) ) {
            if (parseInt(this.itemId) == devItemIdToCheck) console.log("itemObjFactory/itemObj.getWtifDataObj(), leaving function: matched on wtif-itemName")
            return wtifDataObj_forThisLoop;
          }

        }

      }

    }

    if (parseInt(this.itemId) == devItemIdToCheck) {
      console.log("itemObjFactory/itemObj.getWtifDataObj(), leaving function: did not find wtif for:\nitemId=" + this.itemId + "\nitemName=" + this.itemName + "\nwibtypeItemId_toGet=" + wibtypeItemId_toGet + "\nwtifItemId_toGet=" + wtifItemId_toGet + "\nwtifItemName_toGet=" + wtifItemName_toGet);
    }
    return null;
  };

  itemObj.hasListMembers = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string;

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);

    if ( isBlank(listMembers_string) ) return false;

    if (listMembers_string.length > 0) {
      return true;
    } else {
      return false;
    }
  };

  itemObj.hasListMember = function(listMemberItemId_toCheckFor) {
    var listMemberItemIds = this.getListMemberItemIds();
    return doesValArrayHaveElem(listMemberItemIds, listMemberItemId_toCheckFor);
  };

  itemObj.hasWibtypeForListMembers = function(wibtypeItemId_toCheckFor) {
    return doesObjArrayHaveElem(this.wibtypeForListMembersDataObjs, CONST_propName_wibtypeItemId, wibtypeItemId_toCheckFor);
  };

  itemObj.hasWtifValue = function(wibtypeItemId_toMatch, wtifItemId_toMatch, wtifItemName_toMatch, wtifData_toMatch) {
    var wtifData_grabbed = this.getWtifData(wibtypeItemId_toMatch, wtifItemId_toMatch, wtifItemName_toMatch);

    if (wtifData_grabbed == null) {
      return false;
    }

    if ( isEqual(wtifData_grabbed, wtifData_toMatch) ) {
      return true;
    } else {
      return false;
    }
  };

  itemObj.isAssignedToType = function(wibtypeItemId) {
    if ( doesValArrayHaveElem(this.assignedWibtypes_itemIds, wibtypeItemId) ) {
      return true;
    } else {
      return false;
    }
  };

  itemObj.joinList = function(listToJoin_itemId) {
    //TO-DO2: need to handle attempt to join list that this item is already a member of
    var listToJoin_itemObj;

    //grab item-object for the list-to-join
    listToJoin_itemObj = grabItemObj(listToJoin_itemId);

    //call function on list-to-join's item-object, in order to be added to the list-members for that list-to-join 
    listToJoin_itemObj.addItemToListMembers(this.itemId);

    //add the list-to-join's itemId to this list's array of joined-lists
    this.joinedLists_itemIds.push(listToJoin_itemId);

    //save joined-lists to datastore
    this.saveJoinedListsToDatastore();
  };

  itemObj.leaveList = function(listToLeave_itemId) {
    var listToLeave_itemObj;

    //remove the list-to-leave's itemId from this list's array of joined-lists
    this.joinedLists_itemIds = getValArrayWithoutElem(this.joinedLists_itemIds, listToLeave_itemId);

    //save joined-lists to datastore
    this.saveJoinedListsToDatastore();

    //grab item-object for the list-to-join
    listToLeave_itemObj = grabItemObj(listToLeave_itemId);

    //call function on list-to-leave's item-object, in order to be removed from its list-members
    listToLeave_itemObj.removeListMember(this.itemId);
  };

  itemObj.makeIntoAList = function() {
    var saveKeyText_itemListMembers_ofItem, check_listMemberDataObjs_string;

    if (this.isList == "1") {
      // no action needed
    } else {
      this.isList = "1";
      this.saveItemInfoToDatastore();
    }

    saveKeyText_itemListMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);

    // check any list members are already saved for this item 
    check_listMemberDataObjs_string = getFromDatastore(saveKeyText_itemListMembers_ofItem);

    if ( isBlank(check_listMemberDataObjs_string) ) {
      // if the existing list-member save text DID return blank, okay to set to empty-string
      saveToDatastore(saveKeyText_itemListMembers_ofItem, "");
    } else {
      // if the existing list-member save text DID NOT return blank, leave as is
      //  (there was a previous error where this item was turned into not-a-list, but retained list members)
      // => no action
    }
  };

  itemObj.markAllListMembers = function(markDirectionIsDone, listMemberDataObjs) {
    var i;

    for (i = 0; i < listMemberDataObjs.length; i++) {
      let curItemObj = grabItemObj(listMemberDataObjs[i].itemId);
      
      if (markDirectionIsDone) {
        if (curItemObj.doneStatusCode == CONST_doneStatusCode_undone) {
          curItemObj.changeItemInfo(null, CONST_doneStatusCode_done, null, null, null);
        }
      } else {
        if (curItemObj.doneStatusCode == CONST_doneStatusCode_done) {
          curItemObj.changeItemInfo(null, CONST_doneStatusCode_undone, null, null, null);
        }
      }
    }
  };

  itemObj.removeListMember = function(listMemberItemId_toRemove) {
    var oldListMemberDataObjs, newListMemberDataObjs;

    oldListMemberDataObjs = this.getListMemberDataObjs();
    newListMemberDataObjs = getObjArrayWithoutElem(oldListMemberDataObjs, CONST_propName_itemId, listMemberItemId_toRemove)

    this.saveListMembersToDatastore(newListMemberDataObjs);
  };

  itemObj.removeWibtype = function(wibtypeItemId_toRemove) {
    // create replacement array for wtif-data-objects that don't match the wibtypeItemId_toRemove function parameter
    var newWtifDataObjs = [];

    // cycle through all wtif-data-objects:
    //
    //   - if the wibtype  DOES      match wibtypeItemId_toRemove  -->  delete from datastore
    //
    //   - if the wibtype  DOES NOT  match wibtypeItemId_toRemove  -->  save the wtif-data-object to the replacement array
    //
    this.wtifDataObjs.forEach( (wtifDataObj) => {
      if ( isEqual(wibtypeItemId_toRemove, wtifDataObj.wibtypeItemId) ) {
        wtifDataObj.deleteFromDatastore(this.itemId);
      } else {
        newWtifDataObjs.push(wtifDataObj);
      }
    } );

    // set the item's live wtif-data-objects array to the replacement array
    this.wtifDataObjs = newWtifDataObjs;

    // remove the wibtypeItemId_toRemove
    this.assignedWibtypes_itemIds = getValArrayWithoutElem(this.assignedWibtypes_itemIds, wibtypeItemId_toRemove);

    // save the revised wibtype-itemId-array to the datastore
    this.saveWibtypeAssignmentsToDatastore();
  };

  itemObj.saveConnectedItemsToDatastore = function() {
    var saveKeyText_connectedItems_ofItem = getSaveKeyText_connectedItems_ofItem(this.itemId);
    var connectedItems_string = "";

    this.connectedItemDataObjs.forEach( (x) => {
      if (connectedItems_string !== "") connectedItems_string += sD;
      connectedItems_string += x.itemId2;
    } );

    saveToDatastore(saveKeyText_connectedItems_ofItem, connectedItems_string);
  };

  itemObj.saveItemInfoToDatastore = function() {
    var itemInfoString = createItemInfoString(this.itemName, this.doneStatusCode, this.displayCode, this.isList, this.notes, this.isWibtype, this.isWibtypeInfoField)
    saveToDatastore(getSaveKeyText_item(this.itemId), itemInfoString);
  };

  itemObj.saveJoinedListsToDatastore = function() {
    var joinedLists_itemIds_string = getIdString(this.joinedLists_itemIds);
    saveToDatastore(getSaveKeyText_joinedLists_ofItem(this.itemId), joinedLists_itemIds_string);
  };

  itemObj.saveListMembersToDatastore = function(listMemberDataObjs) {
    var saveKeyText_itemListMembers_ofItem, i, listMemberDataObjs_string = ""; 

    saveKeyText_itemListMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);

    for (i = 0; i < listMemberDataObjs.length; i++) {
      let curListMemberDataObj = listMemberDataObjs[i];
      if ( !isBlank(listMemberDataObjs_string) ) listMemberDataObjs_string += sD;
      listMemberDataObjs_string += curListMemberDataObj.itemId + sD + curListMemberDataObj.sortPosition;
    }

    saveToDatastore(saveKeyText_itemListMembers_ofItem, listMemberDataObjs_string);
  };

  itemObj.saveWibtypeAssignmentsToDatastore = function() {
    var assignedWibtypes_itemIds_string = getIdString(this.assignedWibtypes_itemIds);
    var saveKeyText = getSaveKeyText_wibtypeAssignments_toItem(this.itemId);

    // if the string is empty, we can delete the wibtype-assignments key from the datastore
    if ( isBlank(assignedWibtypes_itemIds_string) ) {
      deleteFromDatastore(saveKeyText);
    } else {
      saveToDatastore(saveKeyText, assignedWibtypes_itemIds_string);
    }
  };

  itemObj.saveWibtypeInfoFieldInfoToDatastore = function() {
    var wibtypeInfoFieldInfoString = createWibtypeInfoFieldInfoString(this.wibDataTypeId, this.required);
    saveToDatastore(getSaveKeyText_wibtypeInfoFieldInfo_ofItem(this.itemId), wibtypeInfoFieldInfoString);
  };

  itemObj.saveWibtypesForListMembersToDatastore = function() {
    var saveKeyText = getSaveKeyText_wibtypesForListMembers_ofItem(this.itemId);
    var theString = "";

    this.wibtypeForListMembersDataObjs.forEach( (x) => {
      if (theString !== "") theString += sD;
      theString += x.wibtypeItemId;
    } );

    saveToDatastore(saveKeyText, theString);
  };

  itemObj.setWtifData = function(wibtypeItemId, wtifItemId, wtifItemName, theData, saveToDatastore) {
    if ( isBlank(wibtypeItemId) ){

      // if we have a wtifItemId, can try to grab the wibtype from that
      
      if ( isBlank(wtifItemId) ) {
        showSoftError("itemObjFactory -> itemObj.setWtifData()", "could not save theData='" + theData + "' for wtifItemName='" + wtifItemName + "', as wibtypeItemId and wtifItemId received are both blank");
        return false;
      }

      let wtifItemObj = grabItemObj(wtifItemId);

      if (!wtifItemObj) {
        showSoftError("itemObjFactory -> itemObj.setWtifData()", "could not save theData='" + theData + "' for wtifItemName='" + wtifItemName + "', as wtifItemId=" + wtifItemId + " did not resolve to a valid item in the datastore (and received blank wibtypeItemId)");
        return false;
      }
      
      if (wtifItemObj.joinedLists_itemIds.length == 0) {

        showSoftError("itemObjFactory -> itemObj.setWtifData()", "could not save theData='" + theData + "' for wtifItemName='" + wtifItemName + "', as wtifItemObj.itemName='" + wtifItemObj.itemName + "' (wtifItemId=" + wtifItemId + ") was not marked in the datastore as being joined to any lists, which is needed to find the wibtype (received blank wibtypeItemId)");
        return false;


      } else if (wtifItemObj.joinedLists_itemIds.length >= 1) {

        for (let i = 0; i < wtifItemObj.joinedLists_itemIds.length; i++) {
          var x = grabItemObj(wtifItemObj.joinedLists_itemIds[i]);
          if (x.isWibType == "1") {
            wibtypeItemId = x.itemId;
            break;
          }
        }
 
        showSoftError("itemObjFactory -> itemObj.setWtifData()", "could not save theData='" + theData + "' for wtifItemName='" + wtifItemName + "' -- received valid wtif '" + wtifItemObj.itemName + "' (wtifItemId=" + wtifItemId + ") but none of the datastore lists joined by the wtif are marked as a wibtype-list");
        return false;

      }

    }

    if ( isBlank(wtifItemId) && isBlank(wtifItemName) ) {
      showSoftError("itemObjFactory -> itemObj.setWtifData()", "could not save theData='" + theData + "' for wtifItemId='" + wtifItemId + "', as wibtypeItemId and wtifItemName received are both blank");
      return false;
    }

    var wtifDataObj = this.getWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName);

    if ( wtifDataObj == null ) {

      wtifDataObj = createWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName, theData);
      this.wtifDataObjs.push(wtifDataObj);

    } else {

      wtifDataObj.theData = theData;

    }


    // if requested, save the wtifDataObject to the datastore
    if (saveToDatastore) {
      wtifDataObj.saveToDatastore(this.itemId);
    }

    return true;
  };

  itemObj.setWibtypeAndWtifs = function(wibtypeItemId, wtifItemName1, wtifData1, wtifItemName2, wtifData2, wtifItemName3, wtifData3, wtifItemName4, wtifData4, wtifItemName5, wtifData5) {
    this.assignToWibtype(wibtypeItemId);

    if ( !isBlank(wtifItemName1) ) {
      this.setWtifData(wibtypeItemId, null, wtifItemName1, wtifData1, true);
    }

    if ( !isBlank(wtifItemName2) ) {
      this.setWtifData(wibtypeItemId, null, wtifItemName2, wtifData2, true);
    }

    if ( !isBlank(wtifItemName3) ) {
      this.setWtifData(wibtypeItemId, null, wtifItemName3, wtifData3, true);
    }

    if ( !isBlank(wtifItemName4) ) {
      this.setWtifData(wibtypeItemId, null, wtifItemName4, wtifData4, true);
    }

    if ( !isBlank(wtifItemName5) ) {
      this.setWtifData(wibtypeItemId, null, wtifItemName5, wtifData5, true);
    }
  };

  itemObj.setWibtypeInfoFieldInfo = function(wibDataTypeId, required, saveToDatastore) {
    this.wibDataTypeId = wibDataTypeId;
    this.required = required;
    if (saveToDatastore) {
      this.saveWibtypeInfoFieldInfoToDatastore();
    }
  };

  return itemObj;
}

function js_handleChange(theElem) {
dc_("js_handleChange()")
  if ( ! wapp.wdt_internalChangeToUi ) {
    wapp.wdto.receiveUiChange(theElem);
  }
}

function js_handleClick(theElem) {
dc_("js_handleClick()")
  theElem.select();
}

function left(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theLeft = str.substr(0, numChars);
  return theLeft;
}

function leftIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackLeft = left(haystack, lenNeedle);

  return isEqual(haystackLeft, needle);
}

function returnFromMethod(obj, methodName) {
  var jsStatement = "obj." + methodName + "()";
  var returnValue = null;

  try {
    returnValue = eval(jsStatement);
  } catch(x){}

  return returnValue;
}

function right(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theRight = str.substr(str.length - numChars);
  return theRight;
}

function rightIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackRight = right(haystack, lenNeedle);

  return isEqual(haystackRight, needle);
}

function makeNewItem(doneStatusCode, wibDataTypeId, required, isWibtypeInfoField, isWibtype, overrideDisallowName, itemName, itemNamePrompt, displayCode, isList, addToList_itemId) {
  var newItemObj, allItemIds_string, allItemIds_array, i, itemId_toCheck, maxItemId;

  // if not passed, get item name
  if ( isBlank(itemName) ) {
    if ( isBlank(itemNamePrompt) ) itemNamePrompt = "new item:";
    itemName = prompt(itemNamePrompt, "");
    if ( isBlank(itemName) ) return false;
  }

  // process itemName up here, as it will be used in comparisons below
  itemName = getProcessedStringForSave(itemName);

  if (!overrideDisallowName) {
    // TO-DO2: prevent creation/renaming of duplicate wtif names
    if ( !itemNameIsAllowed(itemName) ) {
      return false;
    }
  }

  // create item-object
  newItemObj = itemObjFactory();

  // generate new itemId
  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
  maxItemId = -1;
  for (i = 0; i < allItemIds_array.length; i++) {
    itemId_toCheck = allItemIds_array[i];
    if (parseInt(itemId_toCheck) > parseInt(maxItemId)) maxItemId = parseInt(itemId_toCheck);
  }
  newItemObj.itemId = parseInt(maxItemId) + 1;

  // set new-item-object values from function arguments received
  if ( !isBlank(doneStatusCode) ) newItemObj.doneStatusCode = doneStatusCode;

  if (isWibtypeInfoField == "1") {
    newItemObj.isWibtypeInfoField = "1";
  } else {
    newItemObj.isWibtypeInfoField = "0";
  }

  if (isWibtype == "1") {
    newItemObj.isWibtype = "1";
  } else {
    newItemObj.isWibtype = "0";
  }

  newItemObj.itemName = itemName;

  if ( !isBlank(displayCode) ) newItemObj.displayCode = displayCode;
  if ( !isBlank(isList) ) newItemObj.isList = isList;
  newItemObj.notes = "";


  // save item-info to datastore
  newItemObj.saveItemInfoToDatastore();

  // if is-list, make into a list
  if (isList == "1") {
    newItemObj.makeIntoAList();
  }

  // add item to list-of-all-items
  if ( isBlank(allItemIds_string) ) {
    allItemIds_string = "";
  } else {
    allItemIds_string = allItemIds_string + sD;
  }
  allItemIds_string = allItemIds_string + newItemObj.itemId;
  saveToDatastore(CONST_stringOfAllItemIds, allItemIds_string);

  // if requested, add this item to a list
  if ( !isBlank(addToList_itemId) ) {
    newItemObj.joinList(addToList_itemId);
  }

  // if this is a wibtype-item-info-field, set the wibtype-item-info-field-info and save to datastore
  if (isWibtypeInfoField == "1") {
    newItemObj.setWibtypeInfoFieldInfo(wibDataTypeId, required, true);
  }

  return newItemObj;
}

function moveOrCopyGrabbedItems(selectedList_itemId, aO_action) {
  var singleItemGrab, sourceList_itemObj, targetList_itemObj;

  if ( !isBlank(wapp.grabbing_itemId1) && isBlank(wapp.grabbing_itemId2) ) {
    singleItemGrab = true;
    if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
      sourceList_itemObj = grabItemObjByName(CONST_listName_homePage);
    } else {
      sourceList_itemObj = grabItemObj(wapp.itemObj.displayedOnList_itemId);
    }
  } else {
    singleItemGrab = false;
    sourceList_itemObj = wapp.itemObj;
  }

  targetList_itemObj = grabItemObj(selectedList_itemId);

  if (aO_action.a == "move") {
    transferItems(sourceList_itemObj, targetList_itemObj, wapp.grabbing_itemIdArray);
  } else {
    copyItems(sourceList_itemObj, targetList_itemObj, wapp.grabbing_itemIdArray);
  }

  toggleGrabbing_off();

  if (singleItemGrab) {
    //reset the display-item-object -- still is correct itemId-property in wapp.itemObj, but list-membership change means we need to reset the wapp.itemObj by re-passing in its item-id
    goToItemView(wapp.itemObj.itemId, false);
  } else {
    //display the item-object for the list where the grabbed-items where moved or copied to
    goToItemView(selectedList_itemId, false);
  }
}

function reorderActivatedItemAboveOtherItem(otherItemId) {
  var listItemObj = wapp.itemObj;
  var itemIdToMove = wapp.reordering_activatedItemId;
  var itemIdToMoveAbove = otherItemId;

  if ( walkSortPosition(listItemObj, itemIdToMove, null, false, false, itemIdToMoveAbove) ) {
    return true;
  } else {
    return false;
  }
}

function resetElemVal(elemId) {
  var theElem, elemType, elemVal;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      theElem.checked = false;
      break;

    default:
      theElem.value = "";
  }
}

function saveToDatastore(itemKey, itemValue) {
  if ( isBlank(itemValue) ) {
    itemValue = "";
  }

  localStorage.setItem(itemKey, itemValue);
}

function showSoftError(funcName, errorText) {
  var fullErrorMsg = "ERROR: function " + funcName + ", " + errorText;
  console.log(fullErrorMsg);
  // alert(fullErrorMsg);
}

function sortingObjects_defaultListTree() {
  return function(objA, objB) {
    var comparisonCode;


//TO-DO1.5:
    //  1st sort = list position on home-page-list
    //  2nd sort = list position on the parent list (parent list being the one that was on home-page-list)
    //  3rd sort = list position on the parent list from 2nd sort above
    //  4th sort = etc



// --> OR... should we write a function that handles this manually? due to walk-through-all-lists process?
    

    var objA_isOnHomepageList = isMemberOfList(objA.itemId, wapp.homePageList_itemId);
    var objB_isOnHomepageList = isMemberOfList(objB.itemId, wapp.homePageList_itemId);

    var objA_homePageList
    if (objA_isOnHomepageList)






    var aIsBlank = isBlank(objA[propNameToSortBy]);
    var bIsBlank = isBlank(objB[propNameToSortBy]);

    if ( aIsBlank && bIsBlank ) {
      comparisonCode = 0;
    } else if (aIsBlank && !bIsBlank) {
      comparisonCode = 1;
    } else if (!aIsBlank && bIsBlank) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) < parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) > parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };
}

function searchForItemObj_OLD(searchParam_wtif_searchForBlankTheData, searchParam_assignedToWibtypeItemId_noWtifConnection, searchParam_wtif_wibtypeItemId, searchParam_wtif_itemName, searchParam_wtif_itemId, searchParam_wtif_theData, searchParam_itemName, searchParam_onListItemId, returnFirstOnly) {
  //TO-DO2: searchForItemObj_OLD is deprecated -- other code that calls this, should eventually be migrated to using ItemGrabbingObj()

//dc_("--------------------")
/*
dc_("searchForItemObj_OLD(), searchParam_onListItemId="+searchParam_onListItemId)
dc_("searchForItemObj_OLD(), searchParam_wtif_itemName="+searchParam_wtif_itemName)
dc_("searchForItemObj_OLD(), searchParam_wtif_wibtypeItemId="+searchParam_wtif_wibtypeItemId)
dc_("searchForItemObj_OLD(), searchParam_wtif_searchForBlankTheData="+searchParam_wtif_searchForBlankTheData)
dc_("searchForItemObj_OLD(), searchParam_wtif_theData="+searchParam_wtif_theData)
*/

  var allItemIds_array, i, result_itemObjArray = [];
  
  allItemIds_array = getAllItemsArray();
  
  for (i = 0; i < allItemIds_array.length; i++) {

    let curItemObj = grabItemObj(allItemIds_array[i]);

    if ( !isBlank(searchParam_itemName) ) {
      if ( !isEqual(searchParam_itemName, curItemObj.itemName) ) {
        continue;
      }
    }

    if ( !isBlank(searchParam_onListItemId) ) {
//dc_("searchForItemObj_OLD(), inside loop, checking joined-lists, i="+i+", searchParam_onListItemId="+searchParam_onListItemId+", curItemObj.itemId="+curItemObj.itemId)
      if ( !doesValArrayHaveElem(curItemObj.joinedLists_itemIds, searchParam_onListItemId) ) {
        continue;
      }
//dc_("searchForItemObj_OLD(), inside loop, joined-list found, i="+i+", searchParam_onListItemId="+searchParam_onListItemId+", curItemObj.itemId="+curItemObj.itemId)
    }

    if ( !isBlank(searchParam_assignedToWibtypeItemId_noWtifConnection) ) {
      if ( !doesValArrayHaveElem(curItemObj.assignedWibtypes_itemIds, searchParam_assignedToWibtypeItemId_noWtifConnection) ) {
        continue;
      }
    }

    if ( !isBlank(searchParam_wtif_itemId) || !isBlank(searchParam_wtif_itemName) ) {
      let wtifIdOrName_found = false;
      let wtifTheData_matchSuccessful = false;

      for (let j = 0; j < curItemObj.wtifDataObjs.length; j++) {
        let curWtifDataObj = curItemObj.wtifDataObjs[j];

        if ( !isBlank(searchParam_wtif_itemId) ) { 

          if ( isEqual(curWtifDataObj.wtifItemId, searchParam_wtif_itemId) ) {
            wtifIdOrName_found = true;
          }

        } else if ( !isBlank(searchParam_wtif_itemName) ) {
//dc_("searchForItemObj_OLD(), inside loop, checking itemName, i="+i+", curItemObj.itemId="+curItemObj.itemId)
          let wtifItemObj = grabItemObj(curWtifDataObj.wtifItemId);

          if ( isEqual(curWtifDataObj.wibtypeItemId, searchParam_wtif_wibtypeItemId) && isEqual(wtifItemObj.itemName, searchParam_wtif_itemName) ) {
            wtifIdOrName_found = true;
          }

        }

        if (wtifIdOrName_found) {
          if (searchParam_wtif_searchForBlankTheData && isBlank(curWtifDataObj.theData) ) {
            wtifTheData_matchSuccessful = true;
          } else if ( isEqual(curWtifDataObj.theData, searchParam_wtif_theData) ) {
            wtifTheData_matchSuccessful = true;
          }
          break;
        }

      }

      if (!wtifTheData_matchSuccessful) {
        continue;
      }
    }

    result_itemObjArray.push(curItemObj);

    if (returnFirstOnly) {
      break;
    }
  }

  if (result_itemObjArray.length == 0) {
    return null;
  } else if (returnFirstOnly) {
    return result_itemObjArray[0];
  } else {
    return result_itemObjArray;
  }
}

function setElemCursor_none(elem) {
  elem.style.cursor = "";
}

function setElemCursor_pointer(elem) {
  elem.style.cursor = "pointer";
}

function setElemMouseover(elem) {
  css_addClass(elem.id, CONST_cssClassName_blue)
  elem.style.textDecoration = "underline";
  elem.style.cursor = "pointer";
}

function setElemMouseout(elem) {
  css_removeClass(elem.id, CONST_cssClassName_blue)
  elem.style.textDecoration = "";
  elem.style.cursor = "";
}

function setElemsToToday(yyyyElemId, mmElemId, ddElemId) {
  //TO-DO2: switch to using the wdt_objects
  return;

  var wappDatetimeObj = getCurWappDatetimeObj();
  setElemVal(yyyyElemId, wappDatetimeObj.endYyyy);
  setElemVal(mmElemId, wappDatetimeObj.endMm);
  setElemVal(ddElemId, wappDatetimeObj.endDd);
}

function setElemVal(elemId, elemVal) {
  var theElem, elemType;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      if (elemVal == "1") {
        theElem.checked = true;
      } else {
        theElem.checked = false;
      }
      break;

    default:
      theElem.value = elemVal;
  }
}

function setWappItemObj(itemObj) {
  wapp.itemObj = itemObj;
  if ( wapp.itemObj ) {
    wapp.itemObj.displayedOnList_itemId = null;
  }
}

function showPopUp(popUpCode, popUpFocusElem) {
   wappObj_clearAll();

 // when switching directly from one pop-up to another, we were getting too-wide layout, so calling a blank displayPage in order to reset the UI first
  displayPage("");

  elem("dvPopUp_AddTimeTracking").style.display = "none";
  elem("dvPopUp_ChangeDoneStatus").style.display = "none";
  elem("dvPopUp_EditTimeTracking").style.display = "none";
  elem("dvPopUp_MakeNewItem").style.display = "none";
  elem("dvPopUp_MakeNewItemTT").style.display = "none";
  elem("dvPopUp_MakeNewWibtype").style.display = "none";
  elem("dvPopUp_MakeNewWibtypeInfoField").style.display = "none";
  elem("dvPopUp_WibBuilder_UseExistingWibtype").style.display = "none";

  elem("dvMainViewOverlay").style.display = "none";
  elem("dvPopUp").style.display = "inline-flex";
  elem("dvPopUp_" + popUpCode).style.display = "grid";

  switch (popUpCode) {

    case "AddTimeTracking": {
      elem("spnAddTimeTracking_itemName").innerHTML = wapp.itemObj.itemName;

      wappObj_set( "wdto", wdt_getWappDatetimeObj(wapp.itemObj, false) );
      wapp.wdto.setIncompleteEntryAllowed();

      wappObj_set( "wdtUiDataObj", wdt_uiDataObjFactory(popUpCode) );
      wapp.wdtUiDataObj.initUi__timeTrackingToggleExists_no();

      break;
    }

    case "ChangeDoneStatus": {
      elem("spnChangeDoneStatus_mainListName").innerHTML = wapp.itemObj.getMainListName();
      elem("spnChangeDoneStatus_itemName").innerHTML = wapp.itemObj.itemName;
      //elem("dvChangeDoneStatus_itemName").innerHTML = wapp.itemObj.itemName;
      elem("spnChangeDoneStatus_currentStatus").innerHTML = getDoneStatusDisplay(wapp.itemObj.doneStatusCode);

      elem("dvChangeDoneStatus_Done1").style.display = "";
      elem("dvChangeDoneStatus_Done2").style.display = "";
      elem("aChangeDoneStatus_Done").innerHTML = CONST_doneStatusDisplay_done;
      css_setElemToDoneStatusColor("aChangeDoneStatus_Done", CONST_doneStatusCode_done);

      elem("dvChangeDoneStatus_Undone1").style.display = "";
      elem("dvChangeDoneStatus_Undone2").style.display = "";
      elem("aChangeDoneStatus_Undone").innerHTML = CONST_doneStatusDisplay_undone;
      css_setElemToDoneStatusColor("aChangeDoneStatus_Undone", CONST_doneStatusCode_undone);

      elem("dvChangeDoneStatus_Okay1").style.display = "";
      elem("dvChangeDoneStatus_Okay2").style.display = "";
      elem("aChangeDoneStatus_Okay").innerHTML = CONST_doneStatusDisplay_okay;
      css_setElemToDoneStatusColor("aChangeDoneStatus_Okay", CONST_doneStatusCode_okay);

      elem("dvChangeDoneStatus_Info1").style.display = "";
      elem("dvChangeDoneStatus_Info2").style.display = "";
      elem("aChangeDoneStatus_Info").innerHTML = CONST_doneStatusDisplay_info;
      css_setElemToDoneStatusColor("aChangeDoneStatus_Info", CONST_doneStatusCode_info);

      elem("dvChangeDoneStatus_Notice1").style.display = "";
      elem("dvChangeDoneStatus_Notice2").style.display = "";
      elem("aChangeDoneStatus_Notice").innerHTML = CONST_doneStatusDisplay_notice;
      css_setElemToDoneStatusColor("aChangeDoneStatus_Notice", CONST_doneStatusCode_notice);

      if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_done) {
        elem("dvChangeDoneStatus_Done1").style.display = "none";
        elem("dvChangeDoneStatus_Done2").style.display = "none";
      } else if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_undone) {
        elem("dvChangeDoneStatus_Undone1").style.display = "none";
        elem("dvChangeDoneStatus_Undone2").style.display = "none";
      } else if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_okay) {
        elem("dvChangeDoneStatus_Okay1").style.display = "none";
        elem("dvChangeDoneStatus_Okay2").style.display = "none";
      } else if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_info) {
        elem("dvChangeDoneStatus_Info1").style.display = "none";
        elem("dvChangeDoneStatus_Info2").style.display = "none";
      } else if (wapp.itemObj.doneStatusCode == CONST_doneStatusCode_notice) {
        elem("dvChangeDoneStatus_Notice1").style.display = "none";
        elem("dvChangeDoneStatus_Notice2").style.display = "none";
      }

      break;
    }

    case "EditTimeTracking": {
      elem("spnEditTimeTracking_itemName").innerHTML = wapp.itemObj.itemName;

      wappObj_set( "wdto", wdt_getWappDatetimeObj(wapp.itemObj, true) );
      wapp.wdto.setIncompleteEntryAllowed();

      wappObj_set( "wdtUiDataObj", wdt_uiDataObjFactory(popUpCode) );
      wapp.wdtUiDataObj.initUi__timeTrackingToggleExists_no();

      break;
    }

    case "MakeNewItem": {
      resetElemVal("ipMakeNewItem_ItemName");

      setElemVal("ckMakeNewItem_TopOfList", wapp.makeNewItem_TopOfList);
      setElemVal("ckMakeNewItem_StayListView", wapp.makeNewItem_StayListView);
      setElemVal("ckMakeNewItem_AddMoreItems", wapp.makeNewItem_AddMoreItems);
      setElemVal("ckMakeNewItem_TimeTracking", wapp.makeNewItem_TimeTracking);

      wappObj_set( "wdto", wdt_getWappDatetimeObj(null, false) );

      wappObj_set( "wdtUiDataObj", wdt_uiDataObjFactory(popUpCode) );
      wapp.wdtUiDataObj.initUi__timeTrackingToggleExists_yes();

      doCheckboxClickAction("ckMakeNewItem_TimeTracking");

      break;
    }

    case "MakeNewItemTT": {
      resetElemVal("ipMakeNewItemTT_ItemName");

      wappObj_set( "wdto", wdt_getWappDatetimeObj(null, false) );
      wapp.wdto.setIncompleteEntryAllowed();

      wappObj_set( "wdtUiDataObj", wdt_uiDataObjFactory(popUpCode) );
      wapp.wdtUiDataObj.initUi__timeTrackingToggleExists_no();

      break;
    }

    case "MakeNewWibtype": {
      resetElemVal("ipMakeNewWibtype_WibtypeName");
      break;
    }

    case "MakeNewWibtypeInfoField": {
      elem("spnMakeNewWibtypeInfoField_WibtypeName").innerHTML = wapp.itemObj.itemName;

      let wibDataTypesArray = getWibDataTypesAsArray(true);
      let wibDataTypeSelectHtml = getHtml_selectElem("selMakeNewWibtypeInfoField_WibDataTypeId", true, wibDataTypesArray, null, "width: 10em", null, null, false);
  
      elem("spnMakeNewWibtypeInfoField_WibDataTypeId").innerHTML = wibDataTypeSelectHtml;
    
      resetElemVal("ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
      resetElemVal("selMakeNewWibtypeInfoField_WibDataTypeId");
      resetElemVal("ckMakeNewWibtypeInfoField_Required");
      break;
    }

    case "WibBuilder_UseExistingWibtype": {
      // no action needed
      break;
    }

    default: {
      showSoftError("showPopUp()", "popUpCode=" + popUpCode + " not found")
      return false;
    }
  }

  if ( !isBlank(popUpFocusElem) ) {
    elem(popUpFocusElem).focus();

    // also try to select() the element -- will throw an error if it is not a selectable (e.g. input) element, so need to handle & skip this error
    try {
      elem(popUpFocusElem).select();
    } catch(x) {}
  }
}

function sorting_objs(propNameToSortBy) {
  return function(objA, objB) {
    var comparisonCode;

    var objA_hasProp = doesObjHaveProp(objA, propNameToSortBy);
    var objB_hasProp = doesObjHaveProp(objB, propNameToSortBy);

    if ( objA_hasProp && objB_hasProp ) {
      comparisonCode = sorting_returnComparisonCode(objA[propNameToSortBy], objB[propNameToSortBy]);
    } else if ( objA_hasProp ) {
      comparisonCode = -1;
    } else if ( objB_hasProp ) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };

  /* test code for this function:

  var i, ay = [];

  var x1 = {};
  x1.thisObjName = "x1";
  // no setting x1.prop1
  ay.push(x1);

  var x2 = [];
  x2.thisObjName = "x2";
  x2.prop1 = "b";
  ay.push(x2);

  var x3 = [];
  x3.thisObjName = "x3";
  x3.prop1 = null;
  ay.push(x3);

  var x4 = [];
  x4.thisObjName = "x4";
  x4.prop1 = "";
  ay.push(x4);

  var x5 = [];
  x5.thisObjName = "x5";
  x5.prop1 = "c";
  ay.push(x5);

  var x6 = [];
  x6.thisObjName = "x6";
  x6.prop1 = "a";
  ay.push(x6);

  dc_("--------------------");

  for (i = 0; i < ay.length; i++) {
    dc_("PRE-sort: ay[" + i + "], .thisObjName=" + ay[i].thisObjName + ", .prop1=" + ay[i].prop1);
  }

  dc_("--------------------");

  ay.sort( sorting_objs("prop1") );

  for (i = 0; i < ay.length; i++) {
    dc_("POST-sort: ay[" + i + "], .thisObjName=" + ay[i].thisObjName + ", .prop1=" + ay[i].prop1);
  }

  */
}

function sorting_vals() {
  return function(valA, valB) {
    var comparisonCode = sorting_returnComparisonCode(valA, valB);
    return comparisonCode;
  };
}

function sorting_returnComparisonCode(valA, valB) {
  var comparisonCode;

  var aIsBlank = isBlank(valA);
  var bIsBlank = isBlank(valB);

  var aIsNumeric = isNumeric(valA);
  var bIsNumeric = isNumeric(valB);

  // return -1  -->  A comes before B
  // return  1  -->  B comes before A
  // return  0  -->  neither A nor B comes first

  if ( aIsBlank && bIsBlank ) {
    // both are blank, so neither comes first
    comparisonCode = 0;

  } else if (aIsBlank && !bIsBlank) {
    // A is blank, so B comes first
    comparisonCode = 1;

  } else if (!aIsBlank && bIsBlank) {
    // B is blank, so A comes first
    comparisonCode = -1;

  } else if (aIsNumeric && !bIsNumeric) {
    // A is a number, but B is not, so A comes first
    comparisonCode = -1;

  } else if (!aIsNumeric && bIsNumeric) {
    // B is a number, but A is not, so B comes first
    comparisonCode = 1;

  } else if (aIsNumeric && bIsNumeric) {

    // both are numbers...
    let valA_num = parseFloat(valA);
    let valB_num = parseFloat(valB);

    if (valA_num < valB_num) {
      // A < B numerically, so A comes first
      comparisonCode = -1;

    } else if (valA_num > valB_num) {
      // A > B numerically, so B comes first
      comparisonCode = 1;

    } else {
      // A == B numerically, so neither comes first
      comparisonCode = 0;

    }

  } else {

    // both are non-blank non-numbers, so compare as lowercase strings
    let valA_str = String(valA).toLowerCase();
    let valB_str = String(valB).toLowerCase();

    if (valA_str < valB_str) {
      // A < B by lowercase-string comparison, so A comes first
      comparisonCode = -1;

    } else if (valA_str > valB_str) {
      // A > B by lowercase-string comparison, so B comes first
      comparisonCode = 1;

    } else {
      // A == B by lowercase-string comparison, so neither comes first
      comparisonCode = 0;

    }

  }

  return comparisonCode;
}

function sortingObjects_alphabetic(propNameToSortBy) {
  //TO-DO2: deprecated function -- switch to sorting_objs()
  return function(objA, objB) {
    var comparisonCode;

    var aIsBlank = isBlank(objA[propNameToSortBy]);
    var bIsBlank = isBlank(objB[propNameToSortBy]);

    var aString, bString;
    if (!aIsBlank) aString = String(objA[propNameToSortBy]).toLowerCase();
    if (!bIsBlank) bString = String(objB[propNameToSortBy]).toLowerCase();

    if ( aIsBlank && bIsBlank ) {
      comparisonCode = 0;
    } else if (aIsBlank && !bIsBlank) {
      comparisonCode = 1;
    } else if (!aIsBlank && bIsBlank) {
      comparisonCode = -1;
    } else if (aString < bString) {
      comparisonCode = -1;
    } else if (aString > bString) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };
}

function sortingObjects_numeric(propNameToSortBy) {
  //TO-DO2: deprecated function -- switch to sorting_objs()
  return function(objA, objB) {
    var comparisonCode;
    var aIsBlank = isBlank(objA[propNameToSortBy]);
    var bIsBlank = isBlank(objB[propNameToSortBy]);

    if ( aIsBlank && bIsBlank ) {
      comparisonCode = 0;
    } else if (aIsBlank && !bIsBlank) {
      comparisonCode = 1;
    } else if (!aIsBlank && bIsBlank) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) < parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) > parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };
}

function swapSortPosition(itemId, moveUp, moveAmt) {
  var listItemObj, memberItemObj, list_memberDataObjs, i = null;
  
  listItemObj = wapp.itemObj;
  memberItemObj = grabItemObj(itemId);
  list_memberDataObjs = listItemObj.getListMemberDataObjs();

  for (i = 0; i < list_memberDataObjs.length; i++) {
    let requestedNewIndex, memberItemDataObj, memberItemDataObj_toSwapWith, member_oldSortPosition;

    if ( isEqual(list_memberDataObjs[i].itemId, memberItemObj.itemId) ) {
      memberItemDataObj = list_memberDataObjs[i];

      if (moveUp) {
        requestedNewIndex = i - parseInt(moveAmt);
        if (requestedNewIndex < 0) return false;
      } else {
        requestedNewIndex = i + parseInt(moveAmt);
        if (requestedNewIndex >= list_memberDataObjs.length) return false;
      }

      memberItemDataObj_toSwapWith = list_memberDataObjs[requestedNewIndex];

      member_oldSortPosition = memberItemDataObj.sortPosition;
      memberItemDataObj.sortPosition = memberItemDataObj_toSwapWith.sortPosition;
      memberItemDataObj_toSwapWith.sortPosition = member_oldSortPosition;
  
      listItemObj.saveListMembersToDatastore(list_memberDataObjs);

      return true;
    }
  }

  return false;
}

function transferItemInfo_stringToObject(itemInfoString, itemInfoObject) {
  // TO-DO2: starting using transferItemInfo_XtoY to move item-info between itemObjFactory and the datastore (e.g. createItemInfoString())
  var iit = getItemInfoTransfer();
  iit.receiveString(itemInfoString);
  iit.setObject(itemInfoObject);
}

function transferItemInfo_objectToString(itemInfoObject) {
  // TO-DO2: starting using transferItemInfo_XtoY to move item-info between itemObjFactory and the datastore (e.g. createItemInfoString())
  var iit = getItemInfoTransfer();
  iit.receiveObject(itemInfoObject);
  return iit.getString();
}

function toggleGrabbing_off(maintainFocus) {
  css_removeClass("aGrabItems1", CONST_cssClassName_red);
  css_removeClass("aGrabItems2", CONST_cssClassName_red);

  if ( !isBlank(wapp.grabbing_itemId1) ) {

    // the HTML element for wapp.grabbing_itemId1 may or may not exist, depending on which display-page this function is called from
    
    let grabbingElemId1 = getHtml_aItem(wapp.grabbing_itemId1);

    if ( !isBlank(elem(grabbingElemId1) ) ) {
      css_removeClass(grabbingElemId1, CONST_cssClassName_bold);
    }

  }

  wapp.grabbing_itemId1 = null;
  wapp.grabbing_itemId2 = null;
  wapp.grabbing_itemIdArray = [];
  wapp.grabbingOn = false;

  if (maintainFocus) {
  } else {
    focus_clear();
  }
}

function toggleGrabbing_on() {
  wapp.grabbing_itemId1 = null;
  wapp.grabbing_itemId2 = null;
  wapp.grabbing_itemIdArray = [];
  wapp.grabbingOn = true;

  css_addClass("aGrabItems1", CONST_cssClassName_red);
  css_addClass("aGrabItems2", CONST_cssClassName_red);

  focus_clear();
}

function toggleNavList(itemId) {
  var elemId_plusMinusTop = "dvNavListMembers_PlusTop_" + itemId;
  var elemId_plusMinusBottom = "dvNavListMembers_PlusBottom_" + itemId;
  var elem_list = elem("dvNavListMembers_" + itemId);

  if (elem_list.style.display == "none") {
    elem_list.style.display = "";
    css_removeClass(elemId_plusMinusTop, CONST_cssClassName_backgroundBlue);
    css_removeClass(elemId_plusMinusBottom, CONST_cssClassName_backgroundBlue);
  } else {
    elem_list.style.display = "none";
    css_addClass(elemId_plusMinusTop, CONST_cssClassName_backgroundBlue);
    css_addClass(elemId_plusMinusBottom, CONST_cssClassName_backgroundBlue);
  }
}

function toggleReordering_off(maintainFocus) {
  css_removeClass("aReorder1", CONST_cssClassName_red);
  css_removeClass("aReorder2", CONST_cssClassName_red);

  if ( !isBlank(wapp.reordering_activatedItemId) ) {
    deactivateItemForReordering(wapp.reordering_activatedItemId);
  }

  wapp.reorderingOn = false;
  wapp.reordering_mode = null;

  if (maintainFocus) {
  } else {
    focus_clear();
  }
}

function toggleReordering_on() {
  wapp.reorderingOn = true;
  wapp.reordering_mode = CONST_reordering_mode_normal;

  css_addClass("aReorder1", CONST_cssClassName_red);
  css_addClass("aReorder2", CONST_cssClassName_red);

  focus_clear();
}

function toggleReorderingMode_normal(itemId) {
  wapp.reordering_mode = CONST_reordering_mode_normal;
  elem(getHtml_reorderingModeIs_normal_tblOptions(itemId)).style.display = "";
  elem(getHtml_reorderingModeIs_moveAboveOtherItem_dvInstructions(itemId)).style.display = "none";
}

function toggleReorderingMode_moveAboveOtherItem(itemId) {
  wapp.reordering_mode = CONST_reordering_mode_moveAboveOtherItem;
  elem(getHtml_reorderingModeIs_normal_tblOptions(itemId)).style.display = "none";
  elem(getHtml_reorderingModeIs_moveAboveOtherItem_dvInstructions(itemId)).style.display = "";
}

function transferItems(sourceListObj, targetListObj, listMembers_itemIdArray) {
  listMembers_itemIdArray.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);

    curItemObj.joinList(targetListObj.itemId);
    curItemObj.leaveList(sourceListObj.itemId);
  } );
}

function walkSortPosition(listItemObj, itemIdToMove, moveAmt, moveToTop, moveToEnd, itemIdToMoveAbove) {

//dc_("walkSortPosition(), itemIdToMove=" + itemIdToMove + ", itemIdToMoveAbove=" + itemIdToMoveAbove)

  var memberItemObj, list_memberDataObjs, i, movedAtLeastOneSpot = false;

  // grab item-object for the item-being-walked, and the array of list-member-data-objects for the list
  memberItemObj = grabItemObj(itemIdToMove);
  list_memberDataObjs = listItemObj.getListMemberDataObjs();

  // cycle through all list-member-data-objects for the list, until we find our item that is being walked
  for (i = 0; i < list_memberDataObjs.length; i++) {

    let memberItemDataObj, requestedNewIndex = null, curSortIndex, reachedNewIndex = false;

    if ( isEqual(list_memberDataObjs[i].itemId, memberItemObj.itemId) ) {

//dc_("walkSortPosition(), found the item-to-move, i=" + i)

      // found the item that is being walked
      memberItemDataObj = list_memberDataObjs[i];

      // calculate the requested new index when the walk will be complete
      if ( Number.isInteger(moveAmt) ) {
        // a negative moveAmt sends us towards the top of the list; positive moveAmt sends us towards the end
        requestedNewIndex = i + parseInt(moveAmt);
      } else if (moveToTop) {
        requestedNewIndex = 0;
      } else if (moveToEnd) {
        requestedNewIndex = list_memberDataObjs.length - 1;
      } else if ( !isBlank(itemIdToMoveAbove) ) {

        // need to grab the current index of the requested item-to-move-above
        for (let j = 0; j < list_memberDataObjs.length; j++) {
          let memberDataObj_toCheck = list_memberDataObjs[j];

          if ( isEqual(memberDataObj_toCheck.itemId, itemIdToMoveAbove) ) {

//dc_("walkSortPosition(), found the item-to-move-above, j=" + j)

            // found the requested item-to-move-above

            // if the item-to-move is already directly above the item-to-move-above, we can exit here
            if (i == j - 1) {

              return false;
            }

            if (i < j) {
              // option A: if the item-to-move is ABOVE the item-to-move-above, the new index will be ONE LESS THAN the index of the item-to-move-above
              requestedNewIndex = j - 1;
            } else {
              // option B: if the item-to-move is BELOW the item-to-move-above, the new index will be EQUAL TO the index of the item-to-move-above
              requestedNewIndex = j;
            }
          }
        }
      } else {
        // this occurs if none of the "move" function parameters were set in a valid fashion
        return false;
      }

      // if there was a problem finding the requested item or spot to walk to, return false
      if ( isBlank(requestedNewIndex) || !Number.isInteger(parseInt(requestedNewIndex)) ) {
        return false;
      }

      // don't walk past the top or end of the list
      if (requestedNewIndex < 0) requestedNewIndex = 0;
      if (requestedNewIndex >= list_memberDataObjs.length) requestedNewIndex = list_memberDataObjs.length - 1;

      // check if the item-being-walked is already at the requested new index
      curSortIndex = i;
      if ( parseInt(curSortIndex) == parseInt(requestedNewIndex) ) {
        reachedNewIndex = true;
      }

//dc_("walkSortPosition(), starting walking-loop to move item from curSortIndex=" + curSortIndex + " until it gets to its new position requestedNewIndex=" + requestedNewIndex)

      // while we have not yet reached the requested new index, walk one step at a time in its direction
      while(!reachedNewIndex) {
        let memberItemDataObj_toSwapWith, member_oldSortPosition;

        // determine which direction to walk
        if (curSortIndex > requestedNewIndex) {
          curSortIndex = curSortIndex - 1;
        } else {
          curSortIndex = parseInt(curSortIndex) + 1;
        }

//dc_("walkSortPosition(), starting walking-loop to move item from curSortIndex=" + curSortIndex + " until it gets to its new position requestedNewIndex=" + requestedNewIndex)

        // grab the item-object for the item that our walk has brought us to
        memberItemDataObj_toSwapWith = list_memberDataObjs[curSortIndex];

        // save the current sortPosition value for the item-being-walked
        //  (sortPosition is not always the same as list-index: example #1, if an item has been removed from the list); example #2, if items have swapped position)
        member_oldSortPosition = memberItemDataObj.sortPosition;

        // set the sortPosition value for the item-being-walked, to the sortPosition value of the list-member that was already at this index
        memberItemDataObj.sortPosition = memberItemDataObj_toSwapWith.sortPosition;

        // /... and give the old sortPosition of the item-to-be-walked, to the list-member that was already at this index
        memberItemDataObj_toSwapWith.sortPosition = member_oldSortPosition;

        // mark that we moved at least one spot
        if (!movedAtLeastOneSpot) movedAtLeastOneSpot = true;

        // check if we have reached our requested index for the walk
        if ( parseInt(curSortIndex) == parseInt(requestedNewIndex) ) {
          reachedNewIndex = true;
        }
      }

      // if we moved at least one spot, save the member-data-objects for the the list
      if (movedAtLeastOneSpot) {
        listItemObj.saveListMembersToDatastore(list_memberDataObjs);
      }

      // exit this for-loop -- was only being used to find the item-being-walked
      break;
    }
  }

  return movedAtLeastOneSpot;
}

function wappObj_clearAll() {
  wapp.wdto = null;
  wapp.wdtUiDataObj = null;
  wapp.wdt_internalChangeToUi = false;
}

function wappObj_set(wappObjName, obj) {
  wapp[wappObjName] = obj;
}

function wb_createOrChangeScreenType(existingWibtypeItemId, newWibtypeName) {
  var screenTypeCode = getElemVal("selWibBuilder_BuildScreen_ScreenTypeCode");

  var wibtypeItemObj_associatedWithScreen = null;

  if (existingWibtypeItemId) {
    wibtypeItemObj_associatedWithScreen = grabItemObj(existingWibtypeItemId);
  } else {
    wibtypeItemObj_associatedWithScreen = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, newWibtypeName, null, CONST_displayCode_hidden1, "1", wapp.wibtypes_itemId);
  }

  if (!wibtypeItemObj_associatedWithScreen) {
    return false;
  }

  if (!wapp.wb_curScreen_itemObj) {

    wapp.wb_curScreen_itemObj = wb_screen_create(null, screenTypeCode, wibtypeItemObj_associatedWithScreen.itemId);

    if (!wapp.wb_curScreen_itemObj) {
      return null;
    }

  } else {

    showSoftError("wb_createOrChangeScreenType()", "changing screen wibtype is not currently allowed for existing screens");
    return false;

  }

  displayPage("WibBuilder_BuildScreen");
}

function wb_deleteScreen(screenItemId) {
  var i, screenItemObj = grabItemObj(screenItemId);

  if (screenItemObj == null) {
    showSoftError("wb_deleteScreen()", "Screen with screenItemId=" + screenItemId + " does not exist");
    return false;
  }

  var wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(screenItemObj)

  if (wibtypeItemObj_associatedWithScreen == null) {
    showSoftError("wb_deleteScreen()", "screen with screenItemId=" + screenItemId + " does not have an associated wibtype");
    return false;
  }

  if ( isWibtypeInUse(wibtypeItemObj_associatedWithScreen.itemId) ) {
    alert("Cannot delete this screen -- there are instances of the screen's type that must be deleted first");
    return false;
  }

  if ( !screenItemObj.doDeletion(null) ) {
    return false;
  }

  var allScreens_itemObj = grabItemObj(wapp.wb_screenListItemId);
  var allScreens_itemIdList = allScreens_itemObj.getListMemberItemIds();
  var anotherScreenIsUsingTheAssociatedWibtype = false;

  for (i = 0; i < allScreens_itemIdList.length; i++) {
    let screenInLoop_itemObj = grabItemObj(allScreens_itemIdList[i]);

    if ( screenInLoop_itemObj.hasWtifValue(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName, wibtypeItemObj_associatedWithScreen.itemId) ) {
      anotherScreenIsUsingTheAssociatedWibtype = true;
      break;
    }
  }

  if (!anotherScreenIsUsingTheAssociatedWibtype) {

    // if the instance-holder-list was created, we can now delete it
    var wibtypeInstanceHolderList_itemObj = wb_getWibtypeInstanceHolderList_itemObj(wibtypeItemObj_associatedWithScreen);

    if (wibtypeInstanceHolderList_itemObj) {
      if ( wibtypeInstanceHolderList_itemObj.hasListMembers() ) {
        showSoftError("wb_deleteScreen()", "screen with screenItemId=" + screenItemId + ", associated with wibtypeItemId=" + wibtypeInstanceHolderList_itemObj.itemId + ", the instace-holder-list still has items in it");
        return false;
      }

      wibtypeInstanceHolderList_itemObj.doDeletion(null);
    }

    // delete the wtifs here -- .doDeletion(null) for the wibtype does not handle list-members (the wtifs are list-members of the wibtype)
    let wtifItemIds = wibtypeItemObj_associatedWithScreen.getListMemberItemIds();
    wtifItemIds.forEach( (wtifItemId) => {
      let wtifItemObj = grabItemObj(wtifItemId);
      if ( !wtifItemObj.doDeletion(null) ) {
        return false;
      }
    } );

    if ( !wibtypeItemObj_associatedWithScreen.doDeletion(null) ) {
      return false;
    }
  }

  return true;
}

function wb_generateScreenItemName(wbsScreenTypeCode, wibtypeItemId) {
  // the screen's item-name is in the format:
  // -> wbs__ScreenTypeCode_X__wibtypeItemId_Y
  //      ... the part "ScreenTypeCode_X" comes from -- X = e.g. wbsScreenTypeCode = CONST_wb_screenTypeCode_createWibtype (which is "1")
  //      ... the part "wibtypeItemId_Y" comes from -- Y = the wibtype-itemId of the wibtypeItemObj we created in wb_createOrChangeScreenType()

  var screenItemName = "wbs__ScreenTypeCode_" + wbsScreenTypeCode + "__wibtypeItemId_" + wibtypeItemId;
  return screenItemName;
}

function wb_generateWibtypeInstanceHolderList_itemName(wibtypeItemId_heldByThisWibtypeInstanceHolderList) {
  // the wibtype-instance-holder's item-name is in the format:
  // -> wb__WibtypeInstanceHolder__wibTypeItemId_X
  //      ... where X = the itemId of the wibtype whose instances this wibtype-instance-holder-list is holding
  //           (said wibtype-itemId is passed into this function)

  var wibtypeInstanceHolderList_itemName = "wb__WibtypeInstanceHolder__wibTypeItemId_" + wibtypeItemId_heldByThisWibtypeInstanceHolderList;

  return wibtypeInstanceHolderList_itemName;
}

function wb_getScreenNameDisplay(screenItemObj, wibtypeItemObj) {
  var screenTypeCode = screenItemObj.getWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_screenTypeCode_itemName);

  if ( isBlank(wibtypeItemObj) ) {
    var wibtypeItemId = screenItemObj.getWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName);
    if ( !isBlank(wibtypeItemId) ) {
      wibtypeItemObj = grabItemObj(wibtypeItemId);
    }
  }

  switch (screenTypeCode) {
    case CONST_wb_screenTypeCode_createWibtype:
      return "Create " + wibtypeItemObj.itemName;

    case CONST_wb_screenTypeCode_editWibtype:
      return "Edit " + wibtypeItemObj.itemName;

    default:
      return screenItemObj.itemName;
  }
}

function wb_getScreenTypeCodesAarray() {
  var anObj;
  var theArray = [];

  anObj = getSelectArrayElem(CONST_wb_screenTypeCode_createWibtype, "create type");
  theArray.push(anObj);

  anObj = getSelectArrayElem(CONST_wb_screenTypeCode_editWibtype, "edit type");
  theArray.push(anObj);

  return theArray;

}

function wb_getWibtypeItemObj_associatedWithScreen(screenItemObj) {
  var wibtypeItemId_associatedWithScreen = screenItemObj.getWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName);

  if ( isBlank(wibtypeItemId_associatedWithScreen) ) {
    // not all screens have a wibtype associated now, so we need to return null here
    return null;
  }

  var wibtypeItemObj_associatedWithScreen = grabItemObj(wibtypeItemId_associatedWithScreen);
  return wibtypeItemObj_associatedWithScreen;
}

function wb_getWibtypeInstanceHolderList_itemObj(targetWibtypeItemId) {
  // find the list that holds the target wibtype-instance
  //   -> this list/item will:
  //       (a) be a member of the list "wb-list-of-wibtype-instance-holder-lists" (whose itemId is held in wapp.wb_listOfWibtypeInstanceHolderLists_itemId)
  //       (b) have a wtif-data-obj whose:
  //             (i)   itemName matches the wtif-itemName "WibtypeInstanceHeldItemId" PLUS said wtif is associated with the wibtype "wb-wibtype-instance-holder-wibtype"
  //             (ii)  theData matches the targetWibtypeItemId received
  var igo = new ItemGrabbingObj();
  igo.set_targetJoinedListWithItemId(wapp.wb_listOfWibtypeInstanceHolderLists_itemId);
  igo.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifTheData(CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, wapp.wb_wibtypeInstanceHolderWibtype_itemId, targetWibtypeItemId, false);
  var wibtypeInstanceHolderList_itemObj = igo.runSearchAndReturnX();

  return wibtypeInstanceHolderList_itemObj;
}

function wb_promptNewWibtypeName() {
  if (wapp.wb_curScreen_itemObj == null) {

    let newWibtypeName = prompt("type of thing:", "");

    if ( isBlank(newWibtypeName) ) {
      return false;
    }

    wb_createOrChangeScreenType(null, newWibtypeName)

  } else {

    showSoftError("wb_promptNewWibtypeName()", "changing screen wibtype is not currently allowed for existing screens");
    return false;

  }

  return true;
}

function withoutLeft(haystack, needle) {
  if (typeof haystack !== "string") return "";
  if (typeof needle !== "string") return haystack;

  var lenNeedle = needle.length;

  if (lenNeedle == 0) {
    return haystack;
  }

  var haystackLeft = left(haystack, lenNeedle);

  if ( isEqual(haystackLeft, needle) ) {
    return haystack.substr(lenNeedle);
  } else {
    return haystack;
  }
}

function withoutRight(haystack , needle) {
  if (typeof haystack !== "string") return "";
  if (typeof needle !== "string") return haystack;

  var lenNeedle = needle.length;

  if (lenNeedle == 0) {
    return haystack;
  }

  var haystackRight = right(haystack, lenNeedle);

  if ( isEqual(haystackRight, needle) ) {
    return haystack.substr(0, haystack.length - lenNeedle);
  } else {
    return haystack;
  }
}

function writeBackupExport() {
  var i, keyName, keyValue, txt = "";

  for (i = 0; i < localStorage.length; i++){
    keyName = localStorage.key(i);
    keyValue = localStorage.getItem(keyName);

    if (i > 0) txt += sD2;

    txt += keyName + sD2 + keyValue;
  }

  elem("taExportedBackupText").value = txt;
  elem("taExportedBackupText").select();
}

function writeHtml_MoveOrCopy_ItemsBeingMovedOrCopied() {
  var singleItemGrab, displayList_itemObj, curList_listMemberDataObjs, html, i, firstGrabbingItemId = null, secondGrabbingItemId = null, firstWas1 = false, firstWas2 = false, wroteFirstHtmlRow = false;

  if ( !isBlank(wapp.grabbing_itemId1) && isBlank(wapp.grabbing_itemId2) ) {
    singleItemGrab = true;
    if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
      displayList_itemObj = grabItemObjByName(CONST_listName_homePage);
    } else {
      displayList_itemObj = grabItemObj(wapp.itemObj.displayedOnList_itemId);
    }
  } else {
    singleItemGrab = false;
    displayList_itemObj = wapp.itemObj;
  }

  html = "<table cellspacing=0 cellpadding=0>\n";
  wapp.grabbing_itemIdArray = [];

  curList_listMemberDataObjs = displayList_itemObj.getListMemberDataObjs();

  for (i = 0; i < curList_listMemberDataObjs.length; i++){
    let curItemId, curItemObj, writeCurItem = false;

    curItemId = curList_listMemberDataObjs[i].itemId;

    if ( firstGrabbingItemId == null ) {
      
      //we HAVE NOT found the earliest-sort-position grabbed-item yet

      if ( isEqual(curItemId, wapp.grabbing_itemId1) ) {
        //the current item matches grab-item-1

        //... set info about first-grabbed-item found
        firstGrabbingItemId = wapp.grabbing_itemId1;
        firstWas1 = true;

        //... mark that we should write the current item
        writeCurItem = true;
      }

      if ( isEqual(curItemId, wapp.grabbing_itemId2) ) {
        //the current item matches grab-item-2

        //... set info about first-grabbed-item found
        firstGrabbingItemId = wapp.grabbing_itemId2;
        firstWas2 = true;

        //... mark that we should write the current item
        writeCurItem = true;
      }

    } else {

      //we HAVE found the earliest-sort-position grabbed-item yet

      //... NOTE: this ELSE section does not apply to single-item-grab, as we will exit this loop on the pass when firstGrabbingItemId is filled with the single-item, above

      //we should always write the current item now, because firstGrabbingItem is filled (non-null)
      writeCurItem = true;

      if (firstWas1) {

        //the earliest-sort-position grabbed-item was 1, so check 2 to see if we're done after the current item
        if ( isEqual(curItemId, wapp.grabbing_itemId2) ) {

          //the current item matches grab-item-2, so mark it as the second-grabbed-item found
          secondGrabbingItemId = wapp.grabbing_itemId2;
        }

      } else {

        //the earliest-sort-position grabbed-item was 2, so check 1 to see if we're done after the current item
        if ( isEqual(curItemId, wapp.grabbing_itemId1) ) {

          //the current item matches grab-item-1, so mark it as the second-grabbed-item found
          secondGrabbingItemId = wapp.grabbing_itemId1;
        }

      }

    }

    //check if we've gotten to the earliest-sort-position grabbed-item yet; if so, we can write HTML
    if (writeCurItem) {
      curItemObj = grabItemObj(curItemId);

      //save the item in an array, for use in the next step
      wapp.grabbing_itemIdArray.push(curItemId);

      if (wroteFirstHtmlRow) {
        html += "<tr style='height: 0.8em'><td></td><td></td></tr>\n";
      }

      html += "<tr><td>\n";
      html += " <table cellspacing=0 cellpadding=0>\n";
      html += " <tr style='height: 2px'><td></td></tr>\n";
      html += " <tr><td style='color: black; font-size: 125%'>&bull;</td></tr>\n";
      html += " </table>\n";
      html += "</td><td style='width: 0.5em'></td><td><i>" + curItemObj.itemName + "</i></td></tr>\n";

      wroteFirstHtmlRow = true;

      //always break for single-item-grab, after this one row is written
      if (singleItemGrab) {
        break;
      }
    }

    //if first-grabbed-item and second-grabbed-item are filled, we can now exit this loop
    if ( firstGrabbingItemId !== null && secondGrabbingItemId !== null ) {
      break;
    }
  }

  html += "</table>\n";

  return html;
}

function writeHtml_MoveOrCopy_ListsToMoveOrCopyItemsTo() {
  var singleItemGrab, grabbingItemObj1, displayList_itemId, allItemIds_array, html = "", i, wroteFirstHtmlRow = false, listItemObjsToDisplay = [];
  var sortingPropName = CONST_propName_itemName + "_forSorting";
  var homePageList_itemObj = grabItemObj(wapp.homePageList_itemId);
  var homePageList_listMemberDataObjs = homePageList_itemObj.getListMemberDataObjs();

  if ( !isBlank(wapp.grabbing_itemId1) && isBlank(wapp.grabbing_itemId2) ) {
    singleItemGrab = true;
    grabbingItemObj1 = grabItemObj(wapp.grabbing_itemId1);
    if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
      displayList_itemId = wapp.homePageList_itemId;
    } else {
      displayList_itemId = wapp.itemObj.displayedOnList_itemId;
    }
  } else {
    singleItemGrab = false;
    displayList_itemId = wapp.itemObj.itemId;
  }

  allItemIds_array = getAllItemsArray();
  
  html += "<table cellspacing=0 cellpadding=0>\n";

  for (i = 0; i < allItemIds_array.length; i++) {
    let j, skipThisItem = false;
    let curItemId = allItemIds_array[i];
    let curItemObj = grabItemObj(curItemId)

    // don't write the display-list that holds the grabbed-items:
    if ( isEqual(displayList_itemId, curItemId) ) {
      continue;
    }

    // don't write non-list items:
    if (curItemObj.isList == "0") {
      continue;
    }

    // don't write hidden1 items
    if ( !isEqual(curItemObj.displayCode, CONST_displayCode_normal) ) {
      
      // unless it's the home-page-list, which we want to be an option here
      if ( !isEqual(curItemId, wapp.homePageList_itemId) ) {
        continue;
      }
    }

    // don't write items from the list of grabbed-items
    for (j = 0; j < wapp.grabbing_itemIdArray.length; j++) {
      if ( isEqual(wapp.grabbing_itemIdArray[j], curItemId) ) {
        skipThisItem = true;
        continue;
      }
    }
    if (skipThisItem) {
      continue;
    }

    // everything else is okay to write as an available list to move the grabbed-items to
    // -> push the current-item-object to the designated array
    //     (after adding a sort-column that will put home-page-list items first)
    if ( isEqual(curItemId, wapp.homePageList_itemId) ) {
      curItemObj[sortingPropName] = "0";
    } else if ( isEqual(curItemObj.joinedLists_itemIds[0], wapp.homePageList_itemId) ) {
      let curListMemberDataObj = getElemFromObjArray(homePageList_listMemberDataObjs, CONST_propName_itemId, curItemObj.itemId);
      curItemObj[sortingPropName] = getWithLeadingZeroes(curListMemberDataObj.sortPosition, 5) + "_" + curItemObj.itemName;
    } else {
      curItemObj[sortingPropName] = "99999_" + curItemObj.itemName;
    }

    listItemObjsToDisplay.push(curItemObj);
  }

  // sort the array of list-item-objects we will be displaying
  listItemObjsToDisplay.sort( sortingObjects_alphabetic(sortingPropName) );

  //loop through sorted array of list-item-objects to build the associated html
  for (i = 0; i < listItemObjsToDisplay.length; i++) {
    let curListItemObj = listItemObjsToDisplay[i];
    let curListItemName = curListItemObj.itemName;

    if ( isEqual(curListItemObj.itemId, wapp.homePageList_itemId) ) {
      curListItemName = "Home";
    }

    if (wroteFirstHtmlRow) {
        html += "<tr style='height: 1.8em'><td colspan=2></td></tr>\n";
    }

    html += "<tr><td colspan=2>" + curListItemName + "</td></tr>\n";
    html += "<tr style='height: 0.2em'><td colspan=2></td></tr>\n";
    if ( !isBlank(curListItemObj.joinedLists_itemIds[0]) ) {
      let parentListObj = grabItemObj(curListItemObj.joinedLists_itemIds[0]);
      let parentListName = parentListObj.itemName;
      if (parentListName == CONST_listName_homePage) parentListName = "Home";
      html += "<tr><td colspan=2 style='font-size: 95%'>&nbsp;&nbsp;> " + parentListName + "</td></tr>\n";
      html += "<tr style='height: 0.2em'><td colspan=2></td></tr>\n";
    }

    html += "<tr><td style='width: 0.0em'></td><td>\n";
    html += " <a href='javascript:void move_to_this_list(\"" + curListItemObj.itemId + "\")'>move here</a>\n";

    if ( singleItemGrab && grabbingItemObj1.isList == "1" ) {
      // if we are moving a single item that is a list, don't offer the "copy here" option
      //  (copying duplicates items but not their list-members, which we will allow for multi-items because it might be helpful)
    } else {
      html += " &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void copy_to_this_list(\"" + curListItemObj.itemId + "\")'>copy here</a>\n";
    }

    html += "</td></tr>\n";

    wroteFirstHtmlRow = true;
  }

  if (!wroteFirstHtmlRow) html += "<tr><td>(no other lists are available)</td></tr>";

  html += "</table>\n";

  return html;
}

function writeHtml_items(mainItemObj) {
  var listMemberDataObjs, html = "", i;

  if ( isBlank(mainItemObj) ) mainItemObj = wapp.itemObj;

  if (mainItemObj.isList) {
    //get array of list-member-item-ids
    listMemberDataObjs = mainItemObj.getListMemberDataObjs();

    //open html table
    html += "<table cellspacing=0 cellpadding=0>\n";

    //loop through array to write list in HTML
    for (i = 0; i < listMemberDataObjs.length; i++){
      let curItemId, curItemObj, addAsterisk, ttDisplayForItem, itemNameDisplay;

      curItemId = listMemberDataObjs[i].itemId;

      if (i > 0) {
        html += "<tr style='height: 1.4em'><td></td><td></td></tr>\n";
      }

      //call the function that grabs the current item's item-info from storage and returns it as a js-object
      curItemObj = grabItemObj(curItemId);

      //add asterisk to item-name if it has notes or list-members
      {
        addAsterisk = false;

        if ( !isBlank(curItemObj.notes) ) {
          addAsterisk = true;
        } else {
          if ( curItemObj.hasListMembers() ) {
            addAsterisk = true;
          }
        }

        if (addAsterisk) {
          itemNameDisplay = curItemObj.itemName + " *";
        } else {
          itemNameDisplay = curItemObj.itemName;
        }
      }

      //add Time-Tracking info if this is such an item
      {
        ttDisplayForItem = "";
        if ( curItemObj.isAssignedToType(wapp.timeTracking_wibtypeItemId) ) {
          let wdto = wdt_getWappDatetimeObj(curItemObj, true);
          ttDisplayForItem = wdto.getDisplay1();
        }
      }

      //set html based on item-info values stored as properties of the item-info-js-object
      html += "<tr><td>\n";
      html += " <table cellspacing=0 cellpadding=0>\n";
      html += " <tr style='height: 2px'><td></td></tr>\n";
      html += " <tr><td style='color: black; font-size: 125%'>&bull;</td></tr>\n";
      html += " </table>\n";
      html += "</td><td style='width: 0.5em'></td><td><a id='" + getHtml_aItem(curItemId) + "'" ;
      html += " class='" + getDoneStatusCssClassNameColor(curItemObj.doneStatusCode) + "'";
      html += " href='javascript:void click_item(\"" + curItemId + "\")'>" + itemNameDisplay + "</a>";
      if (ttDisplayForItem) html += "<br /><span style='font-size: 90%'>" + ttDisplayForItem + "</span>";
      html += "</td></tr>\n";
      html += "<tr style='height: 1.4em'><td colspan=3></td></tr>\n"
      html += "<tr id='" + getHtml_reorderingActivated_tr(curItemId) + "' style='display: "
      if ( ! isEqual(curItemId, wapp.reordering_activatedItemId) ) html += "none";
      html += "'><td colspan=2></td><td>\n";
      html += " <table id='" + getHtml_reorderingModeIs_normal_tblOptions(curItemId) + "' cellspacing=0 cellpadding=0>\n";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_above_other_item(\"" + curItemId + "\")'>move above other item</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 1.6em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_up(\"" + curItemId + "\", 1)'>up 1</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_down(\"" + curItemId + "\", 1)'>down 1</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 1.7em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_to_top(\"" + curItemId + "\")'>to top</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_to_end(\"" + curItemId + "\")'>to end</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 1.7em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a class='" + CONST_cssClassName_red + "' href='javascript:void toggle_reorder()'>finished reordering</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 0.8em'><td colspan=2></td></tr>";
      html += " </table>\n";
      html += " <div id='" + getHtml_reorderingModeIs_moveAboveOtherItem_dvInstructions(curItemId) + "' style='padding-bottom: 0.5em; display: none'><i>now click the other item</i></div>\n";
      html += "</td></tr>\n";

      if ( isBlank(wapp.focusElemId) ) {
        focus_set_fromItemId(curItemId);
      }
    }

    if (listMemberDataObjs.length == 0) {
      if (mainItemObj.isWibtype == "1") {
        html += "<tr'><td>(no info-fields yet for this Type)</td></tr>";
      } else {
        html += "<tr'><td>(no items)</td></tr>";
      }
      html += "<tr style='height: 0.85em'><td></td></tr>";
    }

    html += "</table>\n";
  }

//elem("taDev1").value = html;
  return html;
}

function writeHtml_navigationTree(curList_memberDataObjs, listItemIds_alreadyWritten, numOfIndents) {
  var html = "", horzSpaces = "";

  for (var i = 1; i <= numOfIndents; i++) {
    horzSpaces += "  ";
  }

  curList_memberDataObjs.forEach( (curList_memberDataObj) => {
    let curItemObj = grabItemObj(curList_memberDataObj.itemId);
    let displayListAsList = false;

    if (curItemObj.isList == "1") {
      if ( !doesValArrayHaveElem(listItemIds_alreadyWritten, curItemObj.itemId) ) {
        listItemIds_alreadyWritten.push(curItemObj.itemId);
        displayListAsList = true;
      }
    }

    if (html !== "" || numOfIndents > 0) html += horzSpaces + "<div style='height: 1.8em'></div>\n"

    if (numOfIndents > 0) {
      html += horzSpaces + "<div style='display: inline-block; width: " + numOfIndents + "em'></div>\n";
    }

    if (curItemObj.isList == "1") {
      html += horzSpaces + "<div style='display: inline-flex'>";

      if (displayListAsList) {
        html += writeHtml_plusMinusSign(curItemObj.itemId) + "&nbsp;&nbsp;";
      }

      html += "<div style='padding-top: 0.15em'>LIST: " + curItemObj.itemName + "</div></div>\n";

    } else {
      html += horzSpaces + "<div style='display: inline-block'>" + curItemObj.itemName + "</div>\n";

    }

    if (curItemObj.isList == "1") {
      html += horzSpaces + "<div style='height: 0.8em'></div>\n"
    } else {
      html += horzSpaces + "<div style='height: 0.3em'></div>\n"
    }

    if (numOfIndents > 0) {
      html += horzSpaces + "<div style='display: inline-block; width: " + numOfIndents + "em'></div>\n";
    }

    let connectLinkText = "connect to this item";
    let connectSpacer = "";
    if (curItemObj.isList == "1") {
      connectLinkText = "connect to this list";
      connectSpacer = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    }

    html += horzSpaces + "<div style='display: inline-block'>" + connectSpacer + "<a href='javascript:void navigate__connect_to_item(\"" + curItemObj.itemId + "\")'>" + connectLinkText + "</a></div>\n";

    if (displayListAsList) {
      let innerListOfMemberDataObjs = curItemObj.getListMemberDataObjs();
      let newNumOfIndents = parseInt(numOfIndents) + 1;

      html += horzSpaces + "<div id='dvNavListMembers_" + curItemObj.itemId + "' style='display: none'>\n";

      html += writeHtml_navigationTree(innerListOfMemberDataObjs, listItemIds_alreadyWritten, newNumOfIndents);

      html += horzSpaces + "</div>\n";
    }
  } );

  if (html == "") {
    if (html !== "" || numOfIndents > 0) html += horzSpaces + "<div style='height: 1.8em'></div>\n"
    if (numOfIndents > 0) {
      html += horzSpaces + "<div style='display: inline-block; width: " + 1.5 * numOfIndents + "em'></div>\n";
    }
    html += horzSpaces + "<div style='display: inline-block'><i>(empty list)</i></div>\n";
  }

  return html;
}

function writeHtml_plusMinusSign(itemId, writeMinus, baseSizeInEm) {
  var html = "";

  if ( !isNumeric(baseSizeInEm) ) {
    baseSizeInEm = 0.9;
  }

  baseSizeInEm = parseFloat(baseSizeInEm);

  var borderInEm = baseSizeInEm * 0.1;
  var paddingInEm = baseSizeInEm * 0.15;

  var overallSizeInEm = baseSizeInEm + 2 * borderInEm + 2 * paddingInEm;

  html += "<div class='borderBlue' onmouseover='setElemCursor_pointer(this)' onmouseout='setElemCursor_none(this)' onclick='toggleNavList(" + itemId + ")'";
  html += " style='display: grid; grid-template-columns: auto 15% auto; grid-template-rows: auto 14% auto; width: " + overallSizeInEm + "em; height: " + overallSizeInEm + "em; border-width: " + borderInEm + "em; padding: " + paddingInEm + "em'>";

  if (writeMinus) {
    html += "<div style='grid-column: 1/4'></div>";
  } else {
    html += "<div></div><div id='dvNavListMembers_PlusTop_" + itemId + "' class='backgroundBlue'></div><div></div>";
  }

  html += "<div class='backgroundBlue' style='grid-column: 1/4'></div>";


  if (writeMinus) {
    html += "<div style='grid-column: 1/4'></div>";
  } else {
    html += "<div></div><div id='dvNavListMembers_PlusBottom_" + itemId + "' class='backgroundBlue'></div><div></div>";
  }

  html += "</div>";

  return html;
}

function writeHtml_WtifData() {
  var wibtypeItemIds, html = "", i;

  html += "<div class='grid2'>\n";

  for (i = 0; i < wapp.itemObj.assignedWibtypes_itemIds.length; i++) {
    let wibtypeItemId = wapp.itemObj.assignedWibtypes_itemIds[i];
    let wibtypeItemObj = grabItemObj(wibtypeItemId);

    if (i > 0) {
      html += "<div class='grid2Cell gc2VSpace2'></div>\n";
    }
    html += "<div class='grid2Cell gc2Header2'>" + wibtypeItemObj.itemName
    if ( isEqual(wibtypeItemId, wapp.timeTracking_wibtypeItemId) ) {
      html += "&nbsp;&nbsp;&nbsp;<a href='javascript:void edit_time_tracking()'>edit</a>";
      html += "&nbsp;&nbsp;&nbsp;<a href='javascript:void remove_time_tracking()'>remove</a>";
    }
    html += "&nbsp;&nbsp;</div>\n";
    html += "<div class='grid2Cell gc2VSpace2'></div>\n";

    let wtifs_listMemberDataObjs = wibtypeItemObj.getListMemberDataObjs();

    for (let j = 0; j < wtifs_listMemberDataObjs.length; j++) {
      let wtif_listMemberDataObj = wtifs_listMemberDataObjs[j];
      let wtif_itemObj = grabItemObj(wtif_listMemberDataObj.itemId);

      let wtifDataObj = getElemFromObjArray(wapp.itemObj.wtifDataObjs, "wtifItemId", wtif_itemObj.itemId);
      let dataDisplay = "(blank)";

      if ( wtifDataObj !== null ) {
        dataDisplay = wtifDataObj.theData;

        if ( isBlank(dataDisplay) ) {
          dataDisplay = "(blank)";
        }
      }

      if (j > 0) {
        html += "<div class='grid2Cell gc2VSpace2'></div>\n";
      }
      html += "<div class='grid2Cell gc2TextLeft'>" + wtif_itemObj.itemName + ":</div>\n";
      html += "<div class='grid2Cell gc2TextRight'>" + dataDisplay + "</div>\n";
    }
  }

  if (wapp.itemObj.assignedWibtypes_itemIds == 0) {
    html += "<div class='grid2Cell gc2Footer'>types: <i>none</i>";
    html += "&nbsp;&nbsp;&nbsp;<a href='javascript:void view_item__add_time_tracking()'>add TT</a></div>\n";
  }

  html += "</div>\n";

//elem("taDev1").value = html;
  return html;
}

function writeStorage() {
  var i, keyName, keyValue, html = "", curListId, curListName, appNarrow;

  appNarrow = getFromDatastore(CONST_wibapp_narrow);

  html += "<div><a href='javascript:void storage__add_row()'>add</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript:void storage__refresh()'>refresh</a></div>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<table cellpadding=5 cellspacing=0 border=1>\n";

  if (localStorage.length <= 0) {
    html += "<tr><td>(no items in storage)</td></tr>\n";
  } else {
    if (appNarrow == "1") {
      html += "<tr><td></td><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><b>Key Name</b></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td style='height: 1px; background-color: black'></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td><b>Key Value</b></td></tr>\n";
      html += "  </table>\n";
      html += "</td></tr>\n";
    } else {
      html += "<tr><td></td><td><b>Key Name</b></td><td><b>Key Value</b></td></tr>\n";
    }
  }

  for (i = 0; i < localStorage.length; i++) {
    keyName = localStorage.key(i);
    keyValue = getFromDatastore(keyName);

    if (appNarrow == "1") {
      html += "<tr><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><a href='javascript:void edit_storage_row(\"" + keyName + "\")'>edit</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript:void change_storage_key_name(\"" + keyName + "\")'>change key</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript:void delete_storage_row(\"" + keyName + "\")'>delete</a></td></tr>\n";
      html += "  </table>\n";
      html += "</td>\n";
    } else {
      html += "<tr><td style='white-space: nowrap'>&nbsp;<a href='javascript:void edit_storage_row(\"" + keyName + "\")'>edit</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript:void change_storage_key_name(\"" + keyName + "\")'>change key</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript:void delete_storage_row(\"" + keyName + "\")'>delete</a>&nbsp;&nbsp;</td>\n";
    }

    if (appNarrow == "1") {
      html += "<td>" + keyName + "</td></tr>\n";
      html += "<tr><td></td><td>" + keyValue + "</td></tr>\n";
    } else {
      html += "<td>" + keyName + "</td><td>" + keyValue + "</td></tr>\n";
    }
  }

  html += "</table>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<div><a href='javascript:void storage__add_row()'>add</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript:void storage__refresh()'>refresh</a></div>\n";

  elem("dvStorage").innerHTML = html;
}


///// USER-CLICKABLE FUNCTIONS

function add_connected_item() {
  displayPage("NavigateItems");
}

function add_notes() {
  var newNotes = prompt("Notes:", "");
  if ( isBlank(newNotes) ) return;

  newNotes = getProcessedStringForSave(newNotes);

  wapp.itemObj.changeItemInfo(null, null, null, null, newNotes);
  goToItemView(null, true);
}

function add_time_tracking__add_this() {

  if ( ! wapp.wdto.isUiValid() ) {
    return;
  }

  wapp.wdto.saveToDatastore();

  wapp.itemObj.changeDoneStatus(CONST_doneStatusCode_okay);

  hidePopUp("AddTimeTracking");
  goToItemView(null, true);
}

function add_time_tracking__cancel() {
  hidePopUp("AddTimeTracking");
  displayPage("ViewItem");
}

function add_time_tracking__display_end_date() {
  elem("dvAddTimeTracking_EndDate_Link").style.display = "none";
  elem("dvAddTimeTracking_EndDate_Data_1").style.display = "";
  elem("dvAddTimeTracking_EndDate_Data_2").style.display = "";
  elem("ipAddTimeTracking_EndYear").focus();
  elem("ipAddTimeTracking_EndYear").select();
}

function all_apps__create_new_app() {
  var appItemName = prompt("Name for new app:", "");

  if ( isBlank(appItemName) ) {
    return;
  }

  var appItemObj = wb_app_create(appItemName);

  if (appItemObj) {
    wapp.wb_curApp_itemObj = appItemObj;
    displayPage("WibBuilder_ViewApp");
  }
}

function all_apps__delete_app(appItemId) {
  var appItemObj = grabItemObj(appItemId);

  if ( !confirm("Delete app '" + appItemObj.itemName + "' ?" ) ) {
    return;
  }
  
  wb_app_delete(appItemObj);
  displayPage("WibBuilder_AllApps");
}

function all_apps__go_to_all_scripts() {
  displayPage("WibBuilder_AllScripts");
}

function all_apps__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function all_apps__view_app(appItemId) {
  wapp.wb_curApp_itemObj = grabItemObj(appItemId);
  displayPage("WibBuilder_ViewApp");
}

function all_screens__build_new_screen() {
  wapp.wb_curScreen_itemObj = null;
  displayPage("WibBuilder_BuildScreen");
}

function all_screens__build_screen(screenItemId) {
  wapp.wb_curScreen_itemObj = grabItemObj(screenItemId);

  wapp.wb_curWibtype_itemObj = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);

  if (!wapp.wb_curWibtype_itemObj) {
    alert("only screens with an associated type can be built from this link");
    return;
  }

  displayPage("WibBuilder_BuildScreen");
}

function all_screens__delete_screen(screenItemId) {
  var screenItemObj = grabItemObj(screenItemId);
  var screenNameDisplay = wb_getScreenNameDisplay(screenItemObj);
  var wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(screenItemObj);
  var deletionSuccess;

  if ( !confirm("Delete screen '" + screenNameDisplay + "' ?" ) ) {
    return;
  }

  if (wibtypeItemObj_associatedWithScreen) {
    deletionSuccess = wb_deleteScreen(screenItemId);
  } else {
    deletionSuccess = wb_screen_delete(screenItemObj)
  }

 if (deletionSuccess) {
    displayPage("WibBuilder_AllScreens");
  } else {
    // for now, will refresh the all-screens page, even if there was an error during the screen-deletion process
    displayPage("WibBuilder_AllScreens");
  }
}

function all_screens__go_to_all_apps() {
  displayPage("WibBuilder_AllApps");
}

function all_screens__go_to_all_scripts() {
  displayPage("WibBuilder_AllScripts");
}

function all_screens__run_screen(screenItemId) {
  wapp.wb_curScreen_itemObj = grabItemObj(screenItemId);

  wapp.wb_curWibtype_itemObj = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);

  if (!wapp.wb_curWibtype_itemObj) {
    alert("only screens with an associated type can be run from this link");
    return;
  }

  displayPage("WibBuilder_RunScreen");
}

function all_screens__show_type_instances(screenItemId) {
  wapp.wb_curScreen_itemObj = grabItemObj(screenItemId);
  wapp.wb_curWibtype_itemObj = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);

  if (!wapp.wb_curWibtype_itemObj) {
    alert("only screens with an associated type can show instances");
    return;
  }

  displayPage("WibBuilder_ShowWibtypeInstances");
}

function all_scripts__create_new_script() {
da("--- incomplete function ---")
}

function all_scripts__delete_script(scriptItemId) {
  var scriptItemObj = grabItemObj(scriptItemId);

  if ( !confirm("Delete script '" + scriptItemObj.itemName + "' ?" ) ) {
    return;
  }
  
  var scriptItemObj = grabItemObj(scriptItemId);
  wb_script_delete(scriptItemObj);
  displayPage("WibBuilder_AllScripts");
}

function all_scripts__go_to_all_apps() {
  displayPage("WibBuilder_AllApps");
}

function all_scripts__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function back_to_type(wibtypeItemId) {
  goToItemView(wibtypeItemId, false);
}

function begin_import() {
  var textToImport = elem("taBackupTextToImport").value;
  if ( isBlank(textToImport) ) return;
  importBackupText(textToImport);
}

function build_screen__changeScreenType() {
  var newScreenTypeCode = getElemVal("selWibBuilder_BuildScreen_ScreenTypeCode");
  var wibtypeName = "________";

  if (wapp.wb_curScreen_itemObj) {
    wapp.wb_curScreen_itemObj.setWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_screenTypeCode_itemName, newScreenTypeCode, true)
    let wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);
    wibtypeName = wibtypeItemObj_associatedWithScreen.itemName;
  }

  if ( isEqual(newScreenTypeCode, CONST_wb_screenTypeCode_createWibtype) ) {
    elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = "Create&nbsp;&nbsp;" + wibtypeName;
  } else if ( isEqual(newScreenTypeCode, CONST_wb_screenTypeCode_editWibtype) ) {
    elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = "Edit&nbsp;&nbsp;" + wibtypeName;
  }
}

function build_screen__go_to_all_screens() {
  wapp.wb_curScreen_itemObj = null;
  displayPage("WibBuilder_AllScreens");
}

function build_screen__run_this_screen() {
  if (!wapp.wb_curScreen_itemObj) {
    alert("must set the 'type of thing being created' in order to run this screen");
    return;
  }

  displayPage("WibBuilder_RunScreen");
}

function build_screen__set_type_of_thing() {
  if (wapp.wb_curScreen_itemObj !== null) {
    alert("Changing the type of thing for a screen is currently disabled")
    return;
  }

  showPopUp("WibBuilder_UseExistingWibtype", null);
}

function build_screen__use_existing_type(choice) {
  switch (choice) {
    case "yes":
      hidePopUp("WibBuilder_UseExistingWibtype");
      displayPage("WibBuilder_ChooseExistingWibtype");
      break;

    case "no":
      if ( wb_promptNewWibtypeName() ) {
        hidePopUp("WibBuilder_UseExistingWibtype");
        displayPage("WibBuilder_BuildScreen");
      }
      break;

    case "cancel":
      hidePopUp("WibBuilder_UseExistingWibtype");
      displayPage("WibBuilder_BuildScreen");
      break;
  }
}

function cancel_change_done_status() {
  hidePopUp("ChangeDoneStatus");
  goToItemView();
}

function cancel_make_new_type() {
  hidePopUp("MakeNewWibtype");
  displayPage("Wibtypes");
}

function cancel_make_new_type_info_field() {
  hidePopUp("MakeNewWibtypeInfoField");
  goToItemView();
}

function cancel_move() {
  toggleGrabbing_off();
  goToItemView(null, false);
}

function change_done_status() {
  showPopUp("ChangeDoneStatus", null);
}

function change_storage_key_name(curKeyName) {
  var editedKeyName, keyValue, keyValueFromEditedKeyName, warningMsg, confirmationMsg;

  //get new key name user requests
  editedKeyName = prompt("Change key name to:", curKeyName);

  //exit if user did not provide a new key name
  if ( isBlank(editedKeyName) ) {
    return;
  }

  //grab existing key value for current key name
  keyValue = getFromDatastore(curKeyName);

  //check to see if new requestd key name is already in use; if so, disallow
  keyValueFromEditedKeyName = getFromDatastore(editedKeyName);
  if ( !isBlank(keyValueFromEditedKeyName) ) {
    warningMsg = "*** OPERATION DISALLOWED ***\n";
    warningMsg += "You tried to change key with keyName='" + curKeyName + "'\n";
    warningMsg += "( keyValue='" + keyValue + "' )\n";
    warningMsg += "... to the new-keyName '" + editedKeyName + "'\n";
    warningMsg += "... but that new-keyName already exists, with existing-keyValue '" + keyValueFromEditedKeyName + "'";
    alert(warningMsg);
    return;
  }

  //save new key to storage
  saveToDatastore(editedKeyName, keyValue);

  //delete previous key name
  deleteFromDatastore(curKeyName);

  //provide info with change
  confirmationMsg = "Change Made:\n\n";
  confirmationMsg += " old-keyName: " + curKeyName + "\n";
  confirmationMsg += " new-keyName " + editedKeyName + "\n";
  confirmationMsg += " keyValue: " + keyValue;
  alert(confirmationMsg);

  //refresh storage view
  storage__show();
}

function choose_existing_type__cancel() {
  displayPage("WibBuilder_BuildScreen");
}

function choose_existing_type__click_type(wibTypeItemId) {
  wb_createOrChangeScreenType(wibTypeItemId, null)
}

function choose_type__cancel() {
  goToItemView(null, false);
}

function choose_wibtype__this_one(wibtypeItemId_toAdd) {
  wapp.itemObj.addWibtypeForListMembers(wibtypeItemId_toAdd);
  goToItemView(null, false);
}

function clear_storage() {
  var clearStoragePrompt;
  
  clearStoragePrompt = prompt("type 'clear it' to clear local storage", "");

  if (clearStoragePrompt == "clear it") {
    localStorage.clear();
    alert("storage cleared");
  } else {
    alert("storage NOT cleared");
  }
}

function click_item(itemIdThatWasClicked) {

  if (wapp.reorderingOn) {

    if ( isBlank(wapp.reordering_activatedItemId) ) {

      activateItemForReordering(itemIdThatWasClicked);
      focus_set_fromItemId(itemIdThatWasClicked);

    } else if ( isEqual(itemIdThatWasClicked, wapp.reordering_activatedItemId) ) {

      deactivateItemForReordering(wapp.reordering_activatedItemId);
      focus_set_fromItemId(itemIdThatWasClicked);

    } else if (wapp.reordering_mode == CONST_reordering_mode_normal) {

      deactivateItemForReordering(wapp.reordering_activatedItemId);
      activateItemForReordering(itemIdThatWasClicked);
      focus_set_fromItemId(itemIdThatWasClicked);

    } else if (wapp.reordering_mode == CONST_reordering_mode_moveAboveOtherItem) {

      toggleReorderingMode_normal(wapp.reordering_activatedItemId)

      if ( reorderActivatedItemAboveOtherItem(itemIdThatWasClicked) ) {
        focus_set_fromItemId(wapp.reordering_activatedItemId);
        goToItemView(null, true);
      }

    }

  } else if (wapp.grabbingOn) {

    if ( isBlank(wapp.grabbing_itemId1) ) {

      css_addClass(getHtml_aItem(itemIdThatWasClicked), CONST_cssClassName_bold);
      wapp.grabbing_itemId1 = itemIdThatWasClicked;

    } else if ( isEqual(itemIdThatWasClicked, wapp.grabbing_itemId1) ) {

        css_removeClass(getHtml_aItem(itemIdThatWasClicked), CONST_cssClassName_bold);
        wapp.grabbing_itemId1 = null;

    } else {

      wapp.grabbing_itemId2 = itemIdThatWasClicked;
      focus_clear();
      displayPage("MoveOrCopy");

    }

  } else {

    focus_clear();
    goToItemView(itemIdThatWasClicked, false);

  }

}

function copy_imported_text_to_clipboard() {
  elem("taExportedBackupText").select();  
  document.execCommand("copy")
  alert("backup text copied to clipboard");
}

function copy_to_this_list(selectedList_itemId) {
  moveOrCopyGrabbedItems(selectedList_itemId, aO("copy"))
}

function delete_item() {
  if ( confirm("Delete this item?\n\nItem Name: " + wapp.itemObj.itemName) ) {
    if ( deleteItem(wapp.itemObj.itemId, null, true) ) {
      if ( !isBlank(wapp.itemObj) ) {
        goToItemView(null, false);
      } else {
        return_home();
      }
    }
  }
}

function delete_notes() {
  if ( confirm("Delete all Notes for this item?\n\nItem Name: " + wapp.itemObj.itemName + "\n\nNotes: " + wapp.itemObj.notes) ) {
    wapp.itemObj.changeItemInfo(null, null, null, null, "");
    goToItemView(null, true);
  }
}

function delete_storage_row(keyName) {
  if ( confirm("Delete this row?") ) {
    deleteFromDatastore(keyName);
    storage__show();
  }
}

function do_change_done_status(newDoneStatusDisplay) {
  var newDoneStatusCode, goToItemId;

  if (newDoneStatusDisplay == CONST_doneStatusDisplay_done) {
    newDoneStatusCode = CONST_doneStatusCode_done;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_info) {
    newDoneStatusCode = CONST_doneStatusCode_info;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_notice) {
    newDoneStatusCode = CONST_doneStatusCode_notice;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_okay) {
    newDoneStatusCode = CONST_doneStatusCode_okay;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_undone) {
    newDoneStatusCode = CONST_doneStatusCode_undone;
  }

  wapp.itemObj.changeDoneStatus(newDoneStatusCode);

  hidePopUp("ChangeDoneStatus");

  focus_set_fromItemId(wapp.itemObj.itemId);

  if ( isBlank(wapp.itemObj.displayedOnList_itemId) ) {
    goToItemView(null, false);
  } else {
    goToItemView(wapp.itemObj.displayedOnList_itemId, false);
  }
}

function do_make_new_type() {
  var itemName, newItemObj;

  itemName = getElemVal("ipMakeNewWibtype_WibtypeName");

  // process itemName string here, as it will be used in a comparison below
  itemName = getProcessedStringForSave(itemName);

  if ( !itemNameIsAllowed(itemName) ) {
    return;
  }

  if ( isBlank(itemName) ) {
    alert("Type Name is required");
    return;
  }

  newItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", false, itemName, null, CONST_displayCode_hidden1, "1", wapp.itemObj.itemId);
  if ( newItemObj ) {
    hidePopUp("MakeNewWibtype");
    displayPage("Wibtypes");
  }
}

function do_make_new_type_info_field() {
  var itemName, wibDataTypeId, required, newItemObj;

  itemName = getElemVal("ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
  wibDataTypeId = getElemVal("selMakeNewWibtypeInfoField_WibDataTypeId");
  required = getElemVal("ckMakeNewWibtypeInfoField_Required");

  // process itemName string here, as it will be used in a comparison below
  itemName = getProcessedStringForSave(itemName);

  if ( !itemNameIsAllowed(itemName) ) {
    return;
  }

  if ( isBlank(itemName) ) {
    alert("Info-Field Name is required");
    return;
  }

  if ( isBlank(wibDataTypeId) ) {
    alert("Data Type is required");
    return;
  }

  newItemObj = makeNewItem(CONST_doneStatusCode_okay, wibDataTypeId, required, "1", "0", false, itemName, null, CONST_displayCode_hidden1, "0", wapp.itemObj.itemId);
  if ( newItemObj ) {
    hidePopUp("MakeNewWibtypeInfoField");
    goToItemView(null, false);
  }
}

function edit_notes() {
  var editedNotes = prompt("Notes:", wapp.itemObj.notes);
  if ( isBlank(editedNotes)) {
    alert("Edit canceled because a blank Notes entry was received\n\n(click 'delete notes' if you want to remove all notes for this item)");
    return;
  }

  editedNotes = getProcessedStringForSave(editedNotes);

  wapp.itemObj.changeItemInfo(null, null, null, null, editedNotes);
  goToItemView(null, true);
}

function edit_storage_row(keyName) {
  var curKeyValue = getFromDatastore(keyName);

  elem("dvShowStorage_EditAllItemIds").style.display = "none";

  if (curKeyValue.length > 999) {
    if (keyName == CONST_stringOfAllItemIds) {
      elem("dvShowStorage_EditAllItemIds").style.display = "";
      elem("taShowStorage_EditAllItemIds").value = getFromDatastore(CONST_stringOfAllItemIds);
      elem("taShowStorage_EditAllItemIds").focus();
      return;
    } else {
      throw ("curKeyValue.length > 999, so not sure if javascript prompt box will work => exiting with error");
    }
  }

  var editedKeyValue = prompt("Change key value to:", curKeyValue);

  if ( editedKeyValue == null ) {
    return;
  }

  saveToDatastore(keyName, editedKeyValue);
  storage__show();
}

function edit_storage_row__do_all_items_edit() {
  var editedKeyValue = elem("taShowStorage_EditAllItemIds").value;

  if ( isBlank(editedKeyValue) ) {
    alert("for now, not allowing blank entry for all-item-ids");
    return;
  }

  saveToDatastore(CONST_stringOfAllItemIds, editedKeyValue);
  storage__show();
}

function edit_storage_row__cancel_all_items_edit() {
  elem("dvShowStorage_EditAllItemIds").style.display = "none";
}

function edit_time_tracking() {
  showPopUp("EditTimeTracking", "ipEditTimeTracking_EndHour");
}

function edit_time_tracking__cancel() {
  hidePopUp("EditTimeTracking");
  displayPage("ViewItem");
}

function edit_time_tracking__display_end_date() {
  elem("dvEditTimeTracking_EndDate_Link").style.display = "none";
  elem("dvEditTimeTracking_EndDate_Data_1").style.display = "";
  elem("dvEditTimeTracking_EndDate_Data_2").style.display = "";
  elem("ipEditTimeTracking_EndYear").focus();
  elem("ipEditTimeTracking_EndYear").select();
}

function edit_time_tracking__make_this_edit() {
  if ( ! wapp.wdto.isUiValid() ) {
    return;
  }

  wapp.wdto.saveToDatastore();

  hidePopUp("EditTimeTracking");
  goToItemView(null, true);
}

function export_backup_text() {
  displayPage("BackupExport");
}

function go_to_builder() {
  window.location = "index.html?builder";
}

function go_to_item(itemId) {
  goToItemView(itemId, false);
}

function go_to_list(itemId) {
  toggleGrabbing_off();
  toggleReordering_off();

  if ( !isBlank(wapp.itemObj) ) {
    focus_set_fromItemId(wapp.itemObj.itemId);
  }

  goToItemView(itemId, false);
}

function grab_items() {
  if (wapp.grabbingOn) {
    toggleGrabbing_off();
  } else {
    toggleReordering_off();
    toggleGrabbing_on();
  }
}

function home_page__view_as_regular_item() {
  goToItemView(wapp.homePageList_itemId, false);
}

function import_backup_text() {
  if ( getFromDatastore(CONST_importBlocked) == "1" ) {
    alert("OPERATION DISALLOWED\n\nImporting of text has been blocked on this device");
    return;
  }
  displayPage("BackupImport");
}

function make_into_a_list() {
  wapp.itemObj.makeIntoAList();
  goToItemView(null, false);
}

function make_new_item() {
  var hasTtWibtype = wapp.itemObj.hasWibtypeForListMembers(wapp.timeTracking_wibtypeItemId);

  if ( hasTtWibtype ) {
    showPopUp("MakeNewItemTT", "ipMakeNewItemTT_ItemName");
  } else {
    showPopUp("MakeNewItem", "ipMakeNewItem_ItemName");
  }
}

function make_new_item__cancel() {
  hidePopUp("MakeNewItem");
  goToItemView();
}

function make_new_item__display_end_date() {
  elem("dvMakeNewItem_EndDate_Link").style.display = "none";
  elem("dvMakeNewItem_EndDate_Data_1").style.display = "";
  elem("dvMakeNewItem_EndDate_Data_2").style.display = "";
  elem("ipMakeNewItem_EndYear").focus();
  elem("ipMakeNewItem_EndYear").select();
}

function make_new_item__make(makeCode) {
  var itemName, doneStatusCode = null, topOfList, stayListView, addMoreItems, timeTracking, ttUiDataObj = {}, newItemObj;

  if (makeCode == "line") {
    itemName = "--------------------";
    doneStatusCode = CONST_doneStatusCode_info
  } else {
    itemName = getElemVal("ipMakeNewItem_ItemName");

    // process itemName string here, as it will be used in a comparison below
    itemName = getProcessedStringForSave(itemName);

    if ( !itemNameIsAllowed(itemName) ) {
      elem("ipMakeNewItem_ItemName").focus();
      return;
    }
  }

  topOfList = getElemVal("ckMakeNewItem_TopOfList");
  wapp.makeNewItem_TopOfList = topOfList;

  stayListView = getElemVal("ckMakeNewItem_StayListView");
  wapp.makeNewItem_StayListView = stayListView;

  addMoreItems = getElemVal("ckMakeNewItem_AddMoreItems");
  wapp.makeNewItem_AddMoreItems = addMoreItems;

  if (makeCode == "line") {
    timeTracking = "0";
  } else {
    timeTracking = getElemVal("ckMakeNewItem_TimeTracking");
    wapp.makeNewItem_TimeTracking = timeTracking;
  }

  if ( isBlank(itemName) ) {
    alert("Item Name is required");
    elem("ipMakeNewItem_ItemName").focus();
    return;
  }

  if (timeTracking == "1") {
    if ( ! wapp.wdto.isUiValid() ) {
      return;
    }

    doneStatusCode = CONST_doneStatusCode_okay;
  }

  newItemObj = makeNewItem(doneStatusCode, null, null, "0", "0", false, itemName, null, null, "0", wapp.itemObj.itemId);
  if ( newItemObj ) {

    if (topOfList == "1") {
      walkSortPosition(wapp.itemObj, newItemObj.itemId, null, true, false, null);
    }

    if (stayListView == "0" && addMoreItems == "0") {
      setWappItemObj(newItemObj);
    }

    if (timeTracking == "1") {
      wapp.timeTracking_defaultYear = wapp.wdto.get_startYyyy();
      wapp.timeTracking_defaultMonth = wapp.wdto.get_startM();
      wapp.timeTracking_defaultDay = wapp.wdto.get_startD();

      wapp.wdto.saveToDatastore(newItemObj);
    }

    focus_set_fromItemId(newItemObj.itemId);

    hidePopUp("MakeNewItem");
    goToItemView(null, false);

    if (addMoreItems == "1") {
      showPopUp("MakeNewItem", "ipMakeNewItem_ItemName");
    }
  }
}

function make_new_item__make_line() {
  make_new_item__make("line");
}

function make_new_item_tt__cancel() {
  hidePopUp("MakeNewItemTT");
  goToItemView();
}

function make_new_item_tt__display_end_date() {
  elem("dvMakeNewItemTT_EndDate_Link").style.display = "none";
  elem("dvMakeNewItemTT_EndDate_Data_1").style.display = "";
  elem("dvMakeNewItemTT_EndDate_Data_2").style.display = "";
  elem("ipMakeNewItemTT_EndYear").focus();
  elem("ipMakeNewItemTT_EndYear").select();
}

function make_new_item_tt__make() {
  var itemName, ttUiDataObj = {}, newItemObj;

  itemName = getElemVal("ipMakeNewItemTT_ItemName");

  // process itemName string here, as it will be used in a comparison below
  itemName = getProcessedStringForSave(itemName);

  if ( !itemNameIsAllowed(itemName) ) {
    elem("ipMakeNewItemTT_ItemName").focus();
    return;
  }

  if ( isBlank(itemName) ) {
    alert("Item Name is required");
    elem("ipMakeNewItemTT_ItemName").focus();
    return;
  }

  if ( ! wapp.wdto.isUiValid() ) {
    return;
  }

  newItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", false, itemName, null, null, "0", wapp.itemObj.itemId);

  if ( newItemObj ) {

    walkSortPosition(wapp.itemObj, newItemObj.itemId, null, true, false, null);

    wapp.timeTracking_defaultYear = wapp.wdto.get_startYyyy();
    wapp.timeTracking_defaultMonth = wapp.wdto.get_startM();
    wapp.timeTracking_defaultDay = wapp.wdto.get_startD();

    wapp.wdto.saveToDatastore(newItemObj);

    focus_set_fromItemId(newItemObj.itemId);

    hidePopUp("MakeNewItemTT");
    goToItemView(null, false);

  }
}

function make_new_item_tt__switch_to_normal() {
  hidePopUp("MakeNewItemTT");
  showPopUp("MakeNewItem", "ipMakeNewItem_ItemName");
}

function make_new_list() {
  var newItemObj;

  newItemObj = makeNewItem(null, null, null, "0", "0", false, null, "new list name:", null, "1", wapp.homePageList_itemId);
  if ( newItemObj ) {
    setWappItemObj(newItemObj);
    goToItemView(null, false);
  }
}

function make_new_type() {
  showPopUp("MakeNewWibtype", "ipMakeNewWibtype_WibtypeName");
}

function make_new_type_info_field() {
  showPopUp("MakeNewWibtypeInfoField", "ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
}

function mark_all() {
  var markDirectionIsDone = false, listMemberDataObjs, i, confirmText;
  
  listMemberDataObjs = wapp.itemObj.getListMemberDataObjs();

  for (i = 0; i < listMemberDataObjs.length; i++) {
    let curItemObj = grabItemObj(listMemberDataObjs[i].itemId);

    //if we find at least one that is undone, that mark-all direction will be towards done
    if (curItemObj.doneStatusCode == CONST_doneStatusCode_undone) {
      markDirectionIsDone = true;
      break;
    }
  }

  if (markDirectionIsDone) {
    confirmText = "mark all undone items on this list as done?";
  } else {
    confirmText = "mark all done items on this list as undone?";
  }

  if ( !confirm(confirmText) ) {
    return;
  }

  wapp.itemObj.markAllListMembers(markDirectionIsDone, listMemberDataObjs);

  goToItemView(null, true);
}

function move_item_down(itemIdToMove, amount) {
  if ( walkSortPosition(wapp.itemObj, itemIdToMove, Math.abs(amount), false, false, null) ) {
    wapp.focusElemId_pre = "aViewItem_MakeNewItem2";
    goToItemView(null, true);
  }
}

function move_item_to_end(itemIdToMove) {
  if ( walkSortPosition(wapp.itemObj, itemIdToMove, null, false, true, null) ) {
    wapp.focusElemId_pre = "aViewItem_MakeNewItem2";
    goToItemView(null, true);
  }
}

function move_item_above_other_item(itemIdToMove) {
  toggleReorderingMode_moveAboveOtherItem(itemIdToMove);
}

function move_item_to_top(itemIdToMove) {
  if ( walkSortPosition(wapp.itemObj, itemIdToMove, null, true, false, null) ) {
    wapp.focusElemId_pre = "aViewItem_MakeNewItem1";
    goToItemView(null, true);
  }
}

function move_item_up(itemIdToMove, amount) {
  if ( walkSortPosition(wapp.itemObj, itemIdToMove, Math.abs(amount) * -1, false, false, null) ) {
    //wapp.focusElemId_pre = "aViewItem_MakeNewItem1";
    goToItemView(null, true);
  }
}

function move_or_copy_to_different_list() {
  wapp.grabbing_itemId1 = wapp.itemObj.itemId;
  wapp.grabbing_itemId2 = null;
  displayPage("MoveOrCopy");
}

function move_to_this_list(selectedList_itemId) {
  moveOrCopyGrabbedItems(selectedList_itemId, aO("move"))
}

function navigate__cancel() {
  goToItemView();
}

function navigate__connect_to_item(itemId2) {
  if ( isEqual(wapp.itemObj.itemId, itemId2) ) {
    alert("Can't connect an item to itself --- please choose a different item or list");
    return;
  }

  if ( wapp.itemObj.connectToItem(itemId2, true) ) {
    goToItemView();
  }
}

function rename_item() {
  var editedItemName = prompt("Change item name to:", wapp.itemObj.itemName);
  if ( isBlank(editedItemName) ) return;

  editedItemName = getProcessedStringForSave(editedItemName);

  if ( wapp.itemObj.changeItemInfo(editedItemName, null, null, null, null) ) {
    goToItemView(null, true);
  }
}

function remove_time_tracking() {
  if ( ! confirm("Remove " + CONST_timeTracking_itemName + " info?") ) {
    return;
  }

  wapp.itemObj.removeWibtype(wapp.timeTracking_wibtypeItemId);

  hidePopUp("AddTimeTracking");
  goToItemView(null, true);
}

function return_home() {
  if (!wapp.wappDataLoadedSuccessfully) loadAppData_andReturnNextDisplayPage();
  setWappItemObj(grabItemObjByName(CONST_listName_homePage));
  displayPage("Home");
}

function return_home_from_storage() {
  loadAppData_andReturnNextDisplayPage();
  displayPage("Home");
}

function run_screen__back_to_app() {
  wapp.wb_curApp_itemObj = wapp.runningApp_itemObj;
  wapp.runningApp_itemObj = null;
  displayPage("WibBuilder_ViewApp");
}

function run_screen__build_this_screen() {
  displayPage("WibBuilder_BuildScreen");
}

function run_screen__go_to_all_screens() {
  wapp.wb_curScreen_itemObj = null;
  displayPage("WibBuilder_AllScreens");
}

function run_screen__save_new_item() {
  var wibtypeItemObj_associatedWithScreen = wb_getWibtypeItemObj_associatedWithScreen(wapp.wb_curScreen_itemObj);

  var typeInstance_itemName = elem("ipWibBuilder_RunScreen_ItemNameValue").value;
  if ( isBlank(typeInstance_itemName) ) {
    alert(wibtypeItemObj_associatedWithScreen.itemName + " Name is required");
    elem("ipWibBuilder_RunScreen_ItemNameValue").focus();
    return;
  }

  var wibtypeInstanceHolderList_itemObj = wb_getWibtypeInstanceHolderList_itemObj(wibtypeItemObj_associatedWithScreen.itemId)

  // if the wibtype-holder-instance-list does not exist yet, create it
  if (!wibtypeInstanceHolderList_itemObj) {
    let itemName = wb_generateWibtypeInstanceHolderList_itemName(wibtypeItemObj_associatedWithScreen.itemId);
    wibtypeInstanceHolderList_itemObj = makeNewItem(null, null, null, "0", "0", false, itemName, null, CONST_displayCode_hidden1, "1", wapp.wb_listOfWibtypeInstanceHolderLists_itemId);
    wibtypeInstanceHolderList_itemObj.assignToWibtype(wapp.wb_wibtypeInstanceHolderWibtype_itemId);
    //TO-DO2: if the wibtypeItemObj_associatedWithScreen has wtifs, we might need/want to set their values here
  }

  // create the wibtype-instance and assign to the wibtype
  var typeInstance_itemObj = makeNewItem(null, null, null, "0", "0", false, typeInstance_itemName, null, CONST_displayCode_hidden1, "0", wibtypeInstanceHolderList_itemObj.itemId);
  typeInstance_itemObj.assignToWibtype(wibtypeItemObj_associatedWithScreen.itemId);


//TO-DO1.5:
//go to the list of items of this type, related to the builder screen, with the newly-created item highlighted?
wapp.wb_curWibtype_itemObj = wibtypeItemObj_associatedWithScreen;
displayPage("WibBuilder_ShowWibtypeInstances");
}

function set_ymd_to_today() {
//TO-DO1.5: need to change this to handle start vs end YMD
alert("--- incomplete ---")
return
  setElemsToToday("ipMakeNewItem_EndYear", "ipMakeNewItem_EndMonth", "ipMakeNewItem_EndDay");
}

function show_dev_screen() {
  displayPage("Dev");
}

function show_instances__delete(itemId) {
  var itemObj = grabItemObj(itemId);

  if ( !confirm("Delete item '" + itemObj.itemName + "' ?" ) ) {
    return;
  }

  if ( itemObj.doDeletion(null) ) {
    displayPage("WibBuilder_ShowWibtypeInstances");
  } else {
    // for now, will refresh the all-screens page, even if there was an error during the screen-deletion process
    displayPage("WibBuilder_ShowWibtypeInstances");
  }
}

function show_instances__edit(itemId) {
da("edit function incomplete...");
}

function show_instances__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function show_instances__run_screen_again() {
  displayPage("WibBuilder_RunScreen");
}

function show_types() {
  displayPage("Wibtypes");
}

function storage__add_row() {
  var keyName = prompt("New key name:", "");
  var keyValue = prompt("New key value:", "");

  if ( isBlank(keyName) ) {
    return;
  }

  saveToDatastore(keyName, keyValue);
  storage__show();
}

function storage__refresh() {
  displayPage("ShowStorage");
}

function storage__show() {
  displayPage("ShowStorage");
}

function toggle_wibapp_narrow() {
  var curWibappppNarrow, newWibappppNarrow;

  curWibappppNarrow = getFromDatastore(CONST_wibapp_narrow);

  if ( curWibappppNarrow == "1" ) {
    newWibappppNarrow = "0";
  } else {
    newWibappppNarrow = "1";
  }

  saveToDatastore(CONST_wibapp_narrow, newWibappppNarrow);

  alert(CONST_wibapp_narrow + " set to " + newWibappppNarrow);
}

function toggle_wibapp_dev() {
  var curDev1, newDev1;

  curDev1 = getFromDatastore(CONST_wibapp_dev1);

  if (curDev1 == "1") {
    newDev1 = "0";
  } else {
    newDev1 = "1";
  }

  saveToDatastore(CONST_wibapp_dev1, newDev1);

  alert(CONST_wibapp_dev1 + " set to " + newDev1);
}

function toggle_import_blocked() {
  var curImportBlocked, newImportBlocked;

  curImportBlocked = getFromDatastore(CONST_importBlocked);

  if ( curImportBlocked == "1" ) {
    newImportBlocked = "0";
  } else {
    newImportBlocked = "1";
  }

  saveToDatastore(CONST_importBlocked, newImportBlocked);

  alert("importBlocked set to " + newImportBlocked);
}

function toggle_more_options() {
  if (wapp.moreOptionsOn) {
    toggleGrabbing_off();
    elem("dvMoreOptions1").style.display = "none";
    elem("dvMoreOptions2").style.display = "none";
    elem("aMoreOptions1").innerHTML = "more...";
    elem("aMoreOptions2").innerHTML = "more...";
    wapp.moreOptionsOn = false;
  } else {
    elem("dvMoreOptions1").style.display = "";
    elem("dvMoreOptions2").style.display = "";
    elem("aMoreOptions1").innerHTML = "less...";
    elem("aMoreOptions2").innerHTML = "less...";
    wapp.moreOptionsOn = true;
  }
}

function toggle_reorder() {
  if (wapp.reorderingOn) {
    toggleReordering_off();
  } else {
    toggleGrabbing_off();
    toggleReordering_on()
  }
}

function view_app__go_to_all_apps() {
  displayPage("WibBuilder_AllApps");
}

function view_app__run_app() {
  wb_app_run(wapp.wb_curApp_itemObj);
}

function view_item__add_time_tracking() {
  showPopUp("AddTimeTracking", "ipAddTimeTracking_StartHour");
}

function view_item__add_type_for_list_members() {
  displayPage("ChooseWibtype")
}


///// FUNCTIONS TO LOAD & UPGRADE APP-LEVEL DATA FROM STORAGE

function loadAppData_andReturnNextDisplayPage() {
  var homePageListItemObj, wibtypesItemObj, timeTracking_wibtypeItemObj;
  var wibBuilderScreen_wibtypeItemObj, wibBuilderScreenList_itemObj;
  var wibBuilderScreenBox_wibtypeItemObj;
  var wibBuilderScript_wibtypeItemObj, wb_scriptList_itemObj;
  var wibBuilderScriptRow_wibtypeItemObj;
  var wibBuilderApp_wibtypeItemObj, wb_appList_itemObj;

  var wb_listOfWibtypeInstanceHolderLists_itemObj, wb_wibtypeInstanceHolderWibtype_itemObj;  // OLD-ISH

  wapp.wappDataLoadedSuccessfully = false;

  /* home-page-list item */ {
    homePageListItemObj = grabItemObjByName(CONST_listName_homePage);
    if ( isBlank(homePageListItemObj) ) {
      homePageListItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_listName_homePage, null, CONST_displayCode_hidden1, "1", null);
    }
    wapp.homePageList_itemId = homePageListItemObj.itemId;
  }

  /* wibtypes item */ {
    wibtypesItemObj = grabItemObjByName(CONST_listName_wibtypes);
    if ( isBlank(wibtypesItemObj) ) {
      wibtypesItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_listName_wibtypes, null, CONST_displayCode_hidden1, "1", null);
    }
    wapp.wibtypes_itemId = wibtypesItemObj.itemId;
  }

  /* Time-Tracking wibtype and its wtifs */ {
    timeTracking_wibtypeItemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_itemName, wapp.wibtypes_itemId, true);
    if ( isBlank(timeTracking_wibtypeItemObj) ) {
      timeTracking_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_timeTracking_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
    }
    wapp.timeTracking_wibtypeItemId = timeTracking_wibtypeItemObj.itemId;

    let ttWtif_endYMD_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_wtifEndYMD_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_endYMD_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_date_id, "1", "1", "0", true, CONST_timeTracking_wtifEndYMD_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId); 
    }

    let ttWtif_EndTime_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_wtifEndTime_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_EndTime_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_timeOfDay_id, "1", "1", "0", true, CONST_timeTracking_wtifEndTime_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId);
    }

    let ttWtif_MinsTracked_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_wtifMinsTracked_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_MinsTracked_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "1", "1", "0", true, CONST_timeTracking_wtifMinsTracked_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId);
    }

    let ttWtif_startYMD_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_wtifStartYMD_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_startYMD_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_date_id, "1", "1", "0", true, CONST_timeTracking_wtifStartYMD_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId); 
    }

    let ttWtif_StartTime_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_timeTracking_wtifStartTime_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_StartTime_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_timeOfDay_id, "1", "1", "0", true, CONST_timeTracking_wtifStartTime_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId);
    }
  }

  /* Wib-Builder Screens, Scripts, & Apps */ {

    /* Wib-Builder Screens */ {

      // wibtype for Wib-Builder Screens
      wibBuilderScreen_wibtypeItemObj = grabItemObjByName(CONST_wb_screenWibtype_itemName);
      if ( isBlank(wibBuilderScreen_wibtypeItemObj) ) {
        wibBuilderScreen_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_screenWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
      }
      wapp.wb_screenWibtype_itemId = wibBuilderScreen_wibtypeItemObj.itemId;

      // wtif for Wib-Builder Screens -- WbAppItemId
      let wb_screenWibtype_wtif_WbAppItemId_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreen_wibtypeItemObj.itemId, CONST_wb_screenWibtype_wtif_WbAppItemId_itemName, true)
      if ( isBlank(wb_screenWibtype_wtif_WbAppItemId_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenWibtype_wtif_WbAppItemId_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder Screens -- NumColumns
      let wb_screenWibtype_wtif_NumColumns_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreen_wibtypeItemObj.itemId, CONST_wb_screenWibtype_wtif_NumColumns_itemName)
      if ( isBlank(wb_screenWibtype_wtif_NumColumns_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenWibtype_wtif_NumColumns_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder Screens -- NumRows
      let wb_screenWibtype_wtif_NumRows_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreen_wibtypeItemObj.itemId, CONST_wb_screenWibtype_wtif_NumRows_itemName)
      if ( isBlank(wb_screenWibtype_wtif_NumRows_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenWibtype_wtif_NumRows_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
      }

      // item that is the list of Wib-Builder Screens
      wibBuilderScreenList_itemObj = grabItemObjByName(CONST_wb_screenList_itemName);
      if ( isBlank(wibBuilderScreenList_itemObj) ) {
        wibBuilderScreenList_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wb_screenList_itemName, null, CONST_displayCode_hidden1, "1", null);
      }
      wapp.wb_screenListItemId = wibBuilderScreenList_itemObj.itemId;

      // wibtype for Wib-Builder ScreenBoxes
      wibBuilderScreenBox_wibtypeItemObj = grabItemObjByName(CONST_wb_screenBoxWibtype_itemName);
      if ( isBlank(wibBuilderScreenBox_wibtypeItemObj) ) {
        wibBuilderScreenBox_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_screenBoxWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
      }
      wapp.wb_screenBoxWibtype_itemId = wibBuilderScreenBox_wibtypeItemObj.itemId;

      // wtif for Wib-Builder ScreenBoxes -- StartColumn
      let wb_screenBoxWibtype_wtif_StartColumn_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_StartColumn_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_StartColumn_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_StartColumn_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScreenBoxes -- StartRow
      let wb_screenBoxWibtype_wtif_StartRow_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_StartRow_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_StartRow_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_StartRow_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScreenBoxes -- BoxesAcross
      let wb_screenBoxWibtype_wtif_BoxesAcross_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_BoxesAcross_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_BoxesAcross_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_BoxesAcross_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScreenBoxes -- BoxesDown
      let wb_screenBoxWibtype_wtif_BoxesDown_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_BoxesDown_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_BoxesDown_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_BoxesDown_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScreenBoxes -- ContentTypeCode
      let wb_screenBoxWibtype_wtif_ContentTypeCode_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_ContentTypeCode_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_ContentTypeCode_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_ContentTypeCode_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScreenBoxes -- ContentData
      let wb_screenBoxWibtype_wtif_ContentData_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScreenBox_wibtypeItemObj.itemId, CONST_wb_screenBoxWibtype_wtif_ContentData_itemName)
      if ( isBlank(wb_screenBoxWibtype_wtif_ContentData_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_screenBoxWibtype_wtif_ContentData_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreenBox_wibtypeItemObj.itemId); 
      }
    }

    /* Wib-Builder Scripts */ {

      // wibtype for Wib-Builder Scripts
      wibBuilderScript_wibtypeItemObj = grabItemObjByName(CONST_wb_scriptWibtype_itemName);
      if ( isBlank(wibBuilderScript_wibtypeItemObj) ) {
        wibBuilderScript_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_scriptWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
      }
      wapp.wb_scriptWibtype_itemId = wibBuilderScript_wibtypeItemObj.itemId;

      // wtif for Wib-Builder Script -- WbAppItemId
      let wb_scriptWibtype_wtif_WbAppItemId_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScript_wibtypeItemObj.itemId, CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName)
      if ( isBlank(wb_scriptWibtype_wtif_WbAppItemId_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScript_wibtypeItemObj.itemId); 
      }

      // item that is the list of Wib-Builder Scripts
      wb_scriptList_itemObj = grabItemObjByName(CONST_wb_scriptList_itemName);
      if ( isBlank(wb_scriptList_itemObj) ) {
        wb_scriptList_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wb_scriptList_itemName, null, CONST_displayCode_hidden1, "1", null);
      }
      wapp.wb_scriptListItemId = wb_scriptList_itemObj.itemId;

      // wibtype for Wib-Builder ScriptRows
      wibBuilderScriptRow_wibtypeItemObj = grabItemObjByName(CONST_wb_scriptRowWibtype_itemName);
      if ( isBlank(wibBuilderScriptRow_wibtypeItemObj) ) {
        wibBuilderScriptRow_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_scriptRowWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
      }
      wapp.wb_scriptRowWibtype_itemId = wibBuilderScriptRow_wibtypeItemObj.itemId;

      // wtif for Wib-Builder ScriptRows -- RowNum
      let wb_scriptRowWibtype_wtif_RowNum_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScriptRow_wibtypeItemObj.itemId, CONST_wb_scriptRowWibtype_wtif_RowNum_itemName)
      if ( isBlank(wb_scriptRowWibtype_wtif_RowNum_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_scriptRowWibtype_wtif_RowNum_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScriptRow_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScriptRows -- ActionCode
      let wb_scriptRowWibtype_wtif_ActionCode_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScriptRow_wibtypeItemObj.itemId, CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName)
      if ( isBlank(wb_scriptRowWibtype_wtif_ActionCode_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_text_id, "0", "1", "0", true, CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScriptRow_wibtypeItemObj.itemId); 
      }

      // wtif for Wib-Builder ScriptRows -- ActionData
      let wb_scriptRowWibtype_wtif_ActionData_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderScriptRow_wibtypeItemObj.itemId, CONST_wb_scriptRowWibtype_wtif_ActionData_itemName)
      if ( isBlank(wb_scriptRowWibtype_wtif_ActionData_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_scriptRowWibtype_wtif_ActionData_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScriptRow_wibtypeItemObj.itemId); 
      }
    }

    /* Wib-Builder Apps */ {

      // wibtype for Wib-Builder Apps
      wibBuilderApp_wibtypeItemObj = grabItemObjByName(CONST_wb_appWibtype_itemName);
      if ( isBlank(wibBuilderApp_wibtypeItemObj) ) {
        wibBuilderApp_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_appWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
      }
      wapp.wb_appWibtype_itemId = wibBuilderApp_wibtypeItemObj.itemId;

      // wtif for Wib-Builder Apps -- FirstScriptItemId
      let wb_appWibtype_wtif_FirstScriptItemId_itemObj = grabItemObj__listItemId_and_memberItemName(wibBuilderApp_wibtypeItemObj.itemId, CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName)
      if ( isBlank(wb_appWibtype_wtif_FirstScriptItemId_itemObj) ) {
        makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderApp_wibtypeItemObj.itemId); 
      }

      // item that is the list of Wib-Builder Apps
      wb_appList_itemObj = grabItemObjByName(CONST_wb_appList_itemName);
      if ( isBlank(wb_appList_itemObj) ) {
        wb_appList_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wb_appList_itemName, null, CONST_displayCode_hidden1, "1", null);
      }
      wapp.wb_appListItemId = wb_appList_itemObj.itemId;

      // if no apps exist, create a starter one
      if ( !wb_appList_itemObj.hasListMembers() ) {
        //TO-DO1.5: ?? move "starter app" stuff here (keep out of wb_app_create function) ??
        /////let starterApp = wb_app_create("My Starter App");
      }
    }
  }

  /* (blank section to copy for new stuff) */ {
    
  }

  /* OLD-ISH? -- previous wb-screen wtifs */ {
    let wbs_ScreenTypeCode_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_wbs_screenWtifs_screenTypeCode_itemName, wibBuilderScreen_wibtypeItemObj.itemId, true);
    if ( isBlank(wbs_ScreenTypeCode_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wbs_screenWtifs_screenTypeCode_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
    }

    let wbs_wibtypeItemId_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName, wibBuilderScreen_wibtypeItemObj.itemId, true);
    if ( isBlank(wbs_wibtypeItemId_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wbs_screenWtifs_wibtypeItemId_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
    }
  }

  /* OLD-ISH? -- the wb-list-of-wibtype-instance-holder-lists item, the wibtype-instance-holder wibtype, and associated wtif */ {
    wb_listOfWibtypeInstanceHolderLists_itemObj = grabItemObjByName(CONST_wb_listOfWibtypeInstanceHolderLists_itemName);
    if ( isBlank(wb_listOfWibtypeInstanceHolderLists_itemObj) ) {
      wb_listOfWibtypeInstanceHolderLists_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wb_listOfWibtypeInstanceHolderLists_itemName, null, CONST_displayCode_hidden1, "1", null);
    }
    wapp.wb_listOfWibtypeInstanceHolderLists_itemId = wb_listOfWibtypeInstanceHolderLists_itemObj.itemId;

    wb_wibtypeInstanceHolderWibtype_itemObj = searchForItemObj_OLD(null, null, null, null, null, null, CONST_wb_wibtypeInstanceHolderWibtype_itemName, wapp.wibtypes_itemId, true);
    if ( isBlank(wb_wibtypeInstanceHolderWibtype_itemObj) ) {
      wb_wibtypeInstanceHolderWibtype_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_wibtypeInstanceHolderWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
    }
    wapp.wb_wibtypeInstanceHolderWibtype_itemId = wb_wibtypeInstanceHolderWibtype_itemObj.itemId;

    let wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId = searchForItemObj_OLD(null, null, null, null, null, null, CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, wb_wibtypeInstanceHolderWibtype_itemObj.itemId, true);
    if ( isBlank(wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "1", "1", "0", true, CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, null, CONST_displayCode_hidden1, "0", wb_wibtypeInstanceHolderWibtype_itemObj.itemId); 
    }
  }

  setWappItemObj(homePageListItemObj);

  if ( ! upgradeStoredData() ) return;

  elem("spnAppHeader_AppNameAndVersion").innerHTML = "wib v" + CONST_wibappVersion;

  wapp.wappDataLoadedSuccessfully = true;

  if (wapp.qs_obj.wibBuilder) {


//TO-DO1.5: go to first wb-app, etc

    return "WibBuilder_AllApps";
  } else {
    return "Home";
  }
}




//TO-DO1.5:


const CONST_wb_screen_contentTypeCode_clicky = "300";
const CONST_wb_screen_contentTypeCode_heading = "120";
const CONST_wb_screen_contentTypeCode_input = "200";
const CONST_wb_screen_contentTypeCode_text = "100";


///////////////

function DEV_deleteNewWbWappData() {
  deleteItem__joinedList_and_itemName(wapp.wb_scriptRowWibtype_itemId, CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_scriptRowWibtype_itemId, CONST_wb_scriptRowWibtype_wtif_ActionData_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_scriptRowWibtype_itemId, CONST_wb_scriptRowWibtype_wtif_RowNum_itemName);

  deleteItem(wapp.wb_scriptRowWibtype_itemId, true, null);

  deleteItem__joinedList_and_itemName(wapp.wb_scriptWibtype_itemId, CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName);

  deleteItem(wapp.wb_scriptWibtype_itemId, true, null);

  deleteItem(wapp.wb_scriptListItemId, true, null);

  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_BoxesAcross_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_BoxesDown_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_ContentData_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_ContentTypeCode_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_StartColumn_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenBoxWibtype_itemId, CONST_wb_screenBoxWibtype_wtif_StartRow_itemName);

  deleteItem(wapp.wb_screenBoxWibtype_itemId, true, null);

  deleteItem__joinedList_and_itemName(wapp.wb_screenWibtype_itemId, CONST_wb_screenWibtype_wtif_NumColumns_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenWibtype_itemId, CONST_wb_screenWibtype_wtif_NumRows_itemName);
  deleteItem__joinedList_and_itemName(wapp.wb_screenWibtype_itemId, CONST_wb_screenWibtype_wtif_WbAppItemId_itemName);

  deleteItem__joinedList_and_itemName(wapp.wb_appWibtype_itemId, CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName);

  deleteItem(wapp.wb_appWibtype_itemId, true, null);

  deleteItem(wapp.wb_appListItemId, true, null);

  return "DEV_deleteNewWbWappData() ran successfully";
}

function DEV_deleteStarterWb() {
  if ( DEV_wb_screen_deleteByName("Home Screen for My Starter App") ) {
    if ( DEV_wb_scriptRow_deleteByScriptName("first script for app") ) {
      if ( DEV_wb_script_deleteByName("first script for app") ) {
        if ( DEV_wb_app_deleteByName("My Starter App") ) {
          return "DEV_deleteStarterWb() ran successfully";
        }
      }
    }
  }
}

/*
function DEV_wb_app_deleteByName(appItemName) {
  var app_itemObj = grabItemObj__listItemId_and_memberItemName(wapp.wb_appListItemId, appItemName);
  var app_itemId = app_itemObj.itemId;
  app_itemObj.doDeletion(null);
  dc_("app_itemId=" + app_itemId + " was deleted");
  return true;
}

function DEV_wb_screen_deleteByName(screenItemName) {
  var screen_itemObj = grabItemObj__listItemId_and_memberItemName(wapp.wb_screenListItemId , screenItemName);
  var screen_itemId = screen_itemObj.itemId;
  screen_itemObj.doDeletion(null);
  dc_("screen_itemId=" + screen_itemId + " was deleted");
  return true;
}

function DEV_wb_script_deleteByName(scriptItemName) {
  var script_itemObj = grabItemObj__listItemId_and_memberItemName(wapp.wb_scriptListItemId , scriptItemName);
  var script_itemId = script_itemObj.itemId;
  script_itemObj.doDeletion(null);
  dc_("script_itemId=" + script_itemId + " was deleted");
  return true;
}

function DEV_wb_scriptRow_deleteByScriptName(scriptItemName) {
  var script_itemObj = grabItemObj__listItemId_and_memberItemName(wapp.wb_scriptListItemId , scriptItemName);
  var script_itemId = script_itemObj.itemId;
  var scriptRows_array = script_itemObj.getListMemberItemIds();
  scriptRows_array.forEach( (scriptRow_itemId) => {
    let scriptRow_itemObj = grabItemObj(scriptRow_itemId);
    scriptRow_itemObj.doDeletion(null);
    dc_("scriptRow_itemId=" + scriptRow_itemId + " was deleted");
  } );
  return true;
}
*/

///////////////


function wb_app_create(appItemName) {

  // don't allow duplicate app name
  var checkForExisting = grabItemObj__listItemId_and_memberItemName(wapp.wb_appListItemId, appItemName)
  if (checkForExisting) {
    alert("Cannot create new app named '" + appItemName + "' -- an app with that name already exists");
    return null;
  }

  // create app item
  var app_itemObj = makeNewItem(null, null, null, null, null, null, appItemName, null, null, null, wapp.wb_appListItemId);

  // create home-screen
  var homeScreenForApp_itemObj = wb_screen_create(app_itemObj.itemId, "Home Screen", 1, 2, null, null);
  wb_screenBox_create(homeScreenForApp_itemObj.itemId, 1, 1, 1, 1, CONST_wb_screen_contentTypeCode_heading, "Home Screen for My Starter App")
  wb_screenBox_create(homeScreenForApp_itemObj.itemId, 1, 2, 1, 1, CONST_wb_screen_contentTypeCode_text, "(other stuff goes here)")

  // create first/loading script
  var firstScriptForApp_itemObj = wb_script_create(app_itemObj.itemId, "loading script");
  wb_scriptRow_create(firstScriptForApp_itemObj.itemId, "1", CONST_wb_script_actionCode_displayScreen, homeScreenForApp_itemObj.itemId)

  // set the the first/loading script for the app item
  app_itemObj.setWibtypeAndWtifs(wapp.wb_appWibtype_itemId, CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName, firstScriptForApp_itemObj.itemId)

  // all done -- return the app item-object to the calling function
  return app_itemObj;
}

function wb_app_delete(appItemObj) {
  var scriptItemObjs_forApp = grabAllItemObjs__wtifItemName_and_wibtypeItemId_and_wtifTheData(CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName, wapp.wb_scriptWibtype_itemId, appItemObj.itemId)
  scriptItemObjs_forApp.forEach( (scriptItemObj) => {
    if ( !wb_script_delete(scriptItemObj) ) {
      return false;
    }
  } );

  var screenItemObjs_forApp = grabAllItemObjs__wtifItemName_and_wibtypeItemId_and_wtifTheData(CONST_wb_screenWibtype_wtif_WbAppItemId_itemName, wapp.wb_screenWibtype_itemId, appItemObj.itemId)
  screenItemObjs_forApp.forEach( (screenItemObj) => {
    if ( !wb_screen_delete(screenItemObj) ) {
      return false;
    }
  } );

  var deletionSucess = appItemObj.doDeletion(null);
  return deletionSucess;
}

function wb_app_run(appItemObj) {
  wapp.runningApp_itemObj = appItemObj;

  var firstScriptItemId = wapp.runningApp_itemObj.getWtifData(wapp.wb_appWibtype_itemId, null, CONST_wb_appWibtype_wtif_FirstScriptItemId_itemName);
  var firstScriptItemObj = grabItemObj(firstScriptItemId);

  wb_script_run(firstScriptItemObj);
}

function wb_screen_create(appItemId, screenItemName, numColumns, numRows, screenTypeCode, wibtypeItemObj_associatedWithScreen_itemId) {
  var screen_itemObj;

  if ( isBlank(screenItemName) ) {
    screenItemName = wb_generateScreenItemName(screenTypeCode, wibtypeItemObj_associatedWithScreen_itemId);
  }

  screen_itemObj = makeNewItem(null, null, null, "0", "0", false, screenItemName, null, CONST_displayCode_hidden1, "0", wapp.wb_screenListItemId);

  if (!screen_itemObj) {
    return null;
  }

  screen_itemObj.setWibtypeAndWtifs(wapp.wb_screenWibtype_itemId, CONST_wb_screenWibtype_wtif_WbAppItemId_itemName, appItemId
    , CONST_wb_screenWibtype_wtif_NumColumns_itemName, numColumns, CONST_wb_screenWibtype_wtif_NumRows_itemName, numRows)

  if ( !isBlank(screenTypeCode) ) {
    screen_itemObj.setWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_screenTypeCode_itemName, screenTypeCode, true);
    screen_itemObj.setWtifData(wapp.wb_screenWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName, wibtypeItemObj_associatedWithScreen_itemId, true);
  }

  return screen_itemObj;
}

function wb_screen_delete(screenItemObj) {
  var screenBoxItemIds = screenItemObj.getListMemberItemIds();

  screenBoxItemIds.forEach( (screenBoxItemId) => {
    let screenBoxItemObj = grabItemObj(screenBoxItemId);
    if ( !wb_screenBox_delete(screenBoxItemObj) ) {
      return false;
    }
  } );

  var deletionSucess = screenItemObj.doDeletion(null);
  return deletionSucess;
}

function wb_screenBox_create(screenItemId, startColumn, startRow, boxesAcross, boxesDown, contentTypeCode, contentData) {
  var screenBoxItemName = wb_screenBox_generateItemName(startColumn, startRow);

  var screenBox_itemObj = makeNewItem(null, null, null, null, null, null, screenBoxItemName, null, null, null, screenItemId);

  screenBox_itemObj.setWibtypeAndWtifs( wapp.wb_screenBoxWibtype_itemId
    , CONST_wb_screenBoxWibtype_wtif_StartColumn_itemName, startColumn
    , CONST_wb_screenBoxWibtype_wtif_StartRow_itemName, startRow
    , CONST_wb_screenBoxWibtype_wtif_BoxesAcross_itemName, boxesAcross
    , CONST_wb_screenBoxWibtype_wtif_BoxesDown_itemName, boxesDown
    , CONST_wb_screenBoxWibtype_wtif_ContentTypeCode_itemName, contentTypeCode
    , CONST_wb_screenBoxWibtype_wtif_ContentData_itemName, contentData
  );

  return screenBox_itemObj;
}

function wb_screenBox_delete(screenBoxItemObj) {
  var deletionSucess = screenBoxItemObj.doDeletion(null);
  return deletionSucess;
}

function wb_screenBox_generateItemName(startColumn, startRow) {
  var itemName = "screen box " + startColumn + ", " + startRow;
  return itemName
}

function wb_script_create(appItemId, scriptItemName) {
  var script_itemObj = makeNewItem(null, null, null, null, null, null, scriptItemName, null, null, "1", wapp.wb_scriptListItemId);

  script_itemObj.setWibtypeAndWtifs(wapp.wb_scriptWibtype_itemId, CONST_wb_scriptWibtype_wtif_WbAppItemId_itemName, appItemId)

  return script_itemObj;
}

function wb_script_delete(scriptItemObj) {
  var scriptRowItemIds = scriptItemObj.getListMemberItemIds();

  scriptRowItemIds.forEach( (scriptRowItemId) => {
    let scriptRowItemObj = grabItemObj(scriptRowItemId);
    if ( !wb_scriptRow_delete(scriptRowItemObj) ) {
      return false;
    }
  } );

  var deletionSucess = scriptItemObj.doDeletion(null);
  return deletionSucess;
}

function wb_script_doAction(actionCode, actionData) {
  switch (actionCode) {
    case CONST_wb_script_actionCode_displayScreen:
      wapp.wb_curScreen_itemObj = grabItemObj(actionData);
      displayPage("WibBuilder_RunScreen");
      break;

    default:
      showSoftError("wb_script_doAction()", "invalid actionCode (" + actionCode + ") with actionData='" + actionData + "'");
      return false;
  }

  return true;
}

function wb_script_getActionDisplay(actionCode) {
  switch (actionCode) {

    case CONST_wb_script_actionCode_displayScreen:
      return "display screen";

    default:
      showSoftError("wb_script_getActionDisplay()", "received invalid actionCode=" + actionCode);
      return null;
  }
}

function wb_script_getNextRowNum(scriptItemId) {
//TO-DO1.5:
return "1";
}

function wb_script_run(scriptItemObj) {
  var scriptRows_itemObjs = scriptItemObj.getListMemberItemObjs();

  scriptRows_itemObjs.sort( sorting_objs(CONST_wb_scriptRowWibtype_wtif_RowNum_itemName) );

  for (var i = 0; i < scriptRows_itemObjs.length; i++) {
    let actionCode = scriptRows_itemObjs[i].getWtifData(wapp.wb_scriptRowWibtype_itemId, null, CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName);
    let actionData = scriptRows_itemObjs[i].getWtifData(wapp.wb_scriptRowWibtype_itemId, null, CONST_wb_scriptRowWibtype_wtif_ActionData_itemName);
    wb_script_doAction(actionCode, actionData);
  }
}

function wb_scriptRow_create(scriptItemId, rowNum, actionCode, actionData) {
  var scriptRowItemName = wb_scriptRow_generateItemName(actionCode, actionData);

  var scriptRow_itemObj = makeNewItem(null, null, null, null, null, null, scriptRowItemName, null, null, null, scriptItemId);

  if ( isBlank(rowNum) ) {
    rowNum = wb_script_getNextRowNum(scriptItemId);
  }

  scriptRow_itemObj.setWibtypeAndWtifs(wapp.wb_scriptRowWibtype_itemId, CONST_wb_scriptRowWibtype_wtif_RowNum_itemName, rowNum
    , CONST_wb_scriptRowWibtype_wtif_ActionCode_itemName, actionCode, CONST_wb_scriptRowWibtype_wtif_ActionData_itemName, actionData);

  return scriptRow_itemObj;
}

function wb_scriptRow_delete(scriptRowItemObj) {
  var deletionSucess = scriptRowItemObj.doDeletion(null);
  return deletionSucess;
}

function wb_scriptRow_generateItemName(actionCode, actionData) {
  var itemName;

  switch (actionCode) {

    case CONST_wb_script_actionCode_displayScreen:
      itemName = "display screen ";

      let displayScreenItemObj = grabItemObj(actionData);

      if (displayScreenItemObj) {
        itemName += displayScreenItemObj.itemName;
      } else {
        itemName += "INVALID_SCREEN (actionData=" + actionData + ")";
      }

      break;

    default:
      showSoftError("wb_scriptRow_generateItemName()", "received invalid actionCode=" + actionCode);
      return null;
  }

  return itemName
}





function upgradeStoredData() {
  var appVersion_array, appVersion_major, appVersion_minor;
  var storedDataVersion_string, storedDataVersion_array, storedDataVersion_major, storedDataVersion_minor;

  //split app-version into major and minor
  appVersion_array = CONST_wibappVersion.split(".");
  appVersion_major = Number(appVersion_array[0]);
  appVersion_minor = Number(appVersion_array[1]);

  //establish existing version of the stored data
  storedDataVersion_string = getFromDatastore(CONST_storedDataVersion);
  if ( isBlank(storedDataVersion_string) ) storedDataVersion_string = "0.0";
  
  //split stored-data-version into major and minor
  storedDataVersion_array = storedDataVersion_string.split(".");
  storedDataVersion_major =  Number(storedDataVersion_array[0]);
  storedDataVersion_minor =  Number(storedDataVersion_array[1]);

  //warning if major version differs
  if ( !isEqual(appVersion_major, storedDataVersion_major) ) {
    alert("WARNING: app version is " + appVersion_major + ", stored data version is " + storedDataVersion_major + " ... no automatic data update available yet for major version upgrades");
    return false;
  }

  /* old stored-data upgrades, may not be compatible with existing loadAppData_andReturnNextDisplayPage() code, keeping for future reference */ {
    /*
    if (parseInt(appVersion_minor) >= 66 && parseInt(storedDataVersion_minor) < 66) {
      if ( upgradeStoredData_0_66() ) {
        // no action -- continue with function
      } else {
        return false;
      }
    }
    */
  }

  // if stored-data-version wasn't set from upgrade, and does not exist, set it to the current app-version
  storedDataVersion_string = getFromDatastore(CONST_storedDataVersion);
  if ( isBlank(storedDataVersion_string) ) saveToDatastore(CONST_storedDataVersion, CONST_wibappVersion);

  return true;
}

function upgradeStoredData_0_66() {
  var allItemIds_array;

  allItemIds_array = getAllItemsArray();
 
  //cycle through all items, swapping displayCode 0 and 1 for each other
  allItemIds_array.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);

    let isHomePageList = isEqual(curItemObj.itemId, wapp.homePageList_itemId);
    let isTypesList = isEqual(curItemObj.itemId, CONST_listName_wibtypes);

    if ( isHomePageList || isTypesList || curItemObj.isWibtype == "1" || curItemObj.isWibtypeInfoField == "1" ) {
      //except don't swap for home-page-list, types, wib-types, and wib-type-info-fields
      curItemObj.displayCode = CONST_displayCode_hidden1;
    } else if (curItemObj.displayCode == "1") {
      curItemObj.displayCode = "0";
    } else if (curItemObj.displayCode == "0") {
      curItemObj.displayCode = "1";
    } else {
      curItemObj.displayCode = CONST_displayCode_normal;
    }

    curItemObj.saveItemInfoToDatastore();
  } ) ;

  //update data's version-number to 0.66
  saveToDatastore(CONST_storedDataVersion, "0.66");

  //return success flag
  return true;
}


///// FUNCTIONS TO LOAD APP-DATA AND CALL UP THE APPROPRIATE HOME PAGE

function runExampleQueryStringStuff() {
  // Assuming "?post=1234&action=edit"

  var urlParams = new URLSearchParams(window.location.search);

  console.log(urlParams.has('post')); // true
  console.log(urlParams.get('action')); // "edit"
  console.log(urlParams.getAll('action')); // ["edit"]
  console.log(urlParams.toString()); // "?post=1234&action=edit"
  console.log(urlParams.append('active', '1')); // "?post=1234&action=edit&active=1"

  var keys = urlParams.keys();
  for(var key of keys) { 
    console.log(key); 
  }
  // post
  // action

  var entries = urlParams.entries();
  for(var pair of entries) { 
    console.log(pair[0], pair[1]); 
  }
}

function processQueryString() {
  wapp.qs_urlParams = new URLSearchParams(window.location.search);

  wapp.qs_obj = {};
  wapp.qs_obj.wibBuilder = wapp.qs_urlParams.has("builder");

  if ( wapp.qs_urlParams.has("dev1") ) {
    saveToDatastore(CONST_wibapp_dev1, "1");
  }
}

function startApp() {
  processQueryString();

  let nextDisplayPage = loadAppData_andReturnNextDisplayPage();

  wapp.isDev1 = false;
  if ( getFromDatastore(CONST_wibapp_dev1) == "1" ) {
    wapp.isDev1 = true;
  }

  //only show home page is appLevelData loaded successfully
  if ( wapp.wappDataLoadedSuccessfully ) {
    displayPage(nextDisplayPage);
  }
}

startApp();




















function wdt_getWappDatetimeObj(itemObj, do_setDateTime_fromItemObj) {
  var wdto = wdt_wappDatetimeObjFactory();

  if ( ! isBlank(itemObj) ){
    wdto.setItemObj(itemObj);
  }

  if ( ! isBlank(itemObj) && do_setDateTime_fromItemObj ) {
    wdto.setDatetime_fromItemObj();
  } else {
    wdto.setDatetime_blankForAdd();
  }

  return wdto;
}

var wdt_timeObjFactory = function() {
  var _hourRaw = null;
  var _minuteRaw = null;

  var _hh = null;
  var _h = null;
  var _nn = null;
  var _n = null;

  var _isTimeObj = true;

  var _timeIsValid = false;

  var _getHourAsTwoDigitString = function(hour) {
    if ( !isNumeric(hour) ) return null;

    hour = parseInt(hour);
    if ( hour < 0 || hour > 23) return null;

    var hourString;

    if (hour < 10) {
      hourString = "0" + hour;
    } else {
      hourString = String(hour);
    }

    return hourString;
  }

  var _getMinuteAsTwoDigitString = function(minute) {
    if ( !isNumeric(minute) ) return null;

    minute = parseInt(minute);
    if ( minute < 0 || minute > 59) return null;

    var minuteString;

    if (minute < 10) {
      minuteString = "0" + minute;
    } else {
      minuteString = String(minute);
    }

    return minuteString;
  }

  var _hasBlankTimePart = function() {
    if ( isBlank(_h) || isBlank(_n) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isClear = function() {
    if ( isBlank(_h) && isBlank(_n) ) {
      return true;
    } else {
      return true;
    }
  };

  var _processRawTimeparts = function() {
    _timeIsValid = false;

    var hourString = _getHourAsTwoDigitString(_hourRaw);
    if ( isBlank(hourString) ) {
      _hh = null;
      _h = null;
    } else {
      _hh = hourString;
      _h = parseInt(_hh);
    }

    var minuteString = _getMinuteAsTwoDigitString(_minuteRaw);
    if ( isBlank(minuteString) ) {
      _nn = null;
      _n = null;
    } else {
      _nn = minuteString;
      _n = parseInt(_nn);
    }

    // don't need to use moment.js is-valid processing, as the getXString functions above check for numeric and hour=0-23 / minute=0-59
    if ( isBlank(hourString) || isBlank(minuteString) ) {
      _timeIsValid = false;
    } else {
      _timeIsValid = true;
    }
  };
    
  var _receiveTime_fromParams = function(hour, minute) {
    _resetPrivateVars();

    _hourRaw = hour;
    _minuteRaw = minute;

    _processRawTimeparts();

    return _timeIsValid;
  };

  var _receiveTime_fromTimeObj = function(timeObj) {
    return _receiveTime_fromParams( timeObj.get_h(), timeObj.get_n() );
  };

  var _resetPrivateVars = function() {
    _hourRaw = null;
    _minuteRaw = null;

    _hh = null;
    _h = null;
    _nn = null;
    _n = null;

    _timeIsValid = false;
  };

  var _time = function() {
    var x = _hh + ":" + _nn;
    return x;
  };

  return {
    get_h: function() {
      return _h;
    },

    get_hh: function() {
      return _hh;
    },

    get_n: function() {
      return _n;
    },

    get_nn: function() {
      return _nn;
    },

    get_time: function() {
      return _time();
    },

    hasBlankTimePart: function() {
      return _hasBlankTimePart();
    },

    isClear: function() {
      return _isClear();
    },

    isTimeObj: function() {
      return _isTimeObj;
    },

    isValidTime: function() {
      return _timeIsValid;
    },
    
    receiveTime_fromDatastore: function(time_fromDatastore) {
      var time_array;

      _resetPrivateVars();

      if ( isBlank(time_fromDatastore) ) return false;

      time_array = time_fromDatastore.split(":");

      if ( time_array.length < 1 || time_array.length > 2 ) return false;

      _hourRaw = time_array[0];
      _minuteRaw = time_array[1];

      _processRawTimeparts();

      return _timeIsValid;
    },
    
    receiveTime_fromParams: function(hour, minute) {
      return _receiveTime_fromParams(hour, minute);
    },

    receiveTime_fromTimeObj: function(timeObj) {
      return _receiveTime_fromTimeObj(timeObj);
    },

    setToBlankTime: function() {
      _resetPrivateVars();
    },

    //zz_func() here, because it does not end with a comma
    //  --> as we add other public methods above, we can add them all with commas, even if would have been alphabetically the last one (if this placeholder zz_func() didn't exist)
    zz_func: function(param1) {
    }
  }
};

function wdt_uiDataObjFactory(displayBaseText) {
  var wdtUiDataObj = {};

  wdtUiDataObj.displayBaseText = displayBaseText;
  wdtUiDataObj.endDateHasBeenDisplayed = false;
  wdtUiDataObj.elemIdLeftPart1 = "ip" + displayBaseText + "_"
  wdtUiDataObj.elemIdLeftPart2 = "dv" + displayBaseText + "_"
  wdtUiDataObj.timeTrackingToggleExists = null;
  wdtUiDataObj.wdtUiParts = [];

  function addWdtUiPart(constCode) {
    var wdtUiPart = wdt_uiPartFactory(constCode, wdtUiDataObj.elemIdLeftPart1);
    wdtUiDataObj.wdtUiParts.push(wdtUiPart);
  };

  wdtUiDataObj.endDate__data_hide = function() {
    elem( this.elemIdLeftPart2 + "EndDate_Data_1").style.display = "none";
    elem( this.elemIdLeftPart2 + "EndDate_Data_2").style.display = "none";
  };

  wdtUiDataObj.endDate__data_show = function() {
    elem( this.elemIdLeftPart2 + "EndDate_Data_1").style.display = "";
    elem( this.elemIdLeftPart2 + "EndDate_Data_2").style.display = "";
  };

  wdtUiDataObj.endDate__link_hide = function() {
    elem( this.elemIdLeftPart2 + "EndDate_Link").style.display = "none";
  };

  wdtUiDataObj.endDate__link_show = function() {
    elem( this.elemIdLeftPart2 + "EndDate_Link").style.display = "";
  };

  wdtUiDataObj.endDate__showOrHideBasedOnDateMatch = function() {
    if ( wapp.wdto.isStartYmdSameAsEndYmd() ) {
      if (this.endDateHasBeenDisplayed) {
        return;
      }
      this.endDate__link_show();
      this.endDate__data_hide();
    } else {
      this.endDate__link_hide();
      this.endDate__data_show();
      this.endDateHasBeenDisplayed = true;
    }
  };

  wdtUiDataObj.get_uiValue_from_constCode = function(constCodeToMatch) {
    var wdtUiPart = this.get_wdtUiPart_from_constCode(constCodeToMatch);
    return wdtUiPart.getValueFromUi();
  };

  wdtUiDataObj.get_wdtUiPart_from_constCode = function(constCodeToMatch) {
    for (var i = 0; i < this.wdtUiParts.length; i++) {
      let iLoop_wdtUiPart = this.wdtUiParts[i];
      if ( isEqual(iLoop_wdtUiPart.get_constCode(), constCodeToMatch) ) {
        return iLoop_wdtUiPart;
      }
    }
  };

  wdtUiDataObj.get_wdtUiPart_from_elemThatChanged = function(elemThatChanged) {

   for (var i = 0; i < this.wdtUiParts.length; i++) {
      let iLoop_wdtUiPart = this.wdtUiParts[i];
      if ( isEqual(iLoop_wdtUiPart.get_elemId(), elemThatChanged.id) ) {
        return iLoop_wdtUiPart;
      }
    }
  };

  wdtUiDataObj.initUi_endDateOrLink = function() {
    this.endDateHasBeenDisplayed = false;
    this.endDate__showOrHideBasedOnDateMatch();
  };

  wdtUiDataObj.initUi__timeTrackingToggleExists_no = function() {
    this.timeTrackingToggleExists = false;
    this.endDateHasBeenDisplayed = false;
    this.initUi_setDatetimeValues();
    this.endDate__showOrHideBasedOnDateMatch();
  };

  wdtUiDataObj.initUi__timeTrackingToggleExists_yes = function() {
    this.timeTrackingToggleExists = true;
    this.endDateHasBeenDisplayed = false;
    this.initUi_setDatetimeValues();

    this.endDate__data_hide();
    this.endDate__link_hide();

    if ( ! elem("ck" + this.displayBaseText + "_TimeTracking").checked ) {
      this.endDate__showOrHideBasedOnDateMatch();
    }
  };

  wdtUiDataObj.receiveUpdateForUi_newStartDatetime = function() {
    wapp.wdt_internalChangeToUi = true;  // need to set this so that the onchange HTML/Javascript event doesn't fire

    setElemVal( this.elemIdLeftPart1 + "StartYear", wapp.wdto.get_startYyyy() );
    setElemVal( this.elemIdLeftPart1 + "StartMonth", wapp.wdto.get_startM() );
    setElemVal( this.elemIdLeftPart1 + "StartDay", wapp.wdto.get_startD() );
    setElemVal( this.elemIdLeftPart1 + "StartHour", wapp.wdto.get_startHh() );
    setElemVal( this.elemIdLeftPart1 + "StartMinute", wapp.wdto.get_startNn() );

    this.endDate__showOrHideBasedOnDateMatch();

    wapp.wdt_internalChangeToUi = false;
  };

  wdtUiDataObj.receiveUpdateForUi_newDuration = function(){
    wapp.wdt_internalChangeToUi = true;  // need to set this so that the onchange HTML/Javascript event doesn't fire

    setElemVal( this.elemIdLeftPart1 + "MinutesTracked", wapp.wdto.get_durationInMinutes_display() );

    wapp.wdt_internalChangeToUi = false;
  };

  wdtUiDataObj.receiveUpdateForUi_newDurationAndEndYmd = function(){
    wapp.wdt_internalChangeToUi = true;  // need to set this so that the onchange HTML/Javascript event doesn't fire

    setElemVal( this.elemIdLeftPart1 + "EndYear", wapp.wdto.get_endYyyy() );
    setElemVal( this.elemIdLeftPart1 + "EndMonth", wapp.wdto.get_endM() );
    setElemVal( this.elemIdLeftPart1 + "EndDay", wapp.wdto.get_endD() );
    setElemVal( this.elemIdLeftPart1 + "MinutesTracked", wapp.wdto.get_durationInMinutes_display() );

    this.endDate__showOrHideBasedOnDateMatch();

    wapp.wdt_internalChangeToUi = false;
  };

  wdtUiDataObj.receiveUpdateForUi_newEndDatetime = function() {
    wapp.wdt_internalChangeToUi = true;  // need to set this so that the onchange HTML/Javascript event doesn't fire

    setElemVal( this.elemIdLeftPart1 + "EndYear", wapp.wdto.get_endYyyy() );
    setElemVal( this.elemIdLeftPart1 + "EndMonth", wapp.wdto.get_endM() );
    setElemVal( this.elemIdLeftPart1 + "EndDay", wapp.wdto.get_endD() );
    setElemVal( this.elemIdLeftPart1 + "EndHour", wapp.wdto.get_endHh() );
    setElemVal( this.elemIdLeftPart1 + "EndMinute", wapp.wdto.get_endNn() );

    this.endDate__showOrHideBasedOnDateMatch();

    wapp.wdt_internalChangeToUi = false;
  };

  wdtUiDataObj.sendError_Ui = function(errorMsg, elemThatChanged, constCode) {
    alert(errorMsg);

    var theElem;

    if ( !isBlank(elemThatChanged) ) {
      theElem = elemThatChanged;
    } else {
      let wdtUiPart = this.get_wdtUiPart_from_constCode(constCode);
      theElem = wdtUiPart.getHtmlElem();
    }

    theElem.focus();
    theElem.select();
  };

  wdtUiDataObj.initUi_setDatetimeValues = function() {
    setElemVal( this.elemIdLeftPart1 + "StartYear", wapp.wdto.get_startYyyy() );
    setElemVal( this.elemIdLeftPart1 + "StartMonth", wapp.wdto.get_startM() );
    setElemVal( this.elemIdLeftPart1 + "StartDay", wapp.wdto.get_startD() );
    setElemVal( this.elemIdLeftPart1 + "StartHour", wapp.wdto.get_startHh() );
    setElemVal( this.elemIdLeftPart1 + "StartMinute", wapp.wdto.get_startNn() );
    setElemVal( this.elemIdLeftPart1 + "EndYear", wapp.wdto.get_endYyyy() );
    setElemVal( this.elemIdLeftPart1 + "EndMonth", wapp.wdto.get_endM() );
    setElemVal( this.elemIdLeftPart1 + "EndDay", wapp.wdto.get_endD() );
    setElemVal( this.elemIdLeftPart1 + "EndHour", wapp.wdto.get_endHh() );
    setElemVal( this.elemIdLeftPart1 + "EndMinute", wapp.wdto.get_endNn() );
    setElemVal( this.elemIdLeftPart1 + "MinutesTracked", wapp.wdto.get_durationInMinutes_display() );
  };

  addWdtUiPart(CONST_wdt_ui_startDay);
  addWdtUiPart(CONST_wdt_ui_startHour);
  addWdtUiPart(CONST_wdt_ui_startMinute);
  addWdtUiPart(CONST_wdt_ui_startMonth);
  addWdtUiPart(CONST_wdt_ui_startYear);
  addWdtUiPart(CONST_wdt_ui_endDay);
  addWdtUiPart(CONST_wdt_ui_endHour);
  addWdtUiPart(CONST_wdt_ui_endMinute);
  addWdtUiPart(CONST_wdt_ui_endMonth);
  addWdtUiPart(CONST_wdt_ui_endYear);
  addWdtUiPart(CONST_wdt_ui_minutesTracked);

  return wdtUiDataObj;
}

var wdt_uiPartFactory = function(constCode, elemIdLeftPart1) {
  var _constCode = constCode;
  var _elemId = elemIdLeftPart1 + constCode;

  var _getHtmlElem = function() {
    var theElem = elem(_elemId);
    return theElem;
  };

  var _getValueFromUi = function() {
    var theValue = elem(_elemId).value;
    return theValue;
  };

  return {
    get_constCode: function() {
      return _constCode;
    },
    get_elemId: function() {
      return _elemId;
    },

    getHtmlElem: function() {
      return _getHtmlElem();
    },

    getValueFromUi: function() {
      return _getValueFromUi();
    },

    //zz_func() here, because it does not end with a comma
    //  --> as we add other public methods above, we can add them all with commas, even if would have been alphabetically the last one (if this placeholder zz_func() didn't exist)
    zz_func: function(param1) {
    }
  }
};

var wdt_wappDatetimeObjFactory = function() {
  var _attempted_startYmdObj = null;
  var _attempted_startTimeObj = null;
  var _attempted_durationInMinutes = null;
  var _attempted_endYmdObj = null;
  var _attempted_endTimeObj = null;

  var _ready_startYmdObj = null;
  var _ready_startTimeObj = null;
  var _ready_durationInMinutes = null;
  var _ready_endYmdObj = null;
  var _ready_endTimeObj = null;

  var _ready_durationInMinutes_display = "";
  var _ready_durationInMinutes_display2 = "--";

  var _wdtWibtypeItemObj = grabItemObj(wapp.timeTracking_wibtypeItemId);
  var _itemObj = null;

  var _incompleteEntryAllowed = false;

  var _doStartAndEndYmdsMatch = function() {
  };

  var _get_durationInMinutes = function() {
    return _ready_durationInMinutes;
  };

  var _get_durationInMinutes_display = function() {
    return _ready_durationInMinutes_display;
  };

  var _get_durationInMinutes_display2 = function() {
    return _ready_durationInMinutes_display2;
  };

  var _get_endD = function() {
    return _ready_endYmdObj.get_d();
  };

  var _get_endDd = function() {
    return _ready_endYmdObj.get_dd();
  };

  var _get_endH = function() {
    return _ready_endTimeObj.get_h();
  };

  var _get_endHh = function() {
    return _ready_endTimeObj.get_hh();
  };

  var _get_endM = function() {
    return _ready_endYmdObj.get_m();
  };

  var _get_endMm = function() {
    return _ready_endYmdObj.get_mm();
  };

  var _get_endN = function() {
    return _ready_endTimeObj.get_n();
  };

  var _get_endNn = function() {
    return _ready_endTimeObj.get_nn();
  };

  var _get_endTime = function() {
    if ( ! _isObj_aValidTime(_ready_endTimeObj) ) {
      return null
    } else {
      return _ready_endTimeObj.get_time();
    }
  };

  var _get_endYmd = function() {
    if ( ! _isObj_aValidYmd(_ready_endYmdObj) ) {
      return null;
    } else {
      return _ready_endYmdObj.get_ymd();
    }
  };

  var _get_endYyyy = function() {
    return _ready_endYmdObj.get_yyyy();
  };

  var _get_startD = function() {
    return _ready_startYmdObj.get_d();
  };

  var _get_startDd = function() {
    return _ready_startYmdObj.get_dd();
  };

  var _get_startH = function() {
    return _ready_startTimeObj.get_h();
  };

  var _get_startHh = function() {
    return _ready_startTimeObj.get_hh();
  };

  var _get_startM = function() {
    return _ready_startYmdObj.get_m();
  };

  var _get_startMm = function() {
    return _ready_startYmdObj.get_mm();
  };

  var _get_startN = function() {
    return _ready_startTimeObj.get_n();
  };

  var _get_startNn = function() {
    return _ready_startTimeObj.get_nn();
  };

  var _get_startTime = function() {
    if ( ! _isObj_aValidTime(_ready_startTimeObj) ) {
      return null
    } else {
      return _ready_startTimeObj.get_time();
    }
  };

  var _get_startYmd = function() {
    if ( ! _isObj_aValidYmd(_ready_startYmdObj) ) {
      return null
    } else {
      return _ready_startYmdObj.get_ymd();
    }
  };

  var _get_startYyyy = function() {
    return _ready_startYmdObj.get_yyyy();
  };

  var _getBlankTimeObj = function() {
    var timeObj = wdt_timeObjFactory();
    return timeObj;
  };

  var _getBlankYmdObj = function() {
    var ymdObj = wdt_ymdObjFactory();
    return ymdObj;
  };

  var _getCalculatedDuration = function(startYmdObj, startTimeObj, endYmdObj, endTimeObj) {
    if ( ! _isObj_aValidYmd(startYmdObj) || ! _isObj_aValidTime(startTimeObj) || ! _isObj_aValidYmd(endYmdObj) || ! _isObj_aValidTime(endTimeObj) ) {
      return null;
    }

    var momentObj_startDatetime = _getMomentObj_fromDatetimeObjs(startYmdObj, startTimeObj);
    var momentObj_endDatetime  = _getMomentObj_fromDatetimeObjs(endYmdObj, endTimeObj);
    var duration;

    if ( momentObj_endDatetime.isBefore(momentObj_startDatetime) ) {
      duration = 0;
    } else {
      duration = momentObj_endDatetime.diff(momentObj_startDatetime, "minutes");
    }
    
    return duration;
  };

  var _getDatetimeAsString = function(yyyy, mm, dd, hh, nn, extraSpace) {
    var str = _getYmdAsString(yyyy, mm, dd);
    if (extraSpace) {
      str += "&nbsp;&nbsp;";
    } else {
      str += " ";
    }
    str += _getTimeAsString(hh, nn);

    return str;
  };

  var _getDisplay1 = function() {
    var str = "(error)";

    if ( ! _isEndDatetimeValid() || ! _isDurationValid() ) {

      if ( _isStartDatetimeValid() ) {

        str = "TT:&nbsp;&nbsp;( incomplete; starts " + _getStartDatetimeAsString(true) + " )";

      } else {

        str = "";

      }

    } else {

      str = "TT:&nbsp;&nbsp;" + _getEndDatetimeAsString(true) + "&nbsp;&nbsp;&nbsp;" + _get_durationInMinutes_display2() + " mins";

    }

    return str;
  };

  var _getEndDatetimeAsString = function(extraSpace) {
    if ( ! _isEndDatetimeValid() ) {
      return "";
    }

    return _getDatetimeAsString(_get_endYyyy(), _get_endMm(), _get_endDd(), _get_endHh(), _get_endNn(), extraSpace);
  };

  var _getEndTimeObj = function() {
    return _ready_endTimeObj;
  };

  var _getEndYmdObj = function() {
    return _ready_endYmdObj;
  };

  var _getMomentObj_fromDatetimeObjs = function(ymdObj, timeObj) {
    var datetimeString = _getDatetimeAsString( ymdObj.get_yyyy(), ymdObj.get_mm(), ymdObj.get_dd(), timeObj.get_hh(), timeObj.get_nn(), false );
    var momentObj_datetime = moment(datetimeString);
    return momentObj_datetime;
  };

  var _getMomentObj_fromTimeObj = function(timeObj) {
    // need to create "time-only" moment.js object with fake date of today, because moment.js throws a soft error if it is set with only time values
    var todayYmdObj = _getTodayYmdObj();
    var momentObj_timeX = _getMomentObj_fromDatetimeObjs(todayYmdObj, timeObj);
    return momentObj_timeX;
  };

  var _getMomentObj_fromYmdObj = function(ymdObj) {
    var ymdString = _getYmdAsString( ymdObj.get_yyyy(), ymdObj.get_mm(), ymdObj.get_dd() );
    var momentObj_ymd = moment(ymdString);
    return momentObj_ymd;
  };

  var _getStartDatetimeAsString = function(extraSpace) {
    if ( ! _isStartDatetimeValid() ) {
      return "";
    }

    return _getDatetimeAsString(_get_startYyyy(), _get_startMm(), _get_startDd(), _get_startHh(), _get_startNn(), extraSpace);
  };

  var _getStartTimeObj = function() {
    return _ready_startTimeObj;
  };

  var _getStartYmdObj = function() {
    return _ready_startYmdObj;
  };

  var _getTimeAsString = function(hh, nn) {
    var str = hh + ":" + nn;
    return str;
  };

  var _getTodayYmdObj = function() {
    var ymdObj = _getBlankYmdObj();
    var todayMomentObj = moment();
    ymdObj.receiveYmd_fromMoment(todayMomentObj);
    return ymdObj;
  };

  var _getValFromWdtUiPart = function(wdtUiPart) {
    switch (wdtUiPart.get_constCode()) {
      case CONST_wdt_ui_endDay:
        return _ready_endYmdObj.get_d();
      case CONST_wdt_ui_endHour:
        return _ready_endTimeObj.get_h();
      case CONST_wdt_ui_endMinute:
        return _ready_endTimeObj.get_n();
      case CONST_wdt_ui_endMonth:
        return _ready_endYmdObj.get_m();
      case CONST_wdt_ui_endYear:
        return _ready_endYmdObj.get_yyyy();
      case CONST_wdt_ui_minutesTracked:
        return _ready_durationInMinutes;
      case CONST_wdt_ui_startDay:
        return _ready_startYmdObj.get_d();
      case CONST_wdt_ui_startHour:
        return _ready_startTimeObj.get_h();
      case CONST_wdt_ui_startMinute:
        return _ready_startTimeObj.get_n();
      case CONST_wdt_ui_startMonth:
        return _ready_startYmdObj.get_m();
      case CONST_wdt_ui_startYear:
        return _ready_startYmdObj.get_yyyy();
    }
  };

  var _getYmdAsString = function(yyyy, mm, dd) {
    var str = yyyy + "-" + mm + "-" + dd;
    return str;
  };

  var _isDatetime1BeforeDatetime2 = function(ymd1Obj, time1Obj, ymd2Obj, time2Obj) {
    if ( ! _isObj_aValidYmd(ymd1Obj) || ! _isObj_aValidTime(time1Obj) || ! _isObj_aValidYmd(ymd2Obj) || ! _isObj_aValidTime(time2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromDatetimeObjs(ymd1Obj, time1Obj);
    var momentObj2 = _getMomentObj_fromDatetimeObjs(ymd2Obj, time2Obj);

    if ( momentObj1.isBefore(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isDatetime1SameAsDatetime2 = function(ymd1Obj, time1Obj, ymd2Obj, time2Obj) {
    if ( ! _isObj_aValidYmd(ymd1Obj) || ! _isObj_aValidTime(time1Obj) || ! _isObj_aValidYmd(ymd2Obj) || ! _isObj_aValidTime(time2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromDatetimeObjs(ymd1Obj, time1Obj);
    var momentObj2 = _getMomentObj_fromDatetimeObjs(ymd2Obj, time2Obj);

    if ( momentObj1.isSame(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isDatetime1AtOrBeforeDatetime2 = function(ymd1Obj, time1Obj, ymd2Obj, time2Obj) {
    if ( ! _isObj_aValidYmd(ymd1Obj) || ! _isObj_aValidTime(time1Obj) || ! _isObj_aValidYmd(ymd2Obj) || ! _isObj_aValidTime(time2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromDatetimeObjs(ymd1Obj, time1Obj);
    var momentObj2 = _getMomentObj_fromDatetimeObjs(ymd2Obj, time2Obj);

    if ( momentObj1.isSame(momentObj2) || momentObj1.isBefore(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isDurationValid = function(durationToCheck) {
    if (durationToCheck === undefined) {
      // if no durationToCheck was passed, we will assume the live duration is being checked
      durationToCheck = _get_durationInMinutes();
    }

    if ( ! isNumeric(durationToCheck) ) {
      return false;
    } else if ( parseInt(durationToCheck) < 0 ) {
      return false;
    } else {
      return true;
    }
  };

  var _isEndDatetimeValid = function() {
    if ( _ready_endYmdObj.isValidYmd() && _ready_endTimeObj.isValidTime() ) {
      return true;
    } else {
      return false;
    }
  };

  var _isObj_aTimeObj = function(timeObj) {
    var returnFromMethod_isTimeObj = returnFromMethod(timeObj, "isTimeObj")

    if (returnFromMethod_isTimeObj) {
      return true;
    } else {
      return false;
    }
  };

  var _isObj_aValidTime = function(timeObj) {
    if ( ! _isObj_aTimeObj(timeObj) ) {
      return false;
    }

    return timeObj.isValidTime();
  };

  var _isObj_aValidYmd = function(ymdObj) {
    if ( ! _isObj_aYmdObj(ymdObj) ) {
      return false;
    }

    return ymdObj.isValidYmd();
  };

  var _isObj_aYmdObj = function(ymdObj) {
    var returnFromMethod_isYmdObj = returnFromMethod(ymdObj, "isYmdObj")

    if (returnFromMethod_isYmdObj) {
      return true;
    } else {
      return false;
    }
  };

  var _isStartYmdSameAsEndYmd = function() {
    return _isYmdObj1SameAsYmdObj2(_ready_startYmdObj, _ready_endYmdObj);
  };

  var _isStartDatetimeValid = function() {
    if ( _ready_startYmdObj.isValidYmd() && _ready_startTimeObj.isValidTime() ) {
      return true;
    } else {
      return false;
    }
  };

  var _isTimeObj1BeforeTimeObj2 = function(time1Obj, time2Obj) {
    if ( ! _isObj_aValidTime(time1Obj) || ! _isObj_aValidTime(time2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromTimeObj(time1Obj);
    var momentObj2 = _getMomentObj_fromTimeObj(time2Obj);

    if ( momentObj1.isBefore(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isTimeObj1SameAsTimeObj2 = function(time1Obj, time2Obj) {
    if ( ! _isObj_aValidTime(time1Obj) || ! _isObj_aValidTime(time2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromTimeObj(time1Obj);
    var momentObj2 = _getMomentObj_fromTimeObj(time2Obj);

    if ( momentObj1.isSame(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isYmdObj1BeforeYmdObj2 = function(ymd1Obj, ymd2Obj) {
    if ( ! _isObj_aValidYmd(ymd1Obj) || ! _isObj_aValidYmd(ymd2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromYmdObj(ymd1Obj);
    var momentObj2 = _getMomentObj_fromYmdObj(ymd2Obj);

    if ( momentObj1.isBefore(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isYmdObj1SameAsYmdObj2 = function(ymd1Obj, ymd2Obj) {
    if ( ! _isObj_aValidYmd(ymd1Obj) || ! _isObj_aValidYmd(ymd2Obj) ) {
      return null;
    }

    var momentObj1 = _getMomentObj_fromYmdObj(ymd1Obj);
    var momentObj2 = _getMomentObj_fromYmdObj(ymd2Obj);

    if ( momentObj1.isSame(momentObj2) ) {
      return true;
    } else {
      return false;
    }
  };

  var _processAttempted_fromUi = function() {
    var haveValidStartYmd = false, haveValidStartTime = false, haveValidEndYmd = false, haveValidEndTime = false, haveValidDuration = false;

    _setReadyVarsToBlank();

    if ( _attempted_startYmdObj.isValidYmd() ) {
        _ready_startYmdObj.receiveYmd_fromYmdObj(_attempted_startYmdObj, true);
        haveValidStartYmd = _ready_startYmdObj.isValidYmd();
    }

    if ( _attempted_startTimeObj.isValidTime() ) {
        _ready_startTimeObj.receiveTime_fromTimeObj(_attempted_startTimeObj);
        haveValidStartTime = _ready_startTimeObj.isValidTime();
    }

    if ( _attempted_endYmdObj.isValidYmd() || ( _incompleteEntryAllowed && _attempted_endYmdObj.isClear() ) ) {
        _ready_endYmdObj.receiveYmd_fromYmdObj(_attempted_endYmdObj, true);
        haveValidEndYmd = _ready_endYmdObj.isValidYmd();
    }

    if ( _attempted_endTimeObj.isValidTime() || ( _incompleteEntryAllowed && _attempted_endTimeObj.isClear() ) ) {
        _ready_endTimeObj.receiveTime_fromTimeObj(_attempted_endTimeObj);
        haveValidEndTime = _ready_endTimeObj.isValidTime();
    }

    if ( _isDurationValid(_attempted_durationInMinutes) || ( _incompleteEntryAllowed && isBlank(_attempted_durationInMinutes) ) ) {
        _setDuration(_attempted_durationInMinutes);
        haveValidDuration = _isDurationValid();
    }

    if ( ! haveValidStartYmd ) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid start year", null, CONST_wdt_ui_startYear)
      return false;
    }

    if ( ! haveValidStartTime ) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid start time", null, CONST_wdt_ui_startHour)
      return false;
    }

    if ( ! haveValidEndYmd && ! _incompleteEntryAllowed ) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid end year", null, CONST_wdt_ui_endYear)
      return false;
    }

    if ( ! haveValidEndTime && ! _incompleteEntryAllowed ) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid end time", null, CONST_wdt_ui_endHour)
      return false;
    }

    if ( ! haveValidDuration && ! _incompleteEntryAllowed ) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid minutes tracked", null, CONST_wdt_ui_minutesTracked)
      return false;
    }

    var endDateTime_isBefore_startDateTime = _isDatetime1BeforeDatetime2(_ready_endYmdObj, _ready_endTimeObj, _ready_startYmdObj, _ready_startTimeObj);
    
    if (endDateTime_isBefore_startDateTime) {
      wapp.wdtUiDataObj.sendError_Ui("Invalid Entry --  start date/time is after end date/time", null, CONST_wdt_ui_startYear);
      return false;
    }

    var testDuration = _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj);
    var existingDuration = _get_durationInMinutes();

    if ( ! isEqual(testDuration, testDuration) ) {
      // this shouldn't happen, but just in case
      _setDuration(testDuration);
    }

    return true;
  };

  var _processAttempted_fromDatastore = function() {
    var haveValidStartDatetime = false, haveValidEndDatetime = false, haveValidDuration = false;

    // check for valid date-time combos and valid duration
    if ( _attempted_startYmdObj.isValidYmd() && _attempted_startTimeObj.isValidTime() ) {
      haveValidStartDatetime = true;
    }

    if ( _attempted_endYmdObj.isValidYmd() && _attempted_endTimeObj.isValidTime() ) {
      haveValidEndDatetime = true;
    }

    if ( _isDurationValid(_attempted_durationInMinutes) ) {
      haveValidDuration = true;
    }

    _setReadyVarsToBlank();

    // POSSIBLE ACTION #1:
    //
    // if we only have 0 or 1 of:
    //   (a) start date-time
    //   (b) duration
    //   (c) end date-time
    // then simply move all valid values to _ready vars
    if ( 
           ( haveValidStartDatetime && ! haveValidDuration && ! haveValidEndDatetime )
        || ( ! haveValidStartDatetime && haveValidDuration && ! haveValidEndDatetime )
        || ( ! haveValidStartDatetime && ! haveValidDuration && haveValidEndDatetime )
        || ( ! haveValidStartDatetime && ! haveValidDuration && ! haveValidEndDatetime )
       )
    {

      if ( _attempted_startYmdObj.isValidYmd() ) {
        _ready_startYmdObj.receiveYmd_fromYmdObj(_attempted_startYmdObj, true);
      }

      if ( _attempted_startTimeObj.isValidTime() ) {
        _ready_startTimeObj.receiveTime_fromTimeObj(_attempted_startTimeObj);
      }

      if ( _isDurationValid(_attempted_durationInMinutes) ) {
        _setDuration(_attempted_durationInMinutes);
      }

      if ( _attempted_endYmdObj.isValidYmd() ) {
        _ready_endYmdObj.receiveYmd_fromYmdObj(_attempted_endYmdObj, true);
      }

      if ( _attempted_endTimeObj.isValidTime() ) {
        _ready_endTimeObj.receiveTime_fromTimeObj(_attempted_endTimeObj);
      }

      // with these changes, we are now done processing the attempted date info --- exit function
      return;
    }

    // POSSIBLE ACTION #2:
    //
    // if we have a valid start date-time AND a valid end date-time:
    //   (a) set ready- start & end date-times with the attempted- vars
    //   (b) set ready- duration to match the appropriate # of minutes between the start & end date-time values
    if ( haveValidStartDatetime && haveValidEndDatetime ) {
      _ready_startYmdObj.receiveYmd_fromYmdObj(_attempted_startYmdObj, true);
      _ready_startTimeObj.receiveTime_fromTimeObj(_attempted_startTimeObj);
      _ready_endYmdObj.receiveYmd_fromYmdObj(_attempted_endYmdObj, true);
      _ready_endTimeObj.receiveTime_fromTimeObj(_attempted_endTimeObj);

      _setDuration( _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj) );

      // with these changes, we are now done processing the attempted date info --- exit function
      return;
    }

    // POSSIBLE ACTION #3:
    //
    // if we have a valid start date-time AND a valid duration:
    //   (a) set ready- start date/time and duration with the attempted- vars
    //   (b) set ready- end to match the start time plus N minutes
    if ( haveValidStartDatetime && haveValidDuration ) {
      _ready_startYmdObj.receiveYmd_fromYmdObj(_attempted_startYmdObj, true);
      _ready_startTimeObj.receiveTime_fromTimeObj(_attempted_startTimeObj);
      _setDuration(_attempted_durationInMinutes);

      _setEndDatetime_usingStartDatetimeAndDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_durationInMinutes, _ready_endYmdObj, _ready_endTimeObj);

      // with these changes, we are now done processing the attempted date info --- exit function
      return;
    }

    // POSSIBLE ACTION #4:
    //
    // if we have a valid end date-time AND a valid duration:
    //   (a) set ready- end date/time and duration with the attempted- vars
    //   (b) set ready- start to match the end time plus N minutes
    if ( haveValidEndDatetime && haveValidDuration ) {
      _ready_endYmdObj.receiveYmd_fromYmdObj(_attempted_endYmdObj, true);
      _ready_endTimeObj.receiveTime_fromTimeObj(_attempted_endTimeObj);
      _setDuration(_attempted_durationInMinutes);

      _setStartDatetime_usingEndDatetimeAndDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_durationInMinutes, _ready_endYmdObj, _ready_endTimeObj);

      // with these changes, we are now done processing the attempted date info --- exit function
      return;
    }
    
    // NOTE: if all 3 (start date-time, end date-time, and duration) are valid, then we don't need to take any action here
    // --> the values will be validated against each other, and necessary changes made if they don't match, based on the priority order above
  };

  var _resetPrivateVars = function() {
    _attempted_startYmdObj = null;
    _attempted_startTimeObj = null;
    _attempted_durationInMinutes = null;
    _attempted_endYmdObj = null;
    _attempted_endTimeObj = null;

    _ready_startYmdObj = null;
    _ready_startTimeObj = null;
    _ready_durationInMinutes = null;
    _ready_endYmdObj = null;
    _ready_endTimeObj = null;

    _setDurationDisplayVarsToBlank();
  };

  var _setAttempted = function(start_ymdObj, start_timeObj, durationInMinutes, end_ymdObj, end_timeObj) {
    if ( _isObj_aYmdObj(start_ymdObj) ) {
      _attempted_startYmdObj = start_ymdObj;
    } else {
      _attempted_startYmdObj = _getBlankYmdObj();
    }

    if ( _isObj_aTimeObj(start_timeObj) ) {
      _attempted_startTimeObj = start_timeObj;
    } else {
      _attempted_startTimeObj = _getBlankTimeObj();
    }

    _attempted_durationInMinutes = durationInMinutes;
 
   if ( _isObj_aYmdObj(end_ymdObj) ) {
      _attempted_endYmdObj = end_ymdObj;
    } else {
      _attempted_endYmdObj = _getBlankYmdObj();
    }

    if ( _isObj_aTimeObj(end_timeObj) ) {
      _attempted_endTimeObj = end_timeObj;
    } else {
      _attempted_endTimeObj = _getBlankTimeObj();
    }
 };

  var _setDatetimeObjs_fromMoment = function(momentObj_datetime, ymdObj, timeObj) {
    if ( ! momentObj_datetime.isValid() ) {
      return false;
    }

    var year = momentObj_datetime.year();
    var month = parseInt( momentObj_datetime.month() ) + 1; // moment.js months are 0-indexed
    var day = momentObj_datetime.date(); // moment.js uses .date() for the day-of-the-month
    var hour = momentObj_datetime.hour();
    var minute = momentObj_datetime.minute();

    ymdObj.receiveYmd_fromParams(year, month, day);
    timeObj.receiveTime_fromParams(hour, minute);

    return true;
  };

  var _setDurationDisplayVarsToBlank = function() {
    _ready_durationInMinutes_display = "";
    _ready_durationInMinutes_display2 = "--";
  };

  var _setDuration = function(newDurationValue) {
    _ready_durationInMinutes = newDurationValue;

    if ( isNumeric(_ready_durationInMinutes) ) {
      _ready_durationInMinutes_display = parseInt(_ready_durationInMinutes);
      _ready_durationInMinutes_display2 = parseInt(_ready_durationInMinutes);
    } else {
      _setDurationDisplayVarsToBlank();
    }
  };

  var _setEndDatetime_usingStartDatetimeAndDuration = function(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj) {
    if ( ! _isObj_aValidYmd(startYmdObj) || ! _isObj_aValidTime(startTimeObj) || ! _isDurationValid(durationInMinutes) ) {
      return false;
    }

    var momentObj_startDatetime = _getMomentObj_fromDatetimeObjs(startYmdObj, startTimeObj);

    var momentObj_endDatetime = momentObj_startDatetime.add( parseInt(durationInMinutes), "minutes" );

    _setDatetimeObjs_fromMoment(momentObj_endDatetime, endYmdObj, endTimeObj);
  };

  var _setIncompleteEntryAllowed = function(optional_setToTrueOrFalse) {
    if ( isBlank(optional_setToTrueOrFalse) ) {
      _incompleteEntryAllowed = true;
    } else {
      _incompleteEntryAllowed = optional_setToTrueOrFalse;
    }
  };

  var _setItemObj = function(itemObj) {
    _itemObj = itemObj;
  };

  var _setReadyVarsToBlank = function() {
    _ready_startYmdObj = _getBlankYmdObj();
    _ready_startTimeObj = _getBlankTimeObj();
    _ready_endYmdObj = _getBlankYmdObj();
    _ready_endTimeObj = _getBlankTimeObj();

    _ready_durationInMinutes = null;
    _setDurationDisplayVarsToBlank();
  };

  var _setStartDatetime_usingEndDatetimeAndDuration = function(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj) {
    if ( ! _isObj_aValidYmd(endYmdObj) || ! _isObj_aValidTime(endTimeObj) || ! _isDurationValid(durationInMinutes) ) {
      return false;
    }

    var momentObj_endDatetime = _getMomentObj_fromDatetimeObjs(endYmdObj, endTimeObj);

    var momentObj_startDatetime = momentObj_endDatetime.subtract( parseInt(durationInMinutes), "minutes" );

    _setDatetimeObjs_fromMoment(momentObj_startDatetime, startYmdObj, startTimeObj);
  };

  var _setYmdObjToToday = function(ymdObj) {
    var todayYmdObj = _getTodayYmdObj();
    ymdObj.receiveYmd_fromYmdObj(todayYmdObj);
  };

  return {
    getDisplay1: function() {
      return _getDisplay1();
    },

    get_durationInMinutes: function() {
      return _get_durationInMinutes();
    },

    get_durationInMinutes_display: function() {
      return _get_durationInMinutes_display();
    },

    get_durationInMinutes_display2: function() {
      return _get_durationInMinutes_display2();
    },

    get_endD: function() {
      return _get_endD();
    },

    get_endDd: function() {
      return _get_endDd();
    },

    get_endH: function() {
      return _get_endH();
    },

    get_endHh: function() {
      return _get_endHh();
    },

    get_endM: function() {
      return _get_endM();
    },

    get_endMm: function() {
      return _get_endMm();
    },

    get_endN: function() {
      return _get_endN();
    },

    get_endNn: function() {
      return _get_endNn();
    },

    get_endTime: function() {
      return _get_endTime();
    },

    get_endYmd: function() {
      return _get_endYmd();
    },

    get_endYyyy: function() {
      return _get_endYyyy();
    },

    get_startD: function() {
      return _get_startD();
    },

    get_startDd: function() {
      return _get_startDd();
    },

    get_startH: function() {
      return _get_startH();
    },

    get_startHh: function() {
      return _get_startHh();
    },

    get_startM: function() {
      return _get_startM();
    },

    get_startMm: function() {
      return _get_startMm();
    },

    get_startN: function() {
      return _get_startN();
    },

    get_startNn: function() {
      return _get_startNn();
    },

    get_startTime: function() {
      return _get_startTime();
    },

    get_startYmd: function() {
      return _get_startYmd();
    },

    get_startYyyy: function() {
      return _get_startYyyy();
    },

    getBlankTimeObj: function() {
      return _getBlankTimeObj();
    },

    getBlankYmdObj: function() {
      return _getBlankYmdObj();
    },

    getCalculatedDuration: function(startYmdObj, startTimeObj, endYmdObj, endTimeObj) {
      return _getCalculatedDuration(startYmdObj, startTimeObj, endYmdObj, endTimeObj);
    },

    getEndDatetimeAsString: function(extraSpace) {
      return _getEndDatetimeAsString(extraSpace);
    },

    getEndTimeObj: function() {
      return _getEndTimeObj();
    },

    getEndYmdObj: function() {
      return _getEndYmdObj();
    },

    getItemObj: function() {
      return _itemObj;
    },

    getStartDatetimeAsString: function(extraSpace) {
      return _getStartDatetimeAsString(extraSpace);
    },

    getStartTimeObj: function() {
      return _getStartTimeObj();
    },

    getStartYmdObj: function() {
      return _getStartYmdObj();
    },

    isEndDatetimeValid: function() {
      return _isEndDatetimeValid();
    },

    isStartDatetimeValid: function() {
      return _isStartDatetimeValid();
    },

    isStartYmdSameAsEndYmd: function() {
      return _isStartYmdSameAsEndYmd();
    },

    isUiValid: function() {
      var start_ymdObj = _getBlankYmdObj();
      var start_timeObj = _getBlankTimeObj();
      var end_ymdObj = _getBlankYmdObj();
      var end_timeObj = _getBlankTimeObj();

      var startYear = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_startYear);
      var startMonth = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_startMonth);
      var startDay = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_startDay);
      var startHour = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_startHour);
      var startMinute = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_startMinute);

      var endYear = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_endYear);
      var endMonth = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_endMonth);
      var endDay = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_endDay);
      var endHour = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_endHour);
      var endMinute = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_endMinute);

      var duration = wapp.wdtUiDataObj.get_uiValue_from_constCode(CONST_wdt_ui_minutesTracked);

      _resetPrivateVars();

      start_ymdObj.receiveYmd_fromParams(startYear, startMonth, startDay);
      start_timeObj.receiveTime_fromParams(startHour, startMinute);
      end_ymdObj.receiveYmd_fromParams(endYear, endMonth, endDay);
      end_timeObj.receiveTime_fromParams(endHour, endMinute);

      _setAttempted(start_ymdObj, start_timeObj, duration, end_ymdObj, end_timeObj);

      return _processAttempted_fromUi();
    },

    receiveUiChange: function(elemThatChanged) {

      //TO-DO2: wdto shouldn't have to know about Duration being called MinutesTracked in the UI
      var wdtUiPartThatChanged = wapp.wdtUiDataObj.get_wdtUiPart_from_elemThatChanged(elemThatChanged);

      var oldValue = _getValFromWdtUiPart(wdtUiPartThatChanged);
      var newValue = wdtUiPartThatChanged.getValueFromUi();

      // StartYMD change
      if ( wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_startDay || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_startMonth || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_startYear ) {
        let startYear, startMonth, startDay;

        switch (wdtUiPartThatChanged.get_constCode()) {
          case CONST_wdt_ui_startDay:
            startYear = _get_startYyyy();
            startMonth = _get_startM();
            startDay = newValue;
            break;
          case CONST_wdt_ui_startMonth:
            startYear = _get_startYyyy();
            startMonth = newValue;
            startDay = _get_startD();
            break;
          case CONST_wdt_ui_startYear:
            startYear = newValue;
            startMonth = _get_startM();
            startDay = _get_startD();
            break;
        }

        _ready_startYmdObj.receiveYmd_fromParams(startYear, startMonth, startDay);

        if ( _ready_startYmdObj.hasBlankYmdPart() ) {
          return;
        }

        if ( ! _ready_startYmdObj.isValidYmd() ) {
          wapp.wdtUiDataObj.sstartError_Ui("Invalid start date", elemThatChanged, null);
          return;
        }

        if ( ! _ready_startTimeObj.isValidTime() || ! _ready_endYmdObj.isValidYmd() || ! _ready_endTimeObj.isValidTime() ) {
          return;
        }

        if ( _isDatetime1BeforeDatetime2(_ready_endYmdObj, _ready_endTimeObj, _ready_startYmdObj, _ready_startTimeObj) ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid Entry --  start date/time is after end date/time", elemThatChanged, null);
          return;
        }

        _setDuration( _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj) );

        if ( _isDurationValid() ) {
          wapp.wdtUiDataObj.receiveUpdateForUi_newDuration();
        }
      }

      // StartTime change
      if ( wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_startHour || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_startMinute ) {
        let startHour, startMinute;

        switch (wdtUiPartThatChanged.get_constCode()) {
          case CONST_wdt_ui_startHour:
            startHour = newValue;
            startMinute = _get_startN();
            break;
          case CONST_wdt_ui_startMinute:
            startHour = _get_startH();
            startMinute = newValue;
            break;
        }

        _ready_startTimeObj.receiveTime_fromParams(startHour, startMinute);

        if ( _ready_startTimeObj.hasBlankTimePart() ) {
          return;
        }

        if ( ! _ready_startTimeObj.isValidTime() ) {
          wapp.wdtUiDataObj.sstartError_Ui("Invalid start time", elemThatChanged, null);
          return;
        }

        if ( ! _ready_startYmdObj.isValidYmd() || ! _ready_endYmdObj.isValidYmd() || ! _ready_endTimeObj.isValidTime() ) {
          return;
        }

        if ( _isDatetime1BeforeDatetime2(_ready_endYmdObj, _ready_endTimeObj, _ready_startYmdObj, _ready_startTimeObj) ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid Entry --  start date/time is after end date/time", elemThatChanged, null);
          return;
        }

        _setDuration( _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj) );

        if ( _isDurationValid() ) {
          wapp.wdtUiDataObj.receiveUpdateForUi_newDuration();
        }
      }

      // Duration change
      if ( wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_minutesTracked ) {
        _setDuration(newValue);

        if ( ! _isDurationValid() ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid minutes tracked", elemThatChanged, null);
          return;
        }
        
        if ( _ready_startYmdObj.isValidYmd() && _ready_startTimeObj.isValidTime() ) {

          _setEndDatetime_usingStartDatetimeAndDuration(_ready_startYmdObj, _ready_startTimeObj, _get_durationInMinutes(), _ready_endYmdObj, _ready_endTimeObj);

          if ( _ready_endYmdObj.isValidYmd() && _ready_endTimeObj.isValidTime() ) {
            wapp.wdtUiDataObj.receiveUpdateForUi_newEndDatetime();
          }

        }
      }

      // EndYMD change
      if ( wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_endDay || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_endMonth || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_endYear ) {
        let endYear, endMonth, endDay;

        switch (wdtUiPartThatChanged.get_constCode()) {
          case CONST_wdt_ui_endDay:
            endYear = _get_endYyyy();
            endMonth = _get_endM();
            endDay = newValue;
            break;
          case CONST_wdt_ui_endMonth:
            endYear = _get_endYyyy();
            endMonth = newValue;
            endDay = _get_endD();
            break;
          case CONST_wdt_ui_endYear:
            endYear = newValue;
            endMonth = _get_endM();
            endDay = _get_endD();
            break;
        }

        _ready_endYmdObj.receiveYmd_fromParams(endYear, endMonth, endDay);

        if ( _ready_endYmdObj.hasBlankYmdPart() ) {
          return;
        }

        if ( ! _ready_endYmdObj.isValidYmd() ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid end date", elemThatChanged, null);
          return;
        }

        if ( ! _ready_startYmdObj.isValidYmd() || ! _ready_startTimeObj.isValidTime() || ! _ready_endTimeObj.isValidTime() ) {
          return;
        }

        if ( _isDatetime1BeforeDatetime2(_ready_endYmdObj, _ready_endTimeObj, _ready_startYmdObj, _ready_startTimeObj) ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid Entry --  end date/time is before start date/time", elemThatChanged, null);
          return;
        }

        _setDuration( _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj) );

        if ( _isDurationValid() ) {
          wapp.wdtUiDataObj.receiveUpdateForUi_newDuration();
        }
      }

      // EndTime change
      if ( wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_endHour || wdtUiPartThatChanged.get_constCode() == CONST_wdt_ui_endMinute ) {
        let endHour, endMinute;

        switch (wdtUiPartThatChanged.get_constCode()) {
          case CONST_wdt_ui_endHour:
            endHour = newValue;
            endMinute = _get_endN();
            break;
          case CONST_wdt_ui_endMinute:
            endHour = _get_endH();
            endMinute = newValue;
            break;
        }

        _ready_endTimeObj.receiveTime_fromParams(endHour, endMinute);

        if ( _ready_endTimeObj.hasBlankTimePart() ) {
          return;
        }

        if ( ! _ready_endTimeObj.isValidTime() ) {
          wapp.wdtUiDataObj.sendError_Ui("Invalid end time", elemThatChanged, null);
          return;
        }

        if ( ! _ready_startYmdObj.isValidYmd() || ! _ready_startTimeObj.isValidTime() || ! _ready_endYmdObj.isValidYmd() ) {
          return;
        }

        let changedEndYmd = false;

        let endDateTime_isBefore_startDateTime = _isDatetime1BeforeDatetime2(_ready_endYmdObj, _ready_endTimeObj, _ready_startYmdObj, _ready_startTimeObj);

        if ( endDateTime_isBefore_startDateTime ) {
          _ready_endYmdObj.receiveYmd_fromYmdObj(_ready_startYmdObj, true);

          changedEndYmd = true;

          let endTime_isBefore_startTime = _isTimeObj1BeforeTimeObj2(_ready_endTimeObj, _ready_startTimeObj);

          if ( endTime_isBefore_startTime ) {
            _ready_endYmdObj.addDays(1);
          }
        }

        let newDuration = _getCalculatedDuration(_ready_startYmdObj, _ready_startTimeObj, _ready_endYmdObj, _ready_endTimeObj);
        _setDuration(newDuration);

        wapp.wdtUiDataObj.receiveUpdateForUi_newDurationAndEndYmd();
      }

    },

    saveToDatastore: function(newItemObj) {
      if ( ! isBlank(newItemObj) ) {
        _setItemObj(newItemObj);
      }

      var startYmd = _get_startYmd();
      var startTime = _get_startTime();
      var endYmd = _get_endYmd();
      var endTime = _get_endTime();
      var duration = _get_durationInMinutes();

      _itemObj.setWibtypeAndWtifs(_wdtWibtypeItemObj.itemId
        , CONST_timeTracking_wtifStartYMD_itemName, startYmd
        , CONST_timeTracking_wtifStartTime_itemName, startTime
        , CONST_timeTracking_wtifEndYMD_itemName, endYmd
        , CONST_timeTracking_wtifEndTime_itemName, endTime
        , CONST_timeTracking_wtifMinsTracked_itemName, duration
      );
    },

    setDatetime_blankForAdd: function() {
      _resetPrivateVars();
      _setReadyVarsToBlank();

      let list_hasValidTT = false;
      let wdto_toUse = null;
      let list_memberDataObjs = wapp.itemObj.getListMemberDataObjs();

      // check the first 10 list-members (should be the top 10 items on the list) to attempt to find a valid Time-Tracking item
      for (let i = 0; i < 10 && i < list_memberDataObjs.length; i++) {

        let itemObj_iLoop = grabItemObj( list_memberDataObjs[i].itemId );
        let wdto_iLoop = wdt_getWappDatetimeObj(itemObj_iLoop, true);

        if ( wdto_iLoop.isStartDatetimeValid() && wdto_iLoop.isEndDatetimeValid() ) {
          list_hasValidTT = true;
          wdto_toUse = wdto_iLoop;
          break;
        }
  
      }

      if ( list_hasValidTT ) {

        // Option A: if there are existing & valid Time-Tracking items for the current list-item, set the start date-time (and end date) equal to the end date-time of the latest existing

          _ready_startYmdObj.receiveYmd_fromYmdObj( wdto_toUse.getEndYmdObj() );
          _ready_startTimeObj.receiveTime_fromTimeObj( wdto_toUse.getEndTimeObj() );

          _ready_endYmdObj.receiveYmd_fromYmdObj( wdto_toUse.getEndYmdObj() );

      } else {

        // Option B: otherwise, use any default Time-Tracking date

        if ( isBlank(wapp.timeTracking_defaultYear) || isBlank(wapp.timeTracking_defaultMonth) || isBlank(wapp.timeTracking_defaultDay) ) {
          _setYmdObjToToday(_ready_startYmdObj);
          _setYmdObjToToday(_ready_endYmdObj);

          wapp.timeTracking_defaultYear = _ready_startYmdObj.get_yyyy();
          wapp.timeTracking_defaultMonth = _ready_startYmdObj.get_m();
          wapp.timeTracking_defaultDay = _ready_startYmdObj.get_d();
        } else {
          _ready_startYmdObj.receiveYmd_fromParams(wapp.timeTracking_defaultYear, wapp.timeTracking_defaultMonth, wapp.timeTracking_defaultDay);
          _ready_endYmdObj.receiveYmd_fromParams(wapp.timeTracking_defaultYear, wapp.timeTracking_defaultMonth, wapp.timeTracking_defaultDay);
        }

      }


    },

    setDatetime_fromItemObj: function(itemObj_funcParam) {
      if ( isBlank(itemObj_funcParam) ) {
        // if no item-object has been received as a function parameter, we assume the item-object was previously set via .setItemObj()
      } else {
        _setItemObj(itemObj_funcParam);
      }

      var end_ymdObj = _getBlankYmdObj();
      var end_timeObj = _getBlankTimeObj();
      var start_ymdObj = _getBlankYmdObj();
      var start_timeObj = _getBlankTimeObj();

      var endYmd_fromDatastore = _itemObj.getWtifData(wapp.timeTracking_wibtypeItemId, null, CONST_timeTracking_wtifEndYMD_itemName);
      var endTime_fromDatastore = _itemObj.getWtifData(wapp.timeTracking_wibtypeItemId, null, CONST_timeTracking_wtifEndTime_itemName);
      var minutesTracked = _itemObj.getWtifData(wapp.timeTracking_wibtypeItemId, null, CONST_timeTracking_wtifMinsTracked_itemName);
      var startYmd_fromDatastore = _itemObj.getWtifData(wapp.timeTracking_wibtypeItemId, null, CONST_timeTracking_wtifStartYMD_itemName);
      var startTime_fromDatastore = _itemObj.getWtifData(wapp.timeTracking_wibtypeItemId, null, CONST_timeTracking_wtifStartTime_itemName);

      _resetPrivateVars();

      end_ymdObj.receiveYmd_fromDatastore(endYmd_fromDatastore);
      end_timeObj.receiveTime_fromDatastore(endTime_fromDatastore);

      start_ymdObj.receiveYmd_fromDatastore(startYmd_fromDatastore);
      start_timeObj.receiveTime_fromDatastore(startTime_fromDatastore);

      _setAttempted(start_ymdObj, start_timeObj, minutesTracked, end_ymdObj, end_timeObj);

      _processAttempted_fromDatastore();
    },

    setIncompleteEntryAllowed: function(optional_setToTrueOrFalse) {
      _setIncompleteEntryAllowed(optional_setToTrueOrFalse);
    },

    setEndDatetime_usingStartDatetimeAndDuration: function(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj) {
      _setEndDatetime_usingStartDatetimeAndDuration(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj);
    },

    setItemObj: function(itemObj) {
      _setItemObj(itemObj);
    },

    setStartDatetime_usingEndDatetimeAndDuration: function(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj) {
      _setStartDatetime_usingEndDatetimeAndDuration(startYmdObj, startTimeObj, durationInMinutes, endYmdObj, endTimeObj);
    },

    //zz_func() here, because it does not end with a comma
    //  --> as we add other public methods above, we can add them all with commas, even if would have been alphabetically the last one (if this placeholder zz_func() didn't exist)
    zz_func: function(param1) {
    }
  }
};

var wdt_ymdObjFactory = function() {
  var _yearRaw = null;
  var _monthRaw = null;
  var _dayRaw = null;

  var _yyyy = null;
  var _mm = null;
  var _m = null;
  var _dd = null;
  var _d = null;

  var _isYmdObj = true;

  var _dateIsValid = false;

  var _addDays = function(numDays) {
    if ( ! _dateIsValid ) {
      return;
    }

    if ( ! isNumeric(numDays) ) {
      return;
    }

    var momentObj_ymd = _getAsMomentObj_ymd();

    momentObj_ymd.add( parseInt(numDays), "days" );

    _receiveYmd_fromMoment(momentObj_ymd);
  };

  var _get_ymd = function() {
    var x = _getYmdAsString(_yyyy, _mm, _dd);
    return x;
  };

  var _getAsMomentObj_ymd = function() {
    if ( ! _dateIsValid ) {
      return null;
    }

    var ymd = _get_ymd();
    var momentObj_ymd = moment(ymd);
    return momentObj_ymd;
  };

  var _getDayAsTwoDigitString = function(day) {
    if ( !isNumeric(day) ) return null;

    day = parseInt(day);
    if ( day < 1 || day > 31) return null;

    var dayString;

    if (day < 10) {
      dayString = "0" + day;
    } else {
      dayString = String(day);
    }

    return dayString;
  };

  var _getMomentObj_fromYmdStrings = function(yearString, monthString, dayString) {
    var momentObj_ymd = null;

    yearString = _getYearAsFourDigitString(yearString);
    monthString = _getMonthAsTwoDigitString(monthString);
    dayString = _getDayAsTwoDigitString(dayString);

    if ( ! isBlank(yearString) && ! isBlank(monthString) && ! isBlank(dayString) ) {
      let ymdString = _getYmdAsString(yearString, monthString, dayString);
      momentObj_ymd = moment(ymdString);
    }

    return momentObj_ymd;
  };

  var _getMomentObj_fromYmdObj = function(ymdObj) {
    var returnFromMethod_isYmdObj = returnFromMethod(ymdObj, "isYmdObj")

    if (returnFromMethod_isYmdObj) {
      let momentObj_ymd = ymdObj.getAsMomentObj_ymd();
      return momentObj_ymd;
    } else {
      return null;
    }
  };

  var _getMonthAsTwoDigitString = function(month) {
    if ( !isNumeric(month) ) return null;

    month = parseInt(month);
    if ( month < 1 || month > 12) return null;

    var monthString;

    if (month < 10) {
      monthString = "0" + month;
    } else {
      monthString = String(month);
    }

    return monthString;
  };

  var _getYearAsFourDigitString = function(year) {
    if ( !isNumeric(year) ) return null;

    year = parseInt(year);
    if ( year < 1 || year > 9999) return null;

    var yearString;

    if (year < 10) {
      yearString = "000" + year;
    } else if (year < 100) {
      yearString = "00" + year;
    } else if (year < 1000) {
      yearString = "0" + year;
    } else {
      yearString = String(year);
    }

    return yearString;
  };

  var _getYmdAsString = function(yyyy, mm, dd) {
    var x = yyyy + "-" + mm + "-" + dd;
    return x;
  };

  var _hasBlankYmdPart = function() {
    if ( isBlank(_yyyy) || isBlank(_m) || isBlank(_d) ) {
      return true;
    } else {
      return false;
    }
  };

  var _isClear = function() {
    if ( isBlank(_yyyy) && isBlank(_m) && isBlank(_d) ) {
      return true;
    } else {
      return true;
    }
  };

  var _processRawDateparts = function(skipValidCheck) {
    _dateIsValid = false;

    var yearString = _getYearAsFourDigitString(_yearRaw);
    if ( isBlank(yearString) ) {
      _yyyy = null;
    } else {
      _yyyy = yearString;
    }

    var monthString = _getMonthAsTwoDigitString(_monthRaw);
    if ( isBlank(monthString) ) {
      _mm = null;
      _m = null;
    } else {
      _mm = monthString;
      _m = parseInt(_mm);
    }

    var dayString = _getDayAsTwoDigitString(_dayRaw);
    if ( isBlank(dayString) ) {
      _dd = null;
      _d = null;
    } else {
      _dd = dayString;
      _d = parseInt(_dd);
    }

    if (skipValidCheck) {
      _dateIsValid = true;
    } else {
      var momentObj_ymd = _getMomentObj_fromYmdStrings(yearString, monthString, dayString);

      if ( ! isBlank(momentObj_ymd) ) {
        _dateIsValid = momentObj_ymd.isValid();
      }
    }
  };
  
  var _receiveYmd_fromParams = function(year, month, day, skipValidCheck) {
    _resetPrivateVars();

    _yearRaw = year;
    _monthRaw = month;
    _dayRaw = day;

    _processRawDateparts(skipValidCheck);

    return _dateIsValid;
  };

  var _receiveYmd_fromYmdObj = function(ymdObj, skipValidCheck) {
    return _receiveYmd_fromParams( ymdObj.get_yyyy(), ymdObj.get_m(), ymdObj.get_d(), skipValidCheck );
  };

  var _resetPrivateVars = function() {
    _yearRaw = null;
    _monthRaw = null;
    _dayRaw = null;

    _yyyy = null;
    _mm = null;
    _m = null;
    _dd = null;
    _d = null;

    _dateIsValid = false;
  };

  var _receiveYmd_fromMoment = function(momentObj) {
    if ( ! momentObj.isValid() ) {
      return;
    }

    var year = momentObj.year();
    var month = parseInt( momentObj.month() ) + 1; // moment.js months are 0-indexed
    var day = momentObj.date(); // moment.js uses .date() for the day-of-the-month

    _receiveYmd_fromParams(year, month, day, true);
  };

  return {
    addDays: function(numDays) {
      _addDays(numDays);
    },

    get_d: function() {
      return _d;
    },

    get_dd: function() {
      return _dd;
    },

    get_m: function() {
      return _m;
    },

    get_mm: function() {
      return _mm;
    },

    get_ymd: function() {
      return _get_ymd();
    },

    get_yyyy: function() {
      return _yyyy;
    },

    getAsMomentObj_ymd: function() {
      return _getAsMomentObj_ymd();
    },

    getMomentObj_fromYmdStrings: function(yearString, monthString, dayString) {
      return _getMomentObj_fromYmdStrings(yearString, monthString, dayString);
    },

    hasBlankYmdPart: function() {
      return _hasBlankYmdPart();
    },

    isClear: function() {
      return _isClear();
    },

    isValidYmd: function() {
      return _dateIsValid;
    },

    isYmdObj: function() {
      return _isYmdObj;
    },

    receiveYmd_fromDatastore: function(ymd_fromDatastore) {
      var ymd_array;

      _resetPrivateVars();

      if ( isBlank(ymd_fromDatastore) ) return false;

      ymd_array = ymd_fromDatastore.split("-");

      if ( ymd_array.length < 1 || ymd_array.length > 3 ) return false;

      _yearRaw = ymd_array[0];
      _monthRaw = ymd_array[1];
      _dayRaw = ymd_array[2];

      _processRawDateparts();

      return _dateIsValid;
    },
    
    receiveYmd_fromMoment: function(momentObj) {
      _receiveYmd_fromMoment(momentObj);
    },

    receiveYmd_fromParams: function(year, month, day) {
      return _receiveYmd_fromParams(year, month, day, null);
    },

    receiveYmd_fromYmdObj: function(ymdObj, skipValidCheck) {
      return _receiveYmd_fromYmdObj(ymdObj, skipValidCheck);
    },

    setToBlankDate: function() {
      _resetPrivateVars();
    },

    //zz_func() here, because it does not end with a comma
    //  --> as we add other public methods above, we can add them all with commas, even if would have been alphabetically the last one (if this placeholder zz_func() didn't exist)
    zz_func: function(param1) {
    }
  }
};




///// SAVED FROM PREVIOUS PROJECTS, MIGHT USE LATER

/* (commented-out, as we are not currently using this)
// MODULE-LEVEL ERROR HANDLING - TOP
try {

var KEY_NAME_alt = "alt" ;
var KEY_NAME_backspace = "backspace" ;
var KEY_NAME_ctrl = "ctrl" ;
var KEY_NAME_delete = "delete" ;
var KEY_NAME_down_arrow = "down arrow" ;
var KEY_NAME_end = "end" ;
var KEY_NAME_enter = "enter" ;
var KEY_NAME_esc = "esc" ;
var KEY_NAME_home = "home" ;
var KEY_NAME_left_arrow = "left arrow" ;
var KEY_NAME_page_down = "page down" ;
var KEY_NAME_page_up = "page up" ;
var KEY_NAME_right_arrow = "right arrow" ;
var KEY_NAME_shift = "shift" ;
var KEY_NAME_spacebar = "spacebar" ;
var KEY_NAME_tab = "tab" ;
var KEY_NAME_up_arrow = "up arrow" ;

var page_keyMonitoring = false ;
var page_pauseKeyInput = false ;
var page_sendKeyToCharacter = false ;

var page_escKeyJsFunc = "" ;

var page_curTheKeyDown = null ;
var page_curTheKeyPress = null ;

function getInputElem ( idName , width , defValue ) {
	try {
		var html = "<input id='" + idName + "' name='" + idName + "' type='text' class='input1' style='width: " + width + "' value='" + defValue + "'" ;
		html += " onfocus='keysAllow()' onblur='keysBlock()'/>" ;
		return html ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


function processKeyDown_master ( e ) {
	try {
		var eventObject = window.event ? event : e ;  // distinguish between IE's explicit event object (window.event) and Firefox's implicit
		var keyCode = eventObject.keyCode ;
		var keyDownName = "" ;

		if ( (keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) ) {
			keyDownName = String.fromCharCode ( keyCode ) ;
		} else {
			switch ( keyCode ) {
				case 8 : keyDownName = KEY_NAME_backspace  ; break ;
				case 9 : keyDownName = KEY_NAME_tab ; break ;
				case 13 : keyDownName = KEY_NAME_enter ; break ;
				case 16 : keyDownName = KEY_NAME_shift ; break ;
				case 17 : keyDownName = KEY_NAME_ctrl  ; break ;
				case 18 : keyDownName = KEY_NAME_alt ; break ;
				case 27 : keyDownName = KEY_NAME_esc ; break ;
				case 32 : keyDownName = KEY_NAME_spacebar ; break ;
				case 33 : keyDownName = KEY_NAME_page_up ; break ;
				case 34 : keyDownName = KEY_NAME_page_down ; break ;
				case 35 : keyDownName = KEY_NAME_end ; break ;
				case 36 : keyDownName = KEY_NAME_home ; break ;
				case 37 : keyDownName = KEY_NAME_left_arrow  ; break ;
				case 38 : keyDownName = KEY_NAME_up_arrow ; break ;
				case 39 : keyDownName = KEY_NAME_right_arrow ; break ;
				case 40 : keyDownName = KEY_NAME_down_arrow ; break ;
				case 46 : keyDownName = KEY_NAME_delete ; break ;
				default:
					try {
						console.log ( "keyCode: " + keyCode ) ;
					} catch ( e_inside1 ) {
						// no action -- error is acceptable
					}
			}
		}

		page_curTheKeyDown = new TheKeyDown ( keyDownName , eventObject.ctrlKey , eventObject.altKey , eventObject.shiftKey , eventObject ) ;

		try {
			processKeyDown_page ( page_curTheKeyDown ) ;
		} catch ( e_inside2 ) {
			// no action, error is acceptable
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyDown_page ( theKeyDown ) {
	try {
		var direction ;

		if ( 
		  theKeyDown.keyDownName == KEY_NAME_backspace
		  || theKeyDown.keyDownName == KEY_NAME_spacebar
		  || theKeyDown.keyDownName == KEY_NAME_down_arrow
		  || theKeyDown.keyDownName == KEY_NAME_left_arrow
		  || theKeyDown.keyDownName == KEY_NAME_right_arrow
		  || theKeyDown.keyDownName == KEY_NAME_up_arrow
		  || theKeyDown.keyDownName == KEY_NAME_page_down
		  || theKeyDown.keyDownName == KEY_NAME_page_up
		  || ( theKeyDown.keyDownName == "A" && theKeyDown.ctrl && ! showingLocalStorage )
		) {
			if ( ! control.allowKeys ) theKeyDown.stopEvent ( ) ;
		}

		if ( page_pauseKeyInput ) return ;

		if ( screens.curScreen ) {
			screens.curScreen.processKeyDown ( theKeyDown ) ;
			return ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyPress_master ( e ) {
	try {
		var eventObject = window.event ? event : e ; // distinguish between IE's explicit event object (window.event) and Firefox's implicit
		var keyCode = eventObject.keyCode ;
		var charCode = eventObject.charCode ;
		var ctrlKey = eventObject.ctrlKey ;
		var altKey = eventObject.altKey ;
		var shiftKey = eventObject.shiftKey ;
		var keyPressName ;

		//alert("keyCode="+keyCode+" --- charCode="+charCode+" --- ctrlKey="+ctrlKey+" --- altKey="+altKey+" --- shiftKey="+shiftKey)

		if ( charCode ) {
			keyPressName = String.fromCharCode ( charCode ) ;
		} else {
			switch ( keyCode ) {
				case 8 : keyPressName = KEY_NAME_backspace  ; break ;
				case 9 : keyPressName = KEY_NAME_tab ; break ;
				case 13 : keyPressName = KEY_NAME_enter ; break ;
				case 27 : keyPressName = KEY_NAME_esc ; break ;
				case 32 : keyPressName = KEY_NAME_spacebar ; break ;
				case 33 : keyPressName = KEY_NAME_page_up ; break ;
				case 34 : keyPressName = KEY_NAME_page_down ; break ;
				case 35 : keyPressName = KEY_NAME_end ; break ;
				case 36 : keyPressName = KEY_NAME_home ; break ;
				case 37 : keyPressName = KEY_NAME_left_arrow  ; break ;
				case 38 : keyPressName = KEY_NAME_up_arrow ; break ;
				case 39 : keyPressName = KEY_NAME_right_arrow ; break ;
				case 40 : keyPressName = KEY_NAME_down_arrow ; break ;
				case 46 : keyPressName = KEY_NAME_delete ; break ;
				default:
					try {
						console.log ( "keyCode="+keyCode+" --- charCode="+charCode+" --- ctrlKey="+ctrlKey+" --- altKey="+altKey+" --- shiftKey="+shiftKey ) ;
					} catch ( e_inside1 ) {
						// no action -- error is acceptable
					}
			}
		}

		page_curTheKeyPress = new TheKeyPress ( keyPressName , ctrlKey , altKey , shiftKey ) ;
		try {
			processKeyPress_page ( page_curTheKeyPress ) ;
		} catch ( e_inside2 ) {
			// no action, error is acceptable
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyPress_page ( theKeyPress ) {
	try {
		if ( page_pauseKeyInput ) return ;

		if ( screens.curScreen ) {
			screens.curScreen.processKeyPress ( theKeyPress ) ;
			return ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function startKeyMonitoring ( ) {
	try {
		page_keyMonitoring = true ;
		page_sendKeyToCharacter = true ;
		document.onkeydown = processKeyDown_master ;
		document.onkeypress = processKeyPress_master ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function TheKeyDown ( keyDownName , ctrl , alt , shift , eventObject ) {
	try {
		this.keyDownName = String(keyDownName) ;
		this.ctrl = ctrl ;
		this.alt = alt ;
		this.shift = shift ;
		this.eventObject = eventObject ;
		
		this.stopEvent = function ( ) {
			this.eventObject.preventDefault ( ) ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function TheKeyPress ( keyPressName , ctrlKey , altKey , shiftKey ) {
	try {
		this.keyPressName = keyPressName ;
		this.ctrlKey = ctrlKey ;
		this.altKey = altKey ;
		this.shiftKey = shiftKey ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


startKeyMonitoring() ;


// MODULE-LEVEL ERROR HANDLING - BOTTOM
} catch ( e ) {
	throw ( handleAndReturnError ( e ) ) ;
}



///////////////
///////////////


function add ( startingValue , amountToAdd1 , amountToAdd2 , amountToAdd3 ) {
	try {
		if ( ! isNumeric(startingValue) ) startingValue = 0 ; // throw ( "add(), received invalid startingValue=" + startingValue ) ;
		if ( ! isNumeric(amountToAdd1) ) amountToAdd1 = 0 ; // throw ( "add(), received invalid amountToAdd1=" + amountToAdd1 ) ;

		var newValue = parseFloat(startingValue) + parseFloat(amountToAdd1) ;

		if ( isNumeric(amountToAdd2) ) newValue = parseFloat(newValue) + parseFloat(amountToAdd2) ;

		if ( isNumeric(amountToAdd3) ) newValue = parseFloat(newValue) + parseFloat(amountToAdd3) ;

		return newValue ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


function confirmInput ( elem , valueName , isRequired , minVal , maxVal ) {
	try {
		var val = elem.value ;

		if ( isRequired && ! val ) {
			alert ( valueName + " is required." ) ;
			elem.focus() ;
			return false ;
		}

		if ( ! isNumeric(minVal) ) minVal = null ;
		if ( ! isNumeric(maxVal) ) maxVal = null ;

		if ( ( minVal || maxVal ) && val && ! isNumeric(val) ) {
			alert ( valueName + " requires a numeric value." ) ;
			elem.focus() ;
			return false ;
		}

		if ( minVal && val && val < minVal ) {
			alert ( valueName + " must be at least " + getNumberWithCommas(minVal) + "." ) ;
			elem.focus() ;
			return false ;
		}

		if ( maxVal && val && val > maxVal ) {
			alert ( valueName + " must be no more than " + getNumberWithCommas(maxVal) + "." ) ;
			elem.focus() ;
			return false ;
		}

		return true ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getElem ( elem_OR_elemId ) {
	try {
		var testElemId , elem ;

		testElemId = getProp ( elem_OR_elemId , "id" ) ;

		if ( testElemId ) {
			elem = elem_OR_elemId ;
		} else {
			elem = document.getElementById ( elem_OR_elemId ) ;
		}

		return elem ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

function getElemPxAsNumber ( elemPx ) {
	try {
		var elemPx = String(elemPx) ;
		var asNumber = withoutRight ( elemPx , "px" ) ;
		return asNumber ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

// this function from http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript
function getNumberWithCommas ( x ) {
	try {
		if ( ! x ) return 0 ;
		
		var y = String(x) ;

		var parts = y.split(".") ;
		parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",") ;

		var z = parts.join(".") ; 

		return z ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getProp ( item , propertyName ) {
	try {
		var propertyValue ;
		try {
			propertyValue = item[propertyName] ;
		} catch ( e ) {
		}
		return propertyValue ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getRandomNumber ( max , min ) {
	try {
		if ( ! min ) min = 1 ;

		max = 1 * max ;
		min = 1 * min ;

		if ( min > max ) {
			var temp = min ;
			min = max ;
			max = temp ;   
		}
		
		var diff = max - min ;
		var diffPlusOne = (diff + 1) ;
		
		var tempRandomNum = Math.floor ( Math.random() * diffPlusOne ) ;

		var finalRandomNum = (tempRandomNum + min) ;
		return finalRandomNum ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function handleError_OLD ( squex ) {
	try {
		if ( ! squex.alerted ) {
			var msg = squex.ex.fileName + "\n" ;
			msg += "\n" ;
			msg += "LINE: " + squex.ex.lineNumber + "\n" ;
			msg += "COLUMN: " + squex.ex.columnNumber + "\n" ;
			msg += "\n" ;
			msg += ex ;
			msg += "\n" ;

			alert ( msg ) ;
		}
		
		throw ( squex ) ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function isSame ( val1 , val2 ) {
	try {
		if ( ( val1 === 0 || val1 === "0" ) && ( val2 === 0 || val2 === "0" ) ) return true ;
		if ( ( val1 === 0 || val1 === "0" ) && ! ( val2 === 0 || val2 === "0" ) ) return false ;
		if ( ! ( val1 === 0 || val1 === "0" ) && ( val2 === 0 || val2 === "0" ) ) return false ;

		if ( ! val1 && ! val2 ) return true ;

		if ( Number ( val1 ) == Number ( val2 ) ) return true ;

		if ( val1 == val2 ) return true ;

		return false ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

function eval2 ( val ) {
	return val ;
}

function runJsFuncWithArgs ( jsFunc , args ) {
	try {
//alert("runJsFuncWithArgs() --- jsFunc.name="+jsFunc.name)
		if ( args ) {
			if ( getProp ( args , "arg5" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) , eval(args.arg4) , eval(args.arg5) )  ;
			} else if ( getProp ( args , "arg4" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) , eval(args.arg4) )  ;
			} else if ( getProp ( args , "arg3" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) )  ;
			} else if ( getProp ( args , "arg2" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) )  ;
			} else {
				jsFunc ( eval(args.arg1) )  ;
			}
		} else {
			jsFunc() ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function setElem ( elemId , val ) {
	try {
		var elem = getElem(elemId) ;
		if ( ! elem ) throw ( sqErrTxt ( "setFocusToLink() --- invalid elemId received ('" + elemId + "')" ) ) ;

		if ( isBlank(val) ) val = "" ;

		elem.value = val ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function setFocusToElem ( elemId , doSelect ) {
	try {
		var elem = getElem(elemId) ;
		if ( ! elem ) throw ( sqErrTxt ( "setFocusToLink() --- invalid elemId received ('" + elemId + "')" ) ) ;

		elem.focus() ;

		if ( doSelect && elem.select ) {
			elem.select() ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function showAllProperties ( theObj ) {
	try {
		var propName ;
		for ( propName in theObj ) {
			alert ( propName + " --- " + theObj[propName] ) ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}



// ERROR HANDLING

var Squerror = Object.create ( Error ) ;

Squerror.doAlert = function ( ) {
	var msg = "" ;

	if ( this.ex ) {
		var fileName = getProp ( this.ex , "fileName" ) ;
		if ( fileName ) {
			msg = fileName + "\n" ;
			msg += "\n" ;
		}

		var lineNumber = getProp ( this.ex , "lineNumber" ) ;
		var columnNumber = getProp ( this.ex , "columnNumber" ) ;
		if ( lineNumber && columnNumber ) {
			msg += "LINE: " + lineNumber + " / COLUMN: " + columnNumber + "\n" ;
			msg += "\n" ;
		}
	}

	msg += this.message + "\n" ;
	msg += "\n" ;

	alert ( msg ) ;

	this.alerted = true ;
} ;

function createSquerrorFromException ( ex ) {
	var squerror = Object.create ( Squerror ) ;

	squerror.isSquerror = true ;
	squerror.ex = ex ;

	var message = ex ;
	if ( ! message ) message = "" ;
	try {
		message = String(message) ;
	} catch ( e ) {
		// no action
	}
	squerror.message = message ;

	squerror.alerted = false ;

	return squerror ;
}

function createSquerrorFromText ( text ) {
	var squerror = Object.create ( Squerror ) ;

	squerror.isSquerror = true ;
	squerror.ex = null ;

	if ( ! text ) text = "" ;
	try {
		text = String(text) ;
	} catch ( e ) {
		// no action
	}
	squerror.message = text ;

	squerror.alerted = false ;

	return squerror ;
}

var sqErrTxt = createSquerrorFromText ;

function handleAndReturnError ( theObj ) {
	var newObj ;

	if ( getProp ( theObj , "isSquerror" ) ) {
		newObj = theObj ;
	} else {
		newObj = createSquerrorFromException ( theObj ) ;
	}

	if ( ! newObj.alerted ) {
		newObj.doAlert() ;
	}

	return newObj ;
}


// MODULE-LEVEL ERROR HANDLING - BOTTOM
} catch ( e ) {
	throw ( handleAndReturnError ( e ) ) ;
}


*/


</script>

</body>
</html>
