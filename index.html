<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>

<style>
* {box-sizing: border-box}

a {color: blue; outline: 0}
a:link {text-decoration: none}
a:visited {text-decoration: none}
a:hover {text-decoration: underline}
a:focus {text-decoration: underline}
a:active {text-decoration: none}

body {font-size: 110%; font-family: Helvetica}
/* div {padding: 0; margin: 0} */
input {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9}
input.ipMonthDay {width: 1.85em; padding-top: 3px; text-align: center}
input.ipNumeric {width: 3em; padding-left: 4px; padding-right: 4px; padding-top: 3px}
input.ipText {padding-left: 4px; padding-right: 4px; padding-top: 1px}
input.ipTime {width: 1.85em; padding-top: 3px; text-align: center}
input.ipYear {width: 2.85em; padding-top: 3px; text-align: center}
select {font-size: 95%; font-family: Helvetica; background-color: #f9f9f9; padding-left: 1px; padding-right: 1px}
table {}

.grid1 {display: grid; grid-template-columns: auto auto auto; padding: 0.5em; padding-right: 0.75em; padding-bottom: 0.65em}
.grid1Cell {/* border: 1px solid red */}
.gc1Header {grid-column: 1/4; padding-bottom: 0.5em; border-bottom: 1px gray solid; text-align: center}
.gc1Line {grid-column: 1/4; border-bottom: 1px gray solid}
.gc1VSpace1 {grid-column: 1/4; padding-bottom: 1em}
.gc1VSpace2 {grid-column: 1/4; padding-bottom: 1em}
.gc1VSpace3 {grid-column: 1/4; padding-bottom: 0.5em}
.gc1VSpace4 {grid-column: 1/4; padding-bottom: 1.8em}
.gc1Text {white-space: nowrap; padding-right: 0.6em; padding-top: 3px; text-align: right}
.gc1TextRight {font-style: italic; padding-top: 3px; text-align: left}
.gc1TextForCheckbox {white-space: nowrap; padding-right: 0.6em; text-align: right}
.gc1TextForActionCheckbox {grid-column: 1/3; padding-right: 0.6em; text-align: right}
.gc1Input {grid-column: 2/4}
.gc1Select {grid-column: 2/4}
.gc1Checkbox {grid-column: 2/4}
.gc1ActionCheckbox {padding-top: 0px /* 2px top padding looked even on PC, but not on Android */}
.gc1ActionCheckboxFirst {padding-right: 5em}
.gc1Footer {grid-column: 1/4; text-align: center}
.gc1QuickLinks {grid-column: 1/4; text-align: left}

.grid2 {display: inline-grid; grid-template-columns: auto auto}
.grid2Cell {/* border: 1px solid red */}
.gc2Header {grid-column: 1/3; padding-bottom: 0.5em; border-bottom: 1px gray solid; text-align: left}
.gc2Header2 {grid-column: 1/3; padding-bottom: 0.4em; border-bottom: 1px gray solid; text-align: center}
.gc2VSpace1 {grid-column: 1/3; padding-bottom: 0.6em}
.gc2VSpace2 {grid-column: 1/3; padding-bottom: 0.6em}
.gc2VSpace3 {grid-column: 1/3; padding-bottom: 0.5em}
.gc2TextLeft {white-space: nowrap; padding-right: 0.8em; /* padding-top: 3px; */ text-align: right}
.gc2TextRight {white-space: nowrap}
.gc2Footer {grid-column: 1/3; text-align: left}

.grid3 {display: grid; grid-template-columns: auto auto; grid-gap: 10px; border: 2px solid grey; padding: 10px}
.gc3 {border: 1px solid lightgrey; padding: 5px}
.gc3TextLeft {width: 150px; padding-right: 5px; text-align: right}
.gc3TextRight {width: 150px}
.gc3LikeInput {width: 140px; display: inline-block; text-align: center}
.gc3InputRight {width: 150px}
.gc3Header {grid-column: 1/3; font-weight: bold; font-size: 18px; text-align: center}
.gc3Footer {grid-column: 1/3; text-align: center}

.bold {font-weight: bold}
.font85 {font-size: 85%}
.font135 {font-size: 135%}

.brown {color: brown}
.green {color: #00CC66}
.red {color: red}

.likeInput {font-size: 95%; background-color: #f9f9f9; border: 1px solid darkgray; box-shadow: 1px 1px 1px 0 lightgray inset}

.popUpMaxTextWidth {width: 10em}
.popUpText {display: block}

/*
input.ipTime {background-color: yellow}
input.ipTime {width: 2em; padding-top: 2px; text-align: center}
*/
</style>

<title>wib</title>
</head>
<body>
<script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>


<div id="dvMainViewOverlay" style="/* border: 1px solid red */">

  <div id="dvAppHeader">
    <span id="spnAppHeader_OptionalPageTitle" class="bold" style="display: none"></span>
    <span id="spnAppHeader_AppParen1" class="font85">&nbsp;&nbsp;(</span>
    <span id="spnAppHeader_AppNameAndVersion" class="bold font135">wib v0.0</span>
    <span id="spnAppHeader_AppParen2" class="font85">)</span>
    <span id="spnAppHeader_Home">
      &nbsp;&nbsp;&nbsp;<a href="javascript:void return_home()" style="white-space: nowrap; font-size: 110%"><b>home</b></a>
    </span>
    <span id="spnAppHeader_Dev">
      &nbsp;&nbsp;&nbsp;<a href="javascript:void show_dev_screen()"><span style="white-space: nowrap; font-size: 80%">(dev)</span></a>
    </span>
    <span id="spnAppHeader_Builder">
      &nbsp;&nbsp;<a href="javascript:void go_to_builder()"><span style="white-space: nowrap; font-size: 80%">(builder)</span></a>
    </span>
    <div style="height:1.0em"></div>
  </div>

  <div id="dvPage_BackupExport" style="display: none">
    <div style="display: inline-block">
      <table cellspacing=0 cellpadding=0>
      <tr><td style="height: 20px"></td></tr>
      </table>
      <div style="height:1em"></div>
    </div>
    <div style="height:0.8em"></div>
    <textarea id="taExportedBackupText" style="height: 50vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea>
    <div style="height:0.8em"></div>
    <div><a href="javascript:void copy_imported_text_to_clipboard()">copy to clipboard</a></div>
    <div style="height:2em"></div>
  </div>

  <div id="dvPage_BackupImport" style="display: none">
    <div style="height:0.8em"></div>
    <div>Paste text-to-import below:</div>
    <div style="height:0.4em"></div>
    <textarea id="taBackupTextToImport" style="height: 50vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea>
    <div style="height:0.8em"></div>
    <div><a href="javascript:void begin_import()">begin import</a></div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_Dev" style="display: none">
    <div style="height:0.8em"></div>
    <div><a href="javascript:void export_backup_text()">export backup text</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void import_backup_text()">import backup text</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_import_blocked()">toggle import-backup-text blocked (for this device)</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_dev()">toggle dev mode</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void toggle_app_narrow()">toggle app narrow mode</a></div>
    <div style="height:1.7em"></div>
    <div><a href="javascript:void show_storage()">show storage</a></div>
    <div style="height:100em"></div>
    <div><a href="javascript:void clear_storage()">clear storage</a></div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_Home" style="display: none">
    <div style="font-weight: bold">Home</div>
    <div style="height:0.8em"></div>
    <div>
      <a href="javascript:void make_new_list()" style="white-space: nowrap">make new list</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void show_types()" style="white-space: nowrap">show types</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
    <div id="dvHome_Items"></div>
    <div style="height: 0.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div><a href="javascript:void make_new_list()">make new list</a></div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_MoveOrCopy" style="display: none">
    <div style="font-weight: bold">Moving or Copying Items</div>
    <div style="height:0.8em"></div>
    <div>from list:&nbsp;&nbsp;&nbsp;<span id="spnMoveOrCopy_FromList"></span></div>
    <div style="height:1.5em"></div>
    <div>moving or copying these items:</div>
    <div style="height:0.8em"></div>
    <div style="display: inline-block">
      <div style="border-bottom: 1px black solid"></div>
      <div style="height:1em"></div>
      <div id="dvMoveOrCopy_ItemsBeingMovedOrCopied"></div>
      <div style="height:1em"></div>
      <div style="border-bottom: 1px black solid"></div>
    </div>
    <div style="height:1.5em"></div>
    <div>... to which list?&nbsp;&nbsp;&nbsp;<a id="aMoveOrCopy_Cancel" style="white-space: nowrap" href="javascript:void cancel_move()">cancel</a></div>
    <div style="height:0.8em"></div>
    <div style="display: inline-block">
      <div style="border-bottom: 1px black solid"></div>
      <div style="height:1em"></div>
      <div id="dvMoveOrCopy_ListsToMoveOrCopyItemsTo"></div>
      <div style="height:1em"></div>
      <div style="border-bottom: 1px black solid"></div>
    </div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_NavigateItems" style="display: none">
    <div class="red" style="font-weight: bold">Navigation</div>
    <div style="height: 0.8em"></div>
    <div>
      <a href="javascript:void _____()" style="white-space: nowrap">_____</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void _____()" style="white-space: _____">_____</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
      <div id="dvNavigateItems_Items"></div>
    <div style="height: 0.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void _____()" style="white-space: nowrap">_____</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void _____()" style="white-space: nowrap">_____</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_ShowStorage" style="display: none">
    <div id="dvStorage"></div>
    <div style="height:0.6em"></div>
    <div style="display: inline-block">
      <hr></hr>
      <div style="height:0.8em"></div>
      <div><a href="javascript:void return_home_from_storage()">return home</a></div>
    </div>
    <div id="dvShowStorage_EditAllItemIds">
      <div style="height:1em"></div>
      <textarea id="taShowStorage_EditAllItemIds" style="height: 20vh; width: 80vw; border: 1px black solid; padding: 10px"></textarea><br />
      <a href="javascript:void edit_storage_row__do_all_items_edit()" style="white-space: nowrap">make this edit</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void edit_storage_row__cancel_all_items_edit()" style="white-space: nowrap">cancel</a>
    </div>
    <div style="height:1em"></div>
  </div>

  <div id="dvPage_WibBuilder_AllScreens" style="display: none">
    <div style="">
      <a href="javascript:void all_screens__build_new_screen()">build new screen</a>
    </div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div id="WibBuilder_AllScreens_Items"></div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div style="">
      <a href="javascript:void all_screens__build_new_screen()">build new screen</a>
    </div>
  </div>

  <div id="dvPage_WibBuilder_BuildScreen" style="display: none">
    <div style="display: grid; width: 20em; margin-left: 0.3em; padding: 0.7em; padding-bottom: 1em; border: 0.2em solid lightgrey; border-bottom: 0; font-size: 90%; font-style: italic">
      <div style="font-weight: bold">Info About This Screen:</div>
      <div style="height: 0.7em"></div>
      <div style="height: 0.1em; background-color: black"></div>
      <div style="height: 0.7em"></div>
      <div style="display: grid; grid-template-columns: auto auto">
        <div style="text-size: 85%; padding-right: 0.3em; text-align: right">type of thing being created:</div>
        <div id="dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Link">
          <a id="aWibBuilder_BuildScreen_TypeName" style="text-size: 85%; font-style: normal" href="javascript:void build_screen__name_type()">(click here)</a>
        </div>
        <div id="dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Text" style="display: none; text-size: 85%; font-style: normal"></div>
      </div>
    </div>
    <div style="display: grid; width: 19.5em; border: 0.2em solid grey; padding: 0.5em">
      <div id="dvWibBuilder_BuildScreen_HeaderText" style="border: 0.2em solid lightgrey; padding: 0.5em; font-weight: bold; text-align: center">Create&nbsp;&nbsp;________</div>
      <div style="height: 0.5em"></div>
      <div style="display: grid; grid-template-columns: auto auto; grid-gap: 0.4em">
        <div id="dvWibBuilder_BuildScreen_ItemNameText" style="border: 0.2em solid lightgrey; width: ; padding: 0.5em; padding-top: 0.7em; text-align: right">_______ Name:</div>
        <div style="border: 0.2em solid lightgrey; width: ; padding: 0.5em">
          <input style="width: 100%" />
        </div>
      </div>
      <div style="height: 0.5em"></div>
      <div style="border: 0.2em solid lightgrey; padding: 0.5em; color: blue; font-style: italic; text-align: center">save&nbsp;&nbsp;&nbsp;</div>
    </div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void build_screen__run_this_screen()">run this screen</a></div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void build_screen__go_to_all_screens()">list of all screens</a></div>
  </div>

  <div id="dvPage_WibBuilder_RunScreen" style="display: none">
    <div style="display: grid; width: 19.5em; border: 0.2em solid grey; padding: 0.8em">
      <div id="dvWibBuilder_RunScreen_HeaderText" style="font-weight: bold; text-align: center">Create&nbsp;&nbsp;________</div>
      <div style="height: 1em"></div>
      <div style="display: grid; grid-template-columns: auto auto; grid-gap: 0.4em">
        <div id="dvWibBuilder_RunScreen_ItemNameText" style="width: ; padding-top: 0.15em; text-align: right">_______ Name:</div>
        <div style="width: ">
          <input class="ipText" id="ipWibBuilder_RunScreen_ItemNameValue" style="width: 100%" />
        </div>
      </div>
      <div style="height: 1em"></div>
      <div style="text-align: center"><a href="javascript:void run_screen__save_new_item()">save</a>&nbsp;&nbsp;&nbsp;</div>
    </div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void run_screen__build_this_screen()">build this screen</a></div>
    <div style="height: 1.8em"></div>
    <div><a href="javascript:void run_screen__go_to_all_screens()">list of all screens</a></div>
  </div>

  <div id="dvPage_WibBuilder_ShowWibtypeInstances" style="display: none">
    <div><a href="javascript:void show_instances__go_to_all_screens()">list of all screens</a></div>
    <div style="height: 1.2em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 0.7em"></div>
    <div id="WibBuilder_ShowWibtypeInstances_Items"></div>
    <div style="height: 0.7em"></div>
    <div style="height: 0.1em; background-color: black"></div>
    <div style="height: 1.2em"></div>
    <div><a href="javascript:void show_instances__go_to_all_screens()">list of all screens</a></div>
  </div>

  <div id="dvPage_Wibtypes" style="display: none">
    <div class="red" style="font-weight: bold">Types</div>
    <div style="height: 0.8em"></div>
    <div>
      <a href="javascript:void make_new_type()" style="white-space: nowrap">make new type</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void return_home()" style="white-space: nowrap">home</a>
    </div>
    <div style="height: 1em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1.4em"></div>
      <div id="dvWibtypes_Items"></div>
    <div style="height: 0.4em"></div>
    <div style="height: 5px; border: 2px solid #AAAAAA">
      <div style="height: 1px; background-color: #DDDDDD"></div>
    </div>
    <div style="height: 1em"></div>
    <div>
      <a href="javascript:void make_new_type()" style="white-space: nowrap">make new type</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void return_home()" style="white-space: nowrap">home</a>
    </div>
    <div style="height: 1em"></div>
  </div>

  <div id="dvPage_ViewItem" style="display: none">

    <div id="dvViewItem_ItemNameArea">
      <div id="dvItemName" style="font-weight: bold"></div>
    </div>

    <div id="dvViewItem_JoinedListsArea" style="display: none">
      <div style="height: 0.3em"></div>
      <div id="dvListNameForItem"></div>
    </div>

    <div id="dvViewItem_ConnectedItemsArea">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div><a href="javascript:void add_connected_item()" style="white-space: nowrap">add connected item</a></div>
      <div style="height: 0.95em"></div>
      <div id="dvViewItem_ConnectedItems_Items"></div>
    </div>

    <div id="dvViewItem_ItemActionsArea">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <div>
          <span id="spnViewItem_DoneStatusDisplay" style="display: none">DONE&nbsp;&nbsp;</span>
          <span id="spnViewItem_DoneStatusLink" style="display: none">
            <a id="aViewItem_DoneStatusLink" href="javascript:void change_done_status()" style="white-space: nowrap">mark done</a>
          </span>
          <span id="spnViewItem_MoveCopy" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void move_or_copy_to_different_list()" style="white-space: nowrap">move or copy</a>
          </span>
          <span id="spnViewItem_ShowWibtypes" style="display: none">
            <a href="javascript:void show_types()" style="white-space: nowrap">back to types</a>
          </span>
          <span id="spnViewItem_ShowWibtypeInfoField" style="display: none">
            <span style="white-space: nowrap">back to <a id="aViewItem_BackToType" href="javascript:void back_to_type()">type</a></span>
          </span>
        </div>
        <div style="height: 1.4em"></div>
        <div>
          <a href="javascript:void rename_item()"><nowrap>rename</nowrap></a>
          <span id="spnViewItem_Delete">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void delete_item()"><nowrap>delete</nowrap></a>
          </span>
          <span id="spnViewItem_Notes_No" style="display: none">
            &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void add_notes()"><nowrap>add notes</nowrap></a>
          </span>
        </div>
      </div>
    </div>

    <div id="dvViewItem_Notes_Yes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div id="dvViewItem_Notes"></div>
      <div style="height: 0.2em"></div>
      <div>
        <a style="white-space: nowrap" href="javascript:void edit_notes()">edit notes</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void delete_notes()">delete notes</a>
      </div>
    </div>

    <div id="dvViewItem_Wibtypes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
  <!--
      <div><a href="javascript:void assign_item_to_type()" style="white-space: nowrap">assign this item to a type</a></div>
      <div style="height: 0.95em"></div>
  -->
      <div id="dvViewItem_Wibtypes_WtifData"></div>
    </div>

    <div id="dvViewItem_WibtypeInfoFieldInfo" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div class="grid2">
        <div class="grid2Cell gc2Header">Info-Field Info:&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void edit_info_field_info()">edit</a></div>
        <div class="grid2Cell gc2VSpace1"></div>
        <div class="grid2Cell gc2TextLeft">Data Type:</div>
        <div class="grid2Cell gc2TextRight"><span id="spn_ViewItem_WibtypeInfoFieldInfo_WibDataType"></span></div>
        <div class="grid2Cell gc2VSpace2"></div>
        <div class="grid2Cell gc2TextLeft">Required:</div>
        <div class="grid2Cell gc2TextRight"><span id="spn_ViewItem_WibtypeInfoFieldInfo_Required"></span></div>
      </div>
    </div>

    <div id="dvViewItem_ListMembers_No" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div><a href="javascript:void make_into_a_list()">make into a list</a></div>
    </div>

    <div id="dvViewItem_ListMembers_Yes" style="display: none">
      <div style="height: 0.95em"></div>
      <div style="height: 5px; border: 2px solid #AAAAAA">
        <div style="height: 1px; background-color: #DDDDDD"></div>
      </div>
      <div style="height: 0.95em"></div>
      <div>
        <span id="spnViewItem_MakeNewItem1">
          <a href="javascript:void make_new_item()" style="white-space: nowrap">new item</a>
        </span>
        <span id="spnViewItem_MakeNewField1">
          <a href="javascript:void make_new_type_info_field()" style="white-space: nowrap">new info-field</a>
        </span>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aReorder1" style="white-space: nowrap" href="javascript:void toggle_reorder()">reorder</a>
        <span id="spnViewItem_More1">
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aMoreOptions1" style="white-space: nowrap" href="javascript:void toggle_more_options()">more...</a>
        </span>
      </div>
      <div id="dvMoreOptions1" style="display: none">
        <div style="height: 1.4em"></div>
        <div>
          <a style="white-space: nowrap" href="javascript:void mark_all()">mark all</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id='aGrabItems1' style="white-space: nowrap" href="javascript:void grab_items()">grab</a>
        </div>
      </div>
      <div style="height: 1em"></div>
      <div style="display: inline-block">
        <div style="border-bottom: 2px solid #BBBBBB"></div>
        <div style="height: 1.2em"></div>
        <div id="dvViewItem_ListMembers_Items"></div>
        <div style="height: 0.3em"></div>
        <div style="border-bottom: 2px solid #BBBBBB"></div>
      </div>
      <div style="height: 1em"></div>
      <div>
        <span id="spnViewItem_MakeNewItem2">
          <a href="javascript:void make_new_item()" style="white-space: nowrap">new item</a>
        </span>
        <span id="spnViewItem_MakeNewField2">
          <a href="javascript:void make_new_type_info_field()" style="white-space: nowrap">new field</a>
        </span>
        &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aReorder2" style="white-space: nowrap" href="javascript:void toggle_reorder()">reorder</a>
        <span id="spnViewItem_More2">
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="aMoreOptions2" style="white-space: nowrap" href="javascript:void toggle_more_options()">more...</a>
        </span>
      </div>
      <div id="dvMoreOptions2" style="display: none">
        <div style="height: 1.4em"></div>
        <div>
          <a style="white-space: nowrap" href="javascript:void mark_all()">mark all</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id='aGrabItems2' style="white-space: nowrap" href="javascript:void grab_items()">grab</a>
        </div>
      </div>
    </div>

    <div id="dvViewItem_EndSpacerArea">
      <div style="height:1em"></div>
    </div>

  </div> <!-- END OF: id="dvPage_ViewItem" -->


</div> <!-- END OF: id="dvMainViewOverlay" -->


<div id="dvPopUp" style="display: none; border: 2px black solid">

  <div class="grid1" id="dvPopUp_MakeNewItem" style="display: none; padding-top: 0.3em">
    <div class="grid1Cell gc1Header" style="padding-bottom: 0.3em"><b>Make New Item</b></div>
    <div class="grid1Cell gc1VSpace3" style="padding-bottom: 0.3em"></div>
    <div class="grid1Cell gc1QuickLinks">
      <a style="white-space: nowrap; font-size: 95%" href="javascript:void do_make_new_item_line()">quick line</a>
    </div>
    <div class="grid1Cell gc1VSpace3" style="padding-bottom: 0.1em"></div>
    <div class="grid1Cell gc1Text" style="padding-left: 2em">Item Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewItem_ItemName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">add to top of list:</div>
    <div class="grid1Cell gc1ActionCheckbox gc1ActionCheckboxFirst"><input id="ckMakeNewItem_TopOfList" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">remain on list view:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_StayListView" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">add additional items:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_AddMoreItems" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForActionCheckbox">do time tracking:</div>
    <div class="grid1Cell gc1ActionCheckbox"><input id="ckMakeNewItem_TimeTracking" onclick="doCheckboxClickAction('ckMakeNewItem_TimeTracking')" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">
      <a style="white-space: nowrap; font-size: 90%" href="javascript:void set_ymd_to_today()">today</a>&nbsp;&nbsp;&nbsp;&nbsp;Y / M / D:
    </div>
    <div class="grid1Cell gc1Input gc1Group1">
      <input id="ipMakeNewItem_Year" class="ipYear" maxlength="4" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_Month" class="ipMonthDay" maxlength="2" />
      &nbsp;/&nbsp;&nbsp;<input id="ipMakeNewItem_Day" class="ipMonthDay" maxlength="2" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">Time:</div>
    <div class="grid1Cell gc1Input gc1Group1">
      <input id="ipMakeNewItem_Hour" class="ipTime" maxlength="2" />
      : <input id="ipMakeNewItem_Minute" class="ipTime" maxlength="2" />
    </div>
    <div class="grid1Cell gc1VSpace2 gc1Group1"></div>
    <div class="grid1Cell gc1Text gc1Group1">Mins Tracked:</div>
    <div class="grid1Cell gc1Input gc1Group1"><input id="ipMakeNewItem_MinutesTracked" class="ipNumeric" maxlength="4" /></div>
    <div class="grid1Cell gc1VSpace2" style="padding-bottom: 0.8em"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void do_make_new_item()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a style="white-space: nowrap" href="javascript:void cancel_make_new_item()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewWibtype" style="display: none">
    <div class="grid1Cell gc1Header red"><b>Make New Type</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">Type Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewWibtype_WibtypeName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void do_make_new_type()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void cancel_make_new_type()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_MakeNewWibtypeInfoField" style="display: none">
    <div class="grid1Cell gc1Header red"><b>Make New Info-Field</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">Type Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnMakeNewWibtypeInfoField_WibtypeName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Info-Field Name:</div>
    <div class="grid1Cell gc1Input"><input id="ipMakeNewWibtypeInfoField_WibtypeInfoFieldName" class="ipText popUpMaxTextWidth" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Data Type:</div>
    <div class="grid1Cell gc1Select"><span id="spnMakeNewWibtypeInfoField_WibDataTypeId" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1TextForCheckbox">Required:</div>
    <div class="grid1Cell gc1Checkbox"><input id="ckMakeNewWibtypeInfoField_Required" type="checkbox" /></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void do_make_new_type_info_field()">make</a>
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href="javascript:void cancel_make_new_type_info_field()">cancel</a>
    </div>
  </div>

  <div class="grid1" id="dvPopUp_ChangeDoneStatus" style="display: none">
    <div class="grid1Cell gc1Header"><b>Change Done Status</b></div>
    <div class="grid1Cell gc1VSpace1"></div>
    <div class="grid1Cell gc1Text">List Name:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_mainListName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Item Name:</div>
<!--
    <div class="grid1Cell gc1TextRight popUpText popUpMaxTextWidth" id="dvChangeDoneStatus_itemName" style="padding: 0"></div>
-->
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_itemName" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Text">Current Status:</div>
    <div class="grid1Cell gc1TextRight"><span id="spnChangeDoneStatus_currentStatus" class="popUpText popUpMaxTextWidth"></span></div>
    <div class="grid1Cell gc1VSpace3"></div>
    <div class="grid1Cell gc1Line"></div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Undone1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Undone2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Undone" href="javascript:void do_change_done_status('undone')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Done1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Done2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Done" href="javascript:void do_change_done_status('done')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Okay1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Okay2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Okay" href="javascript:void do_change_done_status('okay')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4" id="dvChangeDoneStatus_Notice1"></div>
    <div class="grid1Cell gc1Footer" id="dvChangeDoneStatus_Notice2" style="font-weight: bold">
      <a style="white-space: nowrap" id="aChangeDoneStatus_Notice" href="javascript:void do_change_done_status('notice')"></a>
    </div>
    <div class="grid1Cell gc1VSpace4"></div>
    <div class="grid1Cell gc1Line"></div>
    <div class="grid1Cell gc1VSpace2"></div>
    <div class="grid1Cell gc1Footer">
      <a style="white-space: nowrap" href="javascript:void cancel_change_done_status()">cancel</a>
    </div>
  </div>

</div>


<script type="text/javascript">


"use strict";


///// CONSTANTS


//TO-DO1: save below to disallowed-names function
const CONST_appNarrow = "app_narrow";
const CONST_appVersion = "0.73";
const CONST_cssClassName_bold = "bold";
const CONST_cssClassName_brown = "brown";
const CONST_cssClassName_green = "green";
const CONST_cssClassName_red = "red";
const CONST_devText1 = "devText1";
const CONST_displayCode_normal = "0";
const CONST_displayCode_hidden1 = "1";
const CONST_doneStatusCode_done = "1";
const CONST_doneStatusCode_notice = "3";
const CONST_doneStatusCode_okay = "2";
const CONST_doneStatusCode_undone = "0";
const CONST_doneStatusDisplay_done = "done";
const CONST_doneStatusDisplay_notice = "notice";
const CONST_doneStatusDisplay_okay = "okay";
const CONST_doneStatusDisplay_undone = "undone";
const CONST_importBlocked = "importBlocked";
const CONST_stringOfAllItemIds = "string_of_all_item_ids";
const CONST_listName_homePage = "home_page_list";
const CONST_listName_wibtypes = "types";
const CONST_propName_sortPosition = "sortPosition";
const CONST_propName_itemId = "itemId";
const CONST_propName_itemName = "itemName";
const CONST_propName_wtifItemId = "wtifItemId";
const CONST_reordering_mode_normal = "normal";
const CONST_reordering_mode_moveToOtherItem = "moveToOtherItem";
const CONST_storedDataVersion = "stored_data_version";
const CONST_timeTracking_itemName = "Time Tracking";
const CONST_timeTracking_wtifYMD_itemName = "Y / M / D";
const CONST_timeTracking_wtifTime_itemName = "Time";
const CONST_timeTracking_wtifMinsTracked_itemName = "Mins Tracked";
const CONST_wb_listOfWibtypeInstanceHolderLists_itemName = "wb-list-of-wibtype-instance-holder-lists";
const CONST_wb_wibtypeInstanceHolderWibtype_itemName = "wb-wibtype-instance-holder-wibtype";
const CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName = "WibtypeInstanceHeldItemId";
const CONST_wbs_screenList_itemName = "wib-builder-screen-list";
const CONST_wbs_screenTypeCode_createWibtype = "1";
const CONST_wbs_screenWibtype_itemName = "wib-builder-screen";
const CONST_wbs_screenTypeCode_createType = "1";
const CONST_wbs_screenWtifs_screenTypeCode_itemName = "ScreenTypeCode";
const CONST_wbs_screenWtifs_wibtypeItemId_itemName = "TypeItemId";
const CONST_wibBuilder_itemName = "wib-builder";
const CONST_wibDataType_dateTime_name = "date & time";
const CONST_wibDataType_dateTime_id = 2;
const CONST_wibDataType_numeric_name = "numeric";
const CONST_wibDataType_numeric_id = 4;
const CONST_wibDataType_text_name = "text";
const CONST_wibDataType_text_id = 1;
const CONST_wibDataType_timeOfDay_name = "time of day";
const CONST_wibDataType_timeOfDay_id = 3;
const sD = "`"; // sD = storageDivider
const sD2 = "â‰¡"; // sD2 = storageDivider2, used for text formatting during backup


///// APP-LEVEL VARIABLES

var app = {};
app.addDataLoadedSuccessfully = true;
app.grabbing_itemId1 = null;
app.grabbing_itemId2 = null;
app.grabbing_itemIdArray = [];
app.grabbingOn = false;
app.homePageList_itemId = null;
app.makeNewItem_TopOfList = "1";
app.makeNewItem_StayListView = "1";
app.makeNewItem_AddMoreItems = "0";
app.makeNewItem_TimeTracking = "0";
app.moreOptionsOn = false;
app.qs_obj = null;
app.qs_urlParams = null;
app.reorderingOn = false;
app.reordering_activatedItemId = null;
app.reordering_mode = null;
app.timeTracking_defaultYear = null;
app.timeTracking_defaultMonth = null;
app.timeTracking_defaultDay = null;
app.timeTracking_wibtypeItemId = null;
app.wibBuilder_itemId = null;
app.wb_listOfWibtypeInstanceHolderLists_itemId = null;
app.wbs_curScreen_itemObj = null;
app.wbs_curWibtype_itemObj = null;
app.wbs_screensWibtype_itemId = null;
app.wbs_screenListItemId = null;
app.wibtypes_itemId = null;


///// INTERNAL FUNCTIONS

function activateItemForReordering(itemId) {
  app.reordering_activatedItemId = itemId;
  css_addClass(getHtml_aItem(itemId), CONST_cssClassName_bold);
  elem(getHtml_reorderingActivated_tr(itemId)).style.display = "" ;
  toggleReorderingMode_normal(itemId);
}

function aO(argumentValue) {
  // EXAMPLE USAGE:
  // 
  // function getPetMessage(aO_typeOfPet, aO_petName) {
  //   return "you have a " + aO_typeOfPet.a + " named " + aO_petName.a;
  // }
  // 
  // console.log( getPetMessage(aO("dog"), aO("Rover")) );
  // /* prints 'you have a dog named Rover' */

  var argObj = {};
  argObj.a = argumentValue;

  return argObj;
}

function appDateTimeObjFactory() {
  var appDateTimeObj = {};

  appDateTimeObj.getFullRawText = function() {
    var text = this.yyyy + this.mm + this.dd + this.hh + this.nn + this.ss + this.ms;
    return text;
  };

  appDateTimeObj.getYMDHN1 = function(extraSpace) {
    var text = this.yyyy + "-" + this.mm + "-" + this.dd;
    if (extraSpace) {
      text += "&nbsp;&nbsp;";
    } else {
      text += " ";
    }
    text += this.hh + ":" + this.nn;
    return text;
  };

  return appDateTimeObj;
}

function copyItems(sourceListObj, targetListObj, listMembers_itemIdArray) {
  listMembers_itemIdArray.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);
    curItemObj.copyToList(targetListObj.itemId);
  } );
}

function createAppDateTimeObj1(year, month, day, hour, minute) {
  var appDateTimeObj = appDateTimeObjFactory();

  if ( !isValidDate(year, month, day) ) return null;
  if ( !isValidTime(hour, minute) ) return null;

  year = parseInt(year);
  if ( !isNumeric(year) || year < 1 || year > 9999) return null;
  if (year < 10) {
    appDateTimeObj.yyyy = "000" + year;
  } else if (year < 100) {
    appDateTimeObj.yyyy = "00" + year;
  } else if (year < 1000) {
    appDateTimeObj.yyyy = "0" + year;
  } else {
    appDateTimeObj.yyyy = String(year);
  }

  month = parseInt(month);
  appDateTimeObj.m = String(month);
  if (month < 10) {
    appDateTimeObj.mm = "0" + month;
  } else {
    appDateTimeObj.mm = String(month);
  }

  day = parseInt(day);
  appDateTimeObj.d = String(day);
  if (day < 10) {
    appDateTimeObj.dd = "0" + day;
  } else {
    appDateTimeObj.dd = String(day);
  }

  hour = parseInt(hour);
  appDateTimeObj.h = String(hour);
  if (hour < 10) {
    appDateTimeObj.hh = "0" + hour;
  } else {
    appDateTimeObj.hh = String(hour);
  }

  minute = parseInt(minute);
  appDateTimeObj.n = String(minute);
  if (minute < 10) {
    appDateTimeObj.nn = "0" + minute;
  } else {
    appDateTimeObj.nn = String(minute);
  }

  return appDateTimeObj;
}

function createAppDateTimeObj2(ymd_inWtifStyle, time_inWtifStyle) {
  var ymd_inWtifStyle_array, time_inWtifStyle_array;

  if ( isBlank(ymd_inWtifStyle) ) return null;
  if ( isBlank(time_inWtifStyle) ) return null;

  ymd_inWtifStyle_array = ymd_inWtifStyle.split("-");
  if ( ymd_inWtifStyle_array.length < 1 || ymd_inWtifStyle_array.length > 3 ) return null;

  time_inWtifStyle_array = time_inWtifStyle.split(":");
  if ( time_inWtifStyle_array.length < 1 || time_inWtifStyle_array.length > 2 ) return null;

  return createAppDateTimeObj1(ymd_inWtifStyle_array[0], ymd_inWtifStyle_array[1], ymd_inWtifStyle_array[2], time_inWtifStyle_array[0], time_inWtifStyle_array[1]);
}

function createItemInfoString(itemName, doneStatusCode, displayCode, isList, notes, isWibtype, isWibtypeInfoField) {
  var itemInfoString = itemName + sD;

  if ( isBlank(doneStatusCode) ) {
    itemInfoString += CONST_doneStatusCode_undone;
  } else {
    itemInfoString += doneStatusCode;
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(displayCode) ) {
    itemInfoString += CONST_displayCode_normal;
  } else {
    itemInfoString += displayCode
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(isList) ) {
    itemInfoString += "0";
  } else {
    itemInfoString += isList
  }

  itemInfoString = itemInfoString + sD;
  if ( isBlank(notes) ) {
    itemInfoString += "";
  } else {
    itemInfoString += notes
  }

  itemInfoString = itemInfoString + sD;
  if (isWibtype == "1") {
    itemInfoString += "1";
  } else {
    itemInfoString += "0";
  }

  itemInfoString = itemInfoString + sD;
  if (isWibtypeInfoField == "1") {
    itemInfoString += "1";
  } else {
    itemInfoString += "0";
  }

  return itemInfoString;
}

function createListMemberDataObj(itemId, sortPosition) {
  var curListMemberDataObj = {};

  curListMemberDataObj.itemId = itemId;
  curListMemberDataObj.sortPosition = sortPosition;

  return curListMemberDataObj;
}

function createWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName, theData) {
  //NOTE:
  //  don't need the itemId of the item whose data is being held here
  //  -> this wtif-data-object will be stored in an array property of that item
  //      (see "itemIdAssignedToTheWibtype" in function ".saveToDatastore" below)

  var wtifDataObj = {};

  wtifDataObj.wibtypeItemId = wibtypeItemId;

  if ( isBlank(wtifItemId) ) {
    let wtifItemObj = searchForItemObj(null, null, null, null, null, null, wtifItemName, wibtypeItemId, true);
    wtifItemId = wtifItemObj.itemId;
  }

  wtifDataObj.wtifItemId = wtifItemId;

  wtifDataObj.theData = theData;

  wtifDataObj.saveToDatastore = function(itemIdAssignedToTheWibtype) {
    //declaring new variables, because:
    //  accidentally using wtifItemId or theData
    //  (instead of this.theData or this.wtifItemId)
    //  would not throw an error even with "use strict"
    //  (because the former variables are used/available in the parent function)
    let theData_toSave = this.theData;
    let wtifItemId_toSave = this.wtifItemId;

    //NOTE: "itemIdAssignedToTheWibtype" is the item whose wtif-data is being stored
    var saveKeyText_wtifData = getSaveKeyText_wtifData(itemIdAssignedToTheWibtype, wtifItemId_toSave);

    saveToDatastore(saveKeyText_wtifData, theData_toSave);
  };

  return wtifDataObj;
}

function createWibtypeInfoFieldInfoString(wibDataTypeId, required) {
  var itemInfoString = wibDataTypeId + sD + required;
  return itemInfoString;
}

function css_addClass(elemId, classNameToAdd) {
  var theElem = elem(elemId);
  theElem.classList.add(classNameToAdd);
}

function css_removeAllColors(elemId) {
  var theElem = elem(elemId);
  theElem.classList.remove(CONST_cssClassName_brown);
  theElem.classList.remove(CONST_cssClassName_green);
  theElem.classList.remove(CONST_cssClassName_red);
}

function css_removeClass(elemId, classNameToRemove) {
  var theElem = elem(elemId);
  theElem.classList.remove(classNameToRemove);
}

function css_setElemToDoneStatusColor(elemId, doneStatusCode) {
  var doneStatusCssClassNameColor = getDoneStatusCssClassNameColor(doneStatusCode);
  css_removeAllColors(elemId);

  //only add a css-class for the color, if we received a color-name back
  // (might receive back a blank value, in order to not set the color of the html-element)
  if ( !isBlank(doneStatusCssClassNameColor) ) {
    css_addClass(elemId, doneStatusCssClassNameColor);
  }
}

function da(text) {
  alert(text);
}

function dc(text) {
  console.log(text);
}

function deactivateItemForReordering(itemId) {
  app.reordering_activatedItemId = null;
  css_removeClass(getHtml_aItem(itemId), CONST_cssClassName_bold);
  elem(getHtml_reorderingActivated_tr(itemId)).style.display = "none" ;
}

function deleteFromDatastore(itemKey) {
  localStorage.removeItem(itemKey);
}

function deleteItem(itemIdToDelete) {
  var itemObjToDelete, returnValue;

  itemObjToDelete = grabItemObj(itemIdToDelete);

  returnValue = itemObjToDelete.doDeletion() ;
  if ( isBlank(returnValue) ) {
    return false;
  } else if (returnValue == false) {
    return false;
  } else {
    setAppItemObj(grabItemObj(returnValue));
  }

  return true;
}

function displayPage(pageName) {

  if ( leftIs(pageName, "WibBuilder") ) {

    document.body.style.display = "grid";
    document.body.style.margin = "0.8em";

    elem("spnAppHeader_OptionalPageTitle").style.display = "";
    elem("spnAppHeader_OptionalPageTitle").innerHTML = "";
    elem("spnAppHeader_AppParen1").style.display = "";
    elem("spnAppHeader_AppParen2").style.display = "";

    css_removeClass("spnAppHeader_AppNameAndVersion", CONST_cssClassName_bold);
    css_removeClass("spnAppHeader_AppNameAndVersion", "font135");
    css_addClass("spnAppHeader_AppNameAndVersion", "font85");

    elem("spnAppHeader_Home").style.display = "none";
    elem("spnAppHeader_Builder").style.display = "none";

    if (!app.qs_obj.dev) {
      elem("spnAppHeader_Dev").style.display = "none";
    }

  } else {

    document.body.style.display = "";
    document.body.style.margin = "";

    elem("spnAppHeader_OptionalPageTitle").style.display = "none";
    elem("spnAppHeader_OptionalPageTitle").innerHTML = "";
    elem("spnAppHeader_AppParen1").style.display = "none";
    elem("spnAppHeader_AppParen2").style.display = "none";

    css_addClass("spnAppHeader_AppNameAndVersion", CONST_cssClassName_bold);
    css_removeClass("spnAppHeader_AppNameAndVersion", "font85");
    css_addClass("spnAppHeader_AppNameAndVersion", "font135");

    elem("spnAppHeader_Home").style.display = "";
    elem("spnAppHeader_Dev").style.display = "";
    elem("spnAppHeader_Builder").style.display = "";

  }

  elem("dvPage_BackupExport").style.display = "none";
  elem("dvPage_BackupImport").style.display = "none";
  elem("dvPage_Dev").style.display = "none";
  elem("dvPage_Home").style.display = "none";
  elem("dvPage_MoveOrCopy").style.display = "none";
  elem("dvPage_NavigateItems").style.display = "none";
  elem("dvPage_ShowStorage").style.display = "none";
  elem("dvPage_ViewItem").style.display = "none";
  elem("dvPage_WibBuilder_AllScreens").style.display = "none";
  elem("dvPage_WibBuilder_BuildScreen").style.display = "none";
  elem("dvPage_WibBuilder_RunScreen").style.display = "none";
  elem("dvPage_WibBuilder_ShowWibtypeInstances").style.display = "none";
  elem("dvPage_Wibtypes").style.display = "none";

  elem("dvPage_" + pageName).style.display = "inline-grid";

  switch (pageName) {

    case "BackupExport": {
        writeBackupExport();
        break;
      }

    case "BackupImport": {
        elem("taBackupTextToImport").value = "";
        elem("taBackupTextToImport").focus();
        break;
      }

    case "Dev": {
        // don't currently need anything special for Dev
        break;
      }

    case "Home": {
        elem("spnAppHeader_Home").style.display = "none";
        if (!app.itemObj) {
          setAppItemObj(grabItemObjByName(CONST_listName_homePage));
        }
        elem("dvHome_Items").innerHTML = writeHtml_Items();
        break;
      }

    case "MoveOrCopy": {
        elem("spnAppHeader_Home").style.display = "none";
        if ( !isBlank(app.grabbing_itemId1) && isBlank(app.grabbing_itemId2) ) {
          //single-item-move-or-copy
          elem("spnMoveOrCopy_FromList").innerHTML = "<i>" + grabItemObj(app.itemObj.displayedOnList_itemId).itemName + "</i>";
        } else {
          elem("spnMoveOrCopy_FromList").innerHTML = "<i>" + app.itemObj.itemName + "</i>";
        }

        elem("dvMoveOrCopy_ItemsBeingMovedOrCopied").innerHTML = writeHtml_MoveOrCopy_ItemsBeingMovedOrCopied();
        elem("dvMoveOrCopy_ListsToMoveOrCopyItemsTo").innerHTML = writeHtml_MoveOrCopy_ListsToMoveOrCopyItemsTo();
        break;
      }

    case "NavigateItems": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Navigate Items";

      let html = "";

      /* --- INSTRUCTIONS ---

      // create and run search object:
      
      var sObj = new SearchObj();
       
      // include any or all of the following:
      //   (all must be true for an item to be returned)
       
      sObj.set_targetItemName(itemName_toSearchFor);
      sObj.set_targetJoinedListWithItemId(listItemId_toSearchFor);
      sObj.set_targetAssignedToWibtypeWithItemId(wibtypeItemId_toSearchFor);

      // can only include one of the following two options:

      // -> option 1:
      sObj.set_targetCombo_wtifItemId_and_wtifData(wtifItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
      //
      //  --- or ---
      //
      // -> option 2:
      sObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData(wtifItemName_toSearchFor, wtifWibtypeItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
      
      sObj.set_returnFirstOnly_false();  // optional (SearchObj() defaults to returnFirstOnly==true)

      var itemObj = sObj.runSearchAndReturnX();       // if returnFirstOnly==true (default)
      //  --- or ---
      var itemObjArray = sObj.runSearchAndReturnX();  // if returnFirstOnly==false

      */
  //TO-DOx:
      var sObj = new SearchObj();
      let itemObjs = x

      itemObjs.forEach( (itemObj) => {
        if (html !== "") html += "<div style='height: 1.8em'></div>"

        html += "<div>" + itemObj.itemName;
/*
        html += "&nbsp;&nbsp;<a href='javascript:void all_screens__build_screen(\"" + screenItemObj.itemId + "\")'>build</a>\n";
        html += "&nbsp;&nbsp;<a href='javascript:void all_screens__run_screen(\"" + screenItemObj.itemId + "\")'>run</a>\n";
*/
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("NavigateItems_Items").innerHTML = html;

      break;
    }

    case "ShowStorage": {
        elem("dvShowStorage_EditAllItemIds").style.display = "none";
        writeStorage();
        break;
      }

    case "ViewItem": {
        let i, wibtypeItemObj, hasDisplayedLists = false, hasConnectedItems = false;

        if (app.itemObj.isWibtype == "1") {
          elem("dvItemName").innerHTML = "<div class='" + CONST_cssClassName_red +"'><i>[this is a type]</i></div><div style='height: 8px'></div>" + app.itemObj.itemName;
        } else if (app.itemObj.isWibtypeInfoField == "1") {
          elem("dvItemName").innerHTML = "<div class='" + CONST_cssClassName_red +"'><i>[this is a type info-field]</i></div><div style='height: 8px'></div>" + app.itemObj.itemName;
        } else {
          elem("dvItemName").innerHTML = app.itemObj.itemName;
        }

        //TO-DO2: display multiple list names, if this item is a member of 2+
        
        elem("dvListNameForItem").innerHTML = "";

        if (app.itemObj.isWibtype == "0") {
          for (i = 0; i < app.itemObj.joinedLists_itemIds.length; i++) {
            let curItemObjForLoop = grabItemObj(app.itemObj.joinedLists_itemIds[0])

            if (app.itemObj.isWibtypeInfoField == "1" && curItemObjForLoop.isWibtype == "1") {
              wibtypeItemObj = curItemObjForLoop;
//              elem("dvListNameForItem").innerHTML = "&nbsp;&nbsp;&nbsp;<span style='color: " + CONST_cssClassName_red + "'><b>type info-field</b></span>";
            } else if (curItemObjForLoop.displayCode == CONST_displayCode_normal && curItemObjForLoop.isWibtype == "0") {
              hasDisplayedLists = true;
              app.itemObj.displayedOnList_itemId = curItemObjForLoop.itemId;
              elem("dvListNameForItem").innerHTML = "&nbsp;&nbsp;&nbsp;member of list:&nbsp;&nbsp;<a href='javascript:void go_to_list(\"" + curItemObjForLoop.itemId + "\")'>" + curItemObjForLoop.itemName + "</a>";
              break;
            }
          }

          if (hasDisplayedLists) {
            elem("dvViewItem_JoinedListsArea").style.display = "";
          } else {
            elem("dvViewItem_JoinedListsArea").style.display = "none";
          }
        }

        if (hasConnectedItems) {
          elem("dvViewItem_ConnectedItems_Items").innerHTML = "(connected items would go here)";
        } else {
          elem("dvViewItem_ConnectedItems_Items").innerHTML = "connected items: <i>none</i>";
        }

        if (app.itemObj.isWibtype == "1") {
          elem("spnViewItem_MoveCopy").style.display = "none";
          elem("spnViewItem_ShowWibtypes").style.display = "";
          elem("spnViewItem_ShowWibtypeInfoField").style.display = "none";
          elem("spnViewItem_Delete").style.display = "none";
        } else if (app.itemObj.isWibtypeInfoField == "1") {
          elem("spnViewItem_MoveCopy").style.display = "none";
          elem("spnViewItem_ShowWibtypes").style.display = "none";
          elem("spnViewItem_ShowWibtypeInfoField").style.display = "";
          elem("aViewItem_BackToType").href = "javascript:void back_to_type(" + wibtypeItemObj.itemId + ")";
          elem("aViewItem_BackToType").innerHTML = wibtypeItemObj.itemName;
          elem("spnViewItem_Delete").style.display = "none";
        } else {
          if (app.itemObj.isList == "0") {
            elem("spnViewItem_MoveCopy").style.display = "";
          } else {
            elem("spnViewItem_MoveCopy").style.display = "none";
          }
          elem("spnViewItem_ShowWibtypes").style.display = "none";
          elem("spnViewItem_ShowWibtypeInfoField").style.display = "none";
          elem("spnViewItem_Delete").style.display = "";
        }

        if (app.itemObj.isWibtype == "1" || app.itemObj.isWibtypeInfoField == "1") {
          elem("spnViewItem_DoneStatusDisplay").style.display = "none";
          elem("spnViewItem_DoneStatusLink").style.display = "none";

        } else if (app.itemObj.doneStatusCode == CONST_doneStatusCode_undone) {
          elem("spnViewItem_DoneStatusDisplay").style.display = "none";
          elem("spnViewItem_DoneStatusLink").style.display = "";

          elem("aViewItem_DoneStatusLink").style.display = "";
          elem("aViewItem_DoneStatusLink").innerHTML = "mark done";

        } else {
          elem("spnViewItem_DoneStatusDisplay").style.display = "";
          elem("spnViewItem_DoneStatusDisplay").innerHTML = getDoneStatusDisplay(app.itemObj.doneStatusCode).toUpperCase() + "&nbsp;&nbsp;";
          css_setElemToDoneStatusColor("spnViewItem_DoneStatusDisplay", app.itemObj.doneStatusCode);

          elem("aViewItem_DoneStatusLink").style.display = "";
          elem("aViewItem_DoneStatusLink").innerHTML = "change";

        }

        if ( isBlank(app.itemObj.notes) ) {
          elem("dvViewItem_Notes_Yes").style.display = "none";
          elem("spnViewItem_Notes_No").style.display = "";
          elem("dvViewItem_Notes").innerHTML = "";
        } else {
          elem("dvViewItem_Notes_Yes").style.display = "";
          elem("spnViewItem_Notes_No").style.display = "none";
          elem("dvViewItem_Notes").innerHTML = app.itemObj.notes;
        }

        if (app.itemObj.isWibtype == "1" || app.itemObj.isWibtypeInfoField == "1") {
          elem("dvViewItem_Wibtypes").style.display = "none";
        } else {
          elem("dvViewItem_Wibtypes").style.display = "";
          elem("dvViewItem_Wibtypes_WtifData").innerHTML = writeHtml_WtifData(); 
        }

        if (app.itemObj.isWibtypeInfoField == "1") {
          elem("dvViewItem_WibtypeInfoFieldInfo").style.display = "";
          elem("spn_ViewItem_WibtypeInfoFieldInfo_WibDataType").innerHTML = getWibDataTypeNameFromId(app.itemObj.wibDataTypeId);
          elem("spn_ViewItem_WibtypeInfoFieldInfo_Required").innerHTML = getBooleanFieldTextDisplay(app.itemObj.required);
        } else {
          elem("dvViewItem_WibtypeInfoFieldInfo").style.display = "none";
        }

        if (app.itemObj.isWibtype == "1") {
          elem("dvViewItem_ListMembers_Yes").style.display = "";
          elem("dvViewItem_ListMembers_No").style.display = "none";
          elem("spnViewItem_MakeNewItem1").style.display = "none";
          elem("spnViewItem_MakeNewItem2").style.display = "none";
          elem("spnViewItem_MakeNewField1").style.display = "";
          elem("spnViewItem_MakeNewField2").style.display = "";
          elem("spnViewItem_More1").style.display = "none";
          elem("spnViewItem_More2").style.display = "none";
          elem("dvViewItem_ListMembers_Items").innerHTML = writeHtml_Items();
        } else if (app.itemObj.isWibtypeInfoField == "1") {
          elem("dvViewItem_ListMembers_No").style.display = "none";
          elem("dvViewItem_ListMembers_Yes").style.display = "none";
          elem("dvViewItem_ListMembers_Items").innerHTML = "";
        } else {
          elem("spnViewItem_MakeNewItem1").style.display = "";
          elem("spnViewItem_MakeNewItem2").style.display = "";
          elem("spnViewItem_MakeNewField1").style.display = "none";
          elem("spnViewItem_MakeNewField2").style.display = "none";
          elem("spnViewItem_More1").style.display = "";
          elem("spnViewItem_More2").style.display = "";
          if (app.itemObj.isList == "1") {
            elem("dvViewItem_ListMembers_Yes").style.display = "";
            elem("dvViewItem_ListMembers_No").style.display = "none";
            elem("dvViewItem_ListMembers_Items").innerHTML = writeHtml_Items();
          } else {
            elem("dvViewItem_ListMembers_Yes").style.display = "none";
            elem("dvViewItem_ListMembers_No").style.display = "";
            elem("dvViewItem_ListMembers_Items").innerHTML = "";
          }
        }

        if (app.reordering_activatedItemId) {
          css_addClass(getHtml_aItem(app.reordering_activatedItemId), CONST_cssClassName_bold);
        }
        break;
      }

    case "WibBuilder_AllScreens": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - All Screens";

      let html = "";

      let screenList_itemObj = grabItemObj(app.wbs_screenListItemId);
      let screenList_listMemberDataObjs = screenList_itemObj.getListMemberDataObjs();

      screenList_listMemberDataObjs.forEach( (screenList_listMemberDataObj) => {
        let screenItemObj = grabItemObj(screenList_listMemberDataObj.itemId);
        if (html !== "") html += "<div style='height: 1.8em'></div>"

        let screenNameDisplay = wbs_getScreenName(screenItemObj);
        html += "<div>" + screenNameDisplay + "\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__build_screen(\"" + screenItemObj.itemId + "\")'>build</a>\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__run_screen(\"" + screenItemObj.itemId + "\")'>run</a>\n";
        html += " &nbsp;&nbsp;<a href='javascript:void all_screens__view_type_instances(\"" + screenItemObj.itemId + "\")'>type instances</a>\n";
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("WibBuilder_AllScreens_Items").innerHTML = html;

      break;
    }

    case "WibBuilder_BuildScreen": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Build Screen";

      /* OLD
      if (!app.wbs_curScreen_itemObj) {
        let screenList_itemObj = grabItemObj(app.wbs_screenListItemId);
        if ( screenList_itemObj.hasListMembers() ) {
          let screenList_listMemberItemIds = screenList_itemObj.getListMemberItemIds();
          app.wbs_curScreen_itemObj = grabItemObj(screenList_listMemberItemIds[0]);
        }
      }
      */

      if (app.wbs_curScreen_itemObj) {

        let wibtypeItemObj_createdByUsageOfThisScreen = wbs_getWibtypeItemObj_thatScreenWillCreate(app.wbs_curScreen_itemObj)

        elem("dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Link").style.display = "none";
        elem("dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Text").style.display = "";
        elem("dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Text").innerHTML = wibtypeItemObj_createdByUsageOfThisScreen.itemName;
        elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = wbs_getScreenName(app.wbs_curScreen_itemObj, wibtypeItemObj_createdByUsageOfThisScreen);
        elem("dvWibBuilder_BuildScreen_ItemNameText").innerHTML = wibtypeItemObj_createdByUsageOfThisScreen.itemName + " Name:";

      } else {

        elem("dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Text").style.display = "none";
        elem("dvWibBuilder_BuildScreen_NameOfTypeTheScreenWillCreate_Link").style.display = "";
        elem("dvWibBuilder_BuildScreen_HeaderText").innerHTML = "Create&nbsp;&nbsp;________";
        elem("dvWibBuilder_BuildScreen_ItemNameText").innerHTML = "_______ Name:";

      }

      break;
    }

    case "WibBuilder_RunScreen": {
      let wibtypeItemObj_createdByUsageOfThisScreen = wbs_getWibtypeItemObj_thatScreenWillCreate(app.wbs_curScreen_itemObj);

      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Run Screen";
      elem("dvWibBuilder_RunScreen_HeaderText").innerHTML = wbs_getScreenName(app.wbs_curScreen_itemObj, wibtypeItemObj_createdByUsageOfThisScreen);
      elem("dvWibBuilder_RunScreen_ItemNameText").innerHTML = wibtypeItemObj_createdByUsageOfThisScreen.itemName + " Name:";
      elem("ipWibBuilder_RunScreen_ItemNameValue").value = "";
      elem("ipWibBuilder_RunScreen_ItemNameValue").focus();

      break;
    }

    case "WibBuilder_ShowWibtypeInstances": {
      elem("spnAppHeader_OptionalPageTitle").innerHTML = "Builder - Show Instances";

      let html = "";

      let wibtypeInstance_itemObjs = getInstanceItemObjsForWibtype(app.wbs_curWibtype_itemObj.itemId);

      wibtypeInstance_itemObjs.forEach( (wibtypeInstance_itemObj) => {
        if (html !== "") html += "<div style='height: 1.8em'></div>"

        html += "<div>" + wibtypeInstance_itemObj.itemName;
/*
        html += "&nbsp;&nbsp;<a href='javascript:void all_screens__build_screen(\"" + screenItemObj.itemId + "\")'>build</a>\n";
        html += "&nbsp;&nbsp;<a href='javascript:void all_screens__run_screen(\"" + screenItemObj.itemId + "\")'>run</a>\n";
*/
        html += "</div>\n";
      } );

      if (html == "") html += "(none created yet)";

      elem("WibBuilder_ShowWibtypeInstances_Items").innerHTML = html;

      break;
    }

    case "Wibtypes": {
      setAppItemObj(grabItemObj(app.wibtypes_itemId));
      elem("dvWibtypes_Items").innerHTML = writeHtml_Items();
      break;
    }
  }
}

function wbs_getScreenName(screenItemObj, wibtypeItemObj) {
  var screenTypeCode = screenItemObj.getWtifData(app.wbs_screensWibtype_itemId, null, CONST_wbs_screenWtifs_screenTypeCode_itemName);

  if ( isBlank(wibtypeItemObj) ) {
    var wibtypeItemId = screenItemObj.getWtifData(app.wbs_screensWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName);
    wibtypeItemObj = grabItemObj(wibtypeItemId);
  }

  switch (screenTypeCode) {
    case CONST_wbs_screenTypeCode_createWibtype:
      return "Create " + wibtypeItemObj.itemName;

    default:
      return "";
  }
}

function wbs_getWibtypeItemObj_thatScreenWillCreate(screenItemObj) {
  var wibtypeItemId_createdByUsageOfThisScreen = screenItemObj.getWtifData(app.wbs_screensWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName);
//dc("wibtypeItemId_createdByUsageOfThisScreen="+wibtypeItemId_createdByUsageOfThisScreen)
  var wibtypeItemObj_createdByUsageOfThisScreen = grabItemObj(wibtypeItemId_createdByUsageOfThisScreen);
  return wibtypeItemObj_createdByUsageOfThisScreen;
}




function doCheckboxClickAction(elemId) {
  var checkboxIsChecked = false;
  if ( elem(elemId).checked ) {
    checkboxIsChecked = true;
  }

  switch (elemId) {
    case "ckMakeNewItem_TimeTracking":
      if (checkboxIsChecked) {
        html_displayAllElementsOfClass("gc1Group1")
        elem("ipMakeNewItem_Year").focus();
      } else {
        html_hideAllElementsOfClass("gc1Group1")
      }
      break;
  }
}

function doesValArrayHaveElem(theArray, valToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem, valToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return false;
  } else {
    return true;
  }

/* OLD CODE
  for (let i = 0; i < theArray.length; i++) {
    if (isEqual(theArray[i], valToMatch) ) {
      return true;
    }
  }
  return false;
*/
}

function elem(elemId) {
  return document.getElementById(elemId);
}

function getAppDateTimeObj_fromJSDateTime(jsDateTime) {
  if ( isBlank(jsDateTime) ) jsDateTime = new Date();

  var yyyy = jsDateTime.getFullYear();
  var m = jsDateTime.getMonth() + 1; //January is 0
  var d = jsDateTime.getDate();
  var h = jsDateTime.getHours();
  var n = jsDateTime.getMinutes();
  //var s = jsDateTime.getSeconds();
  //var msOriginal = jsDateTime.getMilliseconds();

  /* OLD CODE -- now handled by createAppDateTimeObj1 */ {
    /*
    if (m < 10) mm = "0" + m
    if (d < 10) dd = "0" + d
    if (h < 10) hh = "0" + h
    if (n < 10) nn = "0" + n
    if (s < 10) ss = "0" + s

    if (msOriginal < 100) {
      ms = "0" + msOriginal
    } else if (msOriginal < 10) {
      ms = "00" + msOriginal;
    }
    */
  }

  var appDateTimeObj = createAppDateTimeObj1(yyyy, m, d, h, n);

  /* OLD CODE -- now handled by createAppDateTimeObj */ {
    /*
    appDateTimeObj.yyyy = yyyy;
    appDateTimeObj.m = m;
    appDateTimeObj.mm = mm;
    appDateTimeObj.d = d;
    appDateTimeObj.dd = dd;
    appDateTimeObj.h = h;
    appDateTimeObj.hh = hh;
    appDateTimeObj.n = n;
    appDateTimeObj.nn = nn;
    //appDateTimeObj.s = s;
    //appDateTimeObj.ss = ss;
    //appDateTimeObj.msOriginal = msOriginal;
    //appDateTimeObj.ms = ms;
    */
  }

  return appDateTimeObj;
}

function getBooleanFieldTextDisplay(booleanFieldZeroOrOne) {
  if ( booleanFieldZeroOrOne == "1" ) {
    return "yes";
  } else{
    return "no";
  }
}

function getCurAppDateTimeObj() {
  var curAppDateTimeObj = getAppDateTimeObj_fromJSDateTime( new Date() );
  return curAppDateTimeObj;
}

function getDoneStatusDisplay(doneStatusCode) {
  if ( isEqual(doneStatusCode, CONST_doneStatusCode_done) ) {
    return CONST_doneStatusDisplay_done;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_notice) ) {
    return CONST_doneStatusDisplay_notice;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_okay) ) {
    return CONST_doneStatusDisplay_okay;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_undone) ) {
    return CONST_doneStatusDisplay_undone;
  }
}

function getDoneStatusCssClassNameColor(doneStatusCode, dev__elemId) {
  var cssClassNameColor;

  if ( isEqual(doneStatusCode, CONST_doneStatusCode_done) ) {
    cssClassNameColor = CONST_cssClassName_green;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_notice) ) {
    cssClassNameColor = CONST_cssClassName_red;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_okay) ) {
    cssClassNameColor = CONST_cssClassName_brown;
  } else if ( isEqual(doneStatusCode, CONST_doneStatusCode_undone) ) {
    cssClassNameColor = "";
  }

  return cssClassNameColor;
}

function getElemVal(elemId) {
  var theElem, elemType, elemVal;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      if (elemVal = theElem.checked) {
        elemVal = "1";
      } else {
        elemVal = "0";
      }
      break;

    default:
      elemVal = theElem.value;
  }

  return elemVal;
}

function getElemFromObjArray(theArray, propName, propValToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem[propName], propValToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return null;
  } else {
    return revisedArray[0];
  }
}

function getElemFromValArray(theArray, valToMatch) {
  var revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = false;
    if ( isEqual(arrayElem, valToMatch) ) {
      returnValue = true;
    }
    return returnValue;
  });

  if (revisedArray.length == 0) {
    return "";
  } else {
    return revisedArray[0];
  }
}

function getFromDatastore(itemKey) {
  var itemValue = localStorage.getItem(itemKey);
  return itemValue;
}

function getHtml_aItem(itemId) {
  return "aItem_" + itemId;
}

function getHtml_reorderingActivated_tr(itemId) {
  return "trActivatedForReordering_" + itemId;
}

function getHtml_reorderingModeIs_normal_tblOptions(itemId) {
  return "reorderingModeIs_normal_tblOptions_" + itemId;
}

function getHtml_reorderingModeIs_moveToOtherItem_dvInstructions(itemId) {
  return "reorderingModeIs_moveToOtherItem_dvInstructions_" + itemId;
}

function getHtml_selectElem(selectElemId, includeBlank, theArray, defValue, theStyle, onChange, blankDisplay, isDisabled) {
  var i, html;

  html = "<select id='" + selectElemId + "'";

  if (  !isBlank(theStyle) ) {
    html += " style='" + theStyle + "'";
  }

  if ( !isBlank(onChange) ) {
    html += " onchange='javascript:void " + onChange + "'";
  }

  if (isDisabled) {
    html += " disabled";
  }

  html += ">\n";

  if (includeBlank) {
    html += "<option value=''";
    if ( isBlank(defValue) ) html += " selected";
      html += ">";
    if (blankDisplay) {
      html += blankDisplay + "</option>\n";
    } else {
      html += " </option>\n";
    }
  }


  for (i = 0; i < theArray.length; i++ ) {
    let curOptionId, curOptionDisplay;
    curOptionId = theArray[i].optionId;
    curOptionDisplay = theArray[i].optionDisplay;
    html += "<option value='" + curOptionId + "'";
    if ( isEqual(defValue, curOptionId) ) html += " selected";
    html += ">" + curOptionDisplay + "</option>\n";
  }

  html += "</select>\n";

  return html;
}

function getIdArray(string_ids){
  var array_ids;
  if (isBlank(string_ids)) return [];
  array_ids = string_ids.split(sD);
  return array_ids;
}

function getIdString(array_ids){
  var string_ids = array_ids.join(sD);
  return string_ids;
}

function getInstanceItemObjsForWibtype(wibtypeItemId) {
  var sObj = new SearchObj();

  sObj.set_targetAssignedToWibtypeWithItemId(wibtypeItemId);
  sObj.set_returnFirstOnly_false();

  var instanceItemObjs_array = sObj.runSearchAndReturnX();

  return instanceItemObjs_array;
}

function getObjArrayAsString(theArray, propName1, propName2) {
  var i, str = "";
  for (i = 0; i < theArray.length; i++ ){
    str += propName1 + ": " + theArray[i][propName1];
    if ( !isBlank(propName2) ) str += ", " + propName2 + ": " + theArray[i][propName2];
    str += "\n";
  }
  return str;
}

function getObjArrayWithoutElem(theArray, propName, propValToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem[propName], propValToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;
}

function getProcessedStringForSave(oldString) {
  var newString = getStringWithCharsReplaced(oldString, " ", "&nbsp;");
  return newString;
}

function getSaveKeyText_item(itemId) {
  return "i_" + itemId;
}

function getSaveKeyText_joinedLists_ofItem(itemId) {
  return "iJL_" + itemId;
}

function getSaveKeyText_listMembers_ofItem(itemId) {
  return "iLM_" + itemId;
}

function getSaveKeyText_wibtypeInfoFieldInfo_ofItem(itemId) {
  return "iWTIFI_" + itemId;
}

function getSaveKeyText_wibtypeAssignments_toItem(itemId) {
  return "iWTAs_" + itemId;
}

function getSaveKeyText_wtifData(itemIdAssignedToTheWibtype, wtifItemId) {
  return "i" + itemIdAssignedToTheWibtype + "_wtif" + wtifItemId;
}

function getSelectArrayElem(optionId, optionDisplay) {
  var theObj = {};

  theObj.optionId = optionId;

  if (optionDisplay === undefined) {
    theObj.optionDisplay = optionId;
  } else {
    theObj.optionDisplay = optionDisplay;
  }

  return theObj;
}

function getStringWithCharsReplaced(oldString, oldChars, newChars) {
  if ( oldString == null || oldChars == null ) {
    return "";
  }

  if ( newChars == null ) {
    newChars = "";
  }

  var newString = oldString;

  for (var i = 1; i <= 100000; i++) {  //use a counter to prevent being stuck in a do-loop if something goes wrong
dc("1- newString="+newString)
    if ( !newString.includes(oldChars) ) {
      return newString;
    }

dc("2- newString="+newString)
    newString = newString.replace(oldChars, newChars);
dc("3- newString="+newString)
  }

  return newString;
}

function getValArrayWithoutElem(theArray, valToExclude) {
  var revisedArray;

  revisedArray = theArray.filter( (arrayElem) => {
    var returnValue = true;
    if ( isEqual(arrayElem, valToExclude) ) {
      returnValue = false;
    }
    return returnValue;
  });

  return revisedArray;
}

function getWibDataTypeNameFromId(wibDataTypeId) {
  switch (parseInt(wibDataTypeId)) {
    case parseInt(CONST_wibDataType_text_id):
      return CONST_wibDataType_text_name;
    case parseInt(CONST_wibDataType_dateTime_id):
      return CONST_wibDataType_dateTime_name;
    case parseInt(CONST_wibDataType_timeOfDay_id):
      return CONST_wibDataType_timeOfDay_name;
    case parseInt(CONST_wibDataType_numeric_id):
      return CONST_wibDataType_numeric_name;
  }
}

function getWibDataTypesAsArray() {
  var anObj;
  var theArray = [];

  //WibDataType = "text"
  anObj = getSelectArrayElem(CONST_wibDataType_text_id, CONST_wibDataType_text_name);
  anObj.wibDataTypeId = CONST_wibDataType_text_id;
  anObj.wibDataTypeName = CONST_wibDataType_text_name;
  theArray.push(anObj);

  //WibDataType = "date & time"
  anObj = getSelectArrayElem(CONST_wibDataType_dateTime_id, CONST_wibDataType_dateTime_name);
  anObj.wibDataTypeId = CONST_wibDataType_dateTime_id;
  anObj.wibDataTypeName = CONST_wibDataType_dateTime_name;
  theArray.push(anObj);

  //WibDataType = "time of day"
  anObj = getSelectArrayElem(CONST_wibDataType_timeOfDay_id, CONST_wibDataType_timeOfDay_name);
  anObj.wibDataTypeId = CONST_wibDataType_timeOfDay_id;
  anObj.wibDataTypeName = CONST_wibDataType_timeOfDay_name;
  theArray.push(anObj);

  //WibDataType = "numeric"
  anObj = getSelectArrayElem(CONST_wibDataType_numeric_id, CONST_wibDataType_numeric_name);
  anObj.wibDataTypeId = CONST_wibDataType_numeric_id;
  anObj.wibDataTypeName = CONST_wibDataType_numeric_name;
  theArray.push(anObj);

  return theArray;
}

function getWithLeadingZeroes(startingVal, resultingNumberStringLength) {
  //TO-DO2: allow >5 total string length

  resultingNumberStringLength = parseInt(resultingNumberStringLength);

  if (resultingNumberStringLength < 2 || resultingNumberStringLength > 5)  {
    alert("ERROR: function getWithLeadingZeroes, getWithLeadingZeroes limited to resultingNumberStringLength between 2 and 5 (resultingNumberStringLength=" + resultingNumberStringLength);
    return;
  }

  if ( isBlank(startingVal) ) return "";

  if ( !isNumeric(startingVal) ) return "";

  var endingVal = "";
  startingVal = parseInt(startingVal);

  if (startingVal < 10) {
    if (resultingNumberStringLength == 2) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 3) { endingVal = "00" + String(startingVal);
    } else if (resultingNumberStringLength == 4) { endingVal = "000" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "0000" + String(startingVal);
    }
  } else if (startingVal < 100) {
    if (resultingNumberStringLength == 3) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 4) { endingVal = "00" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "000" + String(startingVal);
    }
  } else if (startingVal < 1000) {
    if (resultingNumberStringLength == 4) { endingVal = "0" + String(startingVal);
    } else if (resultingNumberStringLength == 5) { endingVal = "00" + String(startingVal);
    }
  } else if (startingVal < 10000) {
    if (resultingNumberStringLength == 5) { endingVal = "0" + String(startingVal); }
  }

  return endingVal;
}

function goToItemView(itemId, maintainActivatedItem) {
  if ( !isBlank(itemId) ) {
    setAppItemObj(grabItemObj(itemId));
  }

  if ( !isBlank(app.reordering_activatedItemId) ) {
    if (!maintainActivatedItem) {
      css_addClass(getHtml_aItem(itemId), CONST_cssClassName_bold);
    }
  }

  displayPage("ViewItem");
  toggleGrabbing_off();
}






function transferItemInfo_stringToObject(itemInfoString, itemInfoObj) {
  var itemInfoArray = transferItemInfo_stringToArray(itemInfoString);
  transferItemInfo_arrayToObject(itemInfoArray, itemInfoObj);
}

function transferItemInfo_stringToArray(itemInfoString) {
  return itemInfoString.split(sD);
}

function transferItemInfo_arrayToObject(itemInfoArray, itemInfoObj) {
  var iit = new itemInfoTransfer();
  iit.receiveArray(itemInfoArray);
  iit.setObj(itemInfoObj);
}

function transferItemInfo_objectToString(itemInfoObject) {
//TO-DO1.5
}

var getItemInfoTransfer = function() {
  var itemInfoValues;
  var itemInfoNames = [];

  itemInfoNames.push("itemName");
  itemInfoNames.push("doneStatusCode");
  itemInfoNames.push("displayCode");
  itemInfoNames.push("isList");
  itemInfoNames.push("notes");
  itemInfoNames.push("isWibtype");
  itemInfoNames.push("isWibtypeInfoField");

  return {
    getDisplay: function() {
      let text = "";
      for (let i = 0; i < itemInfoValues.length; i++) {
      if (i > 0) text += "\n";
        text += itemInfoNames[i] + ": " + itemInfoValues[i];
      }
      return text;
    },
    
    receiveArray: function(itemInfoArray) {
      itemInfoValues = [];
      for (let i = 0; i < itemInfoArray.length; i++ ) {
        itemInfoValues.push(itemInfoArray[i]);
      }
    },
    
    receiveString: function(itemInfoString) {
      itemInfoValues = itemInfoString.split(sD);
    },

    setObj: function(itemInfoObj) {
      itemInfoNames.forEach( (itemInfoName, idx) => {
        itemInfoObj[itemInfoName] = itemInfoValues[idx];
      } );
    }
  }
};

function getItemInfoStringDisplay(itemInfoString) {
  var iit = getItemInfoTransfer();
  iit.receiveString(itemInfoString);
  return iit.getDisplay();
}






function grabItemObj(itemId) {
  var i, saveKeyText_item, itemObj, itemInfoString, itemDataArray;

  //get the item-data-string from the datastore
  saveKeyText_item = getSaveKeyText_item(itemId);
  itemInfoString = getFromDatastore(saveKeyText_item);

  //this function assumes only existing items will be requested; so, if the item-data-string is blank, the item does not exist, and we must throw an error
  if ( isBlank(itemInfoString) ) {
    //TO-DO2: showSoftError(funcName, errorText);
    console.log("ERROR: function grabItemObj(), item with itemId=" + itemId + " does not exist in data storage");
    alert("ERROR: function grabItemObj(), item with itemId=" + itemId + " does not exist in data storage");
    return;
  }

  //create an item-object
  itemObj = itemObjFactory();

  //set the item-object's properties from the retrieved item-data
  itemDataArray = itemInfoString.split(sD);
  itemObj.itemId = itemId;
  itemObj.itemName = itemDataArray[0];
  itemObj.doneStatusCode = itemDataArray[1];
  itemObj.displayCode = itemDataArray[2];
  itemObj.isList = itemDataArray[3];
  itemObj.notes = itemDataArray[4];
  itemObj.isWibtype = itemDataArray[5];
  itemObj.isWibtypeInfoField = itemDataArray[6];

  //set joined-lists array, if any exist for this item
  let saveKeyText_joinedLists_ofItem = getSaveKeyText_joinedLists_ofItem(itemObj.itemId);
  let joinedLists_itemIds_string = getFromDatastore(saveKeyText_joinedLists_ofItem);
  itemObj.joinedLists_itemIds = getIdArray(joinedLists_itemIds_string);

  //set wibtype-assignments array, if any exist for this item
  let saveKeyText_wibtypeAssignments_toItem = getSaveKeyText_wibtypeAssignments_toItem(itemObj.itemId);
  let assignedWibtypes_itemIds_string = getFromDatastore(saveKeyText_wibtypeAssignments_toItem);
  itemObj.assignedWibtypes_itemIds = getIdArray(assignedWibtypes_itemIds_string);

  //set data-from-wibtype-assignment-info-fields, if any
  // loop through any wibtype-itemIds that are assigned to this item-we-are-creating
  itemObj.assignedWibtypes_itemIds.forEach( (current_assignedWibtype_itemId) => {

    //get the item-object for the current wibtype-itemId in the outer loop
    let currentWibtype_itemObj = grabItemObj(current_assignedWibtype_itemId);

    //get the list-member-itemIds for the outer-loop-wibtype's item-object
    let currentWibtype_listMemberItemIds = currentWibtype_itemObj.getListMemberItemIds();

    //loop through the list-member-itemIds
    currentWibtype_listMemberItemIds.forEach( (currentListMemberItemId_ofTheCurrentWibtype) => {

      //we are now in an inner loop, of the list-member-data-itemIds for the wibtype from the outer loop
      //
      //each list-member-data-itemId is for a wibtype-info-field
      // (the variable is "currentListMemberItemId_ofTheCurrentWibtype" in this inner loop)

      //get the wtif-related-data from datastore for this item-we-are-creating
      let saveKeyText_wtifData = getSaveKeyText_wtifData(itemObj.itemId, currentListMemberItemId_ofTheCurrentWibtype)
      let wtifData = getFromDatastore(saveKeyText_wtifData);

      //create and fill the wtif-data-object that holds the wtif-data for this item-we-are-creating
      let wtifDataObj = createWtifDataObj(currentWibtype_itemObj.itemId, currentListMemberItemId_ofTheCurrentWibtype, null, wtifData);

      //push tye wtif-data-object to the associated array-property of this item-we-are-creating
      itemObj.wtifDataObjs.push(wtifDataObj);

    } );
  } );

  //if this is a wibtype-info-field, set wibtype-info-field-info properties for this item-object
  if (itemObj.isWibtypeInfoField == "1") {
    let saveKeyText_wibtypeInfoFieldInfo_ofItem = getSaveKeyText_wibtypeInfoFieldInfo_ofItem(itemObj.itemId);
    let wibtypeInfoFieldInfo_string = getFromDatastore(saveKeyText_wibtypeInfoFieldInfo_ofItem);
    let wibtypeInfoFieldInfo_array = wibtypeInfoFieldInfo_string.split(sD);
    let wibDataTypeId = wibtypeInfoFieldInfo_array[0];
    let required = wibtypeInfoFieldInfo_array[1];
    itemObj.setWibtypeInfoFieldInfo(wibDataTypeId, required, false);
  }

  //return the item-object
  return itemObj;
}

function grabItemObjByName(itemName) {
  return searchForItemObj(null, null, null, null, null, null, itemName, null, true);

/* OLD CODE
  var allItemIds_string, allItemIds_array, i, curItemId, curItemObj;
  
  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
  
  for (i = 0; i < allItemIds_array.length; i++) {
    curItemId = allItemIds_array[i];
    curItemObj = grabItemObj(curItemId)

    if ( isEqual(itemName, curItemObj.itemName) ) {
      return curItemObj;
    }
  }

  return false; */
}

function hidePopUp(popUpCode) {
  elem("dvMainViewOverlay").style.display = "";
  elem("dvPopUp").style.display = "none";
  elem("dvPopUp_" + popUpCode).style.display = "none";
}

function html_displayAllElementsOfClass(className) {
  html_toggleDisplayAllElementsOfClass(className, true);
}

function html_hideAllElementsOfClass(className) {
  html_toggleDisplayAllElementsOfClass(className, false);
}

function html_toggleDisplayAllElementsOfClass(className, doShow) {
  var ay = document.querySelectorAll("." + className);
  ay.forEach( (theElem, idx) => {
    if (doShow) {
      theElem.style.display = "";
    } else {
      theElem.style.display = "none";
    }
  } );
}

function importBackupText(textToImport) {
  var i, keyValuePairs, keyName, keyValue;

  //split storage-keys from text-to-import string
  keyValuePairs = textToImport.split(sD2);

  //if we don't have an even number of items, there is a mismatch of key/value pairs
  if (keyValuePairs.length % 2 > 0) {
    alert("uneven number of key/value pairs, operation canceled");
    return;
  }

  //clear existing storage
  if ( !confirm("About to clear existing storage, in order to proceed with import. Continue?") ) {
    return
  }
  localStorage.clear();

  //do the import
  for (i = 0; i < keyValuePairs.length; i = i + 2) {
    keyName = keyValuePairs[i];
    keyValue = keyValuePairs[i+1];
//if(!confirm("would make:\nkeyName: "+keyName+"\nkeyValue: "+keyValue+"\n\nexisting keyValue: "+getFromDatastore(keyName)))return
    localStorage.setItem(keyName, keyValue);
//if(!confirm("just added:\nkeyName: "+keyName+"\n\nnow, when re-grabbed from localStorage it is: "+getFromDatastore(keyName)))return
  }

  alert("Import complete");

  //refresh app and go to home page
  loadAppData_andReturnNextDisplayPage();
  displayPage("Home");
}

function isBlank(val) {
  if(val == undefined) return true;
  if(val == null) return true;
  if(val == "0")return false;
  if(parseInt(val) == 0)return false;
  if(val == "") return true;
  if(!val)return true;
  return false;
}

function isDev() {
  if ( getFromDatastore(CONST_devText1) == "1" ) {
    return true;
  } else {
    return false;
  }
}

function isEqual(val1, val2) {
  if ( isBlank(val1) && isBlank(val2) ) return true;
  if ( val1 == val2 ) return true;
  if ( Number(val1) == Number(val2) ) return true;
  return false;
}

function isMemberOfList(memberItemId, listItemId) {
  var listItemObj, listMemberDataObjs, i;

  listItemObj = grabItemObj(listItemId);
  listMemberDataObjs = listItemObj.getListMemberDataObjs();
  
  for (i = 0; i < listMemberDataObjs.length; i++) {
    if ( isEqual(listMemberDataObjs[i].itemId, listItemId) ) {
      return true;
    }
  }

  return false;
}

function isNumeric(val) {
  if ( isBlank(val) ) return false;
  return val == val * 1;
}

function isValidDate(yyyy, mm, dd) {
  return moment(yyyy + "-" + mm + "-" + dd).isValid();
}

function isValidTime(hh, nn) {
  if ( !isNumeric(hh) || !isNumeric(nn) ) {
    return false;
  }

  if ( parseInt(hh) < 0 || parseInt(hh) > 23 || parseInt(nn) < 0 || parseInt(nn) > 59 ) {
    return false;
  }

  return true;
}

function itemNameIsAllowed(itemName) {
  var disallowedName = false;

  if ( isEqual(itemName, CONST_listName_homePage) ) {
    disallowedName = true;
  } else if ( isEqual(itemName, CONST_listName_wibtypes) ) {
    disallowedName = true;
  } else if ( itemName == CONST_timeTracking_itemName ) {
    //TO-DO2: handle this differently
    disallowedName = true;
  }
  if (disallowedName) {
    alert("Item Name '" + itemName + "' is not allowed, as it is reserved by the app");
    return false;
  }

  return true;
}

function itemObjFactory() {
  var itemObj = {};

  itemObj.itemId = null;
  itemObj.itemName = "";
  itemObj.doneStatusCode = CONST_doneStatusCode_undone;
  itemObj.displayCode = CONST_displayCode_normal;
  itemObj.isList = "0";
  itemObj.notes = "";
  itemObj.joinedLists_itemIds = [];
  itemObj.isWibtype = "0";
  itemObj.isWibtypeInfoField = "0";
  itemObj.assignedWibtypes_itemIds = [];
  itemObj.wtifDataObjs = [];

  itemObj.addItemToListMembers = function(itemIdToAdd) {
    var listMemberDataObjs, curMaxSortPosition, sortPositionToUse, newListMemberDataObj;

    //grab current list-members for this list 
    listMemberDataObjs = this.getListMemberDataObjs();

    //set the new sortPosition value
    if (listMemberDataObjs.length == 0) {
      curMaxSortPosition = -1;
    } else {
      curMaxSortPosition = listMemberDataObjs[listMemberDataObjs.length - 1].sortPosition;
    }
    sortPositionToUse = parseInt(curMaxSortPosition) + 1

    //create a new list-member-data-object, and add it to the current array
    newListMemberDataObj = createListMemberDataObj(itemIdToAdd, sortPositionToUse);
    listMemberDataObjs.push(newListMemberDataObj);
    
    //save the revised list-members-array to datastore
    this.saveListMembersToDatastore(listMemberDataObjs);
  };

  itemObj.assignToWibtype = function(wibtypeItemIdToAssign) {
    var i

    //confirm that this item is not already assigned to the wibtype
    if ( doesValArrayHaveElem(this.assignedWibtypes_itemIds, wibtypeItemIdToAssign) ) {
      return false;
    }
    
    //add the new wibtype's itemId to this list's array of wibtype-assignments
    this.assignedWibtypes_itemIds.push(wibtypeItemIdToAssign);

    //save this item's wibtype-assignments to datastore
    this.saveWibtypeAssignmentsToDatastore();

    //TO-DO2: something about grabbing info-field-data-objects?
  };

  itemObj.changeItemInfo = function(itemName, doneStatusCode, displayCode, isList, notes) {
    // process itemName and notes strings here, in case they were not processed by the calling function
    itemName = getProcessedStringForSave(itemName);
    notes = getProcessedStringForSave(notes);

    if ( !isBlank(itemName) ) this.itemName = itemName;
    if ( !isBlank(doneStatusCode) ) this.doneStatusCode = doneStatusCode;
    if ( !isBlank(displayCode) ) this.displayCode = displayCode;
    if ( !isBlank(isList) ) this.isList = isList;
    if ( notes !== null ) this.notes = notes;
    this.saveItemInfoToDatastore();
    return true;
  };

  itemObj.changeWtifData = function(wibtypeItemId, wtifItemId, wtifItemName, theData) {
    if ( isBlank(wibtypeItemId) ){
      let wtifItemObj = grabItemObj(wtifItemId);

      if (wtifItemObj.joinedLists_itemIds.length > 1) {
        //TO-DO2: showSoftError(funcName, errorText);
        console.log("ERROR: function itemObjFactory -> itemObj.changeWtifData, could not save data, " + wtifItemObj.itemName + " is on more than one list, can't determine Type's item-id\n\n(wtifItemId=" + wtifItemId);
        alert("ERROR: function itemObjFactory -> itemObj.changeWtifData, could not save data, " + wtifItemObj.itemName + " is on more than one list, can't determine Type's item-id\n\n(wtifItemId=" + wtifItemId);
        return;
      }

      wibtypeItemId = wtifItemObj.joinedLists_itemIds[0];
    }

//if(parseInt(this.itemId)==378) dc(".changeWtifData(), wibtypeItemId=" + wibtypeItemId + ", wtifItemId=" + wtifItemId + ", wtifItemName=" + wtifItemName + ", theData=" + theData)
//if(parseInt(this.itemId)==378) dc(".changeWtifData(), about to call setDataFromWtif() ...")
    return this.setDataFromWtif(wibtypeItemId, wtifItemId, wtifItemName, theData, true);
  };

  itemObj.doDeletion = function() {
    var firstListItemId = null, saveKeyText_listMembers_ofItem, i, curAllItemIds_string, curAllItemIds_array, newAllItemIds_string = "";

    //check if this is a list with list-members
    if (this.isList == "1") {
      if ( this.hasListMembers() ) {
        alert("Can't delete something that has list members");
        return false;
      }
    }

    //delete assigned-wibtypes and wtif-data for this item
    this.assignedWibtypes_itemIds.forEach( (assignedWibtypes_itemId) => {
      deleteFromDatastore(getSaveKeyText_wibtypeAssignments_toItem(this.itemId));

      let assignedWibtypes_itemObj = grabItemObj(assignedWibtypes_itemId);
      let wtifItemIds = assignedWibtypes_itemObj.getListMemberItemIds()

      wtifItemIds.forEach( (wtifItemId) => {
        deleteFromDatastore(getSaveKeyText_wtifData(this.itemId, wtifItemId));
      } );
    } );

    //remove from joined-lists
    for (i = 0; i < this.joinedLists_itemIds.length; i++) {
      let joinedList_itemId = this.joinedLists_itemIds[i];
      let joinedList_itemObj = grabItemObj(joinedList_itemId);
      if ( firstListItemId == null ) firstListItemId = joinedList_itemId
      joinedList_itemObj.removeListMember(this.itemId);
    }

    //delete joined-list-info for this item
    deleteFromDatastore(getSaveKeyText_joinedLists_ofItem(this.itemId));

    //delete list-members entry for this item
    deleteFromDatastore(saveKeyText_listMembers_ofItem);

    //remove from all-items array
    curAllItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
    curAllItemIds_array = getIdArray(curAllItemIds_string);
    for (i = 0; i < curAllItemIds_array.length; i++) {
      if ( !isEqual(curAllItemIds_array[i], this.itemId) ) {
        if ( !isBlank(newAllItemIds_string) ) newAllItemIds_string += sD;
        newAllItemIds_string += curAllItemIds_array[i];
      }
    }
    saveToDatastore(CONST_stringOfAllItemIds, newAllItemIds_string);

    //delete item-info from datastore
    deleteFromDatastore(getSaveKeyText_item(this.itemId));

    //clear app-level current-item-id
    setAppItemObj(null);

    //return the the item-id of the first joined-list, so the calling functions can move to that item in the UI
    return firstListItemId;
  };

  itemObj.copyToList = function(listToCopyTo_itemId) {
    // TO-DO2: need to handle attempt to copy-to-list that this item is already a member of

    // double-check that this is not a wib or witf -- shouldn't be allowed to be copied through UI, but double-checking here due to importance of the wibtype system
    // TO-DO2: implement this in additional places
    if (this.isWibtype == "1" || this.isWibtypeInfoField == "1") {
      //TO-DO2: showSoftError(funcName, errorText);
      console.log("ERROR: function itemObjFactory -> itemObj.copyToList, disallowed operation on a type entry or on a type info-field (this.isWibtype=" + this.isWibtype + ", this.isWibtypeInfoField=" + this.isWibtypeInfoField);
      alert("ERROR: function itemObjFactory -> itemObj.copyToList, disallowed operation on a type entry or on a type info-field (this.isWibtype=" + this.isWibtype + ", this.isWibtypeInfoField=" + this.isWibtypeInfoField);
      return;
    }
  
    makeNewItem(this.doneStatusCode, null, null, "0", "0", false, this.itemName, null, this.displayCode, this.isList, listToCopyTo_itemId)
  };

  itemObj.getListMemberDataObjs = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string, listMembers_array, i, curListMemberDataObj, listMemberDataObjs = [];

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);
    listMembers_array = getIdArray(listMembers_string);

    for (i = 0; i < listMembers_array.length; i = i + 2) {
      curListMemberDataObj = createListMemberDataObj(listMembers_array[i], listMembers_array[i + 1]);
      listMemberDataObjs.push(curListMemberDataObj);
    }

    //for now, we will sort the array by sortPosition every time; in the future, this could be provided as a separate function
    listMemberDataObjs.sort( sortingObjects_numeric(CONST_propName_sortPosition) );

    return listMemberDataObjs;
  };

  itemObj.getListMemberItemIds = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string, listMembers_array, i, listMemberItemIds = [];

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);
    listMembers_array = getIdArray(listMembers_string);

    for (i = 0; i < listMembers_array.length; i = i + 2) {
      listMemberItemIds.push(listMembers_array[i]);
    }

    return listMemberItemIds;
  };

  itemObj.getMainListName = function() {
    if ( this.joinedLists_itemIds.length == 0 ) {
      return "";
    } else {
      let mainListItemObj = grabItemObj(this.joinedLists_itemIds[0]);
      return mainListItemObj.itemName;
    }
  };

  itemObj.getWtifData = function(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet) {
//if(parseInt(this.itemId)==378) dc(".getWtifData(), 1 -> itemObjFactory/itemObj/this.itemId=" + this.itemId + ", wibtypeItemId_toGet=" + wibtypeItemId_toGet + ", wtifItemId_toGet=" + wtifItemId_toGet + ", wtifItemName_toGet=" + wtifItemName_toGet);
//if(parseInt(this.itemId)==378) dc(".getWtifData(), 1 -> about to call getWtifDataObj() ...")
    var wtifDataObj = this.getWtifDataObj(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet);
//let wibtypeItemId_createdByUsageOfThisScreen = app.wbs_curScreen_itemObj.getWtifData(app.wbs_screensWibtype_itemId, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName);
//if(parseInt(this.itemId)==378) dc(".getWtifData(), 2 -> wtifDataObj.wibtypeItemId / .wtifItemId / .theData --- " + wtifDataObj.wibtypeItemId + " / " + wtifDataObj.wtifItemId + " / " + wtifDataObj.theData);
    if (wtifDataObj) {
      return wtifDataObj.theData;
    }
    return null;
  };

  itemObj.getWtifDataObj = function(wibtypeItemId_toGet, wtifItemId_toGet, wtifItemName_toGet) {
//if(parseInt(this.itemId)==378) dc("itemObjFactory/itemObj.getWtifDataObj(), this.itemId=" + this.itemId + ", this.wtifDataObjs.length="+this.wtifDataObjs.length)
    for (var i = 0; i < this.wtifDataObjs.length; i++ ) {
      let wtifDataObj_forThisLoop = this.wtifDataObjs[i];
//if(parseInt(this.itemId)==378) dc("itemObjFactory/itemObj.getWtifDataObj(), this.wtifDataObjs[i].wtifItemId=" + this.wtifDataObjs[i].wtifItemId)
//if(parseInt(this.itemId)==378) dc("itemObjFactory/itemObj.getWtifDataObj(), wtifDataObj_forThisLoop.wibtypeItemId="+wtifDataObj_forThisLoop.wibtypeItemId)
      if ( isEqual(wtifDataObj_forThisLoop.wibtypeItemId, wibtypeItemId_toGet) ) {

        if ( isEqual(wtifDataObj_forThisLoop.wtifItemId, wtifItemId_toGet) ) {
          return wtifDataObj_forThisLoop;
        } else if ( !isBlank(wtifItemName_toGet) ) {
          let wtifItemObj_forThisLoop = grabItemObj(wtifDataObj_forThisLoop.wtifItemId);
          if ( isEqual(wtifItemObj_forThisLoop.itemName, wtifItemName_toGet) ) {
            return wtifDataObj_forThisLoop;
          }
        }

      }

    }

//if(parseInt(this.itemId)==378) dc("itemObjFactory/itemObj.getWtifDataObj(), did not find wtif for:\nitemId=" + this.itemId + "\nitemName=" + this.itemName + "\nwibtypeItemId_toGet=" + wibtypeItemId_toGet + "\nwtifItemId_toGet=" + wtifItemId_toGet + "\nwtifItemName_toGet=" + wtifItemName_toGet);
    return null;
  };

  itemObj.hasListMembers = function() {
    var saveKeyText_listMembers_ofItem, listMembers_string;

    saveKeyText_listMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);
    listMembers_string = getFromDatastore(saveKeyText_listMembers_ofItem);

    if ( isBlank(listMembers_string) ) return false;

    if (listMembers_string.length > 0) {
      return true;
    } else {
      return false;
    }
  };

  itemObj.joinList = function(listToJoin_itemId) {
    //TO-DO2: need to handle attempt to join list that this item is already a member of
    var listToJoin_itemObj;

    //grab item-object for the list-to-join
    listToJoin_itemObj = grabItemObj(listToJoin_itemId);

    //call function on list-to-join's item-object, in order to be added to the list-members for that list-to-join 
    listToJoin_itemObj.addItemToListMembers(this.itemId);

    //add the list-to-join's itemId to this list's array of joined-lists
    this.joinedLists_itemIds.push(listToJoin_itemId);

    //save joined-lists to datastore
    this.saveJoinedListsToDatastore();
  };

  itemObj.leaveList = function(listToLeave_itemId) {
    var listToLeave_itemObj;

    //remove the list-to-leave's itemId from this list's array of joined-lists
    this.joinedLists_itemIds = getValArrayWithoutElem(this.joinedLists_itemIds, listToLeave_itemId);

    //save joined-lists to datastore
    this.saveJoinedListsToDatastore();

    //grab item-object for the list-to-join
    listToLeave_itemObj = grabItemObj(listToLeave_itemId);

    //call function on list-to-leave's item-object, in order to be removed from its list-members
    listToLeave_itemObj.removeListMember(this.itemId);
  };

  itemObj.makeIntoAList = function() {
    var saveKeyText_itemListMembers_ofItem, check_listMemberDataObjs_string;

    if (this.isList == "1") {
      // no action needed
    } else {
      this.isList = "1";
      this.saveItemInfoToDatastore();
    }

    saveKeyText_itemListMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);

    // check any list members are already saved for this item 
    check_listMemberDataObjs_string = getFromDatastore(saveKeyText_itemListMembers_ofItem);

    if ( isBlank(check_listMemberDataObjs_string) ) {
      // if the existing list-member save text DID return blank, okay to set to empty-string
      saveToDatastore(saveKeyText_itemListMembers_ofItem, "");
    } else {
      // if the existing list-member save text DID NOT return blank, leave as is
      //  (there was a previous error where this item was turned into not-a-list, but retained list members)
      // => no action
    }
  };

  itemObj.markAllListMembers = function(markDirectionIsDone, listMemberDataObjs) {
    var i;

    for (i = 0; i < listMemberDataObjs.length; i++) {
      let curItemObj = grabItemObj(listMemberDataObjs[i].itemId);
      
      if (markDirectionIsDone) {
        if (curItemObj.doneStatusCode == CONST_doneStatusCode_undone) {
          curItemObj.changeItemInfo(null, CONST_doneStatusCode_done, null, null, null);
        }
      } else {
        if (curItemObj.doneStatusCode == CONST_doneStatusCode_done) {
          curItemObj.changeItemInfo(null, CONST_doneStatusCode_undone, null, null, null);
        }
      }
    }
  };

  itemObj.removeListMember = function(itemIdToRemove) {
    var oldListMemberDataObjs, newListMemberDataObjs;

    oldListMemberDataObjs = this.getListMemberDataObjs();
    newListMemberDataObjs = getObjArrayWithoutElem(oldListMemberDataObjs, CONST_propName_itemId, itemIdToRemove)

    this.saveListMembersToDatastore(newListMemberDataObjs);
  };

  itemObj.saveItemInfoToDatastore = function() {
    var itemInfoString = createItemInfoString(this.itemName, this.doneStatusCode, this.displayCode, this.isList, this.notes, this.isWibtype, this.isWibtypeInfoField)
    saveToDatastore(getSaveKeyText_item(this.itemId), itemInfoString);
  };

  itemObj.saveJoinedListsToDatastore = function() {
    var joinedLists_itemIds_string = getIdString(this.joinedLists_itemIds);
    saveToDatastore(getSaveKeyText_joinedLists_ofItem(this.itemId), joinedLists_itemIds_string);
  };

  itemObj.saveListMembersToDatastore = function(listMemberDataObjs) {
    var saveKeyText_itemListMembers_ofItem, i, listMemberDataObjs_string = ""; 

    saveKeyText_itemListMembers_ofItem = getSaveKeyText_listMembers_ofItem(this.itemId);

    for (i = 0; i < listMemberDataObjs.length; i++) {
      let curListMemberDataObj = listMemberDataObjs[i];
      if ( !isBlank(listMemberDataObjs_string) ) listMemberDataObjs_string += sD;
      listMemberDataObjs_string += curListMemberDataObj.itemId + sD + curListMemberDataObj.sortPosition;
    }

    saveToDatastore(saveKeyText_itemListMembers_ofItem, listMemberDataObjs_string);
  };

  itemObj.saveWibtypeAssignmentsToDatastore = function() {
    var assignedWibtypes_itemIds_string = getIdString(this.assignedWibtypes_itemIds);
    saveToDatastore(getSaveKeyText_wibtypeAssignments_toItem(this.itemId), assignedWibtypes_itemIds_string);
  };

  itemObj.saveWibtypeInfoFieldInfoToDatastore = function() {
    var wibtypeInfoFieldInfoString = createWibtypeInfoFieldInfoString(this.wibDataTypeId, this.required);
    saveToDatastore(getSaveKeyText_wibtypeInfoFieldInfo_ofItem(this.itemId), wibtypeInfoFieldInfoString);
  };

  itemObj.setDataFromWtif = function(wibtypeItemId, wtifItemId, wtifItemName, theData, saveToDatastore) {
//dc(".setDataFromWtif(), about to call getWtifDataObj() ...")
    var wtifDataObj = this.getWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName);

    if ( wtifDataObj == null ) {
      //if the wtifDataObj DOES NOT exist, create a new one
      wtifDataObj = createWtifDataObj(wibtypeItemId, wtifItemId, wtifItemName, theData);
      this.wtifDataObjs.push(wtifDataObj);
//dc(".setDataFromWtif() 2b, wtifDataObj.wibtypeItemId / .wtifItemId / .theData" + wtifDataObj.wibtypeItemId + " / " + wtifDataObj.wtifItemId + " / " + wtifDataObj.theData )
    } else {
      //if the wtifDataObj DOES exist, update its data
//dc(".setDataFromWtif() 1, wtifDataObj.wibtypeItemId / .wtifItemId / .theData" + wtifDataObj.wibtypeItemId + " / " + wtifDataObj.wtifItemId + " / " + wtifDataObj.theData )
     wtifDataObj.theData = theData;
//dc(".setDataFromWtif() 2, wtifDataObj.wibtypeItemId / .wtifItemId / .theData" + wtifDataObj.wibtypeItemId + " / " + wtifDataObj.wtifItemId + " / " + wtifDataObj.theData )
    }

    //if requested, save the wtifDataObject to the datastore
    if (saveToDatastore) {
      wtifDataObj.saveToDatastore(this.itemId);
    }

    return true;
  };

  itemObj.setWibtypeInfoFieldInfo = function(wibDataTypeId, required, saveToDatastore) {
    this.wibDataTypeId = wibDataTypeId;
    this.required = required;
    if (saveToDatastore) {
      this.saveWibtypeInfoFieldInfoToDatastore();
    }
  };

  return itemObj;
}

function left(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theLeft = str.substr(0, numChars);
  return theLeft;
}

function leftIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackLeft = left(haystack, lenNeedle);

  return isEqual(haystackLeft, needle);
}

function right(str, numChars) {
  if (typeof str !== "string") return null;
  if ( ! isNumeric(numChars) ) return null;
  if (numChars < 0) return null;
  if ( isEqual(numChars, 0) ) return "";
  if (numChars > str.length) return str;
  var theRight = str.substr(str.length - numChars);
  return theRight;
}

function rightIs(haystack, needle) {
  if (typeof haystack !== "string") return false;
  if (typeof needle !== "string") return false;

  var lenNeedle = needle.length;

  if ( isEqual(lenNeedle, 0) ) {
    if ( isEqual(haystack.length, 0) ) {
      return true;
    } else {
      return false;
    }
  }

  var haystackRight = right(haystack, lenNeedle);

  return isEqual(haystackRight, needle);
}

function makeNewItem(doneStatusCode, wibDataTypeId, required, isWibtypeInfoField, isWibtype, overrideDisallowName, itemName, itemNamePrompt, displayCode, isList, addToList_itemId) {
  var newItemObj, allItemIds_string, allItemIds_array, i, itemId_toCheck, maxItemId;

  // if not passed, get item name
  if ( isBlank(itemName) ) {
    if ( isBlank(itemNamePrompt) ) itemNamePrompt = "new item:";
    itemName = prompt(itemNamePrompt, "");
    if ( isBlank(itemName) ) return false;
  }

  // process itemName up here, as it will be used in comparisons below
  itemName = getProcessedStringForSave(itemName);

  if (!overrideDisallowName) {
    // TO-DO2: prevent creation/renaming of duplicate wtif names
    if ( !itemNameIsAllowed(itemName) ) {
      return false;
    }
  }

  // create item-object
  newItemObj = itemObjFactory();

  // generate new itemId
  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
  maxItemId = -1;
  for (i = 0; i < allItemIds_array.length; i++) {
    itemId_toCheck = allItemIds_array[i];
    if (parseInt(itemId_toCheck) > parseInt(maxItemId)) maxItemId = parseInt(itemId_toCheck);
  }
  newItemObj.itemId = parseInt(maxItemId) + 1;

  // set new-item-object values from function arguments received
  if ( !isBlank(doneStatusCode) ) newItemObj.doneStatusCode = doneStatusCode;

  if (isWibtypeInfoField == "1") {
    newItemObj.isWibtypeInfoField = "1";
  } else {
    newItemObj.isWibtypeInfoField = "0";
  }

  if (isWibtype == "1") {
    newItemObj.isWibtype = "1";
  } else {
    newItemObj.isWibtype = "0";
  }

  newItemObj.itemName = itemName;

  if ( !isBlank(displayCode) ) newItemObj.displayCode = displayCode;
  if ( !isBlank(isList) ) newItemObj.isList = isList;
  newItemObj.notes = "";


  // save item-info to datastore
  newItemObj.saveItemInfoToDatastore();

  // if is-list, make into a list
  if (isList == "1") {
    newItemObj.makeIntoAList();
  }

  // add item to list-of-all-items
  if ( isBlank(allItemIds_string) ) {
    allItemIds_string = "";
  } else {
    allItemIds_string = allItemIds_string + sD;
  }
  allItemIds_string = allItemIds_string + newItemObj.itemId;
  saveToDatastore(CONST_stringOfAllItemIds, allItemIds_string);

  // if requested, add this item to a list
  if ( !isBlank(addToList_itemId) ) {
    newItemObj.joinList(addToList_itemId);
  }

  // if this is a wibtype-item-info-field, set the wibtype-item-info-field-info and save to datastore
  if (isWibtypeInfoField == "1") {
    newItemObj.setWibtypeInfoFieldInfo(wibDataTypeId, required, true);
  }

  return newItemObj;
}

function moveOrCopyGrabbedItems(selectedList_itemId, aO_action) {
  var singleItemGrab, sourceList_itemObj, targetList_itemObj;

  if ( !isBlank(app.grabbing_itemId1) && isBlank(app.grabbing_itemId2) ) {
    singleItemGrab = true;
    sourceList_itemObj = grabItemObj(app.itemObj.displayedOnList_itemId);
  } else {
    singleItemGrab = false;
    sourceList_itemObj = app.itemObj;
  }

  targetList_itemObj = grabItemObj(selectedList_itemId);

  if (aO_action.a == "move") {
    transferItems(sourceList_itemObj, targetList_itemObj, app.grabbing_itemIdArray);
  } else {
    copyItems(sourceList_itemObj, targetList_itemObj, app.grabbing_itemIdArray);
  }

  toggleGrabbing_off();

  if (singleItemGrab) {
    //reset the display-item-object -- still is correct itemId-property in app.itemObj, but list-membership change means we need to reset the app.itemObj by re-passing in its item-id
    goToItemView(app.itemObj.itemId, false);
  } else {
    //display the item-object for the list where the grabbed-items where moved or copied to
    goToItemView(selectedList_itemId, false);
  }
}

function reorderActivatedItemToOtherItem(otherItemId) {
  var listItemObj = app.itemObj;
  var itemIdToMove = app.reordering_activatedItemId;
  var targetItemId = otherItemId;

  if ( walkSortPosition(listItemObj, itemIdToMove, null, false, false, targetItemId) ) {
    goToItemView(null, true);
  }
}

function resetElemVal(elemId) {
  var theElem, elemType, elemVal;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      theElem.checked = false;
      break;

    default:
      theElem.value = "";
  }
}

function saveToDatastore(itemKey, itemValue) {
  localStorage.setItem(itemKey, itemValue);
}





function showSoftError(funcName, errorText) {
  var fullErrorMsg = "ERROR: function " + funcName + ", " + errorText;
  console.log(fullErrorMsg);
  alert(fullErrorMsg);
}

function SearchObj() {
  this.errorDuringSettingParams = false;

  this.returnFirstOnly = true;

  this.target_itemName = null;
  this.target_joinedListWithItemId = null;
  this.target_assignedToWibtypeWithItemId = null;

  this.target_wtif_isFrom_wibtypeItemId = null;
  this.target_wtif_itemId = null;
  this.target_wtif_itemName = null;
  this.target_wtif_searchForBlankTheData = false;
  this.target_wtif_theData = null;

  //TO-DOx:
  this.ordering

  this.wtifDataSearchHasBeenSet = false;


  /* --- INSTRUCTIONS ---

  // create and run search object:
  
  var sObj = new SearchObj();
   
  // include any or all of the following:
  //   (all must be true for an item to be returned)
   
  sObj.set_targetItemName(itemName_toSearchFor);
  sObj.set_targetJoinedListWithItemId(listItemId_toSearchFor);
  sObj.set_targetAssignedToWibtypeWithItemId(wibtypeItemId_toSearchFor);

  // can only include one of the following two options:

  // -> option 1:
  sObj.set_targetCombo_wtifItemId_and_wtifData(wtifItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
  //
  //  --- or ---
  //
  // -> option 2:
  sObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData(wtifItemName_toSearchFor, wtifWibtypeItemId_toSearchFor, wtifTheData_toSearchFor, searchForBlankTheData);  // searchForBlankTheData -> true/false
  
  sObj.set_returnFirstOnly_false();  // optional (SearchObj() defaults to returnFirstOnly==true)

  var itemObj = sObj.runSearchAndReturnX();       // if returnFirstOnly==true (default)
  //  --- or ---
  var itemObjArray = sObj.runSearchAndReturnX();  // if returnFirstOnly==false

  */


  this.runSearchAndReturnX = function() {
    if (this.errorDuringSettingParams) {
      showSoftError("SearchObj.runSearchAndReturnX()", "an error previously occurred during the setting of search parameters, so we cannot run this search")
      return;
    }

    var searchResult = null;

  /*
  function searchForItemObj(
  1 = searchParam_wtif_searchForBlankTheData
  2 = searchParam_assignedToWibtypeItemId_noWtifConnection
  3 = searchParam_wtif_wibtypeItemId
  4 = searchParam_wtif_itemName
  5 = searchParam_wtif_itemId
  6 = searchParam_wtif_theData
  7 = searchParam_itemName
  8 = searchParam_onListItemId
  9 = returnFirstOnly
  function searchForItemObj(searchParam_wtif_searchForBlankTheData, searchParam_assignedToWibtypeItemId_noWtifConnection, searchParam_wtif_wibtypeItemId, searchParam_wtif_itemName, searchParam_wtif_itemId, searchParam_wtif_theData, searchParam_itemName, searchParam_onListItemId, returnFirstOnly) {
  */

    searchResult = searchForItemObj(
      this.target_wtif_searchForBlankTheData
      , this.target_assignedToWibtypeWithItemId
      , this.target_wtif_isFrom_wibtypeItemId
      , this.target_wtif_itemName
      , this.target_wtif_itemId
      , this.target_wtif_theData
      , this.target_itemName
      , this.target_joinedListWithItemId
      , this.returnFirstOnly
    );

    return searchResult;
  };

  this.set_targetAssignedToWibtypeWithItemId = function(targetAssignedToWibtypeWithItemId) {
    this.target_assignedToWibtypeWithItemId = targetAssignedToWibtypeWithItemId;
  };

  this.set_targetItemName = function(targetItemName) {
    this.target_itemName = targetItemName;
  };

  this.set_targetJoinedListWithItemId = function(targetJoinedListWithItemId) {
    this.target_joinedListWithItemId = targetJoinedListWithItemId;
  };

  this.set_returnFirstOnly_false = function() {
    this.returnFirstOnly = false;
  };

  this.set_returnFirstOnly_true = function() {
    this.returnFirstOnly = true;
  };

  this.set_targetCombo_wtifItemId_and_wtifData = function(targetWtif_itemId, targetWtif_theData, targetWtif_searchForBlankTheData) {
    if (this.wtifDataSearchHasBeenSet) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemId_and_wtifData()", "wtifDataSearchHasBeenSet is already *true* (received targetWtif_itemId=" + targetWtif_itemId + ", targetWtif_theData=" + targetWtif_theData)
      return;
    }

    if ( isBlank(targetWtif_itemId) ) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemId_and_wtifData()", "received blank value for required parameter targetWtif_itemId")
      return;
    }

    if (targetWtif_searchForBlankTheData && !isBlank(targetWtif_theData)) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemId_and_wtifData()", "received targetWtif_searchForBlankTheData=true, but received non-blank value for targetWtif_theData (targetWtif_theData=" + targetWtif_theData)
      return;
    }

    this.target_wtif_itemId = targetWtif_itemId;

    if (targetWtif_searchForBlankTheData && isBlank(targetWtif_theData)) {
      this.target_wtif_theData = null;
      this.target_wtif_searchForBlankTheData = true;
    } else {
      this.target_wtif_theData = targetWtif_theData;
      this.target_wtif_searchForBlankTheData = false;
    }

    this.wtifDataSearchHasBeenSet = true;
  };

  this.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData = function(targetWtif_itemName, targetWtif_isFrom_wibTypeItemId, targetWtif_theData, targetWtif_searchForBlankTheData) {
    if (this.wtifDataSearchHasBeenSet) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData()", "wtifDataSearchHasBeenSet is already *true* (received targetWtif_itemName=" + targetWtif_itemName + "targetWtif_isFrom_wibTypeItemId=" + targetWtif_isFrom_wibTypeItemId + ", targetWtif_theData=" + targetWtif_theData)
      return;
    }

    if ( isBlank(targetWtif_itemName) ) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData()", "received blank value for required parameter targetWtif_itemName")
      return;
    }

    if ( isBlank(targetWtif_isFrom_wibTypeItemId) ) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData()", "received blank value for required parameter targetWtif_isFrom_wibTypeItemId")
      return;
    }

    if (targetWtif_searchForBlankTheData && !isBlank(targetWtif_theData)) {
      this.errorDuringSettingParams = true;
      showSoftError("SearchObj.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData()", "received targetWtif_searchForBlankTheData=true, but received non-blank value for targetWtif_theData (targetWtif_theData=" + targetWtif_theData)
      return;
    }

    this.target_wtif_itemName = targetWtif_itemName;
    this.target_wtif_isFrom_wibtypeItemId = targetWtif_isFrom_wibTypeItemId;

    if (targetWtif_searchForBlankTheData && isBlank(targetWtif_theData)) {
      this.target_wtif_theData = null;
      this.target_wtif_searchForBlankTheData = true;
    } else {
      this.target_wtif_theData = targetWtif_theData;
      this.target_wtif_searchForBlankTheData = false;
    }

    this.wtifDataSearchHasBeenSet = true;
  };
}


//TO-DO1; make _OLD and _NEW versions, then use _NEW for SearchObj(), and add //notes for each regarding deprecation
function searchForItemObj(searchParam_wtif_searchForBlankTheData, searchParam_assignedToWibtypeItemId_noWtifConnection, searchParam_wtif_wibtypeItemId, searchParam_wtif_itemName, searchParam_wtif_itemId, searchParam_wtif_theData, searchParam_itemName, searchParam_onListItemId, returnFirstOnly) {

//dc("--------------------")
/*
dc("searchForItemObj(), searchParam_onListItemId="+searchParam_onListItemId)
dc("searchForItemObj(), searchParam_wtif_itemName="+searchParam_wtif_itemName)
dc("searchForItemObj(), searchParam_wtif_wibtypeItemId="+searchParam_wtif_wibtypeItemId)
dc("searchForItemObj(), searchParam_wtif_searchForBlankTheData="+searchParam_wtif_searchForBlankTheData)
dc("searchForItemObj(), searchParam_wtif_theData="+searchParam_wtif_theData)
*/

  var allItemIds_string, allItemIds_array, i, result_itemObjArray = [];
  
  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
  
  for (i = 0; i < allItemIds_array.length; i++) {

    let curItemObj = grabItemObj(allItemIds_array[i]);

    if ( !isBlank(searchParam_itemName) ) {
      if ( !isEqual(searchParam_itemName, curItemObj.itemName) ) {
        continue;
      }
    }

    if ( !isBlank(searchParam_onListItemId) ) {
//dc("searchForItemObj(), inside loop, checking joined-lists, i="+i+", searchParam_onListItemId="+searchParam_onListItemId+", curItemObj.itemId="+curItemObj.itemId)
      if ( !doesValArrayHaveElem(curItemObj.joinedLists_itemIds, searchParam_onListItemId) ) {
        continue;
      }
//dc("searchForItemObj(), inside loop, joined-list found, i="+i+", searchParam_onListItemId="+searchParam_onListItemId+", curItemObj.itemId="+curItemObj.itemId)
    }

    if ( !isBlank(searchParam_assignedToWibtypeItemId_noWtifConnection) ) {
      if ( !doesValArrayHaveElem(curItemObj.assignedWibtypes_itemIds, searchParam_assignedToWibtypeItemId_noWtifConnection) ) {
        continue;
      }
    }

    if ( !isBlank(searchParam_wtif_itemId) || !isBlank(searchParam_wtif_itemName) ) {
      let wtifIdOrName_found = false;
      let wtifTheData_matchSuccessful = false;

      for (let j = 0; j < curItemObj.wtifDataObjs.length; j++) {
        let curWtifDataObj = curItemObj.wtifDataObjs[j];

        if ( !isBlank(searchParam_wtif_itemId) ) { 

          if ( isEqual(curWtifDataObj.wtifItemId, searchParam_wtif_itemId) ) {
            wtifIdOrName_found = true;
          }

        } else if ( !isBlank(searchParam_wtif_itemName) ) {
//dc("searchForItemObj(), inside loop, checking itemName, i="+i+", curItemObj.itemId="+curItemObj.itemId)
          let wtifItemObj = grabItemObj(curWtifDataObj.wtifItemId);

          if ( isEqual(curWtifDataObj.wibtypeItemId, searchParam_wtif_wibtypeItemId) && isEqual(wtifItemObj.itemName, searchParam_wtif_itemName) ) {
            wtifIdOrName_found = true;
          }

        }

        if (wtifIdOrName_found) {
          if (searchParam_wtif_searchForBlankTheData && isBlank(curWtifDataObj.theData) ) {
            wtifTheData_matchSuccessful = true;
          } else if ( isEqual(curWtifDataObj.theData, searchParam_wtif_theData) ) {
            wtifTheData_matchSuccessful = true;
          }
          break;
        }

      }

      if (!wtifTheData_matchSuccessful) {
        continue;
      }
    }

    result_itemObjArray.push(curItemObj);

    if (returnFirstOnly) {
      break;
    }
  }

  if (result_itemObjArray.length == 0) {
    return null;
  } else if (returnFirstOnly) {
    return result_itemObjArray[0];
  } else {
    return result_itemObjArray;
  }
}

function setAppItemObj(itemObj) {
  app.itemObj = itemObj;
  if ( app.itemObj ) {
    app.itemObj.displayedOnList_itemId = null;
  }
}

function setElemMouseover(elem) {
  elem.style.color = "blue";
  elem.style.textDecoration = "underline";
  elem.style.cursor = "pointer";
}

function setElemMouseout(elem) {
  elem.style.color = "";
  elem.style.textDecoration = "";
  elem.style.cursor = "";
}

function setElemsToToday(yyyyElemId, mmElemId, ddElemId) {
  var appDateTimeObj = getCurAppDateTimeObj();
  setElemVal(yyyyElemId, appDateTimeObj.yyyy);
  setElemVal(mmElemId, appDateTimeObj.mm);
  setElemVal(ddElemId, appDateTimeObj.dd);
}

function setElemVal(elemId, elemVal) {
  var theElem, elemType;

  theElem = elem(elemId);
  elemType = theElem.type;

  switch (elemType) {
    case "checkbox":
      if (elemVal == "1") {
        theElem.checked = true;
      } else {
        theElem.checked = false;
      }
      break;

    default:
      theElem.value = elemVal;
  }
}

function showPopUp(popUpCode, popUpFocusElem) {
  elem("dvPopUp_MakeNewItem").style.display = "none";
  elem("dvPopUp_MakeNewWibtype").style.display = "none";
  elem("dvPopUp_MakeNewWibtypeInfoField").style.display = "none";
  elem("dvPopUp_ChangeDoneStatus").style.display = "none";

  switch (popUpCode) {

    case "MakeNewItem":
      resetElemVal("ipMakeNewItem_ItemName");
      resetElemVal("ipMakeNewItem_Year");
      resetElemVal("ipMakeNewItem_Month");
      resetElemVal("ipMakeNewItem_Day");
      resetElemVal("ipMakeNewItem_Hour");
      resetElemVal("ipMakeNewItem_Minute");
      resetElemVal("ipMakeNewItem_MinutesTracked");
      setElemVal("ckMakeNewItem_TopOfList", app.makeNewItem_TopOfList);
      setElemVal("ckMakeNewItem_StayListView", app.makeNewItem_StayListView);
      setElemVal("ckMakeNewItem_AddMoreItems", app.makeNewItem_AddMoreItems);
      setElemVal("ckMakeNewItem_TimeTracking", app.makeNewItem_TimeTracking);

      doCheckboxClickAction("ckMakeNewItem_TimeTracking");

      if ( isBlank(app.timeTracking_defaultYear) || isBlank(app.timeTracking_defaultMonth) || isBlank(app.timeTracking_defaultDay) ) {
        setElemsToToday("ipMakeNewItem_Year", "ipMakeNewItem_Month", "ipMakeNewItem_Day")
      } else {
        if ( !isBlank(app.timeTracking_defaultYear) ) elem("ipMakeNewItem_Year").value = app.timeTracking_defaultYear;
        if ( !isBlank(app.timeTracking_defaultMonth) ) elem("ipMakeNewItem_Month").value = app.timeTracking_defaultMonth;
        if ( !isBlank(app.timeTracking_defaultDay) ) elem("ipMakeNewItem_Day").value = app.timeTracking_defaultDay;
      }
      break;

    case "MakeNewWibtype":
      resetElemVal("ipMakeNewWibtype_WibtypeName");
      break;

    case "MakeNewWibtypeInfoField":
      {
        elem("spnMakeNewWibtypeInfoField_WibtypeName").innerHTML = app.itemObj.itemName;

        let wibDataTypesArray = getWibDataTypesAsArray(true);
        let wibDataTypeSelectHtml = getHtml_selectElem("selMakeNewWibtypeInfoField_WibDataTypeId", true, wibDataTypesArray, null, "width: 10em", null, null, false);
    
        elem("spnMakeNewWibtypeInfoField_WibDataTypeId").innerHTML = wibDataTypeSelectHtml;
      
        resetElemVal("ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
        resetElemVal("selMakeNewWibtypeInfoField_WibDataTypeId");
        resetElemVal("ckMakeNewWibtypeInfoField_Required");
        break;
      }

    case "ChangeDoneStatus":
      {
        elem("spnChangeDoneStatus_mainListName").innerHTML = app.itemObj.getMainListName();
        elem("spnChangeDoneStatus_itemName").innerHTML = app.itemObj.itemName;
        //elem("dvChangeDoneStatus_itemName").innerHTML = app.itemObj.itemName;
        elem("spnChangeDoneStatus_currentStatus").innerHTML = getDoneStatusDisplay(app.itemObj.doneStatusCode);

        elem("dvChangeDoneStatus_Done1").style.display = "";
        elem("dvChangeDoneStatus_Done2").style.display = "";
        elem("aChangeDoneStatus_Done").innerHTML = CONST_doneStatusDisplay_done;
        css_setElemToDoneStatusColor("aChangeDoneStatus_Done", CONST_doneStatusCode_done);

        elem("dvChangeDoneStatus_Undone1").style.display = "";
        elem("dvChangeDoneStatus_Undone2").style.display = "";
        elem("aChangeDoneStatus_Undone").innerHTML = CONST_doneStatusDisplay_undone;
        css_setElemToDoneStatusColor("aChangeDoneStatus_Undone", CONST_doneStatusCode_undone);

        elem("dvChangeDoneStatus_Okay1").style.display = "";
        elem("dvChangeDoneStatus_Okay2").style.display = "";
        elem("aChangeDoneStatus_Okay").innerHTML = CONST_doneStatusDisplay_okay;
        css_setElemToDoneStatusColor("aChangeDoneStatus_Okay", CONST_doneStatusCode_okay);

        elem("dvChangeDoneStatus_Notice1").style.display = "";
        elem("dvChangeDoneStatus_Notice2").style.display = "";
        elem("aChangeDoneStatus_Notice").innerHTML = CONST_doneStatusDisplay_notice;
        css_setElemToDoneStatusColor("aChangeDoneStatus_Notice", CONST_doneStatusCode_notice);

        if (app.itemObj.doneStatusCode == CONST_doneStatusCode_done) {
          elem("dvChangeDoneStatus_Done1").style.display = "none";
          elem("dvChangeDoneStatus_Done2").style.display = "none";
        } else if (app.itemObj.doneStatusCode == CONST_doneStatusCode_undone) {
          elem("dvChangeDoneStatus_Undone1").style.display = "none";
          elem("dvChangeDoneStatus_Undone2").style.display = "none";
        } else if (app.itemObj.doneStatusCode == CONST_doneStatusCode_okay) {
          elem("dvChangeDoneStatus_Okay1").style.display = "none";
          elem("dvChangeDoneStatus_Okay2").style.display = "none";
        } else if (app.itemObj.doneStatusCode == CONST_doneStatusCode_notice) {
          elem("dvChangeDoneStatus_Notice1").style.display = "none";
          elem("dvChangeDoneStatus_Notice2").style.display = "none";
        }
      }
  }

  elem("dvMainViewOverlay").style.display = "none";
  elem("dvPopUp").style.display = "inline-flex";
  elem("dvPopUp_" + popUpCode).style.display = "grid";
  if ( !isBlank(popUpFocusElem) ) {
    elem(popUpFocusElem).focus();
  }
}

function sortingObjects_alphabetic(propNameToSortBy) {
  return function(objA, objB) {
    var comparisonCode;

    var aIsBlank = isBlank(objA[propNameToSortBy]);
    var bIsBlank = isBlank(objB[propNameToSortBy]);

    var aString, bString;
    if (!aIsBlank) aString = String(objA[propNameToSortBy]).toLowerCase();
    if (!bIsBlank) bString = String(objB[propNameToSortBy]).toLowerCase();

    if ( aIsBlank && bIsBlank ) {
      comparisonCode = 0;
    } else if (aIsBlank && !bIsBlank) {
      comparisonCode = 1;
    } else if (!aIsBlank && bIsBlank) {
      comparisonCode = -1;
    } else if (aString < bString) {
      comparisonCode = -1;
    } else if (aString > bString) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };
}

function sortingObjects_numeric(propNameToSortBy) {
  return function(objA, objB) {
    var comparisonCode;
    var aIsBlank = isBlank(objA[propNameToSortBy]);
    var bIsBlank = isBlank(objB[propNameToSortBy]);

    if ( aIsBlank && bIsBlank ) {
      comparisonCode = 0;
    } else if (aIsBlank && !bIsBlank) {
      comparisonCode = 1;
    } else if (!aIsBlank && bIsBlank) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) < parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = -1;
    } else if ( parseInt(objA[propNameToSortBy]) > parseInt(objB[propNameToSortBy]) ) {
      comparisonCode = 1;
    } else {
      comparisonCode = 0;
    }

    return comparisonCode;
  };
}

function swapSortPosition(itemId, moveUp, moveAmt) {
  var listItemObj, memberItemObj, list_memberDataObjs, i = null;
  
  listItemObj = app.itemObj;
  memberItemObj = grabItemObj(itemId);
  list_memberDataObjs = listItemObj.getListMemberDataObjs();

  for (i = 0; i < list_memberDataObjs.length; i++) {
    let requestedNewIndex, memberItemDataObj, memberItemDataObj_toSwapWith, member_oldSortPosition;

    if ( isEqual(list_memberDataObjs[i].itemId, memberItemObj.itemId) ) {
      memberItemDataObj = list_memberDataObjs[i];

      if (moveUp) {
        requestedNewIndex = i - parseInt(moveAmt);
        if (requestedNewIndex < 0) return false;
      } else {
        requestedNewIndex = i + parseInt(moveAmt);
        if (requestedNewIndex >= list_memberDataObjs.length) return false;
      }

      memberItemDataObj_toSwapWith = list_memberDataObjs[requestedNewIndex];

      member_oldSortPosition = memberItemDataObj.sortPosition;
      memberItemDataObj.sortPosition = memberItemDataObj_toSwapWith.sortPosition;
      memberItemDataObj_toSwapWith.sortPosition = member_oldSortPosition;
  
      listItemObj.saveListMembersToDatastore(list_memberDataObjs);

      return true;
    }
  }

  return false;
}

function toggleGrabbing_off() {
  css_removeClass("aGrabItems1", CONST_cssClassName_red);
  css_removeClass("aGrabItems2", CONST_cssClassName_red);

  if ( !isBlank(app.grabbing_itemId1) ) {

    // the HTML element for app.grabbing_itemId1 may or may not exist, depending on which display-page this function is called from
    
    let grabbingElemId1 = getHtml_aItem(app.grabbing_itemId1);

    if ( !isBlank(elem(grabbingElemId1) ) ) {
      css_removeClass(grabbingElemId1, CONST_cssClassName_bold);
    }

  }

  app.grabbing_itemId1 = null;
  app.grabbing_itemId2 = null;
  app.grabbing_itemIdArray = [];
  app.grabbingOn = false;
}

function toggleGrabbing_on() {
  app.grabbing_itemId1 = null;
  app.grabbing_itemId2 = null;
  app.grabbing_itemIdArray = [];
  app.grabbingOn = true;

  css_addClass("aGrabItems1", CONST_cssClassName_red);
  css_addClass("aGrabItems2", CONST_cssClassName_red);
}

function toggleReordering_off() {
  css_removeClass("aReorder1", CONST_cssClassName_red);
  css_removeClass("aReorder2", CONST_cssClassName_red);

  if ( !isBlank(app.reordering_activatedItemId) ) {
    deactivateItemForReordering(app.reordering_activatedItemId);
  }

  app.reorderingOn = false;
  app.reordering_mode = null;
}

function toggleReordering_on() {
  app.reorderingOn = true;
  app.reordering_mode = CONST_reordering_mode_normal;

  css_addClass("aReorder1", CONST_cssClassName_red);
  css_addClass("aReorder2", CONST_cssClassName_red);
}

function toggleReorderingMode_normal(itemId) {
  app.reordering_mode = CONST_reordering_mode_normal;
  elem(getHtml_reorderingModeIs_normal_tblOptions(itemId)).style.display = "";
  elem(getHtml_reorderingModeIs_moveToOtherItem_dvInstructions(itemId)).style.display = "none";
}

function toggleReorderingMode_moveToOtherItem(itemId) {
  app.reordering_mode = CONST_reordering_mode_moveToOtherItem;
  elem(getHtml_reorderingModeIs_normal_tblOptions(itemId)).style.display = "none";
  elem(getHtml_reorderingModeIs_moveToOtherItem_dvInstructions(itemId)).style.display = "";
}

function transferItems(sourceListObj, targetListObj, listMembers_itemIdArray) {
  listMembers_itemIdArray.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);

    curItemObj.joinList(targetListObj.itemId);
    curItemObj.leaveList(sourceListObj.itemId);
  } );
}

function walkSortPosition(listItemObj, itemIdToMove, moveAmt, moveToTop, moveToEnd, targetItemId) {
  var memberItemObj, list_memberDataObjs, i, movedAtLeastOneSpot = false;

  //grab item-object for the item-being-walked, and the array of list-member-data-objects for the list
  memberItemObj = grabItemObj(itemIdToMove);
  list_memberDataObjs = listItemObj.getListMemberDataObjs();

  //cycle through all list-member-data-objects for the list, until we find our item that is being walked
  for (i = 0; i < list_memberDataObjs.length; i++) {

    let memberItemDataObj, requestedNewIndex = null, curSortIndex, reachedNewIndex = false;

    if ( isEqual(list_memberDataObjs[i].itemId, memberItemObj.itemId) ) {

      //found the item that is being walked
      memberItemDataObj = list_memberDataObjs[i];

      //calculate the requested new index when the walk will be complete
      if ( Number.isInteger(moveAmt) ) {
        //a negative moveAmt sends us towards the top of the list; positive moveAmt sends us towards the end
        requestedNewIndex = i + parseInt(moveAmt);
      } else if (moveToTop) {
        requestedNewIndex = 0;
      } else if (moveToEnd) {
        requestedNewIndex = list_memberDataObjs.length - 1;
      } else if ( !isBlank(targetItemId) ) {
        //need to grab the current index of the requested item-to-move-to
        for (let j = 0; j < list_memberDataObjs.length; j++) {
          let memberDataObj_toCheck = list_memberDataObjs[j];
          if ( isEqual(memberDataObj_toCheck.itemId, targetItemId) ) {
            //found the requested item-to-move-to
            requestedNewIndex = j;
          }
        }
      } else {
        //this occurs if none of the "move" function parameters were set in a valid fashion
        return false;
      }

      //if there was a problem finding the requested item or spot to walk to, return false
      if ( isBlank(requestedNewIndex) || !Number.isInteger(parseInt(requestedNewIndex)) ) {
        return false;
      }

      //don't walk past the top or end of the list
      if (requestedNewIndex < 0) requestedNewIndex = 0;
      if (requestedNewIndex >= list_memberDataObjs.length) requestedNewIndex = list_memberDataObjs.length - 1;

      //check if the item-being-walked is already at the requested new index
      curSortIndex = i;
      if ( parseInt(curSortIndex) == parseInt(requestedNewIndex) ) {
        reachedNewIndex = true;
      }

      //while we have not yet reached the requested new index, walk one step at a time in its direction
      while(!reachedNewIndex) {
        let memberItemDataObj_toSwapWith, member_oldSortPosition;

        //determine which direction to walk
        if (curSortIndex > requestedNewIndex) {
          curSortIndex = curSortIndex - 1;
        } else {
          curSortIndex = parseInt(curSortIndex) + 1;
        }

        //grab the item-object for the item that our walk has brought us to
        memberItemDataObj_toSwapWith = list_memberDataObjs[curSortIndex];

        //save the current sortPosition value for the item-being-walked
        // (sortPosition is not always the same as list-index: example #1, if an item has been removed from the list); example #2, if items have swapped position)
        member_oldSortPosition = memberItemDataObj.sortPosition;

        //set the sortPosition value for the item-being-walked, to the sortPosition value of the list-member that was already at this index
        memberItemDataObj.sortPosition = memberItemDataObj_toSwapWith.sortPosition;

        ///... and give the old sortPosition of the item-to-be-walked, to the list-member that was already at this index
        memberItemDataObj_toSwapWith.sortPosition = member_oldSortPosition;

        //mark that we moved at least one spot
        if (!movedAtLeastOneSpot) movedAtLeastOneSpot = true;

        //check if we have reached our requested index for the walk
        if ( parseInt(curSortIndex) == parseInt(requestedNewIndex) ) {
          reachedNewIndex = true;
        }
      }

      //if we moved at least one spot, save the member-data-objects for the the list
      if (movedAtLeastOneSpot) {
        listItemObj.saveListMembersToDatastore(list_memberDataObjs);
      }

      //exit this for-loop -- was only being used to find the item-being-walked
      break;
    }
  }

  return movedAtLeastOneSpot;
}

function writeBackupExport() {
  var i, keyName, keyValue, txt = "";

  for (i = 0; i < localStorage.length; i++){
    keyName = localStorage.key(i);
    keyValue = localStorage.getItem(keyName);

    if (i > 0) txt += sD2;

    txt += keyName + sD2 + keyValue;
  }

  elem("taExportedBackupText").value = txt;
  elem("taExportedBackupText").select();
}

function writeHtml_MoveOrCopy_ItemsBeingMovedOrCopied() {
  var singleItemGrab, displayList_itemObj, curList_listMemberDataObjs, html, i, firstGrabbingItemId = null, secondGrabbingItemId = null, firstWas1 = false, firstWas2 = false, wroteFirstHtmlRow = false;

  if ( !isBlank(app.grabbing_itemId1) && isBlank(app.grabbing_itemId2) ) {
    singleItemGrab = true;
    displayList_itemObj = grabItemObj(app.itemObj.displayedOnList_itemId);
  } else {
    singleItemGrab = false;
    displayList_itemObj = app.itemObj;
  }

  html = "<table cellspacing=0 cellpadding=0>\n";
  app.grabbing_itemIdArray = [];

  curList_listMemberDataObjs = displayList_itemObj.getListMemberDataObjs();

  for (i = 0; i < curList_listMemberDataObjs.length; i++){
    let curItemId, curItemObj, writeCurItem = false;

    curItemId = curList_listMemberDataObjs[i].itemId;

    if ( firstGrabbingItemId == null ) {
      
      //we HAVE NOT found the earliest-sort-position grabbed-item yet

      if ( isEqual(curItemId, app.grabbing_itemId1) ) {
        //the current item matches grab-item-1

        //... set info about first-grabbed-item found
        firstGrabbingItemId = app.grabbing_itemId1;
        firstWas1 = true;

        //... mark that we should write the current item
        writeCurItem = true;
      }

      if ( isEqual(curItemId, app.grabbing_itemId2) ) {
        //the current item matches grab-item-2

        //... set info about first-grabbed-item found
        firstGrabbingItemId = app.grabbing_itemId2;
        firstWas2 = true;

        //... mark that we should write the current item
        writeCurItem = true;
      }

    } else {

      //we HAVE found the earliest-sort-position grabbed-item yet

      //... NOTE: this ELSE section does not apply to single-item-grab, as we will exit this loop on the pass when firstGrabbingItemId is filled with the single-item, above

      //we should always write the current item now, because firstGrabbingItem is filled (non-null)
      writeCurItem = true;

      if (firstWas1) {

        //the earliest-sort-position grabbed-item was 1, so check 2 to see if we're done after the current item
        if ( isEqual(curItemId, app.grabbing_itemId2) ) {

          //the current item matches grab-item-2, so mark it as the second-grabbed-item found
          secondGrabbingItemId = app.grabbing_itemId2;
        }

      } else {

        //the earliest-sort-position grabbed-item was 2, so check 1 to see if we're done after the current item
        if ( isEqual(curItemId, app.grabbing_itemId1) ) {

          //the current item matches grab-item-1, so mark it as the second-grabbed-item found
          secondGrabbingItemId = app.grabbing_itemId1;
        }

      }

    }

    //check if we've gotten to the earliest-sort-position grabbed-item yet; if so, we can write HTML
    if (writeCurItem) {
      curItemObj = grabItemObj(curItemId);

      //save the item in an array, for use in the next step
      app.grabbing_itemIdArray.push(curItemId);

      if (wroteFirstHtmlRow) {
        html += "<tr style='height: 0.8em'><td></td><td></td></tr>\n";
      }

      html += "<tr><td>\n";
      html += " <table cellspacing=0 cellpadding=0>\n";
      html += " <tr style='height: 2px'><td></td></tr>\n";
      html += " <tr><td style='color: black; font-size: 125%'>&bull;</td></tr>\n";
      html += " </table>\n";
      html += "</td><td style='width: 0.5em'></td><td><i>" + curItemObj.itemName + "</i></td></tr>\n";

      wroteFirstHtmlRow = true;

      //always break for single-item-grab, after this one row is written
      if (singleItemGrab) {
        break;
      }
    }

    //if first-grabbed-item and second-grabbed-item are filled, we can now exit this loop
    if ( firstGrabbingItemId !== null && secondGrabbingItemId !== null ) {
      break;
    }
  }

  html += "</table>\n";

  return html;
}

function writeHtml_MoveOrCopy_ListsToMoveOrCopyItemsTo() {
  var singleItemGrab, displayList_itemId, allItemIds_string, allItemIds_array, html = "", i, wroteFirstHtmlRow = false, listItemObjsToDisplay = [];
  var sortingPropName = CONST_propName_itemName + "_forSorting";
  var homePageList_itemObj = grabItemObj(app.homePageList_itemId);
  var homePageList_listMemberDataObjs = homePageList_itemObj.getListMemberDataObjs();

  if ( !isBlank(app.grabbing_itemId1) && isBlank(app.grabbing_itemId2) ) {
    singleItemGrab = true;
    displayList_itemId = app.itemObj.displayedOnList_itemId;
  } else {
    singleItemGrab = false;
    displayList_itemId = app.itemObj.itemId;
  }

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
  
  html += "<table cellspacing=0 cellpadding=0>\n";

  for (i = 0; i < allItemIds_array.length; i++) {
    let j, skipThisItem = false;
    let curItemId = allItemIds_array[i];
    let curItemObj = grabItemObj(curItemId)

    // don't write the display-list that holds the grabbed-items:
    if ( isEqual(displayList_itemId, curItemId) ) {
      continue;
    }

    // don't write non-list items:
    if (curItemObj.isList == "0") {
      continue;
    }

    // don't write hidden1 items
    if ( !isEqual(curItemObj.displayCode, CONST_displayCode_normal) ) {
      continue;
    }

    // don't write items from the list of grabbed-items
    for (j = 0; j < app.grabbing_itemIdArray.length; j++) {
      if ( isEqual(app.grabbing_itemIdArray[j], curItemId) ) {
        skipThisItem = true;
        continue;
      }
    }
    if (skipThisItem) {
      continue;
    }

    // everything else is okay to write as an available list to move the grabbed-items to
    // -> push the current-item-object to the designated array
    //     (after adding a sort-column that will put home-page-list items first)

    if ( isEqual(curItemObj.joinedLists_itemIds[0], app.homePageList_itemId) ) {
      let curListMemberDataObj = getElemFromObjArray(homePageList_listMemberDataObjs, CONST_propName_itemId, curItemObj.itemId);
      curItemObj[sortingPropName] = getWithLeadingZeroes(curListMemberDataObj.sortPosition, 5) + "_" + curItemObj.itemName;
    } else {
      curItemObj[sortingPropName] = "99999_" + curItemObj.itemName;
    }

    listItemObjsToDisplay.push(curItemObj);
  }

  // sort the array of list-item-objects we will be displaying
  listItemObjsToDisplay.sort( sortingObjects_alphabetic(sortingPropName) );

  //loop through sorted array of list-item-objects to build the associated html
  for (i = 0; i < listItemObjsToDisplay.length; i++) {
    let curListItemObj = listItemObjsToDisplay[i];

    if (wroteFirstHtmlRow) {
        html += "<tr style='height: 1.8em'><td colspan=2></td></tr>\n";
    }

    html += "<tr><td colspan=2>" + curListItemObj.itemName + "</td></tr>\n";
    html += "<tr style='height: 0.2em'><td colspan=2></td></tr>\n";
    if ( !isBlank(curListItemObj.joinedLists_itemIds[0]) ) {
      let parentListObj = grabItemObj(curListItemObj.joinedLists_itemIds[0]);
      let parentListName = parentListObj.itemName;
      if (parentListName == CONST_listName_homePage) parentListName = "Home";
      html += "<tr><td colspan=2 style='font-size: 95%'>&nbsp;&nbsp;> " + parentListName + "</td></tr>\n";
      html += "<tr style='height: 0.2em'><td colspan=2></td></tr>\n";
    }

    html += "<tr><td style='width: 0.0em'></td><td>\n";
    html += " <a href='javascript:void move_to_this_list(\"" + curListItemObj.itemId + "\")'>move here</a>\n";
    html += " &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void copy_to_this_list(\"" + curListItemObj.itemId + "\")'>copy here</a>\n";
    html += "</td></tr>\n";

    wroteFirstHtmlRow = true;
  }

  if (!wroteFirstHtmlRow) html += "<tr><td>(no other lists are available)</td></tr>";

  html += "</table>\n";

  return html;
}

function writeHtml_Items(mainItemObj) {
  var listMemberDataObjs, html = "", i, tt_wtifYMD_itemId, tt_wtifTime_itemId, tt_wtifMinsTracked_itemId;

  if ( isBlank(mainItemObj) ) mainItemObj = app.itemObj;

  /* get Time-Tracking wtif itemIds */ {
    let tt_wtifYMD_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifYMD_itemName, app.timeTracking_wibtypeItemId, true);
    tt_wtifYMD_itemId = tt_wtifYMD_itemObj.itemId;

    let tt_wtifTime_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifTime_itemName, app.timeTracking_wibtypeItemId, true);
    tt_wtifTime_itemId = tt_wtifTime_itemObj.itemId;

    let tt_wtifMinsTracked_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifMinsTracked_itemName, app.timeTracking_wibtypeItemId, true);
    tt_wtifMinsTracked_itemId = tt_wtifMinsTracked_itemObj.itemId;
  }

  if (mainItemObj.isList) {
    //get array of list-member-item-ids
    listMemberDataObjs = mainItemObj.getListMemberDataObjs();

    //open html table
    html += "<table cellspacing=0 cellpadding=0>\n";

    //loop through array to write list in HTML
    for (i = 0; i < listMemberDataObjs.length; i++){
      let curItemId, curItemObj, addAsterisk, ttDisplayForItem, itemNameDisplay;

      curItemId = listMemberDataObjs[i].itemId;

      if (i > 0) {
        html += "<tr style='height: 1.4em'><td></td><td></td></tr>\n";
      }

      //call the function that grabs the current item's item-info from storage and returns it as a js-object
      curItemObj = grabItemObj(curItemId);

      //add asterisk to item-name if it has notes or list-members
      {
        addAsterisk = false;

        if ( !isBlank(curItemObj.notes) ) {
          addAsterisk = true;
        } else {
          if ( curItemObj.hasListMembers() ) {
            addAsterisk = true;
          }
        }

        if (addAsterisk) {
          itemNameDisplay = curItemObj.itemName + " *";
        } else {
          itemNameDisplay = curItemObj.itemName;
        }
      }

      //add Time-Tracking info if this is such an item
      {
        ttDisplayForItem = "";
        if ( doesValArrayHaveElem(curItemObj.assignedWibtypes_itemIds, app.timeTracking_wibtypeItemId) ) {
          let tt_wtifYMD_dataObj = getElemFromObjArray(curItemObj.wtifDataObjs, CONST_propName_wtifItemId, tt_wtifYMD_itemId);
          let tt_wtifTime_dataObj = getElemFromObjArray(curItemObj.wtifDataObjs, CONST_propName_wtifItemId, tt_wtifTime_itemId);
          let tt_wtifMinsTracked_dataObj = getElemFromObjArray(curItemObj.wtifDataObjs, CONST_propName_wtifItemId, tt_wtifMinsTracked_itemId);

          let ttDateAndTimeObj = createAppDateTimeObj2(tt_wtifYMD_dataObj.theData, tt_wtifTime_dataObj.theData);

          if ( ! isBlank(ttDateAndTimeObj) ) {
            ttDisplayForItem = "TT:&nbsp;&nbsp;" + ttDateAndTimeObj.getYMDHN1(true) + "&nbsp;&nbsp;&nbsp;" + tt_wtifMinsTracked_dataObj.theData + " mins";
          }
        }
      }

      //set html based on item-info values stored as properties of the item-info-js-object
      html += "<tr><td>\n";
      html += " <table cellspacing=0 cellpadding=0>\n";
      html += " <tr style='height: 2px'><td></td></tr>\n";
      html += " <tr><td style='color: black; font-size: 125%'>&bull;</td></tr>\n";
      html += " </table>\n";
      html += "</td><td style='width: 0.5em'></td><td><a id='" + getHtml_aItem(curItemId) + "'" ;
      html += " class='" + getDoneStatusCssClassNameColor(curItemObj.doneStatusCode) + "'";
      html += " href='javascript:void click_item(\"" + curItemId + "\")'>" + itemNameDisplay + "</a>";
      if (ttDisplayForItem) html += "<br /><span style='font-size: 90%'>" + ttDisplayForItem + "</span>";
      html += "</td></tr>\n";
      html += "<tr style='height: 0.8em'><td colspan=3></td></tr>\n"
      html += "<tr id='" + getHtml_reorderingActivated_tr(curItemId) + "' style='display: "
      if ( ! isEqual(curItemId, app.reordering_activatedItemId) ) html += "none";
      html += "'><td style='height: 1em' colspan=2></td><td>\n";
      html += " <table id='" + getHtml_reorderingModeIs_normal_tblOptions(curItemId) + "' cellspacing=0 cellpadding=0>\n";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_to_other_item(\"" + curItemId + "\")'>move to other item</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 1em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_up(\"" + curItemId + "\", 1)'>up 1</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_down(\"" + curItemId + "\", 1)'>down 1</a>\n";
      html += " </td></tr>\n";

      /*
      html += " <tr style='height: 1em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_up(\"" + curItemId + "\", 5)'>up 5</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_down(\"" + curItemId + "\", 5)'>down 5</a>\n";
      html += " </td></tr>\n";
      html += " <tr style='height: 1em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_up(\"" + curItemId + "\", 10)'>up 10</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_down(\"" + curItemId + "\", 10)'>down 10</a>\n";
      html += " </td></tr>\n";
      */

      html += " <tr style='height: 1em'><td colspan=2></td></tr>";
      html += " <tr><td>&nbsp;&nbsp;&nbsp;</td><td>";
      html += "  <a href='javascript:void move_item_to_top(\"" + curItemId + "\")'>to top</a>\n";
      html += "  &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a href='javascript:void move_item_to_end(\"" + curItemId + "\")'>to end</a>\n";
      html += " </td></tr>\n";
      html += " </table>\n";
      html += " <div id='" + getHtml_reorderingModeIs_moveToOtherItem_dvInstructions(curItemId) + "' style='display: none'><i>now click the other item</i></div>\n";
      html += "</td></tr>\n";
    }

    if (listMemberDataObjs.length == 0) {
      if (mainItemObj.isWibtype == "1") {
        html += "<tr'><td>(no info-fields yet for this Type)</td></tr>";
      } else {
        html += "<tr'><td>(no items)</td></tr>";
      }
      html += "<tr style='height: 0.85em'><td></td></tr>";
    }

    html += "</table>\n";
  }

//elem("taDev1").value = html;
  return html;
}

function writeHtml_WtifData() {
  var wibtypeItemIds, html = "", i;

  html += "<div class='grid2'>\n";

  for (i = 0; i < app.itemObj.assignedWibtypes_itemIds.length; i++) {
    let wibtypeItemId = app.itemObj.assignedWibtypes_itemIds[i];
    let wibtypeItemObj = grabItemObj(wibtypeItemId);

    if (i > 0) {
      html += "<div class='grid2Cell gc2VSpace2'></div>\n";
    }
    html += "<div class='grid2Cell gc2Header2'>" + wibtypeItemObj.itemName + "&nbsp;&nbsp;</div>\n";
    html += "<div class='grid2Cell gc2VSpace2'></div>\n";

    let wtifs_listMemberDataObjs = wibtypeItemObj.getListMemberDataObjs();

    for (let j = 0; j < wtifs_listMemberDataObjs.length; j++) {
      let wtif_listMemberDataObj = wtifs_listMemberDataObjs[j];
      let wtif_itemObj = grabItemObj(wtif_listMemberDataObj.itemId);

      let wtifDataObj = getElemFromObjArray(app.itemObj.wtifDataObjs, "wtifItemId", wtif_itemObj.itemId);
      let dataDisplay = "(blank)";

      if ( wtifDataObj !== null ) {
        dataDisplay = wtifDataObj.theData;
        if ( isBlank(dataDisplay) ) {
          dataDisplay = "(blank)";
        }
      }

      if (j > 0) {
        html += "<div class='grid2Cell gc2VSpace2'></div>\n";
      }
      html += "<div class='grid2Cell gc2TextLeft'>" + wtif_itemObj.itemName + ":</div>\n";
      html += "<div class='grid2Cell gc2TextRight'>" + dataDisplay + "</div>\n";
    }
  }

  if (app.itemObj.assignedWibtypes_itemIds == 0) {
    html += "<div class='grid2Cell gc2Footer'>types: <i>none</i></div>\n";
  }

  html += "</div>\n";

//elem("taDev1").value = html;
  return html;
}

function writeStorage() {
  var i, keyName, keyValue, html = "", curListId, curListName, appNarrow;

  appNarrow = getFromDatastore(CONST_appNarrow);

  html += "<div><a href='javascript:void add_storage_row()'>add</a></div>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<table cellpadding=5 cellspacing=0 border=1>\n";

  if (localStorage.length <= 0) {
    html += "<tr><td>(no items in storage)</td></tr>\n";
  } else {
    if (appNarrow == "1") {
      html += "<tr><td></td><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><b>Key Name</b></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td style='height: 1px; background-color: black'></td></tr>\n";
      html += "  <tr><td style='height: 3px'></td></tr>\n";
      html += "  <tr><td><b>Key Value</b></td></tr>\n";
      html += "  </table>\n";
      html += "</td></tr>\n";
    } else {
      html += "<tr><td></td><td><b>Key Name</b></td><td><b>Key Value</b></td></tr>\n";
    }
  }

  for (i = 0; i < localStorage.length; i++) {
    keyName = localStorage.key(i);
    keyValue = getFromDatastore(keyName);

    if (appNarrow == "1") {
      html += "<tr><td>\n";
      html += "  <table cellpadding=0 cellspacing=0>\n";
      html += "  <tr><td><a href='javascript:void edit_storage_row(\"" + keyName + "\")'>edit</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript:void change_storage_key_name(\"" + keyName + "\")'>change key</a></td></tr>\n";
      html += "  <tr><td style='height: 15px'></td></tr>\n";
      html += "  <tr><td><a href='javascript:void delete_storage_row(\"" + keyName + "\")'>delete</a></td></tr>\n";
      html += "  </table>\n";
      html += "</td>\n";
    } else {
      html += "<tr><td style='white-space: nowrap'>&nbsp;<a href='javascript:void edit_storage_row(\"" + keyName + "\")'>edit</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript:void change_storage_key_name(\"" + keyName + "\")'>change key</a>\n";
      html += "&nbsp;|&nbsp;&nbsp;<a href='javascript:void delete_storage_row(\"" + keyName + "\")'>delete</a>&nbsp;&nbsp;</td>\n";
    }

    if (appNarrow == "1") {
      html += "<td>" + keyName + "</td></tr>\n";
      html += "<tr><td></td><td>" + keyValue + "</td></tr>\n";
    } else {
      html += "<td>" + keyName + "</td><td>" + keyValue + "</td></tr>\n";
    }
  }

  html += "</table>\n";
  html += "<div style='height:0.8em'></div>\n";
  html += "<div><a href='javascript:void add_storage_row()'>add</a></div>\n";

  elem("dvStorage").innerHTML = html;
}


///// USER-CLICKABLE FUNCTIONS

function add_notes() {
  var newNotes = prompt("Notes:", "");
  if ( isBlank(newNotes) ) return;

  newNotes = getProcessedStringForSave(newNotes);

  app.itemObj.changeItemInfo(null, null, null, null, newNotes);
  goToItemView(null, true);
}

function add_storage_row() {
  var keyName = prompt("New key name:", "");
  var keyValue = prompt("New key value:", "");

  if ( isBlank(keyName) ) {
    return;
  }

  saveToDatastore(keyName, keyValue);
  show_storage();
}

function all_screens__view_type_instances(screenItemId) {
  var screenItemObj = grabItemObj(screenItemId);
  app.wbs_curWibtype_itemObj = wbs_getWibtypeItemObj_thatScreenWillCreate(screenItemObj);
  displayPage("WibBuilder_ShowWibtypeInstances");
}

function all_screens__build_new_screen() {
  displayPage("WibBuilder_BuildScreen");
}

function all_screens__build_screen(screenItemId) {
  app.wbs_curScreen_itemObj = grabItemObj(screenItemId);
  displayPage("WibBuilder_BuildScreen");
}

function all_screens__run_screen(screenItemId) {
  app.wbs_curScreen_itemObj = grabItemObj(screenItemId);
  displayPage("WibBuilder_RunScreen");
}

function back_to_type(wibtypeItemId) {
  goToItemView(wibtypeItemId, false)
}

function begin_import() {
  var textToImport = elem("taBackupTextToImport").value;
  if ( isBlank(textToImport) ) return;
  importBackupText(textToImport);
}

function build_screen__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function build_screen__name_type() {
  var newTypeName = prompt("type of thing being created:", "");

  if ( isBlank(newTypeName) ) {
    return;
  }

  var wibtypeItemObj_createdByUsageOfThisScreen = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, newTypeName, null, CONST_displayCode_hidden1, "1", app.wibtypes_itemId);
  if (!wibtypeItemObj_createdByUsageOfThisScreen) {
    return
  }

  var screenItemName = wibBuilder_screen_getScreenItemName(CONST_wbs_screenTypeCode_createType, wibtypeItemObj_createdByUsageOfThisScreen.itemId);

  var wibBuilderScreen_itemObj = makeNewItem(null, null, null, "0", "0", false, screenItemName, null, CONST_displayCode_hidden1, "0", app.wbs_screenListItemId);
  if (!wibBuilderScreen_itemObj) {
    return
  }

  var wibtypeItemObj_ofWibBuilderScreens = grabItemObj(app.wbs_screensWibtype_itemId);

  setWibtypeAndWtifs(wibBuilderScreen_itemObj, wibtypeItemObj_ofWibBuilderScreens, CONST_wbs_screenWtifs_screenTypeCode_itemName, CONST_wbs_screenTypeCode_createType, CONST_wbs_screenWtifs_wibtypeItemId_itemName, wibtypeItemObj_createdByUsageOfThisScreen.itemId);

  app.wbs_curScreen_itemObj = wibBuilderScreen_itemObj;
  displayPage("WibBuilder_BuildScreen");
}

function setWibtypeAndWtifs(itemObjToSet, wibtypeItemObj, wtifItemName1, wtifData1, wtifItemName2, wtifData2, wtifItemName3, wtifData3, wtifItemName4, wtifData4, wtifItemName5, wtifData5) {
  itemObjToSet.assignToWibtype(wibtypeItemObj.itemId);

  if ( !isBlank(wtifItemName1) ) {
    itemObjToSet.changeWtifData(wibtypeItemObj.itemId, null, wtifItemName1, wtifData1);
  }

  if ( !isBlank(wtifItemName2) ) {
    itemObjToSet.changeWtifData(wibtypeItemObj.itemId, null, wtifItemName2, wtifData2);
  }

  if ( !isBlank(wtifItemName3) ) {
    itemObjToSet.changeWtifData(wibtypeItemObj.itemId, null, wtifItemName3, wtifData3);
  }

  if ( !isBlank(wtifItemName4) ) {
    itemObjToSet.changeWtifData(wibtypeItemObj.itemId, null, wtifItemName4, wtifData4);
  }

  if ( !isBlank(wtifItemName5) ) {
    itemObjToSet.changeWtifData(wibtypeItemObj.itemId, null, wtifItemName5, wtifData5);
  }
}

function wibBuilder_screen_getScreenItemName(wbsScreenTypeCode, wibtypeItemId) {
  // the screen's item-name is in the format:
  // -> wbs__ScreenTypeCode_X__wibtypeItemId_Y
  //      ... the part "ScreenTypeCode_X" comes from -- X = e.g. wbsScreenTypeCode = CONST_wbs_screenTypeCode_createType (which is "1")
  //      ... the part "wibtypeItemId_Y" comes from -- Y = the wibtype-itemId of the wibtypeItemObj we created in build_screen__name_type()

  var screenItemName = "wbs__ScreenTypeCode_" + wbsScreenTypeCode + "__wibtypeItemId_" + wibtypeItemId;
  return screenItemName;
}

function build_screen__run_this_screen() {
  if (!app.wbs_curScreen_itemObj) {
    alert("must set the 'type of thing being created' in order to run this screen");
    return;
  }

  displayPage("WibBuilder_RunScreen");
}

function cancel_change_done_status() {
  hidePopUp("ChangeDoneStatus");
}

function cancel_make_new_item() {
  hidePopUp("MakeNewItem");
}

function cancel_make_new_type() {
  hidePopUp("MakeNewWibtype");
}

function cancel_make_new_type_info_field() {
  hidePopUp("MakeNewWibtypeInfoField");
}

function cancel_move() {
  toggleGrabbing_off();
  goToItemView(null, false);
}

function change_done_status() {
  showPopUp("ChangeDoneStatus", null);
}

function change_storage_key_name(curKeyName) {
  var editedKeyName, keyValue, keyValueFromEditedKeyName, warningMsg, confirmationMsg;

  //get new key name user requests
  editedKeyName = prompt("Change key name to:", curKeyName);

  //exit if user did not provide a new key name
  if ( isBlank(editedKeyName) ) {
    return;
  }

  //grab existing key value for current key name
  keyValue = getFromDatastore(curKeyName);

  //check to see if new requestd key name is already in use; if so, disallow
  keyValueFromEditedKeyName = getFromDatastore(editedKeyName);
  if ( !isBlank(keyValueFromEditedKeyName) ) {
    warningMsg = "*** OPERATION DISALLOWED ***\n";
    warningMsg += "You tried to change key with keyName='" + curKeyName + "'\n";
    warningMsg += "( keyValue='" + keyValue + "' )\n";
    warningMsg += "... to the new-keyName '" + editedKeyName + "'\n";
    warningMsg += "... but that new-keyName already exists, with existing-keyValue '" + keyValueFromEditedKeyName + "'";
    alert(warningMsg);
    return;
  }

  //save new key to storage
  saveToDatastore(editedKeyName, keyValue);

  //delete previous key name
  deleteFromDatastore(curKeyName);

  //provide info with change
  confirmationMsg = "Change Made:\n\n";
  confirmationMsg += " old-keyName: " + curKeyName + "\n";
  confirmationMsg += " new-keyName " + editedKeyName + "\n";
  confirmationMsg += " keyValue: " + keyValue;
  alert(confirmationMsg);

  //refresh storage view
  show_storage();
}

function clear_storage() {
  var clearStoragePrompt;
  
  clearStoragePrompt = prompt("type 'clear it' to clear local storage", "");

  if (clearStoragePrompt == "clear it") {
    localStorage.clear();
    alert("storage cleared");
  } else {
    alert("storage NOT cleared");
  }
}

function click_item(itemIdThatWasClicked) {

  if (app.reorderingOn) {

    if ( isBlank(app.reordering_activatedItemId) ) {

      activateItemForReordering(itemIdThatWasClicked);

    } else if ( isEqual(itemIdThatWasClicked, app.reordering_activatedItemId) ) {

      deactivateItemForReordering(app.reordering_activatedItemId);

    } else if (app.reordering_mode == CONST_reordering_mode_normal) {

      deactivateItemForReordering(app.reordering_activatedItemId);
      activateItemForReordering(itemIdThatWasClicked);

    } else if (app.reordering_mode == CONST_reordering_mode_moveToOtherItem) {
      reorderActivatedItemToOtherItem(itemIdThatWasClicked);      

    }

  } else if (app.grabbingOn) {

    if ( isBlank(app.grabbing_itemId1) ) {

      css_addClass(getHtml_aItem(itemIdThatWasClicked), CONST_cssClassName_bold);
      app.grabbing_itemId1 = itemIdThatWasClicked;

    } else if ( isEqual(itemIdThatWasClicked, app.grabbing_itemId1) ) {

        css_removeClass(getHtml_aItem(itemIdThatWasClicked), CONST_cssClassName_bold);
        app.grabbing_itemId1 = null;

    } else {

      app.grabbing_itemId2 = itemIdThatWasClicked;
      displayPage("MoveOrCopy");

    }

  } else {

    goToItemView(itemIdThatWasClicked, false);

  }

}

function copy_imported_text_to_clipboard() {
  elem("taExportedBackupText").select();  
  document.execCommand("copy")
  alert("backup text copied to clipboard");
}

function copy_to_this_list(selectedList_itemId) {
  moveOrCopyGrabbedItems(selectedList_itemId, aO("copy"))
}

function delete_item() {
  if ( confirm("Delete this item?\n\nItem Name: " + app.itemObj.itemName) ) {
    if ( deleteItem(app.itemObj.itemId) ) {
      if ( !isBlank(app.itemObj) ) {
        goToItemView(null, false);
      } else {
        return_home();
      }
    }
  }
}

function delete_notes() {
  if ( confirm("Delete all Notes for this item?\n\nItem Name: " + app.itemObj.itemName + "\n\nNotes: " + app.itemObj.notes) ) {
    app.itemObj.changeItemInfo(null, null, null, null, "");
    goToItemView(null, true);
  }
}

function delete_storage_row(keyName) {
  if ( confirm("Delete this row?") ) {
    deleteFromDatastore(keyName);
    show_storage();
  }
}

function do_change_done_status(newDoneStatusDisplay) {
  var newDoneStatusCode, goToItemId;

  if (newDoneStatusDisplay == CONST_doneStatusDisplay_done) {
    newDoneStatusCode = CONST_doneStatusCode_done;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_notice) {
    newDoneStatusCode = CONST_doneStatusCode_notice;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_okay) {
    newDoneStatusCode = CONST_doneStatusCode_okay;
  } else if (newDoneStatusDisplay == CONST_doneStatusDisplay_undone) {
    newDoneStatusCode = CONST_doneStatusCode_undone;
  }

  app.itemObj.changeItemInfo(null, newDoneStatusCode, null, null, null);

  hidePopUp("ChangeDoneStatus");

  if ( isBlank(app.itemObj.displayedOnList_itemId) ) {
    goToItemView(null, false);
  } else {
    goToItemView(app.itemObj.displayedOnList_itemId, false);
  }
}

function do_make_new_item(makeCode) {
  var itemName, doneStatusCode = null, topOfList, stayListView, addMoreItems, timeTracking, ttYear, ttMonth, ttDay, ttHour, ttMinute, ttMinutesTracked, newItemObj;

  if (makeCode == "line") {
    itemName = "--------------------";
    doneStatusCode = CONST_doneStatusCode_okay
  } else {
    itemName = getElemVal("ipMakeNewItem_ItemName");

    // process itemName string here, as it will be used in a comparison below
    itemName = getProcessedStringForSave(itemName);

    if ( !itemNameIsAllowed(itemName) ) {
      elem("ipMakeNewItem_ItemName").focus();
      return;
    }
  }

  topOfList = getElemVal("ckMakeNewItem_TopOfList");
  app.makeNewItem_TopOfList = topOfList;

  stayListView = getElemVal("ckMakeNewItem_StayListView");
  app.makeNewItem_StayListView = stayListView;

  addMoreItems = getElemVal("ckMakeNewItem_AddMoreItems");
  app.makeNewItem_AddMoreItems = addMoreItems;

  if (makeCode == "line") {
    timeTracking = "0";
  } else {
    timeTracking = getElemVal("ckMakeNewItem_TimeTracking");
    app.makeNewItem_TimeTracking = timeTracking;
  }

  if ( isBlank(itemName) ) {
    alert("Item Name is required");
    elem("ipMakeNewItem_ItemName").focus();
    return;
  }

  if (timeTracking == "1") {
    //TO-DO2: validate Time-Tracking data via standardized wtif-info-field process
    ttYear = getElemVal("ipMakeNewItem_Year");
    if ( isBlank(ttYear) ) { alert("Year is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_Year").focus(); return; }

    ttMonth = getElemVal("ipMakeNewItem_Month");
    if ( isBlank(ttMonth) ) { alert("Month is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_Month").focus(); return; }

    ttDay = getElemVal("ipMakeNewItem_Day");
    if ( isBlank(ttDay) ) { alert("Day is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_Day").focus(); return; }

    if ( !isValidDate(ttYear, ttMonth, ttDay) ) { alert("The Year/Month/Day entered is not a valid date"); elem("ipMakeNewItem_Year").focus(); return; }

    ttHour = getElemVal("ipMakeNewItem_Hour");
    if ( isBlank(ttHour) ) { alert("Hour is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_Hour").focus(); return; }

    ttMinute = getElemVal("ipMakeNewItem_Minute");
    if ( isBlank(ttMinute) ) { alert("Minute is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_Minute").focus(); return; }

    if ( !isValidTime(ttHour, ttMinute) ) { alert("The Hour/Minute entered is not a valid time"); elem("ipMakeNewItem_Hour").focus(); return; }

    ttMinutesTracked = getElemVal("ipMakeNewItem_MinutesTracked");
    if ( isBlank(ttMinutesTracked) ) { alert("MinutesTracked is required for " + CONST_timeTracking_itemName); elem("ipMakeNewItem_MinutesTracked").focus(); return; }
    if ( !isNumeric(ttMinutesTracked) ) { alert("MinutesTracked requires a numeric value"); elem("ipMakeNewItem_MinutesTracked").focus(); return; }
    if ( parseInt(ttMinutesTracked) < 0 ) { alert("MinutesTracked must be greater than 0"); elem("ipMakeNewItem_MinutesTracked").focus(); return; }

    doneStatusCode = CONST_doneStatusCode_okay;
  }

  newItemObj = makeNewItem(doneStatusCode, null, null, "0", "0", false, itemName, null, null, "0", app.itemObj.itemId);
  if ( newItemObj ) {

    if (topOfList == "1") {
      walkSortPosition(app.itemObj, newItemObj.itemId, null, true, false, null);
    }

    if (stayListView == "0" && addMoreItems == "0") {
      setAppItemObj(newItemObj);
    }

    if (timeTracking == "1") {
      app.timeTracking_defaultYear = ttYear;
      app.timeTracking_defaultMonth = ttMonth;
      app.timeTracking_defaultDay = ttDay;

      //TO-DO1.5: use new function setWibtypeAndWtifs()
      let ttItemObj = grabItemObjByName(CONST_timeTracking_itemName);
      newItemObj.assignToWibtype(ttItemObj.itemId);

      let ttWtifItemIds = ttItemObj.getListMemberItemIds();

      ttWtifItemIds.forEach( (ttWtifItemId) => {
        let ttWtifItemObj = grabItemObj(ttWtifItemId);
        let wtifData = "";
        switch (ttWtifItemObj.itemName) {
          case CONST_timeTracking_wtifYMD_itemName:
            wtifData = ttYear + "-" + ttMonth + "-" + ttDay;
            break;
          case CONST_timeTracking_wtifTime_itemName:
            wtifData = ttHour + ":" + ttMinute;
            break;
          case CONST_timeTracking_wtifMinsTracked_itemName:
            wtifData = ttMinutesTracked;
            break;
        }
        newItemObj.changeWtifData(ttItemObj.itemId, ttWtifItemObj.itemId, null, wtifData)
      } );
    }

    hidePopUp("MakeNewItem");
    goToItemView(null, true);

    if (addMoreItems == "1") {
      showPopUp("MakeNewItem", "ipMakeNewItem_ItemName");
    }
  }
}

function do_make_new_item_line() {
  do_make_new_item("line");
}

function do_make_new_type() {
  var itemName, newItemObj;

  itemName = getElemVal("ipMakeNewWibtype_WibtypeName");

  // process itemName string here, as it will be used in a comparison below
  itemName = getProcessedStringForSave(itemName);

  if ( !itemNameIsAllowed(itemName) ) {
    return;
  }

  if ( isBlank(itemName) ) {
    alert("Type Name is required");
    return;
  }

  newItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", false, itemName, null, CONST_displayCode_hidden1, "1", app.itemObj.itemId);
  if ( newItemObj ) {
    hidePopUp("MakeNewWibtype");
    displayPage("Wibtypes");
  }
}

function do_make_new_type_info_field() {
  var itemName, wibDataTypeId, required, newItemObj;

  itemName = getElemVal("ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
  wibDataTypeId = getElemVal("selMakeNewWibtypeInfoField_WibDataTypeId");
  required = getElemVal("ckMakeNewWibtypeInfoField_Required");

  // process itemName string here, as it will be used in a comparison below
  itemName = getProcessedStringForSave(itemName);

  if ( !itemNameIsAllowed(itemName) ) {
    return;
  }

  if ( isBlank(itemName) ) {
    alert("Info-Field Name is required");
    return;
  }

  if ( isBlank(wibDataTypeId) ) {
    alert("Data Type is required");
    return;
  }

  newItemObj = makeNewItem(CONST_doneStatusCode_okay, wibDataTypeId, required, "1", "0", false, itemName, null, CONST_displayCode_hidden1, "0", app.itemObj.itemId);
  if ( newItemObj ) {
    hidePopUp("MakeNewWibtypeInfoField");
    goToItemView(null, false);
  }
}

function edit_notes() {
  var editedNotes = prompt("Notes:", app.itemObj.notes);
  if ( isBlank(editedNotes)) {
    alert("Edit canceled because a blank Notes entry was received\n\n(click 'delete notes' if you want to remove all notes for this item)");
    return;
  }

  editedNotes = getProcessedStringForSave(editedNotes);

  app.itemObj.changeItemInfo(null, null, null, null, editedNotes);
  goToItemView(null, true);
}

function edit_storage_row(keyName) {
  var curKeyValue = getFromDatastore(keyName);

  elem("dvShowStorage_EditAllItemIds").style.display = "none";

  if (curKeyValue.length > 999) {
    if (keyName == CONST_stringOfAllItemIds) {
      elem("dvShowStorage_EditAllItemIds").style.display = "";
      elem("taShowStorage_EditAllItemIds").value = getFromDatastore(CONST_stringOfAllItemIds);
      elem("taShowStorage_EditAllItemIds").focus();
      return;
    } else {
      throw ("curKeyValue.length > 999, so not sure if javascript prompt box will work => exiting with error");
    }
  }

  var editedKeyValue = prompt("Change key value to:", curKeyValue);

  if ( editedKeyValue == null ) {
    return;
  }

  saveToDatastore(keyName, editedKeyValue);
  show_storage();
}

function edit_storage_row__do_all_items_edit() {
  var editedKeyValue = elem("taShowStorage_EditAllItemIds").value;

  if ( isBlank(editedKeyValue) ) {
    alert("for now, not allowing blank entry for all-item-ids");
    return;
  }

  saveToDatastore(CONST_stringOfAllItemIds, editedKeyValue);
  show_storage();
}

function edit_storage_row__cancel_all_items_edit() {
  elem("dvShowStorage_EditAllItemIds").style.display = "none";
}

function export_backup_text() {
  displayPage("BackupExport");
}

function go_to_builder() {
  window.location = "index.html?builder";
}

function go_to_list(itemId) {
  goToItemView(itemId, false);
}

function grab_items() {
  if (app.grabbingOn) {
    toggleGrabbing_off();
  } else {
    toggleReordering_off();
    toggleGrabbing_on();
  }
}

function import_backup_text() {
  if ( getFromDatastore(CONST_importBlocked) == "1" ) {
    alert("OPERATION DISALLOWED\n\nImporting of text has been blocked on this device");
    return;
  }
  displayPage("BackupImport");
}

function make_into_a_list() {
  app.itemObj.makeIntoAList();
  goToItemView(null, false);
}

function make_new_item() {
  showPopUp("MakeNewItem", "ipMakeNewItem_ItemName");
}

function make_new_list() {
  var newItemObj;

  newItemObj = makeNewItem(null, null, null, "0", "0", false, null, "new list name:", null, "1", app.homePageList_itemId);
  if ( newItemObj ) {
    setAppItemObj(newItemObj);
    goToItemView(null, false);
  }
}

function make_new_type() {
  showPopUp("MakeNewWibtype", "ipMakeNewWibtype_WibtypeName");
}

function make_new_type_info_field() {
  showPopUp("MakeNewWibtypeInfoField", "ipMakeNewWibtypeInfoField_WibtypeInfoFieldName");
}

function mark_all() {
  var markDirectionIsDone = false, listMemberDataObjs, i, confirmText;
  
  listMemberDataObjs = app.itemObj.getListMemberDataObjs();

  for (i = 0; i < listMemberDataObjs.length; i++) {
    let curItemObj = grabItemObj(listMemberDataObjs[i].itemId);

    //if we find at least one that is undone, that mark-all direction will be towards done
    if (curItemObj.doneStatusCode == CONST_doneStatusCode_undone) {
      markDirectionIsDone = true;
      break;
    }
  }

  if (markDirectionIsDone) {
    confirmText = "mark all undone items on this list as done?";
  } else {
    confirmText = "mark all done items on this list as undone?";
  }

  if ( !confirm(confirmText) ) {
    return;
  }

  app.itemObj.markAllListMembers(markDirectionIsDone, listMemberDataObjs);

  goToItemView(null, true);
}

function move_item_down(itemIdToMove, amount) {
  if ( walkSortPosition(app.itemObj, itemIdToMove, Math.abs(amount), false, false, null) ) {
    goToItemView(null, true);
  }
}

function move_item_to_end(itemIdToMove) {
  if ( walkSortPosition(app.itemObj, itemIdToMove, null, false, true, null) ) {
    goToItemView(null, true);
  }
}

function move_item_to_other_item(itemIdToMove) {
  toggleReorderingMode_moveToOtherItem(itemIdToMove);
}

function move_item_to_top(itemIdToMove) {
  if ( walkSortPosition(app.itemObj, itemIdToMove, null, true, false, null) ) {
    goToItemView(null, true);
  }
}

function move_item_up(itemIdToMove, amount) {
  if ( walkSortPosition(app.itemObj, itemIdToMove, Math.abs(amount) * -1, false, false, null) ) {
    goToItemView(null, true);
  }
}

function move_or_copy_to_different_list() {
  app.grabbing_itemId1 = app.itemObj.itemId;
  app.grabbing_itemId2 = null;
  displayPage("MoveOrCopy");
}

function move_to_this_list(selectedList_itemId) {
  moveOrCopyGrabbedItems(selectedList_itemId, aO("move"))
}

function rename_item() {
  var editedItemName = prompt("Change item name to:", app.itemObj.itemName);
  if ( isBlank(editedItemName) ) return;

  editedItemName = getProcessedStringForSave(editedItemName);

  app.itemObj.changeItemInfo(editedItemName, null, null, null, null);
  goToItemView(null, true);
}

function return_home() {
  if (!app.addDataLoadedSuccessfully) loadAppData_andReturnNextDisplayPage();
  setAppItemObj(grabItemObjByName(CONST_listName_homePage));
  displayPage("Home");
}

function return_home_from_storage() {
  loadAppData_andReturnNextDisplayPage();
  displayPage("Home");
}

function run_screen__save_new_item() {
  var wibtypeItemObj_createdByUsageOfThisScreen = wbs_getWibtypeItemObj_thatScreenWillCreate(app.wbs_curScreen_itemObj);

  var typeInstance_itemName = elem("ipWibBuilder_RunScreen_ItemNameValue").value;
  if ( isBlank(typeInstance_itemName) ) {
    alert(wibtypeItemObj_createdByUsageOfThisScreen.itemName + " Name is required");
    elem("ipWibBuilder_RunScreen_ItemNameValue").focus();
    return;
  }

  // find the wibtype called "wb-wibtype-instance-holder-wibtype"
  //   -> this is the wibtype that is assigned to lists that hold the wibtype-intances, for each wibtype created/managed by wib-builder
  var sObj1 = new SearchObj();
  sObj1.set_targetItemName(CONST_wb_wibtypeInstanceHolderWibtype_itemName);
  sObj1.set_targetJoinedListWithItemId(app.wibtypes_itemId);
  var wibtypeInstanceHolderWibtype_itemObj = sObj1.runSearchAndReturnX();

  // find the list that will hold the current wibtype-instance
  //   -> this list/item will:
  //       (a) be a member of the list "wb-list-of-wibtype-instance-holder-lists" (whose itemId is held in app.wb_listOfWibtypeInstanceHolderLists_itemId)
  //       (b) have a wtif-data-obj whose:
  //             (i)   itemName matches the wtif-itemName "WibtypeInstanceHeldItemId" PLUS said wtif is associated with the wibtype "wb-wibtype-instance-holder-wibtype"
  //             (ii)  theData matches the itemId of the wibtypeItemObj_createdByUsageOfThisScreen
  var sObj2 = new SearchObj();
  sObj2.set_targetJoinedListWithItemId(app.wb_listOfWibtypeInstanceHolderLists_itemId);
  sObj2.set_targetCombo_wtifItemName_and_wibTypeItemId_and_wtifData(CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, wibtypeInstanceHolderWibtype_itemObj.itemId, wibtypeItemObj_createdByUsageOfThisScreen.itemId, false);
  var wibtypeInstanceHolderList_itemObj = sObj2.runSearchAndReturnX();
/*
dc("run_screen__save_new_item(), wibtypeInstanceHolderList_itemObj="+wibtypeInstanceHolderList_itemObj)
dc("run_screen__save_new_item(), exiting function...")
return
*/
  // if the wibtype-holder-instance-list does not exist yet, create it
  if (!wibtypeInstanceHolderList_itemObj) {
    let itemName = wb_getWibtypeInstanceHolderList_itemName(wibtypeItemObj_createdByUsageOfThisScreen.itemId);
    wibtypeInstanceHolderList_itemObj = makeNewItem(null, null, null, "0", "0", false, itemName, null, CONST_displayCode_hidden1, "1", app.wb_listOfWibtypeInstanceHolderLists_itemId);
    wibtypeInstanceHolderList_itemObj.assignToWibtype(wibtypeInstanceHolderWibtype_itemObj.itemId);
    //TO-DO2: if the wibtypeItemObj_createdByUsageOfThisScreen has wtifs, we might need/want to set their values here
  }
/*
dc("run_screen__save_new_item(), wibtypeInstanceHolderList_itemObj="+wibtypeInstanceHolderList_itemObj)
dc("run_screen__save_new_item(), exiting function...")
return
*/

  // create the wibtype-instance and assign to the wibtype
  var typeInstance_itemObj = makeNewItem(null, null, null, "0", "0", false, typeInstance_itemName, null, CONST_displayCode_hidden1, "0", wibtypeInstanceHolderList_itemObj.itemId);
  typeInstance_itemObj.assignToWibtype(wibtypeItemObj_createdByUsageOfThisScreen.itemId);


//TO-DO1:
//go to the list of items of this type, related to the builder screen, with the newly-created item highlighted?
app.wbs_curWibtype_itemObj = wibtypeItemObj_createdByUsageOfThisScreen;
displayPage("WibBuilder_ShowWibtypeInstances");
}

function wb_getWibtypeInstanceHolderList_itemName(wibtypeItemId_heldByThisWibtypeInstanceHolderList) {
  // the wibtype-instance-holder's item-name is in the format:
  // -> wb__WibtypeInstanceHolder__wibTypeItemId_X
  //      ... where X = the itemId of the wibtype whose instances this wibtype-instance-holder-list is holding
  //           (said wibtype-itemId is passed into this function)

  var wibtypeInstanceHolderList_itemName = "wb__WibtypeInstanceHolder__wibTypeItemId_" + wibtypeItemId_heldByThisWibtypeInstanceHolderList;

  return wibtypeInstanceHolderList_itemName;
}





function run_screen__build_this_screen() {
  displayPage("WibBuilder_BuildScreen");
}

function run_screen__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function set_ymd_to_today() {
  setElemsToToday("ipMakeNewItem_Year", "ipMakeNewItem_Month", "ipMakeNewItem_Day");
}

function show_dev_screen() {
  displayPage("Dev");
}

function show_instances__go_to_all_screens() {
  displayPage("WibBuilder_AllScreens");
}

function show_storage() {
  displayPage("ShowStorage");
}

function show_types() {
  displayPage("Wibtypes");
}

function toggle_app_narrow() {
  var curAppNarrow, newAppNarrow;

  curAppNarrow = getFromDatastore(CONST_appNarrow);

  if ( curAppNarrow == "1" ) {
    newAppNarrow = "0";
  } else {
    newAppNarrow = "1";
  }

  saveToDatastore(CONST_appNarrow, newAppNarrow);

  alert("app_narrow set to " + newAppNarrow);
}

function toggle_dev() {
  var curDevText1, newDevText1;

  curDevText1 = getFromDatastore(CONST_devText1);

  if (curDevText1 == "1") {
    newDevText1 = "0";
  } else {
    newDevText1 = "1";
  }

  saveToDatastore(CONST_devText1, newDevText1);

  alert("devText1 set to " + newDevText1);
}

function toggle_import_blocked() {
  var curImportBlocked, newImportBlocked;

  curImportBlocked = getFromDatastore(CONST_importBlocked);

  if ( curImportBlocked == "1" ) {
    newImportBlocked = "0";
  } else {
    newImportBlocked = "1";
  }

  saveToDatastore(CONST_importBlocked, newImportBlocked);

  alert("importBlocked set to " + newImportBlocked);
}

function toggle_more_options() {
  if (app.moreOptionsOn) {
    toggleGrabbing_off();
    elem("dvMoreOptions1").style.display = "none";
    elem("dvMoreOptions2").style.display = "none";
    elem("aMoreOptions1").innerHTML = "more...";
    elem("aMoreOptions2").innerHTML = "more...";
    app.moreOptionsOn = false;
  } else {
    elem("dvMoreOptions1").style.display = "";
    elem("dvMoreOptions2").style.display = "";
    elem("aMoreOptions1").innerHTML = "less...";
    elem("aMoreOptions2").innerHTML = "less...";
    app.moreOptionsOn = true;
  }
}

function toggle_reorder() {
  if (app.reorderingOn) {
    toggleReordering_off();
  } else {
    toggleGrabbing_off();
    toggleReordering_on()
  }
}


///// FUNCTIONS TO LOAD & UPGRADE APP-LEVEL DATA FROM STORAGE

function loadAppData_andReturnNextDisplayPage() {

  var homePageListItemObj, wibtypesItemObj, wibBuilderItemObj, wibBuilderScreen_wibtypeItemObj, wibBuilderScreenList_itemObj, timeTracking_wibtypeItemObj, wb_listOfWibtypeInstanceHolderLists_itemObj;
  var wb_wibtypeInstanceHolderWibtype_itemObj;

  app.addDataLoadedSuccessfully = false;

  /* if it does not exist, create the home-page-list item */ {
    homePageListItemObj = grabItemObjByName(CONST_listName_homePage);
    if ( isBlank(homePageListItemObj) ) {
      homePageListItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_listName_homePage, null, CONST_displayCode_hidden1, "1", null);
    }
    app.homePageList_itemId = homePageListItemObj.itemId;
  }

  /* if it does not exist, create the wibtypes-item */ {
    wibtypesItemObj = grabItemObjByName(CONST_listName_wibtypes);
    if ( isBlank(wibtypesItemObj) ) {
      wibtypesItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_listName_wibtypes, null, CONST_displayCode_hidden1, "1", null);
    }
    app.wibtypes_itemId = wibtypesItemObj.itemId;
  }

  /* if it does not exist, create the wib-builder item */ {
    wibBuilderItemObj = grabItemObjByName(CONST_wibBuilder_itemName);
    if ( isBlank(wibBuilderItemObj) ) {
      wibBuilderItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wibBuilder_itemName, null, CONST_displayCode_hidden1, "1", null);
    }
    app.wibBuilder_itemId = wibBuilderItemObj.itemId;
  }

  /* if it does not exist, create the wib-builder-screen wibtype-item and associated wtifs */ {
    wibBuilderScreen_wibtypeItemObj = grabItemObjByName(CONST_wbs_screenWibtype_itemName);
    if ( isBlank(wibBuilderScreen_wibtypeItemObj) ) {
      wibBuilderScreen_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wbs_screenWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
    }

    let wbs_ScreenTypeCode_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_wbs_screenWtifs_screenTypeCode_itemName, wibBuilderScreen_wibtypeItemObj.itemId, true);
    if ( isBlank(wbs_ScreenTypeCode_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wbs_screenWtifs_screenTypeCode_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
    }

    let wbs_wibtypeItemId_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_wbs_screenWtifs_wibtypeItemId_itemName, wibBuilderScreen_wibtypeItemObj.itemId, true);
    if ( isBlank(wbs_wibtypeItemId_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "0", "1", "0", true, CONST_wbs_screenWtifs_wibtypeItemId_itemName, null, CONST_displayCode_hidden1, "0", wibBuilderScreen_wibtypeItemObj.itemId); 
    }

    app.wbs_screensWibtype_itemId = wibBuilderScreen_wibtypeItemObj.itemId;
  }

  /* if it does not exist, create the wib-builder-screen-list item */ {
    wibBuilderScreenList_itemObj = grabItemObjByName(CONST_wbs_screenList_itemName);
    if ( isBlank(wibBuilderScreenList_itemObj) ) {
      wibBuilderScreenList_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wbs_screenList_itemName, null, CONST_displayCode_hidden1, "1", null);
    }
    app.wbs_screenListItemId = wibBuilderScreenList_itemObj.itemId;
  }

  /* if they do not exist, create the Time-Tracking wibtype and its wtifs */ {
    timeTracking_wibtypeItemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_itemName, app.wibtypes_itemId, true);

    if ( isBlank(timeTracking_wibtypeItemObj) ) {
      timeTracking_wibtypeItemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_timeTracking_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
    }

    let ttWtif_YMD_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifYMD_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_YMD_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_dateTime_id, "1", "1", "0", true, CONST_timeTracking_wtifYMD_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId); 
    }

    let ttWtif_Time_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifTime_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_Time_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_timeOfDay_id, "1", "1", "0", true, CONST_timeTracking_wtifTime_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId);
    }

    let ttWtif_MinsTracked_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_timeTracking_wtifMinsTracked_itemName, timeTracking_wibtypeItemObj.itemId, true);
    if ( isBlank(ttWtif_MinsTracked_itemObj) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "1", "1", "0", true, CONST_timeTracking_wtifMinsTracked_itemName, null, CONST_displayCode_hidden1, "0", timeTracking_wibtypeItemObj.itemId);
    }

    app.timeTracking_wibtypeItemId = timeTracking_wibtypeItemObj.itemId;
  }

  /* if it does not exist, create the wb-list-of-wibtype-instance-holder-lists item, the wibtype-instance-holder wibtype, and associated wtif */ {
    wb_listOfWibtypeInstanceHolderLists_itemObj = grabItemObjByName(CONST_wb_listOfWibtypeInstanceHolderLists_itemName);
    if ( isBlank(wb_listOfWibtypeInstanceHolderLists_itemObj) ) {
      wb_listOfWibtypeInstanceHolderLists_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "0", true, CONST_wb_listOfWibtypeInstanceHolderLists_itemName, null, CONST_displayCode_hidden1, "1", null);
    }
    app.wb_listOfWibtypeInstanceHolderLists_itemId = wb_listOfWibtypeInstanceHolderLists_itemObj.itemId;

    wb_wibtypeInstanceHolderWibtype_itemObj = searchForItemObj(null, null, null, null, null, null, CONST_wb_wibtypeInstanceHolderWibtype_itemName, app.wibtypes_itemId, true);
    if ( isBlank(wb_wibtypeInstanceHolderWibtype_itemObj) ) {
      wb_wibtypeInstanceHolderWibtype_itemObj = makeNewItem(CONST_doneStatusCode_okay, null, null, "0", "1", true, CONST_wb_wibtypeInstanceHolderWibtype_itemName, null, CONST_displayCode_hidden1, "1", wibtypesItemObj.itemId);
    }

    let wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId = searchForItemObj(null, null, null, null, null, null, CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, wb_wibtypeInstanceHolderWibtype_itemObj.itemId, true);
    if ( isBlank(wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId) ) {
      makeNewItem(CONST_doneStatusCode_okay, CONST_wibDataType_numeric_id, "1", "1", "0", true, CONST_wb_wibtypeInstanceHolderWibtype_wtif_wibtypeInstanceHeldItemId_itemName, null, CONST_displayCode_hidden1, "0", wb_wibtypeInstanceHolderWibtype_itemObj.itemId); 
    }
  }

  // set app current-item to home-page-list
  setAppItemObj(homePageListItemObj);

  if ( ! upgradeStoredData() ) return;

  // set version# on screen
  elem("spnAppHeader_AppNameAndVersion").innerHTML = "wib v" + CONST_appVersion;

  app.addDataLoadedSuccessfully = true;

  if (app.qs_obj.wibBuilder) {
    return "WibBuilder_AllScreens"
  } else {
    return "Home"
  }
}

function upgradeStoredData() {
  var appVersion_array, appVersion_major, appVersion_minor;
  var storedDataVersion_string, storedDataVersion_array, storedDataVersion_major, storedDataVersion_minor;

  //split app-version into major and minor
  appVersion_array = CONST_appVersion.split(".");
  appVersion_major = Number(appVersion_array[0]);
  appVersion_minor = Number(appVersion_array[1]);

  //establish existing version of the stored data
  storedDataVersion_string = getFromDatastore(CONST_storedDataVersion);
  if ( isBlank(storedDataVersion_string) ) storedDataVersion_string = "0.0";
  
  //split stored-data-version into major and minor
  storedDataVersion_array = storedDataVersion_string.split(".");
  storedDataVersion_major =  Number(storedDataVersion_array[0]);
  storedDataVersion_minor =  Number(storedDataVersion_array[1]);

  //warning if major version differs
  if ( !isEqual(appVersion_major, storedDataVersion_major) ) {
    alert("WARNING: app version is " + appVersion_major + ", stored data version is " + storedDataVersion_major + " ... no automatic data update available yet for major version upgrades");
    return false;
  }

  /* old stored-data upgrades, not compatible with existing loadAppData_andReturnNextDisplayPage() code, keeping for future reference */ {
    /*
    if (parseInt(appVersion_minor) >= 36 && parseInt(storedDataVersion_minor) < 36) {
      if ( upgradeStoredData_0_36() ) {
        // no action -- continue with function
      } else {
        return false;
      }
    }

    if (parseInt(appVersion_minor) >= 37 && parseInt(storedDataVersion_minor) < 37) {
      if ( upgradeStoredData_0_37() ) {
        // no action -- continue with function
      } else {
        return false;
      }
    }

    if (parseInt(appVersion_minor) >= 53 && parseInt(storedDataVersion_minor) < 53) {
      if ( upgradeStoredData_0_53() ) {
        // no action -- continue with function
      } else {
        return false;
      }
    }

    if (parseInt(appVersion_minor) >= 54 && parseInt(storedDataVersion_minor) < 54) {
      if ( upgradeStoredData_0_54() ) {
        // no action -- continue with function
      } else {
        return false;
      }
    }
    */
  }

  if (parseInt(appVersion_minor) >= 66 && parseInt(storedDataVersion_minor) < 66) {
    if ( upgradeStoredData_0_66() ) {
      // no action -- continue with function
    } else {
      return false;
    }
  }

  // if stored-data-version wasn't set from upgrade, and does not exist, set it to the current app-version
  storedDataVersion_string = getFromDatastore(CONST_storedDataVersion);
  if ( isBlank(storedDataVersion_string) ) saveToDatastore(CONST_storedDataVersion, CONST_appVersion);

  return true;
}

function upgradeStoredData_0_36() {
  var allItemIds_string, allItemIds_array, i, curItemId, saveKeyText_curItem, oldItemInfoString, newItemInfoString, storedDataVersion_string;

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
 
  //cycle through all items, add blank Notes field for each
  for (i = 0; i < allItemIds_array.length; i++) {
    curItemId = allItemIds_array[i];
    saveKeyText_curItem = getSaveKeyText_item(curItemId);
    oldItemInfoString = getFromDatastore(saveKeyText_curItem);
    newItemInfoString = oldItemInfoString + sD;
    saveToDatastore(saveKeyText_curItem, newItemInfoString);
  }

  //update data's version-number to 0.36
  saveToDatastore(CONST_storedDataVersion, "0.36");

  //return success flag
  return true;
}

function upgradeStoredData_0_37() {
  var allItemIds_string, allItemIds_array, i, j;

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
 
  //cycle through all items
  for (i = 0; i < allItemIds_array.length; i++) {
    let curItemId = allItemIds_array[i];
    let curItemObj = grabItemObj(curItemId);

    //for each item, if it is-list, cycle through list-members
    if (curItemObj.isList == "1") {
      let saveKeyText_listMembers_ofCurItem = getSaveKeyText_listMembers_ofItem(curItemId);
      let oldListMembers_string = getFromDatastore(saveKeyText_listMembers_ofCurItem);
      let oldListMembers_array = getIdArray(oldListMembers_string);
      let newListMembers_string = "";

      //add sort-position-number after each item-id
      for (j = 0; j < oldListMembers_array.length; j++) {
        if (newListMembers_string !== "") newListMembers_string += sD
        newListMembers_string += oldListMembers_array[j] + sD + String(j);
      }

      saveToDatastore(saveKeyText_listMembers_ofCurItem, newListMembers_string)
    }
  }

  //update data's version-number to 0.37
  saveToDatastore(CONST_storedDataVersion, "0.37");

  //return success flag
  return true;
}

function upgradeStoredData_0_53() {
  var allItemIds_string, allItemIds_array, i, curItemId, saveKeyText_curItem, oldItemInfoString, newItemInfoString, storedDataVersion_string;

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
 
  //cycle through all items, add isWibtype field for each
  // (isWibtype == "0" for all existing items, as no wibtypes have been created yet)
  for (i = 0; i < allItemIds_array.length; i++) {
    curItemId = allItemIds_array[i];
    saveKeyText_curItem = getSaveKeyText_item(curItemId);
    oldItemInfoString = getFromDatastore(saveKeyText_curItem);
    newItemInfoString = oldItemInfoString + sD + "0";
    saveToDatastore(saveKeyText_curItem, newItemInfoString);
  }

  //update data's version-number to 0.53
  saveToDatastore(CONST_storedDataVersion, "0.53");

  //return success flag
  return true;
}

function upgradeStoredData_0_54() {
  var allItemIds_string, allItemIds_array, i, curItemId, saveKeyText_curItem, oldItemInfoString, newItemInfoString;

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
 
  //cycle through all items, add isWibtypeInfoField field for each
  // (isWibtypeInfoField == "0" for all existing items, as no wibtypeInfoFields have been created yet)
  for (i = 0; i < allItemIds_array.length; i++) {
    curItemId = allItemIds_array[i];
    saveKeyText_curItem = getSaveKeyText_item(curItemId);
    oldItemInfoString = getFromDatastore(saveKeyText_curItem);
    newItemInfoString = oldItemInfoString + sD + "0";
    saveToDatastore(saveKeyText_curItem, newItemInfoString);
  }

  //update data's version-number to 0.54
  saveToDatastore(CONST_storedDataVersion, "0.54");

  //return success flag
  return true;
}

function upgradeStoredData_0_66() {
  var allItemIds_string, allItemIds_array;

  allItemIds_string = getFromDatastore(CONST_stringOfAllItemIds);
  allItemIds_array = getIdArray(allItemIds_string);
 
  //cycle through all items, swapping displayCode 0 and 1 for each other
  allItemIds_array.forEach( (curItemId) => {
    let curItemObj = grabItemObj(curItemId);

    let isHomePageList = isEqual(curItemObj.itemId, app.homePageList_itemId);
    let isTypesList = isEqual(curItemObj.itemId, CONST_listName_wibtypes);

    if ( isHomePageList || isTypesList || curItemObj.isWibtype == "1" || curItemObj.isWibtypeInfoField == "1" ) {
      //except don't swap for home-page-list, types, wib-types, and wib-type-info-fields
      curItemObj.displayCode = CONST_displayCode_hidden1;
    } else if (curItemObj.displayCode == "1") {
      curItemObj.displayCode = "0";
    } else if (curItemObj.displayCode == "0") {
      curItemObj.displayCode = "1";
    } else {
      curItemObj.displayCode = CONST_displayCode_normal;
    }

    curItemObj.saveItemInfoToDatastore();
  } ) ;

  //update data's version-number to 0.66
  saveToDatastore(CONST_storedDataVersion, "0.66");

  //return success flag
  return true;
}


///// FUNCTIONS TO LOAD APP-DATA AND CALL UP THE APPROPRIATE HOME PAGE

function runExampleQueryStringStuff() {
  // Assuming "?post=1234&action=edit"

  var urlParams = new URLSearchParams(window.location.search);

  console.log(urlParams.has('post')); // true
  console.log(urlParams.get('action')); // "edit"
  console.log(urlParams.getAll('action')); // ["edit"]
  console.log(urlParams.toString()); // "?post=1234&action=edit"
  console.log(urlParams.append('active', '1')); // "?post=1234&action=edit&active=1"

  var keys = urlParams.keys();
  for(var key of keys) { 
    console.log(key); 
  }
  // post
  // action

  var entries = urlParams.entries();
  for(var pair of entries) { 
    console.log(pair[0], pair[1]); 
  }
}

function processQueryString() {
  app.qs_urlParams = new URLSearchParams(window.location.search);

  app.qs_obj = {};
  app.qs_obj.wibBuilder = app.qs_urlParams.has("builder");
  app.qs_obj.dev = app.qs_urlParams.has("dev");
}

function startApp() {
  processQueryString();

  let nextDisplayPage = loadAppData_andReturnNextDisplayPage();

  //only show home page is appLevelData loaded successfully
  if ( app.addDataLoadedSuccessfully ) {
    displayPage(nextDisplayPage);
  }
}

startApp();


///// SAVED FROM PREVIOUS PROJECTS, MIGHT USE LATER

/* (commented-out, as we are not currently using this)
// MODULE-LEVEL ERROR HANDLING - TOP
try {

var KEY_NAME_alt = "alt" ;
var KEY_NAME_backspace = "backspace" ;
var KEY_NAME_ctrl = "ctrl" ;
var KEY_NAME_delete = "delete" ;
var KEY_NAME_down_arrow = "down arrow" ;
var KEY_NAME_end = "end" ;
var KEY_NAME_enter = "enter" ;
var KEY_NAME_esc = "esc" ;
var KEY_NAME_home = "home" ;
var KEY_NAME_left_arrow = "left arrow" ;
var KEY_NAME_page_down = "page down" ;
var KEY_NAME_page_up = "page up" ;
var KEY_NAME_right_arrow = "right arrow" ;
var KEY_NAME_shift = "shift" ;
var KEY_NAME_spacebar = "spacebar" ;
var KEY_NAME_tab = "tab" ;
var KEY_NAME_up_arrow = "up arrow" ;

var page_keyMonitoring = false ;
var page_pauseKeyInput = false ;
var page_sendKeyToCharacter = false ;

var page_escKeyJsFunc = "" ;

var page_curTheKeyDown = null ;
var page_curTheKeyPress = null ;

function getInputElem ( idName , width , defValue ) {
	try {
		var html = "<input id='" + idName + "' name='" + idName + "' type='text' class='input1' style='width: " + width + "' value='" + defValue + "'" ;
		html += " onfocus='keysAllow()' onblur='keysBlock()'/>" ;
		return html ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


function processKeyDown_master ( e ) {
	try {
		var eventObject = window.event ? event : e ;  // distinguish between IE's explicit event object (window.event) and Firefox's implicit
		var keyCode = eventObject.keyCode ;
		var keyDownName = "" ;

		if ( (keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) ) {
			keyDownName = String.fromCharCode ( keyCode ) ;
		} else {
			switch ( keyCode ) {
				case 8 : keyDownName = KEY_NAME_backspace  ; break ;
				case 9 : keyDownName = KEY_NAME_tab ; break ;
				case 13 : keyDownName = KEY_NAME_enter ; break ;
				case 16 : keyDownName = KEY_NAME_shift ; break ;
				case 17 : keyDownName = KEY_NAME_ctrl  ; break ;
				case 18 : keyDownName = KEY_NAME_alt ; break ;
				case 27 : keyDownName = KEY_NAME_esc ; break ;
				case 32 : keyDownName = KEY_NAME_spacebar ; break ;
				case 33 : keyDownName = KEY_NAME_page_up ; break ;
				case 34 : keyDownName = KEY_NAME_page_down ; break ;
				case 35 : keyDownName = KEY_NAME_end ; break ;
				case 36 : keyDownName = KEY_NAME_home ; break ;
				case 37 : keyDownName = KEY_NAME_left_arrow  ; break ;
				case 38 : keyDownName = KEY_NAME_up_arrow ; break ;
				case 39 : keyDownName = KEY_NAME_right_arrow ; break ;
				case 40 : keyDownName = KEY_NAME_down_arrow ; break ;
				case 46 : keyDownName = KEY_NAME_delete ; break ;
				default:
					try {
						console.log ( "keyCode: " + keyCode ) ;
					} catch ( e_inside1 ) {
						// no action -- error is acceptable
					}
			}
		}

		page_curTheKeyDown = new TheKeyDown ( keyDownName , eventObject.ctrlKey , eventObject.altKey , eventObject.shiftKey , eventObject ) ;

		try {
			processKeyDown_page ( page_curTheKeyDown ) ;
		} catch ( e_inside2 ) {
			// no action, error is acceptable
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyDown_page ( theKeyDown ) {
	try {
		var direction ;

		if ( 
		  theKeyDown.keyDownName == KEY_NAME_backspace
		  || theKeyDown.keyDownName == KEY_NAME_spacebar
		  || theKeyDown.keyDownName == KEY_NAME_down_arrow
		  || theKeyDown.keyDownName == KEY_NAME_left_arrow
		  || theKeyDown.keyDownName == KEY_NAME_right_arrow
		  || theKeyDown.keyDownName == KEY_NAME_up_arrow
		  || theKeyDown.keyDownName == KEY_NAME_page_down
		  || theKeyDown.keyDownName == KEY_NAME_page_up
		  || ( theKeyDown.keyDownName == "A" && theKeyDown.ctrl && ! showingLocalStorage )
		) {
			if ( ! control.allowKeys ) theKeyDown.stopEvent ( ) ;
		}

		if ( page_pauseKeyInput ) return ;

		if ( screens.curScreen ) {
			screens.curScreen.processKeyDown ( theKeyDown ) ;
			return ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyPress_master ( e ) {
	try {
		var eventObject = window.event ? event : e ; // distinguish between IE's explicit event object (window.event) and Firefox's implicit
		var keyCode = eventObject.keyCode ;
		var charCode = eventObject.charCode ;
		var ctrlKey = eventObject.ctrlKey ;
		var altKey = eventObject.altKey ;
		var shiftKey = eventObject.shiftKey ;
		var keyPressName ;

		//alert("keyCode="+keyCode+" --- charCode="+charCode+" --- ctrlKey="+ctrlKey+" --- altKey="+altKey+" --- shiftKey="+shiftKey)

		if ( charCode ) {
			keyPressName = String.fromCharCode ( charCode ) ;
		} else {
			switch ( keyCode ) {
				case 8 : keyPressName = KEY_NAME_backspace  ; break ;
				case 9 : keyPressName = KEY_NAME_tab ; break ;
				case 13 : keyPressName = KEY_NAME_enter ; break ;
				case 27 : keyPressName = KEY_NAME_esc ; break ;
				case 32 : keyPressName = KEY_NAME_spacebar ; break ;
				case 33 : keyPressName = KEY_NAME_page_up ; break ;
				case 34 : keyPressName = KEY_NAME_page_down ; break ;
				case 35 : keyPressName = KEY_NAME_end ; break ;
				case 36 : keyPressName = KEY_NAME_home ; break ;
				case 37 : keyPressName = KEY_NAME_left_arrow  ; break ;
				case 38 : keyPressName = KEY_NAME_up_arrow ; break ;
				case 39 : keyPressName = KEY_NAME_right_arrow ; break ;
				case 40 : keyPressName = KEY_NAME_down_arrow ; break ;
				case 46 : keyPressName = KEY_NAME_delete ; break ;
				default:
					try {
						console.log ( "keyCode="+keyCode+" --- charCode="+charCode+" --- ctrlKey="+ctrlKey+" --- altKey="+altKey+" --- shiftKey="+shiftKey ) ;
					} catch ( e_inside1 ) {
						// no action -- error is acceptable
					}
			}
		}

		page_curTheKeyPress = new TheKeyPress ( keyPressName , ctrlKey , altKey , shiftKey ) ;
		try {
			processKeyPress_page ( page_curTheKeyPress ) ;
		} catch ( e_inside2 ) {
			// no action, error is acceptable
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function processKeyPress_page ( theKeyPress ) {
	try {
		if ( page_pauseKeyInput ) return ;

		if ( screens.curScreen ) {
			screens.curScreen.processKeyPress ( theKeyPress ) ;
			return ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function startKeyMonitoring ( ) {
	try {
		page_keyMonitoring = true ;
		page_sendKeyToCharacter = true ;
		document.onkeydown = processKeyDown_master ;
		document.onkeypress = processKeyPress_master ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function TheKeyDown ( keyDownName , ctrl , alt , shift , eventObject ) {
	try {
		this.keyDownName = String(keyDownName) ;
		this.ctrl = ctrl ;
		this.alt = alt ;
		this.shift = shift ;
		this.eventObject = eventObject ;
		
		this.stopEvent = function ( ) {
			this.eventObject.preventDefault ( ) ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function TheKeyPress ( keyPressName , ctrlKey , altKey , shiftKey ) {
	try {
		this.keyPressName = keyPressName ;
		this.ctrlKey = ctrlKey ;
		this.altKey = altKey ;
		this.shiftKey = shiftKey ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


startKeyMonitoring() ;


// MODULE-LEVEL ERROR HANDLING - BOTTOM
} catch ( e ) {
	throw ( handleAndReturnError ( e ) ) ;
}



///////////////
///////////////


function add ( startingValue , amountToAdd1 , amountToAdd2 , amountToAdd3 ) {
	try {
		if ( ! isNumeric(startingValue) ) startingValue = 0 ; // throw ( "add(), received invalid startingValue=" + startingValue ) ;
		if ( ! isNumeric(amountToAdd1) ) amountToAdd1 = 0 ; // throw ( "add(), received invalid amountToAdd1=" + amountToAdd1 ) ;

		var newValue = parseFloat(startingValue) + parseFloat(amountToAdd1) ;

		if ( isNumeric(amountToAdd2) ) newValue = parseFloat(newValue) + parseFloat(amountToAdd2) ;

		if ( isNumeric(amountToAdd3) ) newValue = parseFloat(newValue) + parseFloat(amountToAdd3) ;

		return newValue ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


function confirmInput ( elem , valueName , isRequired , minVal , maxVal ) {
	try {
		var val = elem.value ;

		if ( isRequired && ! val ) {
			alert ( valueName + " is required." ) ;
			elem.focus() ;
			return false ;
		}

		if ( ! isNumeric(minVal) ) minVal = null ;
		if ( ! isNumeric(maxVal) ) maxVal = null ;

		if ( ( minVal || maxVal ) && val && ! isNumeric(val) ) {
			alert ( valueName + " requires a numeric value." ) ;
			elem.focus() ;
			return false ;
		}

		if ( minVal && val && val < minVal ) {
			alert ( valueName + " must be at least " + getNumberWithCommas(minVal) + "." ) ;
			elem.focus() ;
			return false ;
		}

		if ( maxVal && val && val > maxVal ) {
			alert ( valueName + " must be no more than " + getNumberWithCommas(maxVal) + "." ) ;
			elem.focus() ;
			return false ;
		}

		return true ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getElem ( elem_OR_elemId ) {
	try {
		var testElemId , elem ;

		testElemId = getProp ( elem_OR_elemId , "id" ) ;

		if ( testElemId ) {
			elem = elem_OR_elemId ;
		} else {
			elem = document.getElementById ( elem_OR_elemId ) ;
		}

		return elem ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

function getElemPxAsNumber ( elemPx ) {
	try {
		var elemPx = String(elemPx) ;
		var asNumber = withoutRight ( elemPx , "px" ) ;
		return asNumber ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

// this function from http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript
function getNumberWithCommas ( x ) {
	try {
		if ( ! x ) return 0 ;
		
		var y = String(x) ;

		var parts = y.split(".") ;
		parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",") ;

		var z = parts.join(".") ; 

		return z ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getProp ( item , propertyName ) {
	try {
		var propertyValue ;
		try {
			propertyValue = item[propertyName] ;
		} catch ( e ) {
		}
		return propertyValue ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getRandomNumber ( max , min ) {
	try {
		if ( ! min ) min = 1 ;

		max = 1 * max ;
		min = 1 * min ;

		if ( min > max ) {
			var temp = min ;
			min = max ;
			max = temp ;   
		}
		
		var diff = max - min ;
		var diffPlusOne = (diff + 1) ;
		
		var tempRandomNum = Math.floor ( Math.random() * diffPlusOne ) ;

		var finalRandomNum = (tempRandomNum + min) ;
		return finalRandomNum ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function handleError_OLD ( squex ) {
	try {
		if ( ! squex.alerted ) {
			var msg = squex.ex.fileName + "\n" ;
			msg += "\n" ;
			msg += "LINE: " + squex.ex.lineNumber + "\n" ;
			msg += "COLUMN: " + squex.ex.columnNumber + "\n" ;
			msg += "\n" ;
			msg += ex ;
			msg += "\n" ;

			alert ( msg ) ;
		}
		
		throw ( squex ) ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function isBlank ( val ) {
	try {
		if ( val === 0 || val === "0" ) return false ;
		if ( ! val ) return true ;
		return false ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function isNumeric ( val ) {
	try {
		if ( isBlank(val) ) return false ;

		return val == val * 1 ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function isSame ( val1 , val2 ) {
	try {
		if ( ( val1 === 0 || val1 === "0" ) && ( val2 === 0 || val2 === "0" ) ) return true ;
		if ( ( val1 === 0 || val1 === "0" ) && ! ( val2 === 0 || val2 === "0" ) ) return false ;
		if ( ! ( val1 === 0 || val1 === "0" ) && ( val2 === 0 || val2 === "0" ) ) return false ;

		if ( ! val1 && ! val2 ) return true ;

		if ( Number ( val1 ) == Number ( val2 ) ) return true ;

		if ( val1 == val2 ) return true ;

		return false ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

function left ( str , numChars ) {
	try {
		if ( typeof str !== "string" ) return null ;
		if ( ! isNumeric(numChars) ) return null ;
		if ( numChars < 0 ) return null ;
		if ( isSame(numChars,0) ) return "" ;
		if ( numChars > str.length ) return str ;
		var theLeft = str.substr ( 0 , numChars ) ;
		return theLeft ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function leftIs ( haystack , needle ) {
	try {
		if ( typeof haystack !== "string" ) return false ;
		if ( typeof needle !== "string" ) return false ;

		var lenNeedle = needle.length ;

		if ( isSame(lenNeedle,0) ) {
			if ( isSame(haystack.length,0) ) {
				return true ;
			} else {
				return false ;
			}
		}

		var haystackLeft = left ( haystack , lenNeedle ) ;

		return isSame(haystackLeft,needle) ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function right ( str , numChars ) {
	try {
		if ( typeof str !== "string" ) return null ;
		if ( ! isNumeric(numChars) ) return null ;
		if ( numChars < 0 ) return null ;
		if ( isSame(numChars,0) ) return "" ;
		if ( numChars > str.length ) return str ;
		return str.substr ( str.length - numChars ) ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function rightIs ( haystack , needle ) {
	try {
		if ( typeof haystack !== "string" ) return false ;
		if ( typeof needle !== "string" ) return false ;

		var lenNeedle = needle.length ;

		if ( isSame(lenNeedle,0) ) {
			if ( isSame(haystack.length,0) ) {
				return true ;
			} else {
				return false ;
			}
		}

		var haystackRight = right ( haystack , lenNeedle ) ;

		return isSame(haystackRight,needle) ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function eval2 ( val ) {
	return val ;
}

function runJsFuncWithArgs ( jsFunc , args ) {
	try {
//alert("runJsFuncWithArgs() --- jsFunc.name="+jsFunc.name)
		if ( args ) {
			if ( getProp ( args , "arg5" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) , eval(args.arg4) , eval(args.arg5) )  ;
			} else if ( getProp ( args , "arg4" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) , eval(args.arg4) )  ;
			} else if ( getProp ( args , "arg3" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) , eval(args.arg3) )  ;
			} else if ( getProp ( args , "arg2" ) ) {
				jsFunc ( eval(args.arg1) , eval(args.arg2) )  ;
			} else {
				jsFunc ( eval(args.arg1) )  ;
			}
		} else {
			jsFunc() ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function setElem ( elemId , val ) {
	try {
		var elem = getElem(elemId) ;
		if ( ! elem ) throw ( sqErrTxt ( "setFocusToLink() --- invalid elemId received ('" + elemId + "')" ) ) ;

		if ( isBlank(val) ) val = "" ;

		elem.value = val ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function setFocusToElem ( elemId , doSelect ) {
	try {
		var elem = getElem(elemId) ;
		if ( ! elem ) throw ( sqErrTxt ( "setFocusToLink() --- invalid elemId received ('" + elemId + "')" ) ) ;

		elem.focus() ;

		if ( doSelect && elem.select ) {
			elem.select() ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function showAllProperties ( theObj ) {
	try {
		var propName ;
		for ( propName in theObj ) {
			alert ( propName + " --- " + theObj[propName] ) ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function withoutLeft ( haystack , needle ) {
	try {
		if ( typeof haystack !== "string" ) return "" ;
		if ( typeof needle !== "string" ) return haystack ;

		var lenNeedle = needle.length ;

		if ( isSame(lenNeedle,0) ) {
			return haystack ;
		}

		var haystackLeft = left ( haystack , lenNeedle ) ;

		if ( isSame(haystackLeft,needle) ) {
			return haystack.substr ( lenNeedle ) ;
		} else {
			return haystack ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function withoutRight ( haystack , needle ) {
	try {
		if ( typeof haystack !== "string" ) return "" ;
		if ( typeof needle !== "string" ) return haystack ;

		var lenNeedle = needle.length ;

		if ( isSame(lenNeedle,0) ) {
			return haystack ;
		}

		var haystackRight = right ( haystack , lenNeedle ) ;

		if ( isSame(haystackRight,needle) ) {
			return haystack.substr ( 0 , haystack.length - lenNeedle ) ;
		} else {
			return haystack ;
		}
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


// SQUONCH DATE/TIME

sqDateTime = {} ;

sqDateTime.getText = function ( ) {
	try {
		var text = this.yyyy + this.mm + this.dd + this.hh + this.nn + this.ss + this.ms ;
		return text ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
} ;

function getSqDateTime_fromText ( textOfSqDateTime ) {
	if ( ! textOfSqDateTime ) throw ( sqErrTxt ( "getSqDateTime_fromText(), textOfSqDateTime is blank" ) ) ;

	try {
		textOfSqDateTime = String(textOfSqDateTime) ;

		var yyyy = textOfSqDateTime.substr ( 0 , 4 ) ;
		var mm = textOfSqDateTime.substr ( 4 , 2 ) ;
		var dd = textOfSqDateTime.substr ( 6 , 2 ) ;
		var hh = textOfSqDateTime.substr ( 8 , 2 ) ;
		var nn = textOfSqDateTime.substr ( 10 , 2 ) ;
		var ss = textOfSqDateTime.substr ( 12 , 2 ) ;
		var ms = textOfSqDateTime.substr ( 14 , 3 ) ;

		var sqdt = Object.create ( sqDateTime ) ;

		sqdt.yyyy = yyyy ;
		sqdt.mm = mm ;
		sqdt.dd = dd ;
		sqdt.hh = hh ;
		sqdt.nn = nn ;
		sqdt.ss = ss ;
		sqdt.ms = ms ;

		return sqdt ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getSqDateTime_fromJsDateTime ( jsDateTime ) {
	if ( ! jsDateTime ) throw ( sqErrTxt ( "getSqDateTime_fromText(), jsDateTime is blank" ) ) ;

	try {
		var yyyy = jsDateTime.getFullYear();
		var mm = jsDateTime.getMonth ( ) + 1 ; // January is 0
		var dd = jsDateTime.getDate ( ) ;
		var hh = jsDateTime.getHours ( ) ;
		var nn = jsDateTime.getMinutes ( ) ;
		var ss = jsDateTime.getSeconds ( ) ;
		var ms = jsDateTime.getMilliseconds ( ) ;

		if ( mm < 10 ) mm = "0" + mm
		if ( dd < 10 ) dd = "0" + dd
		if ( hh < 10 ) hh = "0" + hh
		if ( nn < 10 ) nn = "0" + nn
		if ( ss < 10 ) ss = "0" + ss

		if ( ms < 100 ) {
			ms = "0" + ms
		} else if ( ms < 10 ) {
			ms = "00" + ms ;
		}

		var sqdt = Object.create ( sqDateTime ) ;

		sqdt.yyyy = yyyy ;
		sqdt.mm = mm ;
		sqdt.dd = dd ;
		sqdt.hh = hh ;
		sqdt.nn = nn ;
		sqdt.ss = ss ;
		sqdt.ms = ms ;

		return sqdt ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}

function getSqDateTime_now ( ) {
	try {
		var sqdt = getSqDateTime_fromJsDateTime ( new Date() ) ;
		return sqdt ;
	} catch ( e ) {
		throw ( handleAndReturnError ( e ) ) ;
	}
}


// ERROR HANDLING

var Squerror = Object.create ( Error ) ;

Squerror.doAlert = function ( ) {
	var msg = "" ;

	if ( this.ex ) {
		var fileName = getProp ( this.ex , "fileName" ) ;
		if ( fileName ) {
			msg = fileName + "\n" ;
			msg += "\n" ;
		}

		var lineNumber = getProp ( this.ex , "lineNumber" ) ;
		var columnNumber = getProp ( this.ex , "columnNumber" ) ;
		if ( lineNumber && columnNumber ) {
			msg += "LINE: " + lineNumber + " / COLUMN: " + columnNumber + "\n" ;
			msg += "\n" ;
		}
	}

	msg += this.message + "\n" ;
	msg += "\n" ;

	alert ( msg ) ;

	this.alerted = true ;
} ;

function createSquerrorFromException ( ex ) {
	var squerror = Object.create ( Squerror ) ;

	squerror.isSquerror = true ;
	squerror.ex = ex ;

	var message = ex ;
	if ( ! message ) message = "" ;
	try {
		message = String(message) ;
	} catch ( e ) {
		// no action
	}
	squerror.message = message ;

	squerror.alerted = false ;

	return squerror ;
}

function createSquerrorFromText ( text ) {
	var squerror = Object.create ( Squerror ) ;

	squerror.isSquerror = true ;
	squerror.ex = null ;

	if ( ! text ) text = "" ;
	try {
		text = String(text) ;
	} catch ( e ) {
		// no action
	}
	squerror.message = text ;

	squerror.alerted = false ;

	return squerror ;
}

var sqErrTxt = createSquerrorFromText ;

function handleAndReturnError ( theObj ) {
	var newObj ;

	if ( getProp ( theObj , "isSquerror" ) ) {
		newObj = theObj ;
	} else {
		newObj = createSquerrorFromException ( theObj ) ;
	}

	if ( ! newObj.alerted ) {
		newObj.doAlert() ;
	}

	return newObj ;
}


// MODULE-LEVEL ERROR HANDLING - BOTTOM
} catch ( e ) {
	throw ( handleAndReturnError ( e ) ) ;
}


*/


</script>

</body>
</html>
